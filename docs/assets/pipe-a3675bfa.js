import{_ as e}from"./plane-device-c0c5b828.js";import{d as t,o as s,a as l,l as i,w as a,e as n,n as o,P as d,r as c,k as p,i as r,F as y,j as u,A as v,B as m,b as x,q as f,u as h,ar as g,bh as _,c as k,L as w,av as b,C as $,t as C,s as L,m as D,J as z,bi as M,H as V,a3 as T,ac as j,a6 as X,a7 as I,bj as Q,bk as O}from"./vendor-6db95a6f.js";import{h as B,i as E}from"./ep-3bf59634.js";import{a as P}from"./data-07702360.js";import{D as S,a as U,P as A}from"./config-4f270d6d.js";import{_ as H}from"./_plugin-vue_export-helper-1b428a4d.js";import{f as J}from"./common-04bb9be1.js";import{a as F,c as N}from"./modules-49818129.js";const G={title:"pipe",order:10},K=H(t({__name:"line-point",props:{x:{},y:{},isEnd:{type:Boolean},isStart:{type:Boolean},isX:{type:Boolean}},emits:["mousedown","direction"],setup(e,{emit:t}){const d=t;return(e,t)=>(s(),l("div",{class:i({[e.$style.point]:!0,[e.$style["is-end"]]:e.isEnd,[e.$style["is-x"]]:!e.isEnd&&e.isX,[e.$style["is-y"]]:!e.isEnd&&!e.isX}),style:o({left:`${e.x}px`,top:`${e.y}px`}),onMousedown:t[1]||(t[1]=a((e=>d("mousedown",e)),["stop"]))},[e.isEnd?(s(),l("div",{key:0,class:i({[e.$style["point-direction"]]:!0,[e.$style["d-x"]]:e.isX,[e.$style["d-y"]]:!e.isX,[e.$style["is-start"]]:e.isStart}),onMousedown:t[0]||(t[0]=a((e=>d("direction",e)),["stop"]))},null,34)):n("",!0)],38))}}),[["__cssModules",{$style:{point:"_point_nafi7_2","is-end":"_is-end_nafi7_12","is-x":"_is-x_nafi7_16","is-y":"_is-y_nafi7_19","point-direction":"_point-direction_nafi7_22","d-x":"_d-x_nafi7_26","d-y":"_d-y_nafi7_33"}}]]),R=[x("span",null,"你的浏览器不支持 canvas，请升级你的浏览器。",-1)],Y=["width","height"],W=["stroke","stroke-width","d"],q={key:0,attributeName:"stroke-dashoffset",values:"0;-120",dur:"2s",repeatCount:"indefinite"},Z=H(t({__name:"pipe",props:{list:{},active:{},type:{},width:{default:6},scale:{},gap:{default:2},display:{type:Boolean},hideType:{},locked:{type:Boolean},animate:{type:Boolean}},emits:["click","mousedown","mouseup","change"],setup(e,{expose:t,emit:a}){const k=e,w=a;d((()=>k.list),(async()=>{ee(),await _(),N()}),{deep:!0});const b=c([]),$=c(),C=p({isPointer:!1,isMove:!1,list:[]}),L=e=>{const t=$.value.parentNode.parentNode.parentNode.getBoundingClientRect(),s=k.scale??1,l=(e.clientX-t.x)/s,i=(e.clientY-t.y)/s,a=b.value;let n=!1,o=-1;for(let d=0;d<a.length;d++){const e=a[d],t=C.list[d];if(!t)break;const s=t.style||{},c=e.getContext("2d"),p=l-(s.x??0),r=i-(s.y??0);if(n=c.isPointInStroke(p,r),n){o=d;break}}return{isInside:n,index:o}},D=e=>{const t=L(e).isInside;C.isPointer=t},z=e=>{const{isInside:t,index:s}=L(e);t&&(e.stopPropagation(),e.preventDefault(),w("mousedown",e,s,C.list[s],k.type))},M=e=>{var t;return!k.display||!(null==(t=k.hideType)?void 0:t.includes(e.type))},V=()=>(k.width??6)+2*(k.gap??0),T=e=>{const t=E.i,s=C.list[e],l=s.paths.length;return l==s.points.length?t:t==l?l-1:0==t?0:t-1};let j=.5;const X=e=>{if(e>C.list.length-1)return;const t=C.list[e],s=V()/2,l=t.paths,i=l.length;let a=0,n=0,o=l[0].x,d=l[0].y;for(let c=i-1;c>=0;c--){const t=l[c];if(!t)break;const{x:s,y:p}=t;s>a&&(a=s),p>n&&(n=p),o>s&&(o=s),d>p&&(d=p);const r=l[c-1];if(!r)break;const{x:y,y:u}=r;if(y!=s&&u!=p&&i<=2){const t=(s-y)/2+y,i={x:t,y:u},a={x:t,y:p};c==T(e)&&(E.i+=2),l.splice(c,0,i,a)}l.length>2&&(s==y&&p==u||Math.abs(s-y)<=j&&Math.abs(p-u)<=j&&(t.moved||te))&&(c<=E.i&&(E.i-=1),l[c].moved=!0,l.splice(c-1,1));const v=l[c+1];v&&((v.x==t.x&&t.x==r.x&&(v.y>t.y&&t.y>r.y||v.y<t.y&&t.y<r.y)||v.y==t.y&&t.y==r.y&&(v.x>t.x&&t.x>r.x||v.x<t.x&&t.x<r.x))&&(E.i-c>2||te)&&(E.i-=1,l.splice(c,1)))}o>s&&Q(e,o-s),d>s&&O(e,d-s),(e=>{const t=C.list[e].paths;if(t.length<=2)return;const s=T(e),l=t[s],i=0==s?1:-1,a=t[s+i];if(!a)return;let{x:n,y:o}=a,{x:d,y:c}=l;d!==n&&(o=c),t[s+i].y=o})(e),t.width=a+s,t.height=n+s},I=(e,t)=>{const{x:s,y:l}=e,i=C.list[t],a=T(t),n=V()/2,o=i.paths,d=o.length;if(0==a||a==d-1){const e=0==a?a:d-1;let{x:c,y:p}=o[e];c+=s,p+=l,p<n&&(O(t,p-n),p=n),c<n&&(Q(t,c-n),c=n);i.paths[e].moved&&!E.isDire?((e,t)=>{const s=C.list[e].paths,l=s.length,i=T(e),{x:a,y:n,moved:o}=s[i];if(!o)return;const d=s[i+1];if(0==i&&d)if(d.moved){const e=(t.y-n)/2+n,l={x:t.x,y:t.y},o={x:a,y:e};s.splice(i+1,0,l,o)}else s[i].x=t.x,s[i].y=t.y;if(i==l-1){const l={x:a,y:(t.y-n)/2+n},o={x:a,y:t.y};i==T(e)&&(E.i+=2),s.splice(i+1,0,l,o)}})(t,{x:c,y:p}):(i.paths[e].x=c,i.paths[e].y=p)}X(t)},Q=(e,t)=>{const s=C.list[e];s.style.x+=t;const l=s.paths;for(let i=0;i<l.length;i++)l[i].x-=t},O=(e,t)=>{const s=C.list[e];s.style.y+=t;const l=s.paths;for(let i=0;i<l.length;i++)l[i].y-=t},B=e=>{const{index:t,i:s}=E;let{x:l,y:i}=e;const a=k.scale??1;l/=a,i/=a;const n=C.list[t].points;0==s||s==n.length-1?I({x:l,y:i},t):(e=>{const{index:t,i:s}=E,l=C.list[t].paths,i=l[s],a=l[s-1];if(!i||!a)return;const n=V()/2;if(Z(i,a)){let a=i.y+e.y;a<n&&(O(t,a-n),a=n),l[s].y=a,l[s-1].y=a}else{let a=i.x+e.x;a<n&&(Q(t,a-n),a=n),l[s].x=a,l[s-1].x=a}l[s].moved=!0,l[s-1].moved=!0,X(t)})({x:l,y:i})},E={x:0,y:0,index:-1,i:-1,isDire:!1,isX:!1},P=e=>{let t=!Boolean(e.changedTouches);const s=t?e:e.changedTouches[0];return{x:s[t?"clientX":"pageX"],y:s[t?"clientY":"pageY"]}},S=e=>{const t=E.isDire,s=E.isX,{x:l,y:i}=P(e),a={x:l-E.x,y:i-E.y};t&&(s?a.y=0:a.x=0),B(a),E.x=l,E.y=i},U=()=>{E.i=-1},A=(e,t,s)=>{E.isDire=!1;const{x:l,y:i}=P(e);E.x=l,E.y=i,E.i=s,E.index=t,document.body.onmousemove=e=>{S(e)},document.body.onmouseleave=H,document.body.onmouseup=H},H=e=>{E.i<0||(S(e),document.body.onmousemove=null,document.body.onmouseup=null,document.body.onmouseleave=null,w("change"))},J=(e,t)=>{const s=Number(`0x${e.substring(1)}`);return`rgba(${s>>16&255}, ${s>>8&255}, ${255&s}, ${t})`},F=(e,t)=>{const s=window.devicePixelRatio??1,{x:l,y:i}=t;e.lineTo(l*s,i*s)},N=()=>{b.value.forEach(((e,t)=>{(e=>{const t=window.devicePixelRatio??1,s=b.value[e];if(!s)return;const l=C.list[e];s.width=l.width*t,s.height=l.height*t;const i=s.getContext("2d");if(!s.getContext)return;l.paths.forEach(((e,s)=>{if(0==s){const{x:s,y:l}=e;i.moveTo(s*t,l*t)}else F(i,e)})),i.lineWidth=V()*t,i.strokeStyle=J(l.color,.4),i.stroke()})(t)}))},G=(e,t)=>{const s=C.list[e].paths,l=s.length;let i=-1;0==t?i=1:t>=l&&(t=l-1);const a=s[t],n=s[t+i];return Z(a,n)},Z=(e,t)=>e.y==t.y,ee=()=>{C.list=k.list.map((e=>{const t=g(e);return t.points=(e=>{let t=[];for(let s=0;s<e.length;s++){const l=e[s];if((0==s||s==e.length-1)&&(t.push([l.x,l.y]),s==e.length-1))break;const{x:i,y:a}=l,n=e[s+1],{x:o,y:d}=n;Z(l,n)?t.push([(o-i)/2+i,d]):t.push([o,(d-a)/2+a])}return t})(t.paths),t}))};let te=!1;return ee(),r(N),t({optimize:()=>{const e=j;j=2,te=!0,E.i=0,b.value.forEach(((e,t)=>{X(t)})),j=e,te=!1}}),(e,t)=>(s(),l("div",{ref_key:"pipeRef",ref:$,class:i({[e.$style.pipes]:!0,[e.$style["is-locked"]]:e.locked,[e.$style["is-pointer"]]:h(C).isPointer}),onMousemove:D,onMousedown:z},[(s(!0),l(y,null,u(h(C).list,((t,a)=>{return v((s(),l("div",{key:a,style:o({left:`${t.style.x}px`,top:`${t.style.y}px`,marginTop:`${t.my}px`,marginLeft:`${t.mx}px`,zIndex:t.zIndex}),class:i({[e.$style.item]:!0,[e.$style["is-active"]]:e.active==a})},[x("div",{class:i(e.$style["item-wrap"]),style:o({width:`${t.width}px`,height:`${t.height}px`}),onMousedown:U,onMouseup:H},[x("canvas",{ref_for:!0,ref:e=>((e,t)=>{b.value[t]=e})(e,a)},R,512),(s(),l("svg",{width:t.width,height:t.height},[x("path",{stroke:J(t.color,.8),"stroke-width":e.width,"stroke-dasharray":"20,20",fill:"transparent",d:(d=t.paths,d.map(((e,t)=>`${0==t?"M":"L"}${e.x} ${e.y}`)).join(" "))},[e.animate?(s(),l("animate",q)):n("",!0)],8,W)],8,Y)),e.active==a?(s(!0),l(y,{key:0},u(t.points,((e,l)=>(s(),f(K,{x:e[0],y:e[1],"is-start":0==l,"is-end":0==l||l==t.points.length-1,"is-x":G(a,l),onMousedown:e=>A(e,a,l),onDirection:e=>((e,t,s)=>{const l=G(t,s);E.isX=l,A(e,t,s),E.isDire=!0})(e,a,l)},null,8,["x","y","is-start","is-end","is-x","onMousedown","onDirection"])))),256)):n("",!0)],38)],6)),[[m,M(t)]]);var d})),128))],34))}}),[["__cssModules",{$style:{pipes:"_pipes_jc6ti_2","is-locked":"_is-locked_jc6ti_2","is-pointer":"_is-pointer_jc6ti_7",item:"_item_jc6ti_10","is-active":"_is-active_jc6ti_13","item-wrap":"_item-wrap_jc6ti_23",dash:"_dash_jc6ti_1"}}]]),ee=[{name:"冷冻回",type:A.LDH,color:"#2263E7"},{name:"冷冻供",type:A.LDG,color:"#2A19CC"},{name:"冷却供",type:A.LQG,color:"#CA691B"},{name:"冷却回",type:A.LQH,color:"#1F6C28"}],te=[{name:"冷冻泵",type:S.LDB,key:U.CHWP},{name:"冷却泵",type:S.LQB,key:U.CWP},{name:"阀门(冷冻)",type:S.LDFM,key:U.CHWV},{name:"阀门(冷却)",type:S.LQFM,key:U.CWV},{name:"冷却塔",type:S.LQT,key:U.COT},{name:"离心机",type:S.LXJ,key:U.CHL},{name:"分集水器",type:S.JSQ},{name:"监测点",type:S.DOT}],se=["data-index"],le=["data-index"],ie=["src"],ae={class:"flex flex-ac"},ne=x("span",null,"画布大小：",-1),oe=x("span",{class:"pl-xs pr-xs"}," X ",-1),de={class:"pl-xs"},ce={class:"pl-xs pr-xs"},pe={key:0,class:"flex"},re=x("span",null,"名称：",-1),ye={class:"flex"},ue=x("span",null,"类型：",-1),ve={key:1,class:"flex"},me=x("span",null,"编号：",-1),xe={key:2,class:"flex"},fe=x("span",null,"编号：",-1),he={key:3,class:"flex"},ge=x("span",null,"单位：",-1),_e={class:"flex"},ke=x("span",null,"坐标：",-1),we={class:"flex"},be=x("span",null,"角度：",-1),$e={key:4,class:"flex"},Ce=x("span",{class:"pt-xs"},"关联：",-1),Le=x("span",{class:"pl-xs"},"并联：",-1),De={class:"pl-xs"},ze=x("span",null,"设备：",-1),Me=x("span",null,"阀门：",-1),Ve={class:"e-drag__dot-content"},Te=H(t({__name:"index",setup(t){const r=F(),v=N();d((()=>r.sidebar.opened),(()=>{setTimeout((()=>{var e;null==(e=g.value)||e.resize()}),300)}));const m=c(),g=c(),_=p({filters:{},forms:{template:{label:"模板",type:"select",clearable:!0,items:[]},animate:{label:"管路动画",type:"switch",value:!1,cols:.5},lockeDev:{label:"锁定设备",type:"switch",value:!1,cols:.5},lockePipe:{label:"锁定管路",type:"switch",value:!1,cols:.5},display:{label:"隐藏",type:"switch",value:!1,cols:.5},type:{label:"隐藏元素",type:"checkbox",hide:!0,custom:{label:"name",value:"type"},items:ee.concat(te)}},pipes:ee,devices:te,drag:{width:1200,height:900,key:"",index:-1,zIndex:0},edit:{scale:1,type:"",index:-1,devices:[],pipes:[],text:""}}),U="devices",H="pipes",G=p({width:2,gap:4}),K=k((()=>{let e={};return _.edit.index<0||(e=_.edit[_.edit.type][_.edit.index]),e})),R=k((()=>{const e=K.value.type;if(!e)return[];const t=_.edit.devices;let s=[];switch(e){case A.LDG:case A.LDH:s=[S.LDB,S.LXJ,S.LDFM];break;case A.LQG:s=[S.LQT,S.LXJ,S.LQFM];break;case A.LQH:s=[S.LQB,S.LXJ,S.LQT,S.LQFM]}return t.filter((e=>s.includes(e.type)))})),Y=k((()=>{const e=K.value.type;if(!e)return[];const t=_.edit.devices;let s=[];switch(e){case A.LDG:case A.LDH:s=[S.LDFM];break;case A.LQG:case A.LQH:s=[S.LQFM]}return t.filter((e=>s.includes(e.type)))})),W=k((()=>{const e=K.value.type;if(!e)return[];const t=_.edit.devices;let s=[];switch(e){case A.LDG:case A.LDH:s=[S.LDB,S.LXJ];break;case A.LQG:s=[S.LQT,S.LXJ];break;case A.LQH:s=[S.LQB,S.LXJ,S.LQT]}return t.filter((e=>s.includes(e.type)))})),q=e=>{const t=_.edit[e].map((e=>{let{name:t,type:s,unit:l,deviceCode:i,style:a,rotate:n,bind:o,parallel:d,paths:c}=e;return c&&(c=c.map((({x:e,y:t})=>({x:e,y:t})))),d&&d.length&&d[0][0].length>0&&(o=d),{name:t,type:s,unit:l,deviceCode:i,style:a,rotate:n,bind:o,paths:c}})),s=JSON.stringify(t,((e,t)=>{if(!(""===t||void 0===t||t instanceof Array&&0==t.length))return t}),2);_.edit.text=s,J(s)},Te=()=>{_.edit.index=-1,_.edit.devices=[],_.edit.pipes=[],et()},je=c(),Xe=()=>{var e;null==(e=je.value)||e.optimize(),et()},Ie=()=>{},Qe=()=>{et()},Oe=(e,t="")=>Number(t.replace(e,"")),Be=e=>{let t=0;const s=_.edit.devices.filter((t=>t.key==e)).sort(((t,s)=>Oe(e,t.deviceCode)-Oe(e,s.deviceCode)));for(let l=0;l<s.length;l++){const i=s[l],a=Oe(e,i.deviceCode);if(a-t>1)break;a>0&&(t=a)}return t},Ee=e=>{const t=e.key;if(e.name.indexOf("#")>-1&&(e.name=e.name.split("#")[1]),!t)return e.name;return`${Be(t)+1}#${e.name}`},Pe=e=>{const t=e.key;if(!t)return"";return`${t}${Be(t)+1}`},Se=(e,t,s)=>{},Ue={isMove:!1,x:0,y:0,tsp:0,time:10},Ae=(e,t,s,l)=>{Ue.isMove=!0,Ue.tsp=Date.now(),((e,t)=>{const s=_.edit;if(s.type=e,s.index==t)return;s.index=t;const l=_.drag;s[e][t].zIndex=l.zIndex,l.zIndex++})(l,t);const i=!Boolean(e.changedTouches),a=i?e:e.changedTouches[0];Ue.x=a[i?"clientX":"pageX"],Ue.y=a[i?"clientY":"pageY"]},He=e=>{var t;if(!Ue.isMove||_.edit.index<0)return;if(Date.now()-Ue.tsp<Ue.time)return void(Ue.isMove=!1);const s=!Boolean(e.changedTouches),l=s?e:e.changedTouches[0],i=l[s?"clientX":"pageX"]-Ue.x,a=l[s?"clientY":"pageY"]-Ue.y,n=null==(t=g.value)?void 0:t.getSize(),o=_.edit[_.edit.type][_.edit.index];o.mx=i/n.scale,o.my=a/n.scale},Je=e=>{if(!Ue.isMove)return;if(Ue.isMove=!1,_.edit.index<0)return;const t=_.edit[_.edit.type][_.edit.index];let s=t.mx??0,l=t.my??0;0!=s&&(s+=t.style.x,t.style.x=s),0!=l&&(l+=t.style.y,t.style.y=l),t.mx=0,t.my=0,et()},Fe=e=>v.getDeviceSrc(e),Ne=e=>{const t=e.target.dataset;e.dataTransfer.effectAllowed=null==t?void 0:t.effect;const s=_.drag;s.key=null==t?void 0:t.key,s.index=null==t?void 0:t.index,s.zIndex++},Ge=e=>{e.preventDefault()},Ke=e=>{Ye();const t=We(e.target);t&&t.dataset.drop==e.dataTransfer.effectAllowed&&t.classList.add("drop-over")},Re=e=>{Ye();const t=We(e.target);if(t&&t.dataset.drop==e.dataTransfer.effectAllowed){const{key:t,index:s}=_.drag;if(t){const l=_[t][s];"devices"==t?((e,t)=>{var s;const{x:l,y:i}=null==(s=g.value)?void 0:s.displace(e);_.edit.devices.push({...t,zIndex:_.drag.zIndex,name:Ee(t),deviceCode:Pe(t),status:0,error:0,style:{x:l,y:i}})})(e,l):((e,t)=>{var s;const{x:l,y:i}=null==(s=g.value)?void 0:s.displace(e),a=G.width+2*G.gap,n=a/2;_.edit.pipes.push({...t,style:{x:l,y:i},width:100,height:a,zIndex:_.drag.zIndex,paths:[{x:n,y:n},{x:100-n,y:n}],bind:[],parallel:[[[],[]]]})})(e,l),_.edit.type=_.drag.key,_.edit.index=_.edit[t].length-1,et()}}},Ye=()=>{document.querySelectorAll(".drop-over").forEach((e=>{e.classList.remove("drop-over")}))},We=e=>{for(;e;){if(e.dataset&&e.dataset.drop)return e;e=e.parentNode}},qe=e=>{let t=e;return e instanceof Array?t=e.map((e=>qe(e))):"[object Object]"==Object.prototype.toString.call(e)&&(t={},Object.keys(e).forEach((s=>{let l=e[s];(l instanceof Array||"[object Object]"==Object.prototype.toString.call(e))&&(l=qe(l)),t[s]=l}))),t},Ze={max:50,list:[],tsp:0,time:500},et=()=>{const e=Date.now();if(e-Ze.tsp<Ze.time)return;Ze.tsp=e;const t=Ze.list;t.length>=Ze.max&&t.splice(0,1);const s=qe(_.edit);t.push(s)},tt=e=>{const t=e.keyCode;if(e.ctrlKey&&90==t)return void(()=>{const e=Ze.list,t=e.length;if(0==t)return;const s=e[t-2];if(s){const e=qe(s);Object.keys(e).forEach((e=>{_.edit[e]=qe(s[e])}))}t>1&&e.splice(t-1,1)})();const{index:s,type:l}=_.edit;return s<0||!l?void 0:46==t?(_.edit[l].splice(s,1),_.edit.index=-1,void et()):void(e.ctrlKey&&86==t&&((e,t)=>{const s=qe(_.edit[e][t]);"devices"==e&&s.type!==S.DOT&&(s.name=Ee(s),s.deviceCode=Pe(s)),s.style.x+=50,_.drag.zIndex++,s.zIndex=_.drag.zIndex,_.edit.index=_.edit[e].length,_.edit[e].push(s),et()})(l,s))},st=e=>{const t=e.keyCode,{index:s,type:l}=_.edit;if(s<0||!l||Ue.isMove)return;const i={x:0,y:0};switch(t){case 38:case 87:i.y-=1;break;case 40:case 83:i.y+=1;break;case 37:case 65:i.x-=1;break;case 39:case 68:i.x+=1}0==i.x&&0==i.y||lt(i)},lt=e=>{const t=_.edit[_.edit.type][_.edit.index];0!=e.x&&(t.style.x+=e.x),0!=e.y&&(t.style.y+=e.y),et()},it=()=>{const e=_.edit;e[e.type][e.index].parallel.push([[],[]])},at=e=>{if(!e)return;const t=P.find((t=>t.id==e));let s=0;const l=null==t?void 0:t.pipes.map((e=>{var t;const l=qe(e);l.bind||(l.bind=[]),l.bind[0]instanceof Array?(l.parallel=l.bind,l.bind=[]):l.parallel=[[[],[]]];const{width:i,height:a}=(e=>{let t=0,s=0;for(let i=0;i<e.length;i++){const{x:l,y:a}=e[i];e[i].moved=!0,l>t&&(t=l),a>s&&(s=a)}const l=G.width/2+G.gap;return{width:t+l,height:s+l}})(l.paths);return l.width=i,l.height=a,l.zIndex=s++,l.color=(null==(t=_.pipes.find((e=>e.type==l.type)))?void 0:t.color)||"#000",l})),i=null==t?void 0:t.devices.map((e=>{var t;const l=qe(e);return l.key=null==(t=l.deviceCode)?void 0:t.replace(/[^a-zA-Z]/g,""),l.zIndex=s++,l}));_.drag.zIndex=s,_.edit.devices=i,_.edit.pipes=l,et()},nt=(e,t)=>{if(_.filters[e]=t,"display"==e){_.forms.type.hide=!t}else"template"==e&&at(t)};return(()=>{const e=_.forms;e.template.items=P.map((e=>({label:e.name,value:e.id}))),e.template.onChange=e=>nt("template",e),e.animate.onChange=e=>nt("animate",e),e.lockeDev.onChange=e=>nt("lockeDev",e),e.lockePipe.onChange=e=>nt("lockePipe",e),e.display.onChange=e=>nt("display",e),e.type.onChange=e=>nt("type",e)})(),et(),window.addEventListener("keydown",st,!1),window.addEventListener("keyup",tt,!1),w((()=>{window.removeEventListener("keydown",st),window.removeEventListener("keyup",tt)})),(t,d)=>{const c=b("e-form"),p=z,r=M,v=V,k=T,w=j,P=X,A=I,J=B,F=E,N=Q,ee=O,te=e,Oe=b("e-drag");return s(),l("div",{class:i([t.$style.page,"flex"]),ref_key:"pageRef",ref:m,style:o({"--scale":h(_).edit.scale}),onDragstart:Ne,onDragover:a(Ge,["prevent"]),onDragenter:Ke,onDrop:a(Re,["prevent"])},[x("div",{class:i([t.$style.tools,"p-sm o-a"])},[x("div",{class:i(t.$style.group)},[x("div",{class:i(t.$style.wrap)},[$(c,{forms:h(_).forms,size:"small",inline:!0,cols:1},null,8,["forms"])],2)],2),x("div",{class:i([t.$style.group,t.$style.line])},[x("div",{class:i(t.$style.title)},"管路",2),x("div",{class:i(t.$style.wrap)},[(s(!0),l(y,null,u(h(_).pipes,((e,a)=>(s(),l("div",{class:i(t.$style.item),style:o({"--color":e.color}),"data-effect":"copy","data-key":"pipes","data-index":a,draggable:!0},[x("div",{class:i(t.$style.name)},C(e.name)+"：",3),x("div",{class:i(t.$style.pipe)},null,2)],14,se)))),256))],2)],2),x("div",{class:i([t.$style.group,t.$style.device])},[x("div",{class:i(t.$style.title)},"设备",2),x("div",{class:i(t.$style.wrap)},[(s(!0),l(y,null,u(h(_).devices,((e,a)=>(s(),l("div",{class:i({[t.$style.item]:!0,[t.$style["is-dot"]]:e.type==h(S).DOT}),"data-effect":"copy","data-key":"devices","data-index":a,draggable:!0},[e.type!=h(S).DOT?(s(),l("img",{key:0,src:Fe(e),draggable:"false"},null,8,ie)):(s(),l("div",{key:1,class:i(t.$style.dot)},null,2)),x("div",{class:i(t.$style.name)},C(e.name),3)],10,le)))),256))],2)],2),$(r,null,{default:L((()=>[$(p,{type:"primary",size:"small",onClick:d[0]||(d[0]=e=>q("devices"))},{default:L((()=>[D("设备")])),_:1}),$(p,{type:"primary",size:"small",onClick:d[1]||(d[1]=e=>q("pipes"))},{default:L((()=>[D("管路")])),_:1}),$(p,{type:"danger",size:"small",onClick:Te},{default:L((()=>[D("清空")])),_:1}),$(p,{type:"warning",size:"small",onClick:Xe},{default:L((()=>[D("优化")])),_:1}),$(p,{type:"primary",size:"small",onClick:Ie},{default:L((()=>[D("log")])),_:1})])),_:1}),$(v,{class:"mt-xs",type:"textarea",modelValue:h(_).edit.text,"onUpdate:modelValue":d[2]||(d[2]=e=>h(_).edit.text=e),placeholder:"JSON 数据"},null,8,["modelValue"])],2),x("div",{class:i([t.$style.wrapper,"f-x o-h"])},[x("div",{class:i(t.$style["drag-info"])},[x("div",ae,[ne,$(k,{size:"small",modelValue:h(_).drag.width,"onUpdate:modelValue":d[3]||(d[3]=e=>h(_).drag.width=e),onKeyup:d[4]||(d[4]=a((()=>{}),["stop"]))},null,8,["modelValue"]),oe,$(k,{size:"small",modelValue:h(_).drag.height,"onUpdate:modelValue":d[5]||(d[5]=e=>h(_).drag.height=e),onKeyup:d[6]||(d[6]=a((()=>{}),["stop"]))},null,8,["modelValue"])])],2),$(ee,{class:i(t.$style["device-info"]),accordion:""},{default:L((()=>[$(N,{name:"1"},{title:L((()=>[x("span",de,C(h(K).name),1)])),default:L((()=>{var e,o;return[x("div",ce,[h(K).type==h(S).DOT?(s(),l("div",pe,[re,x("span",null,[$(v,{size:"small",modelValue:h(K).name,"onUpdate:modelValue":d[7]||(d[7]=e=>h(K).name=e),placeholder:"请输入",onChange:et,onKeyup:d[8]||(d[8]=a((()=>{}),["stop"]))},null,8,["modelValue"])])])):n("",!0),x("div",ye,[ue,x("span",null,C(h(K).type),1)]),h(K).type==h(S).DOT?(s(),l("div",ve,[me,x("span",null,[$(v,{size:"small",modelValue:h(K).deviceCode,"onUpdate:modelValue":d[9]||(d[9]=e=>h(K).deviceCode=e),placeholder:"请输入",onChange:et,onKeyup:d[10]||(d[10]=a((()=>{}),["stop"]))},null,8,["modelValue"])])])):h(K).deviceCode?(s(),l("div",xe,[fe,x("span",null,C(h(K).deviceCode),1)])):n("",!0),h(K).type==h(S).DOT?(s(),l("div",he,[ge,x("span",null,[$(v,{size:"small",modelValue:h(K).unit,"onUpdate:modelValue":d[11]||(d[11]=e=>h(K).unit=e),placeholder:"请输入",onChange:et,onKeyup:d[12]||(d[12]=a((()=>{}),["stop"]))},null,8,["modelValue"])])])):n("",!0),x("div",_e,[ke,x("span",null,"x: "+C(null==(e=h(K).style)?void 0:e.x.toFixed(2))+", y: "+C(null==(o=h(K).style)?void 0:o.y.toFixed(2)),1)]),x("div",we,[be,$(w,{class:"f-x",modelValue:h(K).rotate,"onUpdate:modelValue":d[13]||(d[13]=e=>h(K).rotate=e),min:0,max:360,"show-input":"",size:"small",onChange:et,onKeyup:d[14]||(d[14]=a((()=>{}),["stop"]))},null,8,["modelValue"])]),h(K).bind?(s(),l("div",$e,[Ce,$(A,{class:"f-x",modelValue:h(K).bind,"onUpdate:modelValue":d[15]||(d[15]=e=>h(K).bind=e),onChange:et},{default:L((()=>[(s(!0),l(y,null,u(h(R),(e=>(s(),f(P,{value:e.deviceCode},{default:L((()=>[D(C(e.name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue"])])):n("",!0),h(K).parallel?(s(),f(ee,{key:5,accordion:"",class:i(t.$style.parallel)},{default:L((()=>[$(N,{name:"2"},{title:L((()=>[Le,$(p,{size:"small",circle:"",plain:"",onClick:a(it,["stop"])},{default:L((()=>[$(J)])),_:1})])),default:L((()=>[x("div",De,[(s(!0),l(y,null,u(h(K).parallel,((e,a)=>(s(),l("div",{class:i(t.$style.item)},[ze,$(p,{size:"small",circle:"",plain:"",onClick:e=>(e=>{const t=_.edit;t[t.type][t.index].parallel.splice(e,1)})(a)},{default:L((()=>[$(F)])),_:2},1032,["onClick"]),$(A,{class:"f-x",modelValue:e[0],"onUpdate:modelValue":t=>e[0]=t,onChange:et},{default:L((()=>[(s(!0),l(y,null,u(h(W),(e=>(s(),f(P,{value:e.deviceCode},{default:L((()=>[D(C(e.name),1)])),_:2},1032,["value"])))),256))])),_:2},1032,["modelValue","onUpdate:modelValue"]),Me,$(A,{class:"f-x",modelValue:e[1],"onUpdate:modelValue":t=>e[1]=t},{default:L((()=>[(s(!0),l(y,null,u(h(Y),(e=>(s(),f(P,{value:e.deviceCode},{default:L((()=>[D(C(e.name),1)])),_:2},1032,["value"])))),256))])),_:2},1032,["modelValue","onUpdate:modelValue"])],2)))),256))])])),_:1})])),_:1},8,["class"])):n("",!0),$(v,{type:"textarea",value:JSON.stringify(h(K),void 0,2)},null,8,["value"])])]})),_:1})])),_:1},8,["class"]),$(Oe,{ref_key:"dragRef",ref:g,width:h(_).drag.width,height:h(_).drag.height,"data-drop":"copy",zoom:h(_).edit.scale,"onUpdate:zoom":d[16]||(d[16]=e=>h(_).edit.scale=e),onMousemove:He,onMouseup:Je},{default:L((()=>[x("div",Ve,[$(te,{list:h(_).edit.devices,type:U,locked:h(_).filters.lockeDev,display:h(_).filters.display,"hide-type":h(_).filters.type,"show-name":!0,active:h(_).edit.type===U?h(_).edit.index:-1,onClick:Se,onMousedown:a(Ae,["stop"]),onMouseup:a(Je,["stop"])},null,8,["list","type","locked","display","hide-type","active"]),$(Z,{ref_key:"pipeRef",ref:je,list:h(_).edit.pipes,type:H,locked:h(_).filters.lockePipe,animate:h(_).filters.animate,display:h(_).filters.display,"hide-type":h(_).filters.type,width:h(G).width,gap:h(G).gap,scale:h(_).edit.scale,active:h(_).edit.type===H?h(_).edit.index:-1,onClick:Se,onMousedown:a(Ae,["stop"]),onMouseup:Je,onChange:Qe},null,8,["list","type","locked","animate","display","hide-type","width","gap","scale","active"])])])),_:1},8,["width","height","zoom"])],2)],38)}}}),[["__cssModules",{$style:{page:"_page_1vxkv_2",tools:"_tools_1vxkv_10",group:"_group_1vxkv_17",title:"_title_1vxkv_20",wrap:"_wrap_1vxkv_23",item:"_item_1vxkv_26",name:"_name_1vxkv_29",line:"_line_1vxkv_33",pipe:"_pipe_1vxkv_38",device:"_device_1vxkv_45",dot:"_dot_1vxkv_53",wrapper:"_wrapper_1vxkv_67","drag-info":"_drag-info_1vxkv_70","device-info":"_device-info_1vxkv_71",parallel:"_parallel_1vxkv_88"}}]]),je=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{G as _,je as i};
