import{d as e,r as t,c as a,o as l,q as s,s as n,Q as o,w as r,bs as i,k as c,g as f,au as u,P as d,i as h,av as p,a as v,C as m,F as w,j as k,m as C,t as y,u as _,ag as g,e as x,l as L,A as V,B as $,b as R,n as b,bh as P,ai as j}from"./vendor-ebf5717c.js";import{a as W,d as q,b as A}from"./modules-8e459763.js";import{b as B}from"./router-b01c2f88.js";const D=e({__name:"scrollPane",setup(e,{expose:c}){const f=t(null),u=a((()=>f.value.wrapRef)),d=e=>{const t=e.wheelDelta||40*-e.deltaY,a=u.value;a.scrollLeft=a.scrollLeft+t/4};return c({scrollContainerRef:f}),(e,t)=>{const a=i;return l(),s(a,{ref_key:"scrollContainerRef",ref:f,vertical:!1,class:"scroll-container",onWheel:r(d,["prevent"])},{default:n((()=>[o(e.$slots,"default")])),_:3},512)}}}),E=e({__name:"index",setup(e){const o=t(!1),i=t(0),E=t(0);let Y=c({}),F=t([]);const I=W(),M=a((()=>I.i18n)),O=q(),Q=A(),X=a((()=>Q.visitedViews)),z=a((()=>O.routes)),G=f(),H=u(),J=()=>{const{name:e}=H;return e&&"redirect"!==e&&Q.addView(H),!1},K=t(null),N=async()=>{const e=K.value;await P();for(const t of e)if(t.to.path===H.path){T(t),t.to.fullPath!==H.fullPath&&Q.updateVisitedView(H);break}},S=t(null),T=e=>{const t=S.value,a=t.$el.offsetWidth,l=null==t?void 0:t.scrollContainerRef.wrapRef,s=K.value;let n=null,o=null;if(s.length>0&&(n=s[0],o=s[s.length-1]),n===e)l.scrollLeft=0;else if(o===e)l.scrollLeft=l.scrollWidth-a;else{const t=s.findIndex((t=>t===e)),n=s[t-1],o=s[t+1],r=o.$el.offsetLeft+o.$el.offsetWidth+4,i=n.$el.offsetLeft-4;r>l.scrollLeft+a?l.scrollLeft=r-a:i<l.scrollLeft&&(l.scrollLeft=i)}};d((()=>G.currentRoute.value),(e=>{J(),N()})),d((()=>o.value),(e=>{e?document.body.addEventListener("click",re):document.body.removeEventListener("click",re)})),h((()=>{Z(),J()}));const U=e=>e.path===H.path,Z=()=>{let e=F=ee(z.value);for(const t of e)t.name&&Q.addVisitedView(t)},ee=(e,t="/")=>{let a=[];return e.forEach((e=>{let l="",s=e.path;if(l=t+"/"+s,l=l.split("/").filter(Boolean).join("/"),47==l.charCodeAt(0)||(l="/"+l),e.meta&&e.meta.affix&&a.push({fullPath:l,path:l,name:e.name,meta:{...e.meta}}),e.children){const t=ee(e.children,l);t.length>=1&&(a=[...a,...t])}})),a},te=async e=>{const t=Y;Q.delCachedView(t);const{fullPath:a}=t;await P(),G.replace({path:`${B}/redirect${a}`})},ae=e=>{const{visitedViews:t}=Q.delView(e);U(e)&&le(t,e)},le=(e,t)=>{const a=e.slice(-1)[0];a?G.push(a):"Dashboard"===t.name?G.replace({path:`${B}/redirect`+t.fullPath}):G.push(`${B}/`)},se=()=>{G.push(Y),Q.delOthersViews(Y),N()},ne=e=>{const t=Y,a=Q.delAllViews();F.some((e=>e.path===t.path))||le(a,t)},oe=t(null),re=()=>{o.value=!1};return(e,t)=>{const a=j,c=p("router-link");return l(),v("div",{id:"tags-view-container",class:"tags-view-container",ref_key:"elRef",ref:oe},[m(D,{ref_key:"scrollPaneRef",ref:S,class:"tags-view-wrapper"},{default:n((()=>[(l(!0),v(w,null,k(_(X),(t=>(l(),s(c,{ref_for:!0,ref_key:"tagRef",ref:K,key:t.path,class:L([U(t)?"active":"","tags-view-item"]),to:{path:t.path,query:t.query},onContextmenu:r((e=>((e,t)=>{const a=oe.value.getBoundingClientRect().left,l=oe.value.offsetWidth-105,s=t.clientX-a+15;E.value=s>l?l:s,i.value=t.clientY,o.value=!0,Y=e,Y.isCurrent=e.name===H.name})(t,e)),["prevent"])},{default:n((()=>[C(y(_(M)?e.$t(`route.${t.title}`):t.title)+" ",1),t.meta.affix?x("",!0):(l(),s(a,{key:0,class:"el-icon-close",onClick:r((e=>ae(t)),["prevent","stop"])},{default:n((()=>[m(_(g))])),_:2},1032,["onClick"]))])),_:2},1032,["class","to","onContextmenu"])))),128))])),_:1},512),V(R("ul",{style:b({left:_(E)+"px",top:_(i)+"px"}),class:"contextMenu"},[_(Y).isCurrent?(l(),v("li",{key:0,onClick:te},"刷新")):x("",!0),_(Y).meta&&_(Y).meta.affix?x("",!0):(l(),v("li",{key:1,onClick:t[0]||(t[0]=e=>ae(_(Y)))},"关闭")),R("li",{onClick:se},"关闭其他"),R("li",{onClick:ne},"关闭所有")],4),[[$,_(o)]])],512)}}});export{E as _};
