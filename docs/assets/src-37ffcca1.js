import{d as e,bt as t,bu as s,c as o,i as r,L as a,k as n,q as i,s as c,u as d,av as m,bv as u,o as l,C as p,N as f,bw as h,bx as w}from"./vendor-ebf5717c.js";import{d as j,b as v}from"./router-b01c2f88.js";import{i as g}from"./locales-c8bf54b5.js";import{a as b,u as $,d as k}from"./modules-8e459763.js";import{d as E,a as y}from"./lang-e64994c5.js";import{i as z}from"./config-b995786f.js";import{h as q,j as S}from"./common-f34ee3bc.js";import{i as x}from"./components-947202d5.js";import"./css-9cbff082.js";import{s as A}from"./mock-273d4049.js";const C=e({__name:"App",setup(e){const f=b(),h={zhCN:{...t,...E},en:{...s,...y}},w=o((()=>f.language)),j=(e,t="href")=>{const s=e.dataset[t];return e.removeAttribute("data-"+t),""+s};(()=>{const e=document.querySelector('link[rel="icon"]');e.href=j(e);const t=document.querySelector('link[rel="manifest"]');t.href=j(t)})(),r((()=>{v(),window.addEventListener("resize",v,!1)})),a((()=>{window.removeEventListener("resize",v)}));const v=()=>{f.sidebar.opened&&document.body.clientWidth,$()},g=n({width:1920,size:14}),$=()=>{let e=(document.getElementById("app").clientWidth||g.width)*(g.size/g.width);document.documentElement.style.fontSize=e+"px"};return(e,t)=>{const s=m("router-view"),o=u;return l(),i(o,{locale:h[d(w)],namespace:"el"},{default:c((()=>[p(s)])),_:1},8,["locale"])}}});f.configure({showSpinner:!1});const{t:I}=g.global;q.interceptors.request.use((e=>{let t=$().token;return t&&(e.headers.Authorization=t),e}),(e=>Promise.reject(e))),q.interceptors.response.use((e=>{var t;return 20010090===(null==(t=e.data)?void 0:t.code)&&$().resetToken().then((()=>{window.location.reload()})),e}),(e=>Promise.reject(e))),j.beforeEach((async(e,t,s)=>{f.start();const o=document,r=e.meta.title;b().i18n?o.title=r?I(`route.${r}`).toUpperCase():"loading...":o.title=r;const a=$(),n=a.token,i=`${v}/login`;if(n)if(e.path==i)s({path:`${v}/`}),f.done();else{if(e.path==`${v}/index`)return s({path:`${v}/`}),void f.done();if(a.powers&&a.powers.length>0)s();else try{const{permissions:t}=await a.getUserInfo(),o=k();(await o.generateRoutes(t)).forEach((e=>{j.hasRoute(e.name)||j.addRoute(e)})),s({...e,replace:!0})}catch(c){await a.resetToken(),s(`${i}?redirect=${e.path}`),f.done()}}else e.path==i?s():(s(`${i}?redirect=${e.path}`),f.done())})),j.afterEach((()=>{f.done()}));const L=h(C);L.directive("focus",{mounted(e){e.focus()}}),L.use(w()).use(j).use(g).use(S).use(x).use(z).mount("#app"),A();
