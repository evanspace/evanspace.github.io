var e,t,s,a,n=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},o=(e,t,s)=>(n(e,t,"read from private field"),s?s.call(e):t.get(e)),i=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},r=(e,t,s,a)=>(n(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s),l=(e,t,s)=>(n(e,t,"access private method"),s);import{ci as c,cT as p,cj as g,cU as u,co as d,bh as m,bp as h,bc as f,ba as v,cb as y,be as w,cc as b,cd as x,cV as C,b6 as k,bs as j,bk as S,cm as A,bB as I,cW as M,cX as L,cY as P,bA as O,cZ as _,c0 as z,c_ as U,bv as B,bD as R,c$ as G,bd as E,b7 as F,ck as D,cg as T,cn as Y,bw as X,d0 as J,d1 as W,bo as $,d2 as Z,bE as N,d3 as V,bz as K,e as Q,i as H,w as q,l as ee,aP as te,o as se,g as ae,h as ne,n as oe,u as ie,a9 as re,a5 as le,B as ce,d4 as pe,Y as ge,q as ue,p as de,I as me,t as he,c as fe,ak as ve}from"./vendor-4ee42cfe.js";import{_ as ye,a as we,b as be,c as xe,d as Ce,e as ke,f as je,g as Se,h as Ae,i as Ie,j as Me,k as Le,l as Pe,m as Oe,n as _e,o as ze,p as Ue,q as Be,r as Re,s as Ge,t as Ee,u as Fe,v as De,w as Te,x as Ye,y as Xe,z as Je,A as We,B as $e,C as Ze,D as Ne,E as Ve,F as Ke,G as Qe,H as He,I as qe,J as et,K as tt,L as st,M as at,N as nt,O as ot,P as it,Q as rt,R as lt,S as ct,T as pt,U as gt,V as ut,W as dt,X as mt,Y as ht,Z as ft,$ as vt,a0 as yt,a1 as wt,a2 as bt,a3 as xt,a4 as Ct,a5 as kt,a6 as jt,a7 as St,a8 as At,a9 as It,aa as Mt,ab as Lt}from"./posZ-95d90af9.js";import{d as Pt,a as Ot,r as _t,T as zt,_ as Ut,b as Bt,c as Rt,e as Gt,f as Et,h as Ft,i as Dt,j as Tt,k as Yt,l as Xt,m as Jt,n as Wt,o as $t,p as Zt,q as Nt,s as Vt,t as Kt,g as Qt,v as Ht,u as qt}from"./scene-resize-41508b8f.js";import{u as es}from"./raycaster-8d1728c0.js";import{D as ts}from"./config-9a637eb0.js";import{u as ss}from"./background-b3a51288.js";import{u as as}from"./dialog-f4ae9538.js";import{_ as ns,e as os,A as is,n as rs}from"./index-0397fdf3.js";const ls=()=>({initCSS3DRender:(e,t)=>{const{width:s,height:a}=e,n=new c;return n.setSize(s,a),n.domElement.style.position="absolute",n.domElement.style.left="0px",n.domElement.style.top="0px",n.domElement.style.pointerEvents="none",t.appendChild(n.domElement),n},createCSS3DDom:e=>{const{name:t,className:s="",onClick:a,position:n,sprite:o}=e,i=document.createElement("div");i.innerHTML=t,i.className=s;const r=o?new p(i):new g(i);return i.style.pointerEvents=a?"auto":"none",i.style.position="absolute","function"==typeof a&&i.addEventListener("click",a),n&&r.position.set(...n),r}}),{createCSS3DDom:cs}=ls(),ps={depth:1,scale:40,plateRadius:200,rightClickBackDiffTime:100,areaLabel:!1,markLight:!1,border:!0,mapBg:!0,mapBar:!0,bgOutFactor:1,bgInnerFactor:.9,map:{}},gs={main:3377879,mainHover:9633791,borderColor:9633791,borderHoverColor:1066618,light:1066618,lightHover:9633791,plateColor:3377879,plateLight:1066618,line:9559027,line2:6421501,gridColor:663606,gridFork:927811,outline:11856636,markColor1:13303807,markColor2:6945023,flyColor1:9559027,flyColor2:6421501,scatterColor1:9559027,scatterColor2:6421501},{initCSS3DRender:us,createCSS3DDom:ds}=ls(),{raycaster:ms,pointer:hs,style:fs,update:vs}=es(),{createCorrugatedPlate:ys,corrugatedPlateUpdate:ws}=((e={})=>{let t=Pt({range:100,interval:.8,size:.2,color:47273,light:881527,factor:1},e);const s=(e,t)=>{const s=e.material,a=s.uniforms.uRange.value,n=s.uniforms.uLength.value;s.uniforms.uRadius.value+=t*(a/4),s.uniforms.uRadius.value>=a+n&&(s.uniforms.uRadius.value=0)};return{createCorrugatedPlate:(e={})=>{t=Pt(t,e);let{range:s,color:a,light:n,factor:o}=t;s*=o;const i=(()=>{let{range:e,interval:s,size:a,factor:n}=t;e*=n,s*=n,a*=n;const o=[],i=Math.floor(e/s);for(let t=-i;t<=i;t++)for(let e=-i;e<=i;e++){const n=new v(a,a),i=t*s,r=e*s,l=new y,c=new w(i,-a,r),p=new b,g=new x,u=new w(1,1,1);p.setFromEuler(g),l.compose(c,p,u),n.applyMatrix4(l),o.push(n)}return o})(),r=u(i),l=new d({uniforms:{uColor:{value:new m(n)},uTcolor:{value:new m(a)},uRadius:{value:1.25},uLength:{value:s/10},uRange:{value:s}},vertexShader:"\n        varying vec3 vp;\n        void main(){\n          vp = position;\n          gl_Position\t= projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        varying vec3 vp;\n        uniform vec3 uColor;\n        uniform vec3 uTcolor;\n        uniform float uRadius;\n        uniform float uLength;\n        float getLeng(float x, float y){\n          return  sqrt((x-0.0)*(x-0.0)+(y-0.0)*(y-0.0));\n        }\n        void main(){\n          float uOpacity = 0.8;\n          vec3 vColor = uColor;\n          float length = getLeng(vp.x,vp.z);\n          if ( length <= uRadius && length > uRadius - uLength ) {\n            float op = sin( (uRadius - length) / uLength ) ;\n            uOpacity = op;\n            if ( vp.y < 0.0 ) {\n              vColor = uColor * op;\n            } else {\n              vColor = uTcolor;\n            };\n            vColor = uTcolor;\n          }\n          gl_FragColor = vec4(vColor,uOpacity);\n        }\n      ",transparent:!0,depthWrite:!1,side:h}),c=new f(r,l);return c.name="波纹板",c},update:s,corrugatedPlateUpdate:s}})(),{getBoundingBox:bs}={getBoundingBox:e=>{var t=new C;t.expandByObject(e);var s=new w;t.getSize(s);var a=new w;return t.getCenter(a),{box3:t,center:a,size:s}}},{createMarkLight:xs}=((e={})=>{let t=Pt({pointTextureUrl:Ot("point.png"),circleTextureUrl:Ot("circle.png"),lightTextureUrl:Ot("light.png"),factor:1,color:65535},e);const s=new k;return{createMarkLight:(e=[0,0,0],a=10,n={})=>{t=Pt(t,n);const o=new j,i=new v(a/6.219,a);i.rotateX(-Math.PI/2),i.translate(0,0,a/2);const r=new S({map:s.load(t.lightTextureUrl),color:t.color,transparent:!0,depthWrite:!1,side:h});let l=new f(i,r);l.rotateX(Math.PI),l.position.z=a,l.renderOrder=3,l.name="光柱 01";let c=l.clone();c.name="光柱 02",c.rotateZ(Math.PI/2);const p=(()=>{const e=new v(3,3),a=new S({map:s.load(t.pointTextureUrl),color:t.color,side:h,transparent:!0,depthWrite:!1});let n=new f(e,a);n.renderOrder=1,n.name="底部光点";const o=.3*t.factor;return n.scale.setScalar(o),n})(),g=(()=>{const e=new v(3,3),a=new S({map:s.load(t.circleTextureUrl),color:t.color,side:h,opacity:0,transparent:!0,depthWrite:!1});let n=new f(e,a);n.renderOrder=2,n.name="createLightHalo";const o=.5*t.factor;n.scale.setScalar(o);const i=_t(0,2e3);return n.tween1=new A({scale:o,opacity:0}).to({scale:1.5*o,opacity:1},1e3).delay(i).onUpdate((e=>{let{scale:t,opacity:s}=e;n.scale.setScalar(t),n.material.opacity=s})),n.tween2=new A({scale:1.5*o,opacity:1}).to({scale:2*o,opacity:0},1e3).onUpdate((e=>{let{scale:t,opacity:s}=e;n.scale.setScalar(t),n.material.opacity=s})),n.tween1.chain(n.tween2),n.tween2.chain(n.tween1),n.tween1.start(),n})();return o.add(l,c,p,g),o.position.set(...e),o.rotateX(.5*Math.PI),o.name="光柱标记",o}}})(),{createCountryFlatLine:Cs,getPoints:ks}=(()=>{const e=(e,t,s="LineLoop")=>{let a;if("Line2"===s){const s=new L;s.setPositions(e),a=new P(s,t),a.name="countryLine2",a.computeLineDistances()}else{const n=new O;n.setFromPoints(e),a=new _[s](n,t),a.name="countryLine"}return a};return{createCountryFlatLine:(t,s={},a="LineLoop")=>{let n={color:65535,linewidth:1,depthTest:!1};n=Pt(n,s);let o=new I(n);"Line2"===a&&(o=new M(n));let i=t.features,r=new j;for(let l=0;l<i.length;l++){const t=i[l].geometry.coordinates;for(let s=0;s<t.length;s++){const n=t[s],i=[];"Line2"===a?n.forEach((e=>{e.forEach((e=>{i.push(e[0],0,-e[1])}))})):n.forEach((e=>{e.forEach((e=>{i.push(new w(e[0],e[1],0))}))}));let l=e(i,o,a);r.add(l)}}return r},getPoints:(e,t=0,s)=>{let a=e.features;const n=[];for(let o=0;o<a.length;o++){const e=a[o].geometry.coordinates;for(let a=0;a<e.length;a++)e[a].forEach((e=>{e.forEach((e=>{s?n.push(new w(e[0],t,-e[1])):n.push(e[0],t,-e[1])}))}))}return n}}})(),{createOutline:js,outlineUpdate:Ss}=((e={})=>{let t=Pt({size:.1,color:16085360,range:500,factor:1,speed:6},e);const s=e=>{const s=e.material,a=s.uniforms.uLength.value;s.uniforms.uIndex.value+=t.speed,s.uniforms.uIndex.value>=a&&(s.uniforms.uIndex.value=0)};return{createOutline:(e,s={})=>{t=Pt(t,s);const{size:a,factor:n,range:o,color:i}=t,r=new Float32Array(e),l=new O;l.setAttribute("position",new z(r,3));const c=new Float32Array(Math.floor(r.length/3)).map(((e,t)=>t));l.setAttribute("aIndex",new z(c,1));const p=new d({vertexShader:"\n        attribute float aOpacity;\n        uniform float uSize;\n\n        attribute float aIndex;\n        varying vec3 vp;\n        varying float vertexIndex;\n\n        void main(){\n          gl_Position = projectionMatrix*modelViewMatrix*vec4(position,1.0);\n          gl_PointSize = uSize;\n\n          vp = position;\n          vertexIndex = aIndex;\n        }\n      ",fragmentShader:"\n        varying float vertexIndex;\n        uniform vec3 uColor;\n        uniform float uIndex;\n        uniform float uRange;\n\n        float invert(float n){\n          return 1.-n;\n        }\n\n        void main(){\n          float uOpacity = 1.0;\n          if(vertexIndex <= uIndex || vertexIndex >= (uRange + uIndex)){\n              discard;\n          }\n          uOpacity = (vertexIndex - uIndex)/uRange;\n          if ( uOpacity < 0.2) {\n            discard;\n          }\n          vec2 uv=vec2(gl_PointCoord.x,invert(gl_PointCoord.y));\n          vec2 cUv=2.*uv-1.;\n          vec4 color=vec4(1./length(cUv));\n          color*=uOpacity;\n          color.rgb*=uColor;\n          gl_FragColor=color;\n        }\n      ",transparent:!0,depthTest:!1,uniforms:{uSize:{value:a*n},uIndex:{value:0},uLength:{value:c.length},uRange:{value:o},uColor:{value:new m(i)}}}),g=new U(l,p);return g.name="轮廓",g.scale.setScalar(n),g},update:s,outlineUpdate:s}})(),{createFlywireTexture:As,createFlywire:Is,flywireUpdate:Ms}=((e={})=>{let t,s,a=Pt({depth:0,height:4,divisions:1e3,color:16777215,flyColor:16761095,pointColor:16715760,pointWidth:2.5,flyPointWidth:2.4,tubularSegments:256,radius:.5,radialSegments:8,closed:!1,length:100,factor:1,speed:4},e);const n=e=>{const[t,n]=e;let{pointWidth:o,depth:i,factor:r}=a;const l=o*r;i*=r;const c=new v(l,l,1,1),p=new f(c,s);return p.position.set(t,i,-n),p.rotateX(.5*-Math.PI),p},o=(e={})=>{a=Pt(a,e),t=new d({depthTest:!1,uniforms:{uColor:{value:new m(a.flyColor)},uIndex:{value:0},uTotal:{value:a.divisions},uWidth:{value:a.flyPointWidth},uLength:{value:a.length}},vertexShader:"\n        attribute float aIndex;\n        uniform float uIndex;\n        uniform float uWidth;\n        uniform vec3 uColor;\n        varying float vSize;\n        uniform float uLength;\n  \n        void main(){\n            vec4 viewPosition = viewMatrix * modelMatrix * vec4(position,1);\n            gl_Position = projectionMatrix * viewPosition;\n  \n            if(aIndex >= uIndex - uLength && aIndex < uIndex){\n              vSize = uWidth * ((aIndex - uIndex + uLength) / uLength);\n            }\n            gl_PointSize = vSize;\n        }\n      ",side:h,fragmentShader:"\n        varying float vSize;\n        uniform vec3 uColor;\n        void main(){\n            if(vSize<=0.0){\n              gl_FragColor = vec4(1,0,0,0);\n            }else{\n              gl_FragColor = vec4(uColor,1);\n            }\n        }\n      ",transparent:!0,vertexColors:!1}),s=new d({uniforms:{uColor:{value:new m(a.pointColor)},uOpacity:{value:1},uSpeed:{value:.1},uSge:{value:4},uRadius:{value:a.pointWidth*a.factor/2},time:{value:0}},transparent:!0,depthTest:!1,vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          // 最终顶点位置信息=投影矩阵*模型视图矩阵*每个顶点坐标\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n      ",fragmentShader:"\n        varying vec2 vUv;\n        uniform vec3 uColor;\n        uniform float uOpacity;\n        uniform float uSpeed;\n        uniform float uSge;\n        uniform float time;\n        float PI = 3.14159265;\n        float drawCircle(float index, float range) {\n          float opacity = 1.0;\n          if (index >= 1.0 - range) {\n            opacity = 1.0 - (index - (1.0 - range)) / range;\n          } else if(index <= range) {\n            opacity = index / range;\n          }\n          return opacity;\n        }\n        float distanceTo(vec2 src, vec2 dst) {\n          float dx = src.x - dst.x;\n          float dy = src.y - dst.y;\n          float dv = dx * dx + dy * dy;\n          return sqrt(dv);\n        }\n        void main() {\n          float iTime = -time * uSpeed;\n          float opacity = 0.0;\n          float len = distanceTo(vec2(0.5, 0.5), vec2(vUv.x, vUv.y));\n  \n          float size = 1.0 / uSge;\n          vec2 range = vec2(0.65, 0.75);\n          float index = mod(iTime + len, size);\n          // 中心圆\n          vec2 cRadius = vec2(0.06, 0.12);\n  \n          if (index < size && len <= 0.5) {\n            float i = sin(index / size * PI);\n  \n            // 处理边缘锯齿\n            if (i >= range.x && i <= range.y){\n              // 归一\n              float t = (i - range.x) / (range.y - range.x);\n              // 边缘锯齿范围\n              float r = 0.3;\n              opacity = drawCircle(t, r);\n            }\n            // 渐变\n            opacity *=  1.0 - len / 0.5;\n          };\n          gl_FragColor = vec4(uColor, uOpacity * opacity);\n        }\n      ",side:h})},i=()=>{const e=t,n=e.uniforms.uTotal.value;e.uniforms.uIndex.value+=a.speed,e.uniforms.uIndex.value>=n&&(e.uniforms.uIndex.value=0);const o=.001*performance.now();s.uniforms.time.value=o};return o(),{createFlywireTexture:o,createFlywire:e=>{const s=new j,o=n(e[0]),i=n(e[1]);s.add(o,i);const r=(e=>{const[t,s]=e[0],[n,o]=e[1];let{depth:i,height:r,factor:l,divisions:c}=a;r=(i+r)*l,i*=l;const p=new w(t,i,-s),g=new w(t+(n-t)/4,r,-(s+(o-s)/4)),u=new w(t+3*(n-t)/4,r,-(s+3*(o-s)/4)),d=new w(n,i,-o);return new G(p,g,u,d).getPoints(c)})(e),l=new B(r,!1,"centripetal",.5),c=new R(l,a.tubularSegments,a.radius,a.radialSegments,a.closed),p=new d({transparent:!0,opacity:1,depthTest:!1,vertexColors:!1,uniforms:{uColor:{value:new m(a.color)},uOpacity:{value:.6}},vertexShader:"\n        varying vec3 vColor;\n        uniform vec3 uColor;\n        void main() {\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        uniform vec3 uColor;\n        uniform float uOpacity;\n        void main() {\n          gl_FragColor = vec4(uColor, uOpacity);\n        }\n      "}),g=new f(c,p);g.renderOrder=10;const u=(e=>{const s=new Float32Array(e.map(((e,t)=>t))),a=(new O).setFromPoints(e);return a.setAttribute("aIndex",new z(s,1)),new U(a,t)})(r);return s.add(g,u),s},update:i,flywireUpdate:i}})(),{createBar:Ls}=((e={})=>{let t=Pt({height:10,size:2,factor:1,color1:1048575,color2:16777215},e);return{createBar:(e={},s={})=>{t=Pt(t,s);let{size:a,height:n,factor:o,color1:i,color2:r}=t;a*=o,n*=o,n*=e.heightRatio??o;const[l,c,p]=e.position||[0,0,0],g=new j,u=new E(a,a,n),h=new d({depthTest:!1,transparent:!0,vertexColors:!1,uniforms:{uColor1:{value:new m(i)},uColor2:{value:new m(r)},uOpacity:{value:.6}},vertexShader:"\n        varying vec3 vColor;\n        uniform vec3 uColor1;\n        uniform vec3 uColor2;\n        void main() {\n          float percent = (position.z + 0.0) / 100.0; // 计算当前像素点在立方体高度上的百分比\n          vColor = mix(uColor1.rgb, uColor2.rgb, percent);\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        varying vec3 vColor;\n        uniform float uOpacity;\n        void main() {\n          gl_FragColor = vec4(vColor, uOpacity);\n        }\n      "}),v=new f(u,h);if(g.add(v),g.name="柱状图",g.position.set(l,c,p+n/2),g.renderOrder=99,e.label){const{name:t="",className:s="",onClick:a}=e.label,o=cs({name:t,className:s,position:[0,0,n/2],onClick:a});o.rotateX(.5*Math.PI),g.add(o)}return g}}})(),Ps={x:105.06,y:0,z:32.93},Os=new k;let _s,zs,Us,Bs,Rs;const Gs=(e,t="/texttures")=>new URL(Object.assign({"../../assets/imgs/label.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAK+SURBVHgB7dzNbdswGIdxSugCRtGBuklWSO17nXs/J0hHywA11AEMu3wDsLFT5WCJ5PtI/D8nQ5cA/FmxJJLqtofhHBSmPihUAoElEFgCgfVu7ODX95suqOKNXVDpDIElEFgCgSUQWAKBJRBYAoE1G2Q3DJ/j9fRjUGE7DI+f4niEGc0CMYzzKezjx7vWUQwjnMJdF8djDsq8M+QYLu/om0VJGP8OXI/LTc0C+fJhs4/fiIeLQ82hvMaI/zEevsVxCROb/RvSMkpuDCvLVVaLKCUwrGyXvS2hlMKwst6HtIBSEsPKfmO4ZpTSGFaRO/U1otTAsIo9OlkTSi0Mq+izrDWg1MSwij9cXDJKbQyrytPeJaJ4YFjVHr8vCcULw6o6H7IEFE8Mq/oEFRnFG8NymTEkohAwLLcpXBIKBcNynVMnoJAwLPdFDp4oNAwLserEA4WIYXVjK7C9Vr+fY8Gh7e8/Lhha/f5GhDMjJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJZDwvIIQs2kIA/K81tYvzKYhBMh/75vyCYHiDgLBSLmjuIK8xrBV6J1HoO11biCk/Rmk7XUuIMTNMhSU6iDUnUsWAaUqCBkj5Y1SDWQJGClPlCogS8JIeaEUB1kiRsoDpSjIkjFStVGKgawBI1UTpQjImjBStVCyg6wRI1UDJSvImjFSpVGygbSAkSqJkgWkJYxUKZTZIC1ipEqgzAJpGSOVG2UyiDBeyokyCWR3OOyFcd0Yyu4wfA83Ngnk2Pe/ziE82WdhvHSJYuNz7MPPcGOTQH5sNk+nPnyMf/xeGNcZSvyS3tv42DiFG0O94q+19Iq/BSQQWAKBJRBYAoElEFgCgSUQWKM3hsovnSGwBAJLILAEAusvLK6Na4P/Au0AAAAASUVORK5CYII=","../../assets/imgs/sky/216/negX.jpeg":ye,"../../assets/imgs/sky/216/negY.jpeg":we,"../../assets/imgs/sky/216/negZ.jpeg":be,"../../assets/imgs/sky/216/posX.jpeg":xe,"../../assets/imgs/sky/216/posY.jpeg":Ce,"../../assets/imgs/sky/216/posZ.jpeg":ke,"../../assets/imgs/sky/217/negX.jpeg":je,"../../assets/imgs/sky/217/negY.jpeg":Se,"../../assets/imgs/sky/217/negZ.jpeg":Ae,"../../assets/imgs/sky/217/posX.jpeg":Ie,"../../assets/imgs/sky/217/posY.jpeg":Me,"../../assets/imgs/sky/217/posZ.jpeg":Le,"../../assets/imgs/sky/218/negX.jpeg":Pe,"../../assets/imgs/sky/218/negY.jpeg":Oe,"../../assets/imgs/sky/218/negZ.jpeg":_e,"../../assets/imgs/sky/218/posX.jpeg":ze,"../../assets/imgs/sky/218/posY.jpeg":Ue,"../../assets/imgs/sky/218/posZ.jpeg":Be,"../../assets/imgs/sky/219/negX.jpeg":Re,"../../assets/imgs/sky/219/negY.jpeg":Ge,"../../assets/imgs/sky/219/negZ.jpeg":Ee,"../../assets/imgs/sky/219/posX.jpeg":Fe,"../../assets/imgs/sky/219/posY.jpeg":De,"../../assets/imgs/sky/219/posZ.jpeg":Te,"../../assets/imgs/sky/220/negX.jpeg":Ye,"../../assets/imgs/sky/220/negY.jpeg":Xe,"../../assets/imgs/sky/220/negZ.jpeg":Je,"../../assets/imgs/sky/220/posX.jpeg":We,"../../assets/imgs/sky/220/posY.jpeg":$e,"../../assets/imgs/sky/220/posZ.jpeg":Ze,"../../assets/imgs/sky/221/negX.jpeg":Ne,"../../assets/imgs/sky/221/negY.jpeg":Ve,"../../assets/imgs/sky/221/negZ.jpeg":Ke,"../../assets/imgs/sky/221/posX.jpeg":Qe,"../../assets/imgs/sky/221/posY.jpeg":He,"../../assets/imgs/sky/221/posZ.jpeg":qe,"../../assets/imgs/sky/222/negX.jpeg":et,"../../assets/imgs/sky/222/negY.jpeg":tt,"../../assets/imgs/sky/222/negZ.jpeg":st,"../../assets/imgs/sky/222/posX.jpeg":at,"../../assets/imgs/sky/222/posY.jpeg":nt,"../../assets/imgs/sky/222/posZ.jpeg":ot,"../../assets/imgs/sky/223/negX.jpeg":it,"../../assets/imgs/sky/223/negY.jpeg":rt,"../../assets/imgs/sky/223/negZ.jpeg":lt,"../../assets/imgs/sky/223/posX.jpeg":ct,"../../assets/imgs/sky/223/posY.jpeg":pt,"../../assets/imgs/sky/223/posZ.jpeg":gt,"../../assets/imgs/sky/224/negX.jpeg":ut,"../../assets/imgs/sky/224/negY.jpeg":dt,"../../assets/imgs/sky/224/negZ.jpeg":mt,"../../assets/imgs/sky/224/posX.jpeg":ht,"../../assets/imgs/sky/224/posY.jpeg":ft,"../../assets/imgs/sky/224/posZ.jpeg":vt,"../../assets/imgs/sky/225/negX.jpeg":yt,"../../assets/imgs/sky/225/negY.jpeg":wt,"../../assets/imgs/sky/225/negZ.jpeg":bt,"../../assets/imgs/sky/225/posX.jpeg":xt,"../../assets/imgs/sky/225/posY.jpeg":Ct,"../../assets/imgs/sky/225/posZ.jpeg":kt,"../../assets/imgs/sky/226/negX.jpeg":jt,"../../assets/imgs/sky/226/negY.jpeg":St,"../../assets/imgs/sky/226/negZ.jpeg":At,"../../assets/imgs/sky/226/posX.jpeg":It,"../../assets/imgs/sky/226/posY.jpeg":Mt,"../../assets/imgs/sky/226/posZ.jpeg":Lt,"../../assets/imgs/texttures/arrow.png":Ut,"../../assets/imgs/texttures/border.png":Bt,"../../assets/imgs/texttures/circle.png":Rt,"../../assets/imgs/texttures/fenceMap0.png":Gt,"../../assets/imgs/texttures/fenceMap1.png":Et,"../../assets/imgs/texttures/fenceMap2.png":Ft,"../../assets/imgs/texttures/gz-map-fx.jpg":Dt,"../../assets/imgs/texttures/gz-map.jpg":Tt,"../../assets/imgs/texttures/inner-circle.png":Yt,"../../assets/imgs/texttures/lensflare0.png":Xt,"../../assets/imgs/texttures/lensflare0_alpha.png":Jt,"../../assets/imgs/texttures/lensflare1.png":Wt,"../../assets/imgs/texttures/lensflare2.png":$t,"../../assets/imgs/texttures/lensflare3.png":Zt,"../../assets/imgs/texttures/light.png":Nt,"../../assets/imgs/texttures/out-circle.png":Vt,"../../assets/imgs/texttures/point.png":Kt})[`../../assets/imgs${t}/${e}`],self.location).href,Es=(e,t,s)=>t?Qt(t,s):e,Fs=(e,t)=>{const s=new J(t),a={depth:e.config.depth,bevelEnabled:!0,bevelSegments:1,bevelThickness:0,steps:0,bevelSize:0},n=new W(s,a),o=new $({color:e.color.main,map:_s,normalMap:zs,combine:Z,transparent:!0,opacity:.8}),i=new N({color:gs.borderColor,map:Us,transparent:!0,opacity:.9}),r=new f(n,[o,i]);return r.scale.setScalar(e.config.scale),r.name="地图拼块",r},Ds=Gs("label.png",""),Ts=(e,t,s)=>{if(!t.centroid&&!t.center)return!1;const{depth:a,scale:n}=e.config,[o,i]=t.centroid||t.center,r=ds({name:`\n      <img src="${Ds}" />\n      <div class="name">${t.name}</div>\n    `,className:"map-3D-label",position:[o*n,i*n*.995,a*n]});r.rotateX(.5*Math.PI),r.name=t.name+"_CSS3D_label",r.isLabel=!0,s.add(r)},Ys=(e,t,s)=>{if(!t.centroid&&!t.center)return!1;const{depth:a,scale:n}=e.config,o=1+(i=5,r=10,(Math.floor(Math.random()*(r-i+1))+i)/4);var i,r;const[l,c]=t.centroid||t.center,p=xs([l,c,1.01*a].map((e=>e*n)),o*n,{factor:n,color:e.color.markColor1});p.rotateX(-Math.PI/2),s.add(p)},Xs=(e,t,s)=>{const{scale:a,depth:n}=e.config,o=new j,i=.2*a,r=new V(i,32),l=new S({color:gs.scatterColor1,transparent:!0,opacity:1}),c=new f(r,l),p=new K(.8*i,32,32,0,Math.PI),g=new S({color:gs.scatterColor2,transparent:!0,opacity:1}),u=new f(p,g);return o.add(c,u),o.position.set(t*a,s*a,n*a*1.005),o};class Js extends zt{constructor(a,n={},o={},l,c){super(a),i(this,s),i(this,e,void 0),i(this,t,void 0),this.config=Pt(ps,n),this.color=Pt(gs,o),r(this,e,l),r(this,t,c),this.clock=new F,this.css3DRender=us(this.options,this.container),((e,t)=>{_s=Os.load(Es(Gs("gz-map.jpg"),e.map.map,t)),zs=Os.load(Es(Gs("gz-map-fx.jpg"),e.map.normal,t)),Us=Os.load(Es(Gs("border.png"),e.map.side,t)),_s.wrapS=zs.wrapS=Us.wrapS=X,_s.wrapT=zs.wrapT=Us.wrapT=X,_s.flipY=!1;const s=.0128;_s.repeat.set(s,s),zs.repeat.set(s,s),Bs=Os.load(Es(Gs("out-circle.png"),e.map.bgOutCircle,t)),Rs=Os.load(Es(Gs("inner-circle.png"),e.map.bgInnerCircle,t))})(this.config,this.options.baseUrl),this.bindEvent()}addCorrugatedPlate(){this.corrugatedPlate&&(this.disposeObj(this.corrugatedPlate),this.corrugatedPlate=void 0);const e=ys({range:this.config.plateRadius,factor:this.config.scale,color:this.color.plateColor,light:this.color.plateLight});e.renderOrder=0,this.corrugatedPlate=e,this.addObject(e)}initMap(e){this.mapGroup&&(this.disposeObj(this.mapGroup),this.mapGroup=null);const t=new j;t.name="地图";const s=e.features,a=s.length;for(let c=0;c<a;c++){const e=s[c],a=new D,n=e.geometry.coordinates,o=e.properties;for(let t=0;t<n.length;t++)n[t].forEach((e=>{const t=e.map((e=>new T(e[0],e[1]))),s=Fs(this,t);s.isProvinceBlock=!0,a.add(s)}));this.config.areaLabel&&Ts(this,o,a),this.config.markLight&&Ys(this,o,a),a.rotateX(-Math.PI/2),a.isProvinceGroup=!0,a.name=o.name,a.data=o,t.add(a)}this.mapGroup=t,this.addObject(t),this.config.border&&((e,t)=>{let s=Cs(t,{color:gs.line,transparent:!0},"Line2");const{depth:a,scale:n}=e.config;s.name="地图上边框",s.position.y+=a*n;let o=Cs(t,{color:gs.line2},"Line2");o.name="地图下边框",s.scale.setScalar(n),o.scale.setScalar(n),e.scene.add(s),e.scene.add(o)})(this,e);const n=bs(t);let{size:o,center:{x:i,y:r,z:l}}=n;if(Ps.x=i,Ps.y=r,Ps.z=l,this.corrugatedPlate.position.set(i,0-.1*this.config.scale,l),this.resetSceneEle(),this.config.mapBg){const e=o.x<o.y?o.y+1:o.x+1;this.outRingMesh=((e,t)=>{let s=new v(t,t),a=new S({map:Bs,transparent:!0,opacity:.6,depthTest:!0}),n=new f(s,a);const{x:o,z:i}=Ps;return n.position.set(o,-1,i),n.scale.setScalar(1.2),n.rotateX(.5*-Math.PI),e.add(n),n})(this.scene,e*this.config.bgOutFactor),this.innerRingMesh=((e,t)=>{let s=new v(t,t),a=new S({map:Rs,transparent:!0,opacity:.3,depthTest:!0}),n=new f(s,a);const{x:o,z:i}=Ps;return n.position.set(o,-2,i),n.scale.setScalar(1.2),n.rotateX(.5*-Math.PI),e.add(n),n})(this.scene,e*this.config.bgInnerFactor)}}initMapOutLine(e){this.outline&&(this.disposeObj(this.outline),this.outline=null);const t=ks(e,this.config.depth,!1),s=js(t,{factor:this.config.scale,color:this.color.outline});s.renderOrder=10,this.outline=s,this.addObject(s)}initFlywire(e){this.flywireGroup&&(this.disposeObj(this.flywireGroup),this.flywireGroup=null);const{scale:t,depth:s}=this.config,a=this.color;As({depth:s,color:a.line,flyColor:a.flyColor2,pointColor:a.flyColor1,factor:t});const n=new j;for(let o=0;o<e.length;o++){const{coords:s,path:a}=e[o],i=Is(s.map((e=>e.map((e=>e*t)))));i.name=a,n.add(i)}n.name="飞线集合",n.renderOrder=20,this.flywireGroup=n,this.addObject(n)}initMapBar(e,t){if(!this.config.mapBar)return;if(!this.mapGroup)return;this.clearMapBar();const s=Math.max(...e.map((e=>e.value||0))),{scale:a,depth:n}=this.config,o=this.color,i={height:5,size:.2,factor:a,color1:o.markColor1,color2:o.markColor2};for(let r=0;r<e.length;r++){const{name:o="",value:l=0}=e[r],c=this.mapGroup.getObjectByName(o);if(c){const o=l/s||0,{centroid:p,center:g}=c.data,u=p||g,d=Ls({position:[u[0]*a,u[1]*a,n*a],heightRatio:o,label:t(e[r])},i);d.isBar=!0,c.add(d)}else;}}clearMapBar(){this.mapGroup.traverse((e=>{e.isBar&&this.disposeObj(e)}))}initScatter(e){this.scatterGroup&&(this.disposeObj(this.scatterGroup),this.scatterGroup=null);const t=new j;t.name="散点集合";for(let s=0;s<e.length;s++){const a=e[s],[n=0,o=0]=a.coord||[],i=Xs(this,n,o);i.name=a.name,i.data=a,i.isScatter=!0,t.add(i)}t.rotateX(.5*-Math.PI),this.scatterGroup=t,this.addObject(t)}onDblclick(e){}onPointerDown(e){this.pointer.isClick=!0,this.pointer.tsp=e.timeStamp}onPointerMove(e){const t=this.container,n=this.options.scale;if(vs(e,t,n),this.mapGroup){ms.setFromCamera(hs,this.camera);const e=[this.mapGroup];this.scatterGroup&&e.push(this.scatterGroup);const t=ms.intersectObjects(e);if(this.container.style.cursor=t.length?"pointer":"auto",t.length>0){const e=t[0].object;let n;const o=this.findParentGroupGroupUuid(e);o&&(n=o.uuid,l(this,s,a).call(this,o)),this.setMapBlockColor(n)}else l(this,s,a).call(this),this.setMapBlockColor()}}onPointerUp(e){this.pointer.isClick=!1;const t=e.timeStamp-this.pointer.tsp<(this.config.rightClickBackDiffTime||ts.rightClickBackDiffTime);2==e.button||(0==e.button?t&&this.clickObject(e):e.button)}findParentGroupGroupUuid(e){const t=e=>{let s=e.parent;if(s)return s&&s.isProvinceGroup||s.isScatter?s:t(s)};return t(e)}setMapBlockColor(e){this.mapGroup.traverse((t=>{if(t.isProvinceBlock)t.material[0].color.set(t.parent.uuid===e?this.color.mainHover:this.color.main),t.material[1].color.set(t.parent.uuid===e?this.color.borderHoverColor:this.color.borderColor);else if(t.isLabel){const s=t.parent.uuid===e;t.element.className="map-3D-label"+(s?" is-active":"")}}))}clickObject(e){const s=this.container,a=this.options.scale;if(vs(e,s,a),this.scatterGroup){ms.setFromCamera(hs,this.camera);const e=[this.scatterGroup],s=ms.intersectObjects(e);if(this.container.style.cursor=s.length?"pointer":"auto",s.length){const e=s[0].object,a=this.findParentGroupGroupUuid(e).data||{};"function"==typeof o(this,t)&&o(this,t).call(this,a)}}}resetSceneEle(){const{x:e,y:t,z:s}=Ps;if(this.camera.lookAt(e,t,s),new A(this.camera.position).to({x:e,y:90*this.config.scale,z:s+40*this.config.scale},1e3).easing(Y.Quadratic.In).start().onUpdate((()=>{})),this.controls.target=new w(e,t,s-5*this.config.scale),this.grid){this.grid.position.set(e,0,s);const t=this.scene.getObjectByProperty("_isGridFork_",!0);t&&t.position.set(e,0,s)}}modelAnimate(){let e=this.clock.getDelta();this.corrugatedPlate&&ws(this.corrugatedPlate,e),this.css3DRender&&this.css3DRender.render(this.scene,this.camera),Us&&(Us.offset.y+=.005),this.outRingMesh&&(this.outRingMesh.rotation.z+=5e-4),this.innerRingMesh&&(this.innerRingMesh.rotation.z-=5e-4),this.outline&&Ss(this.outline),this.flywireGroup&&Ms()}resize(){if(super.resize(),this.css3DRender){const{width:e,height:t}=this.options;this.css3DRender.setSize(e,t)}}dispose(){this.disposeObj(this.corrugatedPlate),this.disposeObj(this.mapGroup),this.disposeObj(this.scatterGroup),this.disposeObj(this.flywireGroup),this.disposeObj(this.outline),this.disposeObj(this.outRingMesh),this.disposeObj(this.innerRingMesh),this.clock=null,this.css3DRender=null,this.corrugatedPlate=null,this.mapGroup=null,this.scatterGroup=null,this.flywireGroup=null,this.outline=null,this.outRingMesh=null,this.innerRingMesh=null,super.dispose()}}e=new WeakMap,t=new WeakMap,s=new WeakSet,a=function(t){"function"==typeof o(this,e)&&o(this,e).call(this,t,fs)};const Ws=ns(Q({__name:"index",props:{devEnv:{type:Boolean},baseUrl:{},bgColor:{},skyCode:{},bgUrl:{},env:{},scale:{},camera:{default:()=>({})},cruise:{default:()=>({})},fog:{default:()=>({})},render:{default:()=>({})},controls:{default:()=>({})},grid:{default:()=>({})},axes:{default:()=>({})},directionalLight:{},color:{default:()=>({})},config:{default:()=>({})},corrugatedPlate:{type:Boolean,default:!0},mapJson:{},outlineJson:{},flywire:{},barList:{},scatters:{},barLabelRender:{}},emits:["init","click"],setup(e,{expose:t,emit:s}){const{backgroundLoad:a}=ss(),{transformGeoJSON:n}={transformGeoJSON:e=>{let t=e.features;for(let s=0;s<t.length;s++){const e=t[s];"Polygon"===e.geometry.type&&(e.geometry.coordinates=[e.geometry.coordinates])}return e}},{show:o,dialog:i}=as({style:{left:"0px",top:"0px"},extend:{}}),r=e,l=H(),c=s;q((()=>r.scale),(e=>{null==u||u.setScale(e||1)})),q((()=>r.mapJson),(e=>{e&&(null==u||u.initMap(n(e)))})),q((()=>r.outlineJson),(e=>{e&&(null==u||u.initMapOutLine(n(e)),r.barList&&(null==u||u.initMapBar(r.barList||[],p)))})),q((()=>r.flywire),(e=>{null==u||u.initFlywire(e||[])})),q((()=>r.barList),(e=>{null==u||u.initMapBar(e||[],p)})),q((()=>r.scatters),(e=>{null==u||u.initScatter(e||[])}));const p=e=>{if("function"==typeof r.barLabelRender)return r.barLabelRender(e);const{name:t="",value:s=0,unit:a=""}=e;return{name:`\n      <div class="label-wrap">\n        <div class="name">${t}</div>\n        <div class="text">\n          <span class="value">${Ht(s)}</span>\n          <span class="unit">${a}</span>\n        </div>\n      </div>\n    `,className:"map-bar-label"}},g={baseUrl:r.baseUrl,bgUrl:r.bgUrl,env:r.env,bgColor:r.bgColor,camera:r.camera,cruise:r.cruise,fog:r.fog,render:r.render,grid:r.grid,controls:r.controls,axes:r.axes};let u;return ee((()=>{g.container=l.value,u=new Js(g,r.config,r.color,((e,t)=>{let s=!!e;if(s){i.style&&(i.style.left=t.left+"px",i.style.top=t.top+"px");const a=e.isScatter,n=e.data;if(a)n.isScatter=!0,i.extend=n;else{const t=(r.barList||[]).find((t=>t.name==e.name));t?i.extend=t:s=!1}}o.value=s}),(e=>{c("click",te(e))})),u.run(),c("init",u),r.skyCode&&a(u,r.skyCode),r.corrugatedPlate&&(null==u||u.addCorrugatedPlate()),r.flywire&&r.flywire.length&&(null==u||u.initFlywire(r.flywire))})),t({exportImage:()=>null==u?void 0:u.exportImage()}),(e,t)=>(se(),ae("div",{class:oe(e.$style["map-scene"])},[ne("div",{class:oe(e.$style.container),ref_key:"containerRef",ref:l},null,2),ie(o)?(se(),ae("div",{key:0,class:oe(e.$style["dialog-view"]),style:re(ie(i).style)},[le(e.$slots,"dialog",{data:ie(i).extend})],6)):ce("",!0)],2))}}),[["__cssModules",{$style:{"map-scene":"_map-scene_5opvk_2",container:"_container_5opvk_8","dialog-view":"_dialog-view_5opvk_12"}}]]),$s={depth:2,scale:40,plateRadius:100},Zs={main:3377879,mainHover:9633791,borderColor:9633791,borderHoverColor:1066618,light:1066618,lightHover:9633791,plateColor:3377879,plateLight:1066618,line:9559027,line2:6421501,gridColor:663606,gridFork:927811,outline:11856636,markColor1:13303807,markColor2:6945023,flyColor1:9559027,flyColor2:6421501,scatterColor1:9559027,scatterColor2:6421501},Ns=["src"],Vs=ns(Q({__name:"index",setup(e){const{load:t}=(()=>{const e=H(0);return{load:t=>{const s=new pe;return new Promise(((a,n)=>{s.load(t,(e=>{let t={};try{t=JSON.parse(e)}catch(s){}a(t)}),(t=>{let{loaded:s,total:a}=t;e.value=Number((s/a*100).toFixed(0))}),n)}))},progress:e}})(),s=H(),a=ge({devEnv:!0,baseUrl:"",bgColor:464681,color:Zs,config:{...$s,areaLabel:!0,markLight:!0,map:{}},camera:{position:[0,100,200]},directionalLight:{helper:!0},fog:{visible:!1,near:2e3,far:3e3},render:{preserveDrawingBuffer:!0},grid:{visible:!0,gridColor:Zs.gridColor,centerLineColor:Zs.gridColor,fork:!0,divisions:40,width:2*$s.plateRadius*$s.scale,forkSize:1.4*$s.scale,forkColor:Zs.gridFork},controls:{maxPolarAngle:.46*Math.PI,maxDistance:5e3,enableDamping:!0,screenSpacePanning:!1},axes:{visible:!0},mapJson:null,outlineJson:null,flywire:[],barList:[],scatters:[]}),n=()=>{var e;return null==(e=s.value)?void 0:e.exportImage()},o=e=>{const s=a.baseUrl;t(`${s}/oss/map/china.json`).then((e=>{a.mapJson=e})),t(`${s}/oss/map/china-outline.json`).then((e=>{a.outlineJson=e})),qt(e).resize()},i=e=>{fe.info({message:e.name,grouping:!0})},r=e=>{const{name:t="",value:s=0,unit:a=""}=e;return{name:`\n      <div class="label-wrap">\n        <div class="name">${t}</div>\n        <div class="text">\n          <span class="value">${rs(s)}</span>\n          <span class="unit">${a}</span>\n        </div>\n      </div>\n    `,className:"map-bar-label"}},l=()=>{os.get(is.d3.map).then((e=>{const t=[],s=[];return e.list.forEach((e=>{const a=e.projects.length;let n=e.province;["重庆","北京","天津","上海"].includes(n)&&(n+="市"),["台湾"].includes(n)&&(n+="省"),e.projects.forEach((s=>{t.push({coord:[s.lng,s.lat],name:s.name,carbon:s.carbon,value:s.use,total:a,city:e.province,id:s.id})}));const o=e.total;-1===s.findIndex((e=>e.name===n))&&s.push({id:e.code,name:n,total:a,value:o,unit:"kWh"})})),{citys:s,projects:t,lines:e.lines}})).then((e=>{a.flywire=e.lines,a.barList=e.citys,a.scatters=e.projects}))};return ee((()=>{l()})),(e,t)=>{const l=ve;return se(),ae("div",{class:oe([e.$style.page,"h-100 o-h"])},[ne("div",{class:oe(e.$style.operate)},[ue(l,{type:"primary",size:"small",onClick:n},{default:de((()=>t[0]||(t[0]=[me("导出")]))),_:1})],2),ue(Ws,{ref_key:"threeSceneRef",ref:s,"dev-env":ie(a).devEnv,"base-url":ie(a).baseUrl,"bg-color":ie(a).bgColor,"bg-url":ie(a).bgUrl,env:ie(a).env,"sky-code":ie(a).skyCode,camera:ie(a).camera,cruise:ie(a).cruise,render:ie(a).render,controls:ie(a).controls,"directional-light":ie(a).directionalLight,grid:ie(a).grid,axes:ie(a).axes,config:ie(a).config,color:ie(a).color,"map-json":ie(a).mapJson,"outline-json":ie(a).outlineJson,flywire:ie(a).flywire,"bar-list":ie(a).barList,scatters:ie(a).scatters,"bar-label-render":r,onInit:o,onClick:i},{dialog:de((({data:s})=>[ne("div",{class:oe(e.$style["dialog-view"])},[ne("div",{class:oe([e.$style.city,"flex"])},[ne("span",{class:oe(e.$style.name)},he(s.isScatter?s.city:s.name),3),ne("span",{class:oe(e.$style.total)},he(s.total)+"个项目",3)],2),s.isScatter?(se(),ae("div",{key:0,class:oe([e.$style.project,"flex flex-ac"])},[ne("img",{src:`${ie(a).baseUrl}/oss/img/map/pos.png`,alt:""},null,8,Ns),ne("span",{class:oe(e.$style.name)},he(s.name),3)],2)):ce("",!0),ne("div",{class:oe(e.$style.count)},[ne("div",{class:oe(e.$style.item)},[t[1]||(t[1]=ne("span",null,"今日用电量",-1)),ne("span",null,he(ie(rs)(s.value)),1),t[2]||(t[2]=ne("span",null,"kWh",-1))],2),s.isScatter?(se(),ae("div",{key:0,class:oe(e.$style.item)},[t[3]||(t[3]=ne("span",null,"今日碳排放",-1)),ne("span",null,he(ie(rs)(s.carbon)),1),t[4]||(t[4]=ne("span",null,"kgCO₂",-1))],2)):ce("",!0)],2)],2)])),_:1},8,["dev-env","base-url","bg-color","bg-url","env","sky-code","camera","cruise","render","controls","directional-light","grid","axes","config","color","map-json","outline-json","flywire","bar-list","scatters"])],2)}}}),[["__cssModules",{$style:{page:"_page_dcgzt_2",operate:"_operate_dcgzt_8","dialog-view":"_dialog-view_dcgzt_15",city:"_city_dcgzt_20",name:"_name_dcgzt_20",total:"_total_dcgzt_28",project:"_project_dcgzt_33",count:"_count_dcgzt_48",item:"_item_dcgzt_52"}}]]);export{Vs as default};
