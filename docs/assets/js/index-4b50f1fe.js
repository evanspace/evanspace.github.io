var t=Object.defineProperty,e=(e,i,o)=>(((e,i,o)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[i]=o})(e,"symbol"!=typeof i?i+"":i,o),o);import{e as i,ej as o,ek as s,a7 as n,a8 as a,o as r,g as l,h as c,n as d,a9 as h,t as u,q as p,B as m,c as g,au as _,F as y,r as v,u as f,l as C,fg as S,p as x,I as T,m as b,S as M,U as E,V as R,eO as A,bq as O,eE as I,eF as D,eG as w,bi as G,bs as z,bg as k,bm as L,ep as N,er as P,es as H,ez as W,bj as B,eA as U,d6 as j,eB as F,dc as V,bn as Y,dE as $,eJ as K,eI as J,Y as Z,i as q,f as X,aP as Q,ak as tt,aa as et}from"./vendor-01fc5bd0.js";import{t as it}from"./index-02078237.js";import{_ as ot,t as st,d as nt,A as at,c as rt,k as lt,s as ct}from"./index-8ac7069f.js";import{w as dt,i as ht,E as ut,u as pt}from"./scene-resize-9435930a.js";import{u as mt}from"./dialog-1cf917d9.js";const gt=["innerHTML"],_t=ot(i({__name:"tip-msg",props:o({style:{},msg:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=s(t,"modelValue");return(t,i)=>n((r(),l("div",{class:d(t.$style.page),style:h({left:t.style.left+"px",top:t.style.top+"px"})},[c("div",{class:d(t.$style.msg),innerHTML:t.msg},null,10,gt)],6)),[[a,e.value]])}}),[["__cssModules",{$style:{page:"_page_1sskt_2",msg:"_msg_1sskt_12"}}]]),yt={key:0,class:"screen-welcom-dialog"},vt={class:"wrap"},ft={class:"body"},Ct={class:"title"},St={class:"bg"},xt={class:"text"},Tt={class:"content"},bt=i({__name:"edit-dialog",props:o({title:{},errMessage:{}},{modelValue:{type:Boolean},modelModifiers:{},content:{},contentModifiers:{}}),emits:o(["confirm"],["update:modelValue","update:content"]),setup(t,{emit:e}){const i=t,o=s(t,"modelValue"),n=s(t,"content"),a=e,d=()=>{st(n.value||"")?(o.value=!1,a("confirm",n.value)):g.warning({message:i.errMessage,grouping:!0})};return(t,e)=>{const i=_;return o.value?(r(),l("div",yt,[c("div",{class:"mask",onClick:e[0]||(e[0]=t=>o.value=!o.value)}),c("div",vt,[c("div",ft,[c("div",Ct,[c("div",St,u(t.title),1),c("div",xt,u(t.title),1)]),c("div",Tt,[p(i,{type:"textarea",modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value=t),placeholder:"请输入",maxlength:"40","show-word-limit":""},null,8,["modelValue"])]),c("div",{class:"footer"},[c("div",{class:"btn",onClick:d})])])])])):m("",!0)}}}),Mt="",Et={baseUrl:Mt,bgSrc:"/oss/img/office/bg.jpg",sky:{day:"/oss/textures/hdr/101.hdr",evening:"/oss/textures/hdr/201.hdr",night:"/oss/textures/hdr/301.hdr"},indexDB:{cache:!0,dbName:"THREE__OFFICE__GPU_DB",tbName:"TB",version:46},hoverDistance:{empty:100},hoverNameSuffix:"-区域",toBridMeshName:"主建筑",curtainMeshName:"_GROUP_013_grp",clickIntervalTime:150,personSightOffset:{x:0,y:3.5,z:.1},personSightClass:"person-sight",personKeys:[{code:"W",desc:"前进"},{code:"S",desc:"后退"},{code:"A",desc:"向左转向"},{code:"D",desc:"向右转向"},{code:"X",desc:"加速"},{code:"Z",desc:"减速"}],personDefaultAnimateName:"PlayOne-Headnod",personRuningAnimateName:"PlayOne-Walk",personRuningSpeed:5,liftGroundMeshName:["电梯地板002","电梯地板"],groundMeshName:["地面002","立方体306","平面118","立方体475","立方体514","立方体552","地面020","地面","平面391","立方体474","立方体1617","ground"],companyModelName:"二十五楼",collisionSpace:1,moveFactor:1,styleTimes:[[8,18],[18,20],[20,8]],fleetings:[[[-1247.3804124641044,1.5,275.8568665121467],[-385.54913233299317,1.5,235.37414186604545],[-74.15440788927455,1.5,249.36770549275383],[465.22573985771027,1.5,245.43607244481086],[725.5941701917296,1.5,249.85748872521614],[1298.4540604962947,1.5,246.2826397113465],[1540.3121752120794,1.5,248.16462011553776],[2035.0305758526924,1.5,250.3197618335575],[2247.330156763603,1.5,247.35851806181827],[2614.171817337305,1.5,241.05764461471873]],[[653.0182392436438,1.5,186.20541161524878],[640.5314650233396,1.5,-478.1628829727225],[641.5186617371273,1.5,-741.7856284596322],[641.8860570932816,1.5,-1180.303297128374],[636.5706330757,1.5,-1435.6099074377244],[651.4496990930706,1.5,-2151.481360404476]],[[-184.48466894299744,1.5,2447.03846990951],[-186.588766153597,1.5,1617.8540886409082],[-184.69458845133832,1.5,1300.1784227505875],[-186.39769511236557,1.5,361.1691127475875],[-181.39186291802253,1.5,100.79623785390046],[-153.08794728573116,1.5,-361.6354243767241],[-149.96162120866242,1.5,-670.0291574302669],[-143.93274083461012,1.5,-1094.1977278309487],[-146.55180744515872,1.5,-1375.823600978301],[-116.02623152983233,1.5,-2108.4946603582016]],[[254.9890486347282,1.5,188.40181034697815],[248.52761744154438,1.5,-519.7744116293145]],[[-1247.9079420458377,1.5,301.9431764689599],[-383.5097210507664,1.5,264.71915732788005],[-71.23512580197027,1.5,275.3629302523157],[466.128250712296,1.5,275.2716282312793],[741.6370632026585,1.5,277.66102510376084],[1297.4737719762595,1.5,277.2168628506806],[1541.7297005023304,1.5,280.31972525507285],[2037.2405649559382,1.5,280.98678580599466],[2246.595015753523,1.5,283.1011600230837],[2617.1867659153927,1.5,278.8253659556488]],[[2611.3420640520076,1.5,163.96935494305524],[2239.038081627408,1.5,174.12102368223074],[2032.5550985659966,1.5,188.6090112066963],[1532.405982209116,1.5,189.6348998853747],[1298.330733919915,1.5,185.10779629834326],[732.0840195081455,1.5,187.16481480781331],[470.24205339525065,1.5,189.90699833376397],[-84.06660102385868,1.5,192.15782227582906],[-384.7643865790769,1.5,185.23744642336993],[-1257.0964658502476,1.5,220.7083203147085]],[[-1494.2513045295325,1.5,-523.9699855391409],[-347.25187028816856,1.5,-474.65671096988984],[-15.027389984711675,1.5,-487.5419186263196],[460.1280047533312,1.5,-554.9641189234129],[769.3595908495539,1.5,-610.2755139698855],[1295.7126441671367,1.5,-685.7478189381841],[1514.966726681715,1.5,-702.0163690628412],[2028.26504557221,1.5,-708.4714990968719],[2229.5644216212645,1.5,-702.2878946149901],[2629.0123847430777,1.5,-711.4343799242977]],[[2617.633985591895,1.5,201.60419658108776],[2243.909428783476,1.5,206.87474446964558],[2034.8776601667457,1.5,214.17713607035415],[1533.6654999142486,1.5,216.16096497050023],[1292.917491810635,1.5,211.694521877535],[733.5212884806997,1.5,212.4150255097067],[468.0441428401828,1.5,211.83554003650767],[-81.88484692151263,1.5,215.50162318985943],[-385.33313200911095,1.5,208.79517510379873],[-1252.2402103549757,1.5,246.2595475811134]],[[-216.74411496965007,1.5,2446.1899911004953],[-212.54025051280874,1.5,1618.4430966822365],[-213.1531765155122,1.5,1299.5372821282467],[-212.88029306826311,1.5,361.004463092096],[-204.31776521867644,1.5,95.17239553880012],[-175.35362468958635,1.5,-361.2624545092945],[-176.90039928865932,1.5,-675.9746927279216],[-169.7193594972355,1.5,-1094.745742326411],[-170.74265977198806,1.5,-1381.291722860903],[-143.83153846069854,1.5,-2106.089132268412]],[[-166.69061346783928,1.5,-2106.8143772513126],[-198.0488246554272,1.5,-1381.582043826204],[-199.7107069657603,1.5,-1095.6028221394768],[-206.74060670641225,1.5,-677.0697121202405],[-202.700259003459,1.5,-365.7406797551388],[-230.01591899796063,1.5,91.60705400934745],[-242.9062425497127,1.5,359.4021473586805],[-242.27821018691782,1.5,1297.7164477844215],[-242.66307406448757,1.5,1615.4387891061058],[-243.2521320513111,1.5,2442.9364318668368]],[[-191.438779413371,1.5,-2106.3282094666683],[-220.73958879833555,1.5,-1384.5763798106966],[-227.4255891103798,1.5,-1097.5557009252084],[-232.3590701921136,1.5,-676.5102411464416],[-229.60449004853604,1.5,-363.66500472487803],[-254.03347391022893,1.5,88.02859900453808],[-270.9119445790846,1.5,355.8050561117999],[-271.8960506127454,1.5,1297.4563069322603],[-269.32241688262354,1.5,1619.2232293653196],[-269.6085197110389,1.5,2442.486822687859]],[[-1490.9279956818982,1.5,-546.4210301147804],[-347.46827976878035,1.5,-499.19644259345415],[-10.407826447936372,1.5,-512.7596249145535],[456.4211224463379,1.5,-576.9125511231589],[759.2761525703872,1.5,-631.8081248108039],[1293.0791107409004,1.5,-705.0280213831614],[1508.7704296505792,1.5,-728.3802290028357],[2032.6982432385287,1.5,-731.5117672205906],[2219.6072248811265,1.5,-734.637580331011],[2625.643276984354,1.5,-743.8101299753371]],[[2626.3901700736037,1.5,-781.1017696857378],[2220.8514498299905,1.5,-769.0356255284045],[2032.2913703532724,1.5,-762.8575496165022],[1511.3552256541166,1.5,-759.2404009381686],[1286.7820276626376,1.5,-730.1059576100947],[756.3682832855267,1.5,-652.7145464611291],[452.61843137679864,1.5,-606.8682449037161],[-12.78416595913032,1.5,-543.2368997160044],[-343.08772274031026,1.5,-527.962481270673],[-1489.2130939698452,1.5,-574.8731410713193]],[[2623.1011840628594,1.5,-814.6475022807425],[2216.036849549517,1.5,-801.011576545054],[2030.0825780786195,1.5,-787.8840257205616],[1506.3601369519993,1.5,-784.4496008940721],[1287.1959219288165,1.5,-752.7952322380231],[752.9829675686118,1.5,-673.170208139215],[445.89106268451593,1.5,-631.647110579748],[-19.911685547898884,1.5,-566.4904449943363],[-345.4294265338732,1.5,-548.87622952709],[-1491.0183116346152,1.5,-596.5878109151417]],[[231.82903145902645,1.5,189.17638213146898],[224.3313036580691,1.5,-523.6629269807526]],[[199.34569678838128,1.5,-519.3457911109576],[206.1046050573263,1.5,188.7851087774285]],[[174.1270577790077,1.5,-515.3193396429033],[182.4833928328745,1.5,188.894326911243]],[[622.1583807823386,1.5,185.58693904691773],[615.5669746892655,1.5,-478.02316117666794],[616.5459390204022,1.5,-744.0007790209756],[613.1324539553776,1.5,-1181.9088663464408],[611.6114090950623,1.5,-1438.6207884389128],[628.3415357586932,1.5,-2153.3845865461985]],[[602.78350309092,1.5,-2154.719743541784],[583.8038920679553,1.5,-1440.8315284661855],[586.7498907865534,1.5,-1180.8808974289223],[586.8406384033154,1.5,-747.7377094033409],[586.8508956121347,1.5,-484.2064033588732],[593.0310370827052,1.5,185.91229223707006]],[[578.7234766214117,1.5,-2156.363001113399],[561.8484645719363,1.5,-1438.6215071324666],[560.7857436547948,1.5,-1182.8499596656188],[560.3517043728388,1.5,-745.4949702873103],[557.7773034922892,1.5,-480.2852643380643],[558.7645775584266,1.5,186.38583329069326]],[[-1484.025498440763,1.5,1589.088331309893],[-393.96910868208226,1.5,1516.2559403282253],[-74.7466791237108,1.5,1497.2077562666695],[1256.1050380329816,1.5,1412.9053951256778],[1545.7613661614432,1.5,1375.475445534589],[2019.3052651779678,1.5,1347.0045562400246],[2264.380569551577,1.5,1321.736985473143],[2621.038902449388,1.5,1303.2632694976223]],[[2615.521068926143,1.5,1238.5780936003941],[2258.3918670930802,1.5,1261.9895519289669],[2015.9065155623832,1.5,1279.1369316700068],[1543.5687412388943,1.5,1313.0857264496485],[1255.9910752964493,1.5,1347.0259911383498],[-74.73105195415519,1.5,1433.156851131467],[-395.3144573092685,1.5,1450.856342285389],[-1484.7746552134213,1.5,1518.2654466877468]],[[-1486.2521698460682,1.5,1553.8383362668728],[-396.19750801269345,1.5,1482.7486065742262],[-71.92088044886327,1.5,1464.5297925685127],[1256.918068908873,1.5,1380.3764995293263],[1545.485404268628,1.5,1347.0908211842523],[2017.8608712283437,1.5,1312.5458999512684],[2263.3526606706505,1.5,1291.6292619335034],[2618.0900692681894,1.5,1271.7679045071297]],[[2609.2336753049603,1.5,1207.2326715997492],[2258.0447448771533,1.5,1234.200060988093],[2013.2433453232213,1.5,1246.4385924864744],[1537.9497670856265,1.5,1285.6015154261588],[1246.9671405964586,1.5,1319.4097956914059],[-76.34105135541756,1.5,1400.1133691807436],[-403.6761898257357,1.5,1426.2143591380525],[-1488.8439414589297,1.5,1488.4834195052688]],[[-1489.9127119985296,1.5,-1305.0787226341486],[-354.29187759205456,1.5,-1199.4424925727942],[-17.325336635572626,1.5,-1210.9973136817894],[479.38519152284806,1.5,-1253.4931898814023],[712.7186683885026,1.5,-1277.225823638084],[1251.9705359784543,1.5,-1323.1594271542313],[1536.9075733445457,1.5,-1342.4231138533764],[2633.970640303025,1.5,-1441.150769865169]],[[2626.7360744966045,1.5,-1500.0907029322143],[1536.1874247547,1.5,-1393.944739235368],[1249.9934542169772,1.5,-1372.6442832591213],[706.0316536599506,1.5,-1323.3622498761565],[475.75181205384024,1.5,-1304.4244974268722],[-23.831381496092263,1.5,-1258.6965801793433],[-345.81148653711205,1.5,-1246.9140156460867],[-1488.2813502899066,1.5,-1360.6189050427602]],[[-1489.3330840643912,1.5,-1333.3203188878533],[-345.07038603482135,1.5,-1224.0929300365299],[-19.92873696625179,1.5,-1232.701480252149],[481.0928175641447,1.5,-1277.4934279216766],[713.0346817725144,1.5,-1300.2035395183932],[1253.4400925497391,1.5,-1349.6955854297387],[1531.382167354786,1.5,-1367.9632989336503],[2628.8682212127546,1.5,-1472.9252382891727]],[[2628.36687079996,1.5,-1531.557671018591],[1531.4864401770299,1.5,-1420.701301081861],[1240.9120402885014,1.5,-1394.9797637220593],[704.2016429913713,1.5,-1347.7184457859767],[476.2658333877147,1.5,-1322.90344068362],[-26.623918325591035,1.5,-1281.7971567634181],[-345.49130989835896,1.5,-1270.872303562496],[-1485.277362327018,1.5,-1387.7346376410196]]],streetLamps:[[-374.6,30,284.2],[-372,30,168.8],[-95.35,30,299.24],[-95.31,30,168.33],[272.61,30,299.17],[276.47,30,168.4],[271.04,30,-58.709],[159.86,30,-56.24],[-134.27,30,30.457],[-247.92,30,-302.57]],residentLights:[[-13,169.8,447.2],[619,179.7,442.5]],airWinds:[{name:"_空调风_grp",list:[{width:5,height:20,position:{x:21.7,y:192.6,z:41.87},rotation:{x:0,y:0,z:-15}},{width:5,height:20,position:{x:24.83,y:192.6,z:41.08},rotation:{x:0,y:0,z:-15}},{width:5,height:20,position:{x:29.36,y:192.6,z:39.94},rotation:{x:0,y:0,z:-15}},{width:5,height:20,position:{x:31.36,y:192.6,z:39.43},rotation:{x:0,y:0,z:-15}},{width:5,height:20,position:{x:37.15,y:192.6,z:37.98},rotation:{x:0,y:0,z:-15}},{width:5,height:21,position:{x:41.58,y:192.6,z:36.86},rotation:{x:0,y:0,z:-15}},{width:5,height:22,position:{x:44.82,y:192.6,z:36.04},rotation:{x:0,y:0,z:-15}},{width:5,height:23,position:{x:49.28,y:192.6,z:34.92},rotation:{x:0,y:0,z:-15}},{width:5,height:23,position:{x:53.33,y:192.6,z:33.9},rotation:{x:0,y:0,z:-15}},{width:5,height:20,position:{x:-25.5,y:192.6,z:39.8},rotation:{x:0,y:0,z:5}},{width:5,height:20,position:{x:-21.5,y:192.6,z:39.9},rotation:{x:0,y:0,z:5}},{width:5,height:20,position:{x:-16.5,y:192.6,z:40},rotation:{x:0,y:0,z:5}},{width:5,height:20,position:{x:-11.5,y:192.6,z:40.1},rotation:{x:0,y:0,z:5}},{width:5,height:20,position:{x:-6.5,y:192.6,z:40.2},rotation:{x:0,y:0,z:5}},{width:5,height:20,position:{x:-1.5,y:192.6,z:40.3},rotation:{x:0,y:0,z:5}},{width:5,height:20,position:{x:3.5,y:192.6,z:40.4},rotation:{x:0,y:0,z:5}},{width:5,height:20,position:{x:8.5,y:192.6,z:40.5},rotation:{x:0,y:0,z:5}},{width:5,height:20,position:{x:13.5,y:192.6,z:40.6},rotation:{x:0,y:0,z:5}},{width:5,height:20,position:{x:18.5,y:192.6,z:42.35},rotation:{x:0,y:0,z:5}},{width:5,height:36,position:{x:-36,y:192.6,z:2.7},rotation:{x:0,y:0,z:180}},{width:5,height:36,position:{x:-31,y:192.6,z:2.7},rotation:{x:0,y:0,z:180}},{width:5,height:36,position:{x:-26,y:192.6,z:2.7},rotation:{x:0,y:0,z:180}},{width:5,height:36,position:{x:-21,y:192.6,z:2.7},rotation:{x:0,y:0,z:180}},{width:5,height:36,position:{x:-17,y:192.6,z:2.7},rotation:{x:0,y:0,z:180}}]},{name:"陈总办公室",list:[{width:5,height:15,position:{x:-41,y:192.6,z:29.5},rotation:{x:0,y:0,z:90}},{width:5,height:15,position:{x:-41,y:192.6,z:35.3},rotation:{x:0,y:0,z:90}}]},{name:"逄总办公室",list:[{width:5,height:15,position:{x:-41,y:192.6,z:10.2},rotation:{x:0,y:0,z:90}},{width:5,height:15,position:{x:-41,y:192.6,z:15.3},rotation:{x:0,y:0,z:90}},{width:5,height:15,position:{x:-41,y:192.6,z:20.3},rotation:{x:0,y:0,z:90}}]},{name:"财务室",list:[{width:5,height:15,position:{x:-41,y:192.6,z:-9},rotation:{x:0,y:0,z:90}},{width:5,height:15,position:{x:-41,y:192.6,z:-4},rotation:{x:0,y:0,z:90}},{width:5,height:15,position:{x:-41,y:192.6,z:1},rotation:{x:0,y:0,z:90}}]},{name:"CFO办公室",list:[{width:5,height:15,position:{x:-41,y:192.6,z:-30},rotation:{x:0,y:0,z:90}},{width:5,height:15,position:{x:-41,y:192.6,z:-25},rotation:{x:0,y:0,z:90}},{width:5,height:15,position:{x:-41,y:192.6,z:-20},rotation:{x:0,y:0,z:90}}]},{name:"大会议室",list:[{width:5,height:13,position:{x:-35,y:192.6,z:46.67},rotation:{x:0,y:0,z:5}},{width:5,height:10,position:{x:-42,y:192.6,z:46.67},rotation:{x:0,y:0,z:5}},{width:5,height:16,position:{x:-36.5,y:192.6,z:46.67},rotation:{x:0,y:0,z:5}},{width:5,height:16,position:{x:-31.5,y:192.6,z:46.7},rotation:{x:0,y:0,z:5}}]},{name:"大洽谈室",list:[{width:5,height:10,position:{x:55.7,y:192.6,z:27},rotation:{x:0,y:0,z:-90}},{width:5,height:10,position:{x:55.7,y:192.6,z:32},rotation:{x:0,y:0,z:-90}},{width:5,height:13,position:{x:55.7,y:192.6,z:37},rotation:{x:0,y:0,z:-90}}]},{name:"程总办公室",list:[{width:5,height:10,position:{x:55.7,y:192.6,z:19},rotation:{x:0,y:0,z:-90}},{width:5,height:10,position:{x:55.7,y:192.6,z:14},rotation:{x:0,y:0,z:-90}}]},{name:"_老板办公室_grp",list:[{width:5,height:32,position:{x:35,y:192.6,z:2.7},rotation:{x:0,y:0,z:180}},{width:5,height:32,position:{x:40,y:192.6,z:2.7},rotation:{x:0,y:0,z:180}},{width:5,height:32,position:{x:45,y:192.6,z:2.7},rotation:{x:0,y:0,z:180}},{width:5,height:32,position:{x:50,y:192.6,z:2.7},rotation:{x:0,y:0,z:180}},{width:5,height:32,position:{x:55,y:192.6,z:2.7},rotation:{x:0,y:0,z:180}},{width:5,height:32,position:{x:60,y:192.6,z:2.7},rotation:{x:0,y:0,z:180}},{width:5,height:32,position:{x:65,y:192.6,z:2.7},rotation:{x:0,y:0,z:180}}]}],diffusionImg:"/oss/textures/diffusion/101.png",screenVideo:"/oss/textures/park/sintel.mp4",videoCover:"/oss/textures/office/cover.jpg",airParticleTexture:"/oss/textures/effect/snowflake.png",cameraTransitionList:[{name:"一楼大门",to:{x:-1.3,y:6.2,z:102.3},target:{x:-1.4,y:5.8,z:97.4}},{name:"前台",areaCode:1,to:{x:15.3,y:188,z:33.2},target:{x:15.3,y:188,z:36.3}},{name:"办公",areaCode:2,to:{x:-29.82,y:188,z:41.52},target:{x:-25.43,y:188,z:43.88}},{name:"大会议室",areaCode:3,to:{x:-28.8,y:188,z:52.7},target:{x:-33.7,y:188,z:53.4}},{name:"陈总办公室",areaCode:4,to:{x:-41.79,y:188,z:27.52},target:{x:-43.1,y:188,z:29.4}},{name:"逄总办公室",areaCode:5,to:{x:-43.1,y:188,z:8.2},target:{x:-44.5,y:188,z:10.7}},{name:"财务部",areaCode:6,to:{x:-42.57,y:188,z:-13.37},target:{x:-43.2,y:188,z:-12.2}},{name:"CFO",areaCode:7,to:{x:-42.8,y:188,z:-14.7},target:{x:-44,y:188,z:-17.2}},{name:"洽谈室一",areaCode:8,to:{x:-14.47,y:188,z:-25.92},target:{x:-16.8,y:188,z:-24.6}},{name:"人事部",areaCode:9,to:{x:-16.35,y:188,z:32.75},target:{x:-19.02,y:188,z:29.2}},{name:"小会议室",areaCode:10,to:{x:-9.9,y:188,z:28.9},target:{x:-10,y:188,z:26}},{name:"洽谈室二",areaCode:11,to:{x:46.3,y:188,z:28.9},target:{x:43.6,y:188,z:27.2}},{name:"茶室",areaCode:12,to:{x:42.8,y:188,z:3.27},target:{x:42,y:188,z:4.3}},{name:"总裁",areaCode:13,to:{x:69.4,y:188,z:-.4},target:{x:65,y:188,z:-2.7}},{name:"程总办公室",areaCode:14,to:{x:56.57,y:188,z:23.3},target:{x:58.4,y:188,z:21.8}},{name:"大洽谈室",areaCode:15,to:{x:56.14,y:188,z:30.42},target:{x:59.1,y:188,z:30.3}},{name:"研发及商务",areaCode:16,to:{x:70.5,y:188,z:42.16},target:{x:68.9,y:188,z:43.1}}],selectObject:{color:2621360,bloomIntensity:.3},cameraMaxDistance:{indoor:5,roam:1,threePerson:8},sightToggle:!1,dotVisibleDistance:{max:20,min:7},debounceDuration:1e3,envRefreshLimitTime:1e4},Rt=ot(i({__name:"first-person",setup(t){const e=Et.personKeys||[];return(t,i)=>(r(),l("div",{class:d([t.$style.page,f(Et).personSightClass])},[c("div",{class:d(t.$style.tip)},[(r(!0),l(y,null,v(f(e),(e=>(r(),l("div",{class:d(t.$style.item)},[c("span",null,u(e.code),1),c("span",null,u(e.desc),1)],2)))),256))],2),c("div",{class:d(t.$style.center)},null,2)],2))}}),[["__cssModules",{$style:{page:"_page_13ksh_2",tip:"_tip_13ksh_15",item:"_item_13ksh_22",center:"_center_13ksh_34"}}]]),At=["CAMERA:ROAM","CAMERA:CRUISE","CAMERA:RESET","CAMERA:FIRST","CAMERA:THREE","CAMERA:GATE","CAMERA:RECCEPTION","CAMERA:OFFICE","CAMERA:LCR","CAMERA:BOSS","PERSON:ADD","PERSON:SUB","LIGHT:RECCEPTION","LIGHT:AILSE","LIGHT:PM","LIGHT:HOST","LIGHT:LCR","LIGHT:CLG","LIGHT:FIRSTFLOOR","LIGHT:CLOSE","LIGHT:AUTO","CURTAIN:TOGGLE","DOOR:COMPANY","DOOR:LCR","DOOR:BOSS","SCREEN:COMPANY","SCREEN:WELCOM","SCREEN:SCR","SCREEN:LCR","AIR:MAIN","AIR:ODD","AIR:WINDADD","AIR:WINDSUB","SCENE:POS","SCENE:TEST","SCENE:SCREENSHOT","SKY:DAY","SKY:EVENING","SKY:NIGHT","EFFECT:FLEETING","BIRD:COMPANY","UPDATE:DOT3"];const Ot=new class{constructor(){e(this,"listteners",At.reduce(((t,e)=>(t[e]=new Set,t)),{}))}on(t,e){this.listteners[t].forEach((i=>{i.toString()===e.toString()&&this.listteners[t].delete(i)})),this.listteners[t].add(e)}emit(t,...e){this.listteners[t].forEach((t=>t(...e)))}},It={class:"scene-operation"},Dt=i({__name:"oprtation",props:{list:{},scene:{}},emits:["change"],setup(t,{emit:e}){const i=t,o=e,s=t=>{for(let e=0;e<t.length;e++){const i=t[e].userData.data;Ot.emit("UPDATE:DOT3",{code:i.code,temperature:23+Number((1*Math.random()-.7).toFixed(2)),humidity:70+Number((1*Math.random()-.7).toFixed(2)),co2:418+Number((5*Math.random()-3).toFixed(2))})}},n=()=>{var t;if(!i.scene)return;const e=null==(t=i.scene)?void 0:t.getLocation();s(e)},a=()=>{var t;i.scene&&s(null==(t=i.scene.dot3Group)?void 0:t.children)};let d;return C((()=>{d=setInterval(a,Et.envRefreshLimitTime)})),S((()=>{clearInterval(d)})),(t,e)=>{const i=M,s=E,d=R;return r(),l("div",It,[c("div",{class:"btn",onClick:e[0]||(e[0]=()=>f(Ot).emit("SCENE:POS"))},"场景坐标"),c("div",{class:"btn",onClick:e[1]||(e[1]=()=>f(Ot).emit("SCENE:TEST"))},"测试"),p(d,{class:"btn",placement:"top","hide-on-click":!1},{dropdown:x((()=>[p(s,null,{default:x((()=>[p(i,{onClick:n},{default:x((()=>e[21]||(e[21]=[T("视角数据更新")]))),_:1}),p(i,{onClick:a},{default:x((()=>e[22]||(e[22]=[T("全数据更新")]))),_:1})])),_:1})])),default:x((()=>[e[23]||(e[23]=c("div",null,"数据",-1))])),_:1}),p(d,{class:"btn",placement:"top","hide-on-click":!1},{dropdown:x((()=>[p(s,null,{default:x((()=>[p(i,{onClick:e[3]||(e[3]=()=>f(Ot).emit("CAMERA:ROAM"))},{default:x((()=>e[24]||(e[24]=[T("全景漫游")]))),_:1}),p(i,{onClick:e[4]||(e[4]=()=>f(Ot).emit("CAMERA:CRUISE"))},{default:x((()=>e[25]||(e[25]=[T("定点巡航")]))),_:1}),p(i,{onClick:e[5]||(e[5]=()=>f(Ot).emit("CAMERA:FIRST"))},{default:x((()=>e[26]||(e[26]=[T("第一人称")]))),_:1}),p(i,{onClick:e[6]||(e[6]=()=>f(Ot).emit("CAMERA:THREE"))},{default:x((()=>e[27]||(e[27]=[T("第三人称")]))),_:1}),p(i,{onClick:e[7]||(e[7]=()=>f(Ot).emit("BIRD:COMPANY"))},{default:x((()=>e[28]||(e[28]=[T("鸟瞰视角")]))),_:1})])),_:1})])),default:x((()=>[c("div",{onClick:e[2]||(e[2]=()=>f(Ot).emit("CAMERA:RESET"))},"视角重置")])),_:1}),p(d,{class:"btn",placement:"top","hide-on-click":!1},{dropdown:x((()=>[p(s,null,{default:x((()=>[(r(!0),l(y,null,v(t.list,(t=>(r(),b(i,{class:"item",onClick:e=>o("change",t)},{default:x((()=>[T(u(t.name),1)])),_:2},1032,["onClick"])))),256))])),_:1})])),default:x((()=>[e[29]||(e[29]=c("div",null,"区域视角",-1))])),_:1}),p(d,{class:"btn",placement:"top","hide-on-click":!1},{dropdown:x((()=>[p(s,null,{default:x((()=>[p(i,{onClick:e[8]||(e[8]=()=>f(Ot).emit("LIGHT:CLG"))},{default:x((()=>e[30]||(e[30]=[T("主灯开关")]))),_:1}),p(i,{onClick:e[9]||(e[9]=()=>f(Ot).emit("LIGHT:FIRSTFLOOR"))},{default:x((()=>e[31]||(e[31]=[T("一楼开关")]))),_:1}),p(i,{onClick:e[10]||(e[10]=()=>f(Ot).emit("LIGHT:LCR",null,Math.floor(5*Math.random())))},{default:x((()=>e[32]||(e[32]=[T("大会议室")]))),_:1})])),_:1})])),default:x((()=>[e[33]||(e[33]=c("div",null,"开关灯",-1))])),_:1}),p(d,{class:"btn",placement:"top","hide-on-click":!1},{dropdown:x((()=>[p(s,null,{default:x((()=>[p(i,{onClick:e[11]||(e[11]=()=>f(Ot).emit("SKY:DAY"))},{default:x((()=>e[34]||(e[34]=[T("白天")]))),_:1}),p(i,{onClick:e[12]||(e[12]=()=>f(Ot).emit("SKY:EVENING"))},{default:x((()=>e[35]||(e[35]=[T("傍晚")]))),_:1}),p(i,{onClick:e[13]||(e[13]=()=>f(Ot).emit("SKY:NIGHT"))},{default:x((()=>e[36]||(e[36]=[T("夜间")]))),_:1})])),_:1})])),default:x((()=>[e[37]||(e[37]=c("div",null,"主题",-1))])),_:1}),p(d,{class:"btn",placement:"top","hide-on-click":!1},{dropdown:x((()=>[p(s,null,{default:x((()=>[p(i,{onClick:e[14]||(e[14]=()=>f(Ot).emit("AIR:MAIN"))},{default:x((()=>e[38]||(e[38]=[T("空调开关")]))),_:1}),p(i,{onClick:e[15]||(e[15]=()=>f(Ot).emit("AIR:WINDADD"))},{default:x((()=>e[39]||(e[39]=[T("空调风速+")]))),_:1}),p(i,{onClick:e[16]||(e[16]=()=>f(Ot).emit("AIR:WINDSUB"))},{default:x((()=>e[40]||(e[40]=[T("空调风速-")]))),_:1})])),_:1})])),default:x((()=>[e[41]||(e[41]=c("div",null,"空调",-1))])),_:1}),c("div",{class:"btn",onClick:e[17]||(e[17]=()=>f(Ot).emit("CURTAIN:TOGGLE"))},"窗帘开关"),c("div",{class:"btn",onClick:e[18]||(e[18]=()=>f(Ot).emit("EFFECT:FLEETING"))},"流光开关"),p(d,{class:"btn",placement:"top","hide-on-click":!1},{dropdown:x((()=>[p(s,null,{default:x((()=>[p(i,{onClick:e[19]||(e[19]=()=>f(Ot).emit("PERSON:ADD"))},{default:x((()=>e[42]||(e[42]=[T("人物加速+")]))),_:1}),p(i,{onClick:e[20]||(e[20]=()=>f(Ot).emit("PERSON:SUB"))},{default:x((()=>e[43]||(e[43]=[T("人物减速-")]))),_:1})])),_:1})])),default:x((()=>[e[44]||(e[44]=c("div",null,"人物速度",-1))])),_:1})])}}}),wt={M_MAIN_SCENE:"MAIN_SCENE",M_CURTAIN:"curtain",M_CAMPANY_FLOOR:"campany_floor",M_COMPANY_EMPTY_GROUP:"company_empty_group",M_PERSON:"PERSON",M_ROBOT:"ROBOT",M_MODE_SWITCH:"MODE_SWITCH",M_ANCHOR_POS:"ANCHOR_POS",M_ANCHOR_TARGET:"ANCHOR_TARGET",M_WAIT_LIFT:"WAIT_LIFT",M_DOUBLE_HORIZONTAL_SWITCH:"DOUBLE_HORIZONTAL_SWITCH",M_DOUBLE_ROTATE_SWITCH:"DOUBLE_ROTATE_SWITCH",M_ODD_ROTATE_SWITCH:"ODD_ROTATE_SWITCH",M_VIDEO_SWITCH:"VIDEO_SWITCH",M_SCREEN_EDIT:"SCREEN_EDIT",M_CURTAIN_SWITCH:"CURTAIN_SWITCH",M_GATE_SWITCH:"GATE_SWITCH",M_LIGHT_MAIN_SWITCH:"LIGHT_MAIN_SWITCH",M_LIGHT_SWITCH:"LIGHT_SWITCH",M_AIR_SWITCH:"AIR_SWITCH",DOT:"DOT",DOT3:"DOT3"},Gt=[{key:wt.M_MAIN_SCENE,name:"场景",size:13.6,url:"/公司总部.glb"},{key:wt.M_CAMPANY_FLOOR,name:"公司",size:14.6,url:"/二十五楼.glb"},{key:"floor_low",name:"低层",size:6.1,url:"/低层.glb"},{key:wt.M_CURTAIN,name:"窗帘",size:.2,url:"/窗帘.glb"},{key:"floor_heigh",name:"高层",size:.5,url:"/高层.glb"},{key:wt.M_COMPANY_EMPTY_GROUP,name:"高层",size:.02,url:"/二十五楼-空组.glb"},{key:wt.M_PERSON,name:"人物",size:1.8,url:"/oss/model/common/人物.glb"},{key:"spot_light_floor_1",type:"spotlight",name:"主机聚光灯",intensity:8,color:16777197,castShadow:!1,distance:20,penumbra:.5},{key:"spot_light_floor_1_2",type:"spotlight",name:"主机聚光灯",intensity:8,color:16777197,castShadow:!0,distance:20,penumbra:.5,mapUrl:"/oss/textures/disturb.jpg"},{key:"spot_light_floor_2",type:"spotlight",name:"会议室聚光灯",intensity:20,color:16777197,castShadow:!1,penumbra:.5,angle:.36*Math.PI,distance:10,iesMap:"/oss/ies/103.ies"},{key:"spot_light_floor_3",type:"spotlight",name:"屏幕聚光灯",intensity:1,color:16777197,distance:15,penumbra:.5,castShadow:!1,angle:.36*Math.PI},{key:"spot_light_floor_4",type:"spotlight",name:"屏幕聚光灯",intensity:2,color:16777197,distance:12,penumbra:.5,castShadow:!1,angle:.4*Math.PI},{key:"spot_light_floor_5",type:"spotlight",name:"屏幕聚光灯",intensity:2,color:16777197,distance:8,penumbra:.5,castShadow:!1,angle:.23*Math.PI},{key:"rect_area_light_1",type:"planelight",name:"面光灯",intensity:1.2,color:16777215,width:134,height:134},{key:"rect_area_light_2",type:"planelight",name:"面光灯",intensity:.5,color:16777215,width:134,height:134},{key:wt.M_ANCHOR_POS,name:"定位",type:"sprite",range:{x:4,y:4},mapUrl:"/pos.png"},{key:wt.M_ANCHOR_TARGET,name:"锚点",type:"sprite",mapUrl:"/dw.png"},{key:wt.M_WAIT_LIFT,name:"电梯门",type:"sprite",mapUrl:"/lift.png"},{key:wt.M_DOUBLE_HORIZONTAL_SWITCH,name:"双横推开关门",type:"sprite",mapUrl:"/lift.png",range:{x:.3,y:.3}},{key:wt.M_DOUBLE_ROTATE_SWITCH,name:"双旋转开关门",type:"sprite",mapUrl:"/lift.png",range:{x:.3,y:.3}},{key:wt.M_ODD_ROTATE_SWITCH,name:"单旋转开关门",type:"sprite",mapUrl:"/lift.png",range:{x:.3,y:.3}},{key:wt.M_GATE_SWITCH,name:"闸机开关",type:"sprite",mapUrl:"/gate.png"},{key:wt.M_VIDEO_SWITCH,name:"视频播放开关",type:"sprite",mapUrl:"/video.png"},{key:wt.M_SCREEN_EDIT,name:"编辑大屏按钮",type:"sprite",mapUrl:"/edit.png"},{key:wt.M_CURTAIN_SWITCH,name:"窗帘-开关",type:"sprite",mapUrl:"/curtain.png"},{key:wt.M_LIGHT_SWITCH,name:"开关灯",type:"sprite",mapUrl:"/light.png"},{key:wt.M_LIGHT_MAIN_SWITCH,name:"开关灯",type:"sprite",mapUrl:"/light.png"},{key:wt.M_AIR_SWITCH,name:"空调开关",type:"sprite",mapUrl:"/air.png"},{key:wt.M_MODE_SWITCH,name:"模式切换按钮",type:"sprite",mapUrl:"/mode.png"}].map((t=>(t.url&&t.url.indexOf("oss")<0&&(t.url="/oss/model/office"+t.url),t.mapUrl&&t.mapUrl.indexOf("oss")<0&&(t.mapUrl="/oss/textures/office"+t.mapUrl),t.range||(t.range={x:.5,y:.5}),t))),zt=dt,kt=ht,{initCSS2DRender:Lt,createCSS2DDom:Nt}=zt.useCSS2D(),{initCSS3DRender:Pt,createCSS3DDom:Ht}=zt.useCSS3D(),{createFleeting:Wt,fleetingAnimate:Bt}=zt.useFleeting(A),{raycaster:Ut,pointer:jt,update:Ft,style:Vt}=zt.useRaycaster(),{createParticleSmoke:Yt}=zt.useSmoke(A),{pass:$t,mrt:Kt,output:Jt,emissive:Zt,float:qt,uniform:Xt}=J,Qt=(t,e,i,o)=>{const s=$t(t,e);o?s.setMRT(Kt({output:Jt,emissive:Zt})):s.setMRT(Kt({output:Jt,bloomIntensity:qt(.01)}));const n=s.getTextureNode();let a;if(o){const t=s.getTextureNode("emissive");a=I(t,2.5,.5)}else{const t=s.getTextureNode("bloomIntensity");a=I(n.mul(t))}i.toneMapping=D;const r=new w(i);return o?r.outputNode=n.add(a):(r.outputColorTransform=!1,r.outputNode=n.add(a).renderOutput()),r},te=(t,e)=>{const i=2*Math.random()-4+26;return void 0!==i&&(t.value=i),t.show=Math.random()>.5,t.value=Number(Number(t.value||0).toFixed(2)),{value:t.value,show:t.show,font:{...t.font||{},color:"#"+(16777215+1e6*i).toString(16).substring(0,6)}}},ee=(t,e,i)=>{var o;const s=e.data||e.userData.data,n=te(s,t.dotGroup);"object"==typeof n&&Object.keys(n).forEach((t=>{s[t]=n[t]})),e.visible=s.show||!i;const a=null==(o=e.element)?void 0:o.getElementsByClassName("inner")[0];if(a){const{size:t,color:e}=s.font||{};null!=t&&(a.style.fontSize="string"==typeof t?t:t+"px"),null!=e&&(a.style.color=e),a.textContent=`${s.value||0}${s.unit??""}`}},ie=(t,e)=>{var i;const o=t.getObjectByProperty("isCSS3DObject",!0);if(!o)return;const s=null==(i=o.element)?void 0:i.getElementsByClassName("env-item");for(let n=0;n<s.length;n++){const t=s[n].getElementsByClassName("value")[0],{value:i,color:o}=oe(n+1,e);t.textContent=i+"",t.style.setProperty("--color",o)}},oe=(t,e)=>{let i=0,o="#fff";switch(t){case 1:i=e.temperature,o=i>23?"#f00":"#008000";break;case 2:i=e.humidity,o=i>70?"#f00":"#008000";break;case 3:i=e.co2,o=i>420?"#f00":"#008000"}return{value:i,color:o}},se=(t,e)=>Lt(t,e),ne=(t,e)=>{const i=t.position,{size:o,color:s}=t.font||{},{x:n=0,y:a=0,z:r=0}=i||{},l=Nt({name:`\n      <div class="bg"></div>\n      <span class="inner" style="${null!=o?`font-size: ${"string"==typeof o?o:o+"px"};`:""} ${null!=s?`color: ${s}`:""}"></span>\n    `,className:"dot-2D-label",position:[n,a,r],onClick:e});return l.name=t.name+"_2D_Dot",l.userData.data=t,l.userData.position={x:n,y:a,z:r},l},ae=(t,e)=>Pt(t,e),re=(t,e)=>{const i=t.position,{size:o,color:s}=t.font||{},{x:n=0,y:a=0,z:r=0}=i||{},l=Ht({name:`\n\n      <div class="env-wrap">\n        <div class="title">${t.name||""}</div>\n        <div class="env-conten" style="${null!=o?`--font-size: ${"string"==typeof o?o:o+"px"};`:""} ${null!=s?`--color: ${s}`:""}">\n          <div class="env-item temp">\n            <div class="name">温度</div>\n            <span class="inner">\n              <span class="value">0</span>\n              <span class="unit">°C</span>\n            </span>\n          </div>\n\n          <div class="env-item hum">\n            <div class="name">湿度</div>\n            <span class="inner">\n              <span class="value">0</span>\n              <span class="unit">%</span>\n            </span>\n          </div>\n\n          <div class="env-item co2">\n            <div class="name">CO₂</div>\n            <span class="inner">\n              <span class="value">0</span>\n              <span class="unit">ppm</span>\n            </span>\n          </div>\n        </div>\n      </div>\n    `,className:"dot-env-box",sprite:!0,onClick:e});l.rotateY(.5*Math.PI);const c=new G;c.position.set(n,a,r),c.add(l);const d=new z(1),h=new k(d,new L({color:1376236,transparent:!0,opacity:.2}));c.add(h),c.scale.setScalar(.02);const{rotation:u}=kt.get_P_S_R_param(c,t),[p,m,g]=u;return c.rotation.set(p,m,g),c.name=t.name+"_3D_Dot",c.userData.data=t,c.userData.position={x:n,y:a,z:r},c},le=t=>null==t?void 0:t.children[1],ce=(t,e,i)=>{const o=new G;e.name=t.name;const s=t.position||{x:0,y:0,z:0},{to:n={x:s.x,y:s.y-2,z:s.z}}=t;if(e.isRectAreaLight||(e.target.position.set(n.x,n.y,n.z),o.add(e.target)),e.visible=!1,o.add(e),i)if(e.isRectAreaLight){const t=new N(e);o.add(t)}else{const t=new P(e,e.color);o.add(t)}return o},de=(t=[],e,i)=>{const o=new G;for(let s=0;s<t.length;s++){const n=t[s],a=Wt({color:e,points:n,tubularSegments:1e3,radius:.6,repeat:{x:2,y:4},bloom:!0,bloomIntensity:i});o.add(a)}return o.name="流光组",o},he=Bt,ue=(t,e=16777215)=>{const i=new G,o=new H(e,10,100,.6*Math.PI,.6,.4);for(let s=0;s<t.length;s++){const e=o.clone(),[n,a,r]=t[s];e.position.set(n,a,r),e.target.position.set(n,a-1,r),e.add(o.target),i.add(e);const l=new P(e);l.visible=!1,i.add(l)}return i.name="路灯组",i.visible=!1,i},pe=(t,e=16777215)=>{const i=new G,o=new W(e,10,100,.4);for(let s=0;s<t.length;s++){const e=o.clone(),[n,a,r]=t[s];e.position.set(n,a,r),i.add(e)}return i.name="居民灯组",i.visible=!1,i},me=(t,e=[],i=!0,o=1)=>{if(!e.length)return;const s=new B(t),n=e.reduce(((t,e)=>{const n=e.name||"";return t[n]=s.clipAction(e),i&&t[n].play(),t[n].timeScale=o,t}),{});t.__action__=n,t.__mixer__=s},ge=(t,e)=>{t.__close__=e??!t.__close__;const{__action__:i,__mixer__:o}=t;Object.keys(i).forEach((e=>{t.__close__&&(i[e].loop=U,i[e].clampWhenFinished=!0,i[e].play())})),t.__close__||o.stopAllAction()},_e=(t,e,i,o,s,n)=>(Ft(t,e,i),Ut.setFromCamera(jt,o),Ut.intersectObjects(s,n)),ye=(t,e,i,o)=>{if("function"==typeof e&&e(t[0],Vt),t.length){const e=t[0].object;if(i.style.cursor=e._isAnchor_?"pointer":"auto",!e._isAnchor_)return void(null==o||o.children.forEach((t=>{t.__change_color__=!1})));const s=e.material;void 0===e.__mat_color__&&(e.__mat_color__=s.color),s.color=new j(16715760),null==o||o.children.forEach((t=>{t.__change_color__=t.uuid===e.uuid}))}else i.style.cursor="auto",null==o||o.children.forEach((t=>{t.__change_color__=!1}))},ve=t=>{null==t||t.children.forEach((t=>{!t.__change_color__&&t.__mat_color__&&(t.material.color=t.__mat_color__)}))},fe=t=>{const e=t=>{if(t._isBuilding_)return t;let i=t.parent;return i?i&&i._isBuilding_?i:e(i):void 0};return e(t)},Ce=(t,e="")=>{const i=t.offsetWidth,o=t.offsetHeight;t.width=i,t.height=o;const s=t.getContext("2d");if(!s)return;s.clearRect(0,0,i,o),s.fillStyle="#f00";let n=e.split(/[\r\n]/g);if(1==n.length&&e.length>12){n=[];let t=0;const i=Math.ceil(e.length/12),o=e.length,s=o>12?Math.ceil(o/i):12;for(;t<o;){const i=t+s;n.push(e.substring(t,i)),t=i}}s.font="100 40px 微软雅黑",s.textAlign="center",s.textBaseline="middle";const a=n.length;n.forEach(((t,e)=>{const n=2*(e+1)-1;s.fillText(t,i/2,o/a/2*n)}))},Se=t=>{const e=document.createElement("video");return e.src=t||Et.screenVideo,e.loop=!0,e},xe=(new O).load(Et.videoCover),Te=t=>{const e=Se(),i=new F(e);return t.__video_texture__=i,t.__cover_texture__=xe.clone(),t.material=new V({map:xe}),t.__video__=e,t},be=(t,e)=>{if(t&&t.__video__){const i=t.__video__;null!=e&&!e||i.paused?(t.material.map=t.__video_texture__,null==i||i.play()):(null==i||i.pause(),t.material.map=t.__cover_texture__)}},Me=t=>{for(let e=0;e<t.length;e++){const i=t[e],{__video__:o,__cover_texture__:s,__video_texture__:n}=i;o&&(o.pause(),o.remove(),null==s||s.dispose(),null==n||n.dispose())}},Ee=t=>{const e=t.animations,i=new B(t),o={};for(let s=0;s<e.length;s++){const t=e[s],n=i.clipAction(t);o[t.name]=n}return{mixer:i,actions:o}},Re=(t,e)=>{if(!t)return new Y;const i=new Y;t.getWorldDirection(i);const o=i.clone().multiplyScalar(e);return t.position.clone().add(o)||new Y},Ae=(t,e,i)=>{const o=5e3;return g.success({message:`【${t}】移动中，请稍候，5秒后到达!`,duration:o}),new $(e).to(i,o).delay(0).start()},Oe=(t,e)=>{const i=Et.airWinds,o=new G;for(let s=0;s<i.length;s++){const{name:n,list:a}=i[s],r=t.getObjectByName(n);r&&r.clear();const l=new G;l.name=n;for(let t=0;t<a.length;t++){const{position:i,rotation:o}=a[t],{x:s=0,y:n=0,z:r=0}=o,c=Yt({speed:e,count:Math.floor(100*Math.random()+50),mixColor:16777215,offsetRangeMin:[-5,2,0],offsetRangeMax:[5,3,3],scaleMin:.1,scaleMax:1.2,mixColorStart:.15,textureSrc:Et.airParticleTexture}),d=Math.PI/180;c.rotation.set(d*s+.5*Math.PI,d*n,d*r),c.position.set(i.x,i.y,i.z),l.add(c)}l.visible=!1,o.add(l)}return o},Ie=t=>{const e=Et.selectObject,i=new K({transparent:!0,opacity:.15,color:e.color});i.mrtNode=J.mrt({bloomIntensity:J.float(e.bloomIntensity)}),t.isMesh&&(t.material=i,t.visible=!1);const o=[];return t.traverse((t=>{t.isMesh&&(t.material=i,t.visible=!1,o.push(t))})),o},De=(t,e,i,o)=>{if(t[0]&&(t[0].object._isEmptyMesh_=!0),"function"==typeof e&&e(t[0],Vt),t.length){const e=t[0].object;i.style.cursor="pointer",null==o||o.traverse((t=>{t.isMesh&&(t.visible=t.uuid===e.uuid)}))}else i.style.cursor="auto",null==o||o.traverse((t=>{t.isMesh&&(t.visible=!1)}))},we=(t,e,i)=>{let{position:o,lookAt:s,curve:n,progress:a}=e;a+=.02,a>1&&(a-=1);const r=new Y(0,.1,0);o=n.getPointAt(a).clone().add(r);let l=a+.001;if(l>1&&(l-=1),s=n.getPointAt(l),null==i?void 0:i.target){const t=new Y(Et.personSightOffset.x,Et.personSightOffset.y,Et.personSightOffset.z);i.target.copy(s.clone().add(t))}t.position.copy(o.clone().add(r));const c=Math.atan2(-s.z+o.z,s.x-o.x);t.rotation.y=.5*Math.PI+c},Ge=Object.freeze(Object.defineProperty({__proto__:null,Hooks:zt,THREE:A,Utils:kt,addVideoMaterial:Te,clearVideo:Me,convertHoverMaterial:Ie,createAirGroup:Oe,createCSS2DRender:se,createCSS3DRender:ae,createDotCSS2DDom:ne,createDotCSS3DDom:re,createFleetingGroup:de,createLightGroup:ce,createModelAnimate:me,createPostProcessing:Qt,createResidentLightGroup:pe,createStreetLampGroup:ue,createVideoDom:Se,cruiseTargetMove:we,dotUpdateObjectCall:te,drawBdCanvas:Ce,findParentIsBuilding:fe,fleetingGroupAnimate:he,getCSS3DObjectTargetMesh:le,getForwardPosition:Re,getIntersectObjects:_e,getModelAction:Ee,hoverAnchor:ye,hoverEmptyGroup:De,liftMove:Ae,restoreAnchorMaterial:ve,toggleCurtainAnimate:ge,updateDot3Visible:ie,updateDotVisible:ee,videoCoverTexture:xe,videoMaterilPlay:be},Symbol.toStringTag,{value:"Module"})),{Utils:ze,Hooks:ke,THREE:Le}=Ge,{createRoam:Ne,executeRoam:Pe,pause:He,play:We,getStatus:Be}=ke.useRoam(),{dubleHorizontal:Ue,dubleRotate:je,oddRotate:Fe}=ke.useOpenTheDoor(),{keyboardPressed:Ve,destroyEvent:Ye,insertEvent:$e}=ke.useKeyboardState(),{createMove:Ke,moveAnimate:Je,stop:Ze}=ke.useMoveAnimate(),{checkCollide:qe}=ke.useCollide(),{virtualization:Xe,closeVirtualization:Qe}=ke.useModelLoader({}),{createDiffusion:ti}=ke.useDiffusion2(),ei="SCREEN",ii="PERSON_FIRST",oi="PERSON_THREE",si=Et.groundMeshName.concat(Et.liftGroundMeshName);class ni extends ut{constructor(t,i){super(t),e(this,"extend"),e(this,"postProcessing"),e(this,"buildingGroup"),e(this,"anchorGroup"),e(this,"css2DRender"),e(this,"dotGroup"),e(this,"css3DRender"),e(this,"dot3Group"),e(this,"lightGroup"),e(this,"animateModels",[]),e(this,"ambientLight",new Le.AmbientLight),e(this,"directionalLight",new Le.DirectionalLight),e(this,"sky",Et.sky),e(this,"style",-1),e(this,"styleTimes",Et.styleTimes),e(this,"fleetingGroup"),e(this,"streetLampGroup"),e(this,"residentLightGroup"),e(this,"canvasTextures",[]),e(this,"videoModels",[]),e(this,"person"),e(this,"personSightOffset",new Le.Vector3(Et.personSightOffset.x,Et.personSightOffset.y,Et.personSightOffset.z)),e(this,"moveFactor",Et.moveFactor),e(this,"currentSight",ei),e(this,"controlCache",{target:new Le.Vector3,cameraPosition:new Le.Vector3,maxDistance:0,personPosition:new Le.Vector3}),e(this,"diffusion",new Le.Mesh),e(this,"collisionSpace",Et.collisionSpace),e(this,"airGroup"),e(this,"airSpeed",Le.TSL.uniform(.05)),e(this,"hoverGroup"),this.extend=i,this.createClock(),this.postProcessing=Qt(this.scene,this.camera,this.renderer),this.pmremGenerator=new Le.PMREMGenerator(this.renderer),this.pmremGenerator.compileEquirectangularShader(),this.addBuildingGroup(),this.addAnchorGroup(),this.css2DRender=se(this.options,this.container),this.addDotGroup(),this.css3DRender=ae(this.options,this.container),this.addDot3Group(),this.addLightGroup(),this.addFleeting(),this.addStreetLamp(),this.addResidentLight(),this.addHoverGroup(),this.findLight(),this.bindEvent(),this.addDiffusion(),this.setControlCache(),this.setDebounceDuration(Et.debounceDuration)}createRender(){return new Le.WebGPURenderer(this.options.render)}createScene(){return new Le.Scene}createDirectionalLight(t,e){return new Le.DirectionalLight(t,e)}createAmbientLight(t,e){return new Le.AmbientLight(t,e)}render(){var t;null==(t=this.postProcessing)||t.renderAsync()}run(){return this.renderer.setAnimationLoop((()=>{this.animate(),this.modelAnimate()})),this}modelAnimate(){var t,e,i,o;let s=null==(t=this.clock)?void 0:t.getDelta();null==(e=this.css2DRender)||e.render(this.scene,this.camera),null==(i=this.css3DRender)||i.render(this.scene,this.camera),this.autoChangeStyle(),this.anchorAnimateUpdate(s),(null==(o=this.fleetingGroup)?void 0:o.visible)&&he(1),this.modelAnimateUpdate(s),Pe(this.camera,this.controls),ve(this.anchorGroup),this.personAnimate(s),this.debounce((()=>{this.checkDot3CameraVisibleObjects()}))}checkDot3CameraVisibleObjects(){this.checkCameraVisibleDot((t=>{t.visible=!0}),(t=>{t.visible=!1}))}checkCameraVisibleDot(t,e){var i;const o=this.getFrustum(),s=(null==(i=this.dot3Group)?void 0:i.children)||[];for(let n=0;n<s.length;n++){const i=s[n],a=le(i);if(a instanceof Le.Mesh)if(this.frustumIntersectsBox(o,a)){const o=this.camera.position.distanceTo(i.position),s=Et.dotVisibleDistance;o<=s.max&&o>=s.min?"function"==typeof t&&t(i):"function"==typeof e&&e(i)}else"function"==typeof e&&e(i)}}getLocation(){let t=[];return this.checkCameraVisibleDot((e=>{t.push(e)})),t}findLight(){const t=this.scene.getObjectByProperty("isAmbientLight",!0);this.ambientLight=t;const e=this.scene.getObjectByProperty("isDirectionalLight",!0);this.directionalLight=e}toByday(t=1){this.style=t;const{ambientLight:e,directionalLight:i}=this.options;this.setStyleOptions(e.intensity,i.intensity,this.sky.day)}toEvening(t=2){this.style=t,this.setStyleOptions(.01,.5,this.sky.evening)}toNight(t=3){this.style=t,this.setStyleOptions(.01,.3,this.sky.night,!0)}setEnv(t){this.scene.background=t;const e=this.convertPmremTexture(t);this.scene.environment=e,t.dispose()}setStyleOptions(t,e,i,o=!1){this.ambientLight.intensity=t,this.directionalLight.intensity=e,this.fleetingGroup&&(this.fleetingGroup.visible=o),this.streetLampGroup&&(this.streetLampGroup.visible=o),this.residentLightGroup&&(this.residentLightGroup.visible=o),this.loadEnvTexture(i,(t=>{}))}autoChangeStyle(){const t=this.styleTimes,e=(new Date).getHours(),i=t.findIndex(((i,o)=>o==t.length-1?e>=i[0]||e<i[1]:e>=i[0]&&e<i[1]));this.style!=i+1&&(0==i?this.toByday():1==i?this.toEvening():2==i&&this.toNight())}addBuildingGroup(){const t=new Le.Group;t.name="建筑组",this.buildingGroup=t,this.addObject(t)}addBuilding(...t){this.buildingGroup&&this.buildingGroup.add(...t)}addAnchorGroup(){const t=new Le.Group;t.name="锚点组",this.anchorGroup=t,this.addObject(t)}addAnchor(t){this.anchorGroup&&this.anchorGroup.add(t);const{x:e,y:i,z:o}=t.position;ze.createSpriteAnimate(t,[e,i,o],.2,8)}anchorAnimateUpdate(t){var e;null==(e=this.anchorGroup)||e.children.forEach((e=>{e.__mixer__&&e.__mixer__.update(t)}))}addDotGroup(){if(!this.css2DRender)return;this.css2DRender.domElement.className="three-scene__dot-wrap";const t=new Le.Group;t.name="点位组",this.dotGroup=t,this.scene.add(t)}addDot(t,e){if(!this.dotGroup)return new Le.Mesh;const i=ne(t,e);return this.dotGroup.add(i),i}addDot3Group(){if(!this.css3DRender)return;this.css3DRender.domElement.className="three-scene__dot-wrap";const t=new Le.Group;t.name="点位组3",this.dot3Group=t,this.scene.add(t)}addDot3(t,e){if(!this.dot3Group)return new Le.Mesh;const i=re(t,e);return this.dot3Group.add(i),i}closeDot3(){}updateDot3(t){var e;const i=null==(e=this.dot3Group)?void 0:e.children.find((e=>e.userData.data.code===t.code));i&&ie(i,t)}addLightGroup(){const t=new Le.Group;t.name="灯光组",this.lightGroup=t,this.addObject(t)}addLight(t,e,i){if(!this.lightGroup)return;const o=ce(t,e,i);this.lightGroup.add(o)}lightSwitch(t,e,i){var o,s;const n=null==(s=this.lightGroup)?void 0:s.getObjectsByProperty("name",null==(o=t.data)?void 0:o.bind);n&&n.forEach(((t,o)=>{let s=!(null!=i&&i>=0)&&(null!=e?e:!t.visible);null!=i&&i>=0&&o<i&&(s=null==e||e),t.visible=s}))}closeLightGroup(t=!1){var e;null==(e=this.lightGroup)||e.traverse((e=>{(e.isSpotLight||e.isRectAreaLight)&&(e.visible=t)}))}addFleeting(){this.fleetingGroup=de(Et.fleetings,21503,1),this.addObject(this.fleetingGroup)}toggleFleeting(t){this.fleetingGroup&&(this.fleetingGroup.visible=t??!this.fleetingGroup.visible)}addStreetLamp(){this.streetLampGroup=ue(Et.streetLamps),this.addObject(this.streetLampGroup)}addResidentLight(){this.residentLightGroup=pe(Et.residentLights),this.addObject(this.residentLightGroup)}addHoverGroup(){const t=new Le.Group;t.name="hover 组",this.hoverGroup=t,this.addObject(t)}addHover(t){var e;const i=Ie(t);null==(e=this.hoverGroup)||e.add(...i)}resetHover(){De([],null,this.container,this.hoverGroup)}toggleCurtain(t,e){const i=this.animateModels.find((e=>{var i;return e.name===(null==(i=t.data)?void 0:i.bind)}));if(i)return ge(i,e),i.__close__}dubleHorizontalDoor(t,e=400,i){const{bind:o,axle:s="z"}=t.data;return Ue(this.scene,{value:o,axle:s,scale:e,isOpen:i})}dubleRotateDoor(t){const{bind:e,axle:i="y",left:o="右",right:s="左",internal:n,autoClose:a=!0}=t.data;return je(this.scene,{value:e,axle:i,autoClose:a,angle:Math.PI*(n?-.5:.5),leftMatch:o,rightMatch:s})}oddRotateDoor(t){const{bind:e,axle:i="y",internal:o,autoClose:s=!1}=t.data;return Fe(this.scene,{value:e,axle:i,angle:Math.PI*(o?-.5:.5),autoClose:s})}openGate(t){return this.dubleRotateDoor(t)}waitLift(t,e){var i;const o=t.data.target,s=this.scene.getObjectByName(o);s||g.error({message:`【${o}】模块未找到！`,grouping:!0});const n=null==(i=t.data)?void 0:i.to;if(!s||!n)return;const a=s.position;if(Math.abs(n.y-a.y)>.2){const i=s.__bind_lift__;if(void 0!==i){const t={data:{bind:i}};this.dubleHorizontalDoor(t,2.3,!1)}const r={data:{bind:o}};this.dubleHorizontalDoor(r,2.3,!1).then((()=>{const i=this.person;Ae(o,a,{y:n.y}).onUpdate((t=>{if(e){if(!this.person)return;this.person.position.setY(t.y);const e=Re(i,.1);this.camera.position.y=t.y+this.personSightOffset.y,this.setControlTarget(e)}})).onComplete((()=>{s.__bind_lift__=t.data.bind,this.openDoorByLift(t,o)}))}))}else this.openDoorByLift(t,o)}openDoorByLift(t,e){this.dubleHorizontalDoor(t,2.3);const i={data:{bind:e}};this.dubleHorizontalDoor(i,2.3)}addVideoMaterial(t){var e,i;this.videoModels=[];for(let o=0;o<t.length;o++){const s=t[o],n=null==(e=this.buildingGroup)?void 0:e.getObjectByName(s);if(!n)continue;const a=null==(i=this.lightGroup)?void 0:i.getObjectByName(s+"-照明灯");a&&(a.visible=!0),Te(n),this.videoModels.push(n)}}clearVideo(){Me(this.videoModels)}videoPlay(t){const e=this.scene.getObjectByName(t.data.bind);be(e)}drawCanvas(t=""){this.extend.canvas&&(Ce(this.extend.canvas,t),this.canvasTextures.length&&this.canvasTextures.forEach((t=>{t.needsUpdate=!0})))}addCanvasMaterial(t){var e;if(!this.extend.canvas)return;const i=new Le.MeshPhongMaterial({map:new Le.CanvasTexture(this.extend.canvas),side:Le.DoubleSide});this.canvasTextures=[];for(let o=0;o<t.length;o++){const s=this.scene.getObjectByName(t[o]);s&&(s.material=i.clone(),s.__cover_texture__=null==(e=i.map)?void 0:e.clone(),this.canvasTextures.push(s.material.map))}}addPerson(t){this.person=t;const{mixer:e,actions:i}=Ee(t),o=i[Et.personDefaultAnimateName];o.play();const s=i[Et.personRuningAnimateName];t.extra={mixer:e,actions:i,runging:s,defaultAction:o},this.addObject(t),this.addPersonEvent()}personWalk(t=!0){const e=this.person;if(!e)return;const{defaultAction:i,runging:o}=e.extra;t?(o.play(),i.stop()):(i.play(),o.stop())}addPersonEvent(){const t=this.person;if(!t)return;const e=["W","S"].map((t=>t.toUpperCase().charCodeAt(0))).concat([38,40]);$e((i=>{t.__runing__||this.isCruise()||!this.isPersonSight()||(e.includes(i.keyCode)&&this.personWalk(),this.isPersonSight()&&(Ve("X")&&this.personSpeed(1),Ve("Z")&&this.personSpeed(-1)))}),(i=>{t.__runing__||this.isCruise()||!this.isPersonSight()||e.includes(i.keyCode)&&this.personWalk(!1)}))}personAnimate(t){const e=this.person;if(e){if(e.extra.mixer.update(t),Je(.2*this.moveFactor),this.isPersonSight()&&!e.__runing__){const i=1+this.moveFactor/5,o=Et.personRuningSpeed*t*i,s=.2*Math.PI*t*i;this.keyboardToMove(o),Ve(["A","left"])?(e.rotation.y+=s,this.keyboardToTotation()):Ve(["D","right"])&&(e.rotation.y-=s,this.keyboardToTotation())}}}keyboardToMove(t){const e=this.person,i=Ve(["S","down"]);if(Ve(["W","up"])||i){const o=new Le.Vector3;null==e||e.getWorldDirection(o);const s=o.clone().multiplyScalar(i?-t:t),n=(null==e?void 0:e.position.clone().add(s))||new Le.Vector3;if(!this.checkCharacterCollide(n)){if(null==e||e.position.copy(n),i){const e=o.clone().multiplyScalar(2*-t);this.camera.position.copy(this.camera.position.clone().add(e))}this.setControlTarget(null==e?void 0:e.position)}}}keyboardToTotation(){var t;const e=this.person,i=new Le.Vector3;null==e||e.getWorldDirection(i);const o=(null==(t=this.controls)?void 0:t.maxDistance)||1.1,s=i.clone().multiplyScalar(-o),n=(null==e?void 0:e.position.clone().setY(this.camera.position.y).add(s))||new Le.Vector3;this.camera.position.copy(n),this.setControlTarget(null==e?void 0:e.position)}togglePersonSight(t){if(!Et.sightToggle){if(1==t&&this.currentSight===ii)return;if(3==t&&this.currentSight===oi)return}this.closeCruise(),this.closeRoam(),Et.sightToggle?this.currentSight=this.isPersonSight()?ei:1==t?ii:oi:this.currentSight=1==t?ii:oi,this.togglePersonView(),this.cameraChangeByPerson(),this.controlsLimitSet()}controlsLimitSet(){if(!this.controls)return;const t=this.currentSight,e=t===ii,i=e||t===oi;this.controls.maxDistance=i?e?0:Et.cameraMaxDistance.threePerson:this.controlCache.maxDistance,this.controls.screenSpacePanning=!i,this.controls.enablePan=!i,this.person&&(this.person.visible=!e)}isPersonSight(){return this.currentSight===ii||this.currentSight===oi}isFirstPersonSight(){return this.currentSight===ii}togglePersonView(){var t;const e=null==(t=this.container.parentNode)?void 0:t.querySelector("."+Et.personSightClass);if(!e)return;const i=this.isPersonSight();e.style.display=i?"block":"none"}clsoePerson(){var t;this.currentSight=ei,(null==(t=this.person)?void 0:t.__runing__)&&(Ze(!1),this.person.__runing__=!1,this.diffusion.visible=!1,this.personWalk(!1)),this.person&&(this.person.visible=!0),this.togglePersonView()}cameraChangeByPerson(){if(!this.person||!this.controls)return;const t=this.isPersonSight(),e=this.person.position;let{target:i,to:o}=this.getControlsCache();const s=this.personSightOffset.clone();if(t){g.success({message:`鼠标点击地面移动，或键盘按键 ${Et.personKeys.map((t=>`${t.code} ${t.desc}`)).join("、")}，来控制人物！`,grouping:!0}),this.setControlCache();const t=e.clone().add(s);this.isFirstPersonSight()?this.keyboardToTotation():(this.camera.lookAt(t),this.controls.target.copy(e.clone().add(s))),Math.abs(this.camera.position.y-t.y)>8&&(this.camera.position.y=t.y)}else this.camera.position.copy(o),this.camera.lookAt(this.controls.target),this.controls.target.copy(i)}personSpeed(t=1){this.moveFactor+=t,this.moveFactor>=10?this.moveFactor=10:this.moveFactor<=1&&(this.moveFactor=1),g.success({message:"人物速度："+this.moveFactor,grouping:!0})}personMove(t){if(this.judgeCruise())return Promise.reject();if(!this.isPersonSight())return Promise.reject();const e=this.person;if(!e)return Promise.reject();const i=Et.liftGroundMeshName,o=t.point,s=this.diffusion;return this.personWalk(),s.position.copy(o.clone().add(new Le.Vector3(0,.05,0))),s.visible=!0,new Promise((n=>{e.__runing__=!0,Ke(e,o,((o,n)=>{this.setControlTarget(o),this.checkCharacterCollide(o,i.includes(t.object.name)?2:.3)&&(n(),this.personWalk(!1),e.__runing__=!1,s.visible=!1)}),(t=>{this.setControlTarget(t),this.personWalk(!1),e.__runing__=!1,s.visible=!1,n(e)}))}))}checkCharacterCollide(t,e=.3){var i;if(!this.person)return;const o=qe(this.person,t,(null==(i=this.buildingGroup)?void 0:i.children)||[],!0,new Le.Vector3(0,e,0));if(o.length){if(o[0].distance<this.collisionSpace)return g.warning({message:"撞到了！",grouping:!0}),!0}}addDiffusion(){const t=ti({textureSrc:Et.diffusionImg,bloomIntensity:.2},Le);t.position.y=.5,t.visible=!1,this.addObject(t),this.diffusion=t}toggleBridCompany(){var t,e;const i=Et.companyModelName,o=null==(t=this.buildingGroup)?void 0:t.getObjectByName(i);if(!o)return void g.warning({message:`未找到【${i}】模块！`,grouping:!0});this.closeCruise(),this.clsoePerson(),this.closeRoam();const s=o.__isFocus__;if(o.__isFocus__=!Et.sightToggle||!o.__isFocus__,!o.__isFocus__&&s!=o.__isFocus__)return this.closeVirtualization(),void this.toggleCompanyFocus(!1);if(this.toggleCompanyFocus(!0),s!=o.__isFocus__){const t=((null==(e=this.buildingGroup)?void 0:e.children)||[]).filter((t=>t.name!=Et.curtainMeshName));Xe(t,o,{wireframe:!0,hidden:!0,opacity:.1,filter:["电梯-1"]})}}getBridStatus(){var t;const e=Et.companyModelName,i=null==(t=this.buildingGroup)?void 0:t.getObjectByName(e);return null==i?void 0:i.__isFocus__}closeVirtualization(){var t,e;const i=Et.companyModelName;(null==(t=this.buildingGroup)?void 0:t.getObjectByName(i)).__isFocus__=!1,Qe(null==(e=this.buildingGroup)?void 0:e.children,{filter:["_空调风_grp"]})}toggleCompanyFocus(t){if(!this.controls)return;let{target:e,to:i,maxDistance:o}=this.getControlsCache();t&&(this.setControlCache(),e=new Le.Vector3(8.5,185,0),i=new Le.Vector3(92.8,291,104),o=320),this.controls.maxDistance=o,ze.cameraLinkageControlsAnimate(this.controls,this.camera,i,e)}closeBrid(){this.getBridStatus()&&this.closeVirtualization()}addAirWindMaterial(t){const e=Oe(this.scene,this.airSpeed);this.airGroup=e,this.addObject(e)}toggleAir(t,e){var i;if(!this.airGroup)return;if(t.data.bind){const i=this.airGroup.getObjectByName(t.data.bind);if(!i)return;i.__open__=e??!i.__open__,i.visible=i.__open__}else null==(i=this.airGroup)||i.children.forEach((t=>{this.toggleAir({data:{bind:t.name}},e)}))}changeAirWindSpeed(t=.02){this.airSpeed.value+=t,this.airSpeed.value<.05&&(this.airSpeed.value=.05),this.airSpeed.value>.5&&(this.airSpeed.value=.5)}cameraLookatMoveTo(t){this.controls&&ze.cameraLookatAnimate(this.camera,t,this.controls.target)}cameraTransition(t){const{to:e,target:i=t.position}=t.data;e&&!this.isCameraMove(e)&&this.controls&&(this.closeRoam(),this.clsoePerson(),this.closeCruise(),this.clsoePerson(),this.controls.enablePan=!0,this.controls.maxDistance=Et.cameraMaxDistance.indoor,ze.cameraLinkageControlsAnimate(this.controls,this.camera,e,i))}cameraTransitionByModelname(t){const e=Et.cameraTransitionList.find((e=>e.name===t));e&&this.cameraTransition({data:e})}addModelAnimate(t,e=[],i=!0,o=1){me(t,e,i,o),this.animateModels.push(t)}modelAnimateUpdate(t){this.animateModels.length&&this.animateModels.forEach((e=>{e.__mixer__&&e.__mixer__.update(t)}))}controlReset(){if(this.closeRoam(),this.clsoePerson(),this.closeBrid(),!this.controls)return;const t=this.options.controls;Object.keys(t).forEach((e=>{this.controls&&(this.controls[e]=t[e])})),super.controlReset()}setControlCache(){if(!this.controls)return;const t=this.controlCache;t.target=t.target.copy(this.controls.target),t.cameraPosition=t.cameraPosition.copy(this.camera.position),t.maxDistance=this.controls.maxDistance}getControlsCache(){const t=this.controlCache;return{target:t.target,to:t.cameraPosition,maxDistance:t.maxDistance}}setControlTarget(t){this.controls&&(this.controls.target.copy(t.clone().add(this.personSightOffset.clone())),this.camera.lookAt(this.controls.target))}toggleRoam(){if(this.closeCruise(),this.clsoePerson(),this.closeRoam())return;const t=this.extend.roamPoints||[];0!=t.length&&this.controls&&(this.controls.maxDistance=Et.cameraMaxDistance.roam,Ne({points:t,segment:12,tension:.5,speed:2,close:!0,factor:1}),We())}setRoamPoint(t){this.extend.roamPoints=t}closeRoam(){return!!Be()&&(this.controls&&(this.controls.maxDistance=this.options.controls.maxDistance),He(),!0)}toggleCruise(t){var e,i;if(!Et.sightToggle&&!(t=!1)===this.options.cruise.runing)return;this.clsoePerson(),this.person&&(this.person.visible=!1),this.closeRoam();!(t??this.options.cruise.runing)&&this.person?(this.controlCache.personPosition.copy(null==(e=this.person)?void 0:e.position),this.personWalk()):(null==(i=this.person)||i.position.copy(this.controlCache.personPosition),this.personWalk(!1)),super.toggleCruise(t),setTimeout((()=>{this.person&&(this.person.visible=!0)}),30)}cruiseStatusCall({enabled:t,runing:e}){t&&this.personWalk(e)}cruiseAnimateCall(t){t.enabled&&this.person&&we(this.person,t,this.controls)}closeCruise(){var t;const e=this.options.cruise.runing;this.closeDot3(),super.closeCruise(),e&&(null==(t=this.person)||t.position.copy(this.controlCache.personPosition),this.personWalk(!1),this.personWalk(!1))}setCruisePoint(t){super.setCruisePoint(t),this.toggleCruiseBloom(!0,Le)}judgeCruise(){return!!this.options.cruise.runing&&(g.warning({message:"请退出巡航！",grouping:!0}),!0)}onPointerMove(t){this.checkIntersectObjects(t)}onPointerUp(t){var e;super.onPointerUp(t);const i=t.timeStamp-this.pointer.tsp<Et.clickIntervalTime;2==t.button?i&&"function"==typeof(null==(e=this.extend)?void 0:e.onClickRight)&&this.extend.onClickRight(t):0==t.button&&i&&this.checkIntersectObjects(t)}checkIntersectObjects(t){var e,i,o,s,n,a,r,l,c;let d="pointerdown"==t.type||"pointerup"==t.type;this.pointer.isClick&&this.person&&this.isFirstPersonSight()&&(this.person.rotation.y-=this.movementXToAngle(t.movementX));const h=(null==(e=this.controls)?void 0:e.maxDistance)||0,u=Et.hoverDistance,p=Et.toBridMeshName;let m=[];const g=h>(this._isTest?1e4:u.empty)&&(null==(i=this.controls)?void 0:i.enabled);if(g){const t=this.getBridStatus();m=((null==(o=this.hoverGroup)?void 0:o.children)||[]).filter((e=>!t||t&&e.name!=p))}else m=(null==(n=this.buildingGroup)?void 0:n.children.filter((t=>t.visible)).map((t=>(t.children=t.children.filter((t=>t.visible)),t))).concat((null==(s=this.anchorGroup)?void 0:s.children)||[]))||[];const _=_e(t,this.container,this.options.scale,this.camera,m,g||d);if(g?De(_,this.extend.onHoverCall,this.container,this.hoverGroup):ye(_,this.extend.onHoverCall,this.container,this.anchorGroup),d)if(_.length){const t=_[0],e=t.object;if(this._isTest&&console.log(t),g){const t=Et.cameraTransitionList.find((t=>t.name+Et.hoverNameSuffix===e.name));return e.visible=!1,void(t?"function"==typeof(null==(a=this.extend)?void 0:a.emptyGroupClick)&&this.extend.emptyGroupClick(t):e.name===p&&this.toggleBridCompany())}const i=fe(e);if("string"==typeof e.name&&si.some((t=>e.name.indexOf(t)>-1))&&"function"==typeof(null==(r=this.extend)?void 0:r.onClickGround)&&this.extend.onClickGround(i,t),!i)return;"function"==typeof(null==(l=this.extend)?void 0:l.onClickLeft)&&this.extend.onClickLeft(i,t)}else"function"==typeof(null==(c=this.extend)?void 0:c.onClickLeft)&&this.extend.onClickLeft()}resize(){var t,e;super.resize();const{width:i,height:o}=this.options;null==(t=this.css2DRender)||t.setSize(i,o),null==(e=this.css3DRender)||e.setSize(i,o)}dispose(){this.clearVideo(),this.animateModels=[],this.canvasTextures=[],this.videoModels=[],this.disposeObj(this.buildingGroup),this.disposeObj(this.dotGroup),this.disposeObj(this.anchorGroup),this.disposeObj(this.lightGroup),this.disposeObj(this.fleetingGroup),this.disposeObj(this.streetLampGroup),this.disposeObj(this.residentLightGroup),this.clock=void 0,this.css2DRender=void 0,this.css3DRender=void 0,this.buildingGroup=void 0,this.dotGroup=void 0,this.anchorGroup=void 0,this.lightGroup=void 0,this.hoverGroup=void 0,this.fleetingGroup=void 0,this.streetLampGroup=void 0,this.residentLightGroup=void 0,this.extend={},Ye(),super.dispose()}}const ai="welcom.key",ri=ot(i({__name:"index",setup(t){const{Hooks:e,Utils:i,THREE:o}=Ge;rt().historyRoutes.includes("/webgpu/scene/office");const s=Z({anchorType:[wt.M_ANCHOR_POS,wt.M_ANCHOR_TARGET,wt.M_WAIT_LIFT,wt.M_LIGHT_SWITCH,wt.M_LIGHT_MAIN_SWITCH,wt.M_AIR_SWITCH,wt.M_GATE_SWITCH,wt.M_VIDEO_SWITCH,wt.M_SCREEN_EDIT,wt.M_DOUBLE_HORIZONTAL_SWITCH,wt.M_ODD_ROTATE_SWITCH,wt.M_DOUBLE_ROTATE_SWITCH,wt.M_CURTAIN_SWITCH,wt.M_MODE_SWITCH],animationModelType:[wt.M_MAIN_SCENE,wt.M_CAMPANY_FLOOR,wt.M_CURTAIN],config:{},cruise:{color:2090220,visible:!0,auto:!1,alway:!1,repeat:[.1,1],width:1.2,segment:100,tension:.01,speed:20,mapSpeed:.02,points:[],close:!0,bloomIntensity:.2,cameraAutoMove:!1,maxDistance:5},roamPoints:[],models:Gt}),m=Z({show:!1,style:{left:0,top:0},msg:""}),g=Z({active:2,show:!1,targetName:"",list:[{target:"电梯-2",items:[{name:"一楼",key:1,y:.1,bind:"_一楼电梯门-2_grp"},{name:"公司",key:2,y:184.7,bind:"_电梯外门_2_grp"}]},{target:"电梯-1",items:[{name:"一楼",key:1,y:.1,bind:"_一楼电梯门-1_grp"},{name:"公司",key:2,y:184.7,bind:"_电梯外门_1_grp"}]}]}),{options:_}=mt({title:"编辑欢迎词",content:lt(ai)||"中碳能源",errMessage:"请输入欢迎词！"}),{progress:S,loadModels:M,initModels:E,getModel:R}=e.useModelLoader({baseUrl:Et.baseUrl,indexDB:Et.indexDB},o),A=q(),O=q(),I={cruise:s.cruise,baseUrl:Et.baseUrl,render:{alpha:!0},controls:{visible:!0,enableDamping:!0,dampingFactor:.25,maxPolarAngle:.48*Math.PI,screenSpacePanning:!1,maxDistance:1500},camera:{near:.01,fov:52,position:[-799.2,55,376.3]},ambientLight:{intensity:.01},directionalLight:{intensity:4,light2:!1,position:[0,7e3,2e3],position2:[0,7e3,-2e3],shadow:{mapSize:2048},shadowCamera:{boundary:7e3}}};let D;const w=X((()=>{var t;return(null==(t=g.list.find((t=>t.target===g.targetName)))?void 0:t.items)||[]})),G=t=>{D.cameraTransition({position:t.position,data:t})},z=()=>E(L.value,(t=>{if(!t)return Promise.resolve();const{type:e}=t;if(e===wt.M_ANCHOR_POS)return Promise.resolve();const o=R(e);if(!o)return e===wt.DOT?(t=>{ee(D,D.addDot(t,(e=>{D.cameraLookatMoveTo(t.position)})),!1)})(t):e===wt.DOT3&&D.addDot3(t),Promise.resolve();const{anchorType:n=[],animationModelType:a=[]}=s;let r=i.modelDeepClone(o);const{position:l,scale:c,rotation:d}=i.get_P_S_R_param(r,t),[h,u,p]=l;return r.scale.set(...c),r.position.set(h,u,p),r.rotation.set(...d),r._isBuilding_=!0,r.data=t,a.includes(e)&&D.addModelAnimate(r,o.animations,e!==wt.M_CURTAIN,1),n.includes(e)?(r._isAnchor_=!0,D.addAnchor(r)):r.isSpotLight||r.isRectAreaLight?D.addLight(t,r,!1):D.addBuilding(r),Promise.resolve()})),k=()=>nt.get(at.d3.office).then((t=>nt.get(at.d3.office_mode).then((e=>(e.forEach(((e,i)=>{t.JsonList.push({...e,type:wt.M_MODE_SWITCH,position:{x:19-.6*i,y:186.8,z:49}})})),t))))),L=q([]),N=X((()=>L.value.filter((t=>t.type===wt.M_ANCHOR_POS)))),P=async t=>{await new Promise((async t=>{var e;await et(),await z(),D.setRoamPoint(s.roamPoints),D.setCruisePoint((null==(e=s.cruise)?void 0:e.points)||[]);const i=D.getValidTargetPosition(s.config||{});D.camera.position.set(i.x,i.y,i.z),D.controlSave(),Ot.emit("LIGHT:CLOSE"),S.percentage=100,S.show=!1,t(1)}));const e=D.scene.getObjectByName("透明_边界");e&&(e.castShadow=!1),H(),W(),Ot.emit("SCREEN:WELCOM",_.content),D.addVideoMaterial(t.JsonList.filter((t=>t.type===wt.M_VIDEO_SWITCH)).map((t=>t.bind))),D.addCanvasMaterial(t.JsonList.filter((t=>t.type===wt.M_SCREEN_EDIT)).map((t=>t.bind))),D.addAirWindMaterial(t.JsonList.filter((t=>t.type===wt.M_AIR_SWITCH)).map((t=>t.bind)))},H=()=>{const t=R(wt.M_PERSON);t.traverse((t=>{t.isMesh&&(t.castShadow=!0)}));const{x:e,y:i,z:o}={x:14.4,y:184.6,z:37.6};t.position.set(e,i,o),t.rotateY(1*Math.PI),t.scale.setScalar(2),D.addPerson(t)},W=()=>{const t=R(wt.M_COMPANY_EMPTY_GROUP);D.addHover(t);const e=D.scene.getObjectByName("立方体3475");e&&(e.material.transparent=!0,e.material.opacity=0)},B=()=>{M(s.models,(()=>{k().then((t=>{let e={};if(t.ConfigJson instanceof Object)e=t.ConfigJson;else if("string"==typeof t.ConfigJson)try{e=JSON.parse(t.ConfigJson)}catch(i){}L.value=t.JsonList,Object.keys(e).forEach((t=>{s.config&&(s.config[t]=e[t])})),s.cruise.points=e.cruise||[],s.roamPoints=e.roamPoints||[],setTimeout((()=>{P(t)}),100)}))})),(t=>{Ot.on("CAMERA:ROAM",(()=>null==t?void 0:t.toggleRoam())),Ot.on("CAMERA:CRUISE",(()=>null==t?void 0:t.toggleCruise())),Ot.on("CAMERA:RESET",(()=>null==t?void 0:t.controlReset())),Ot.on("CAMERA:FIRST",(()=>null==t?void 0:t.togglePersonSight(1))),Ot.on("CAMERA:THREE",(()=>null==t?void 0:t.togglePersonSight(3))),Ot.on("CAMERA:GATE",(()=>null==t?void 0:t.cameraTransitionByModelname("一楼大门"))),Ot.on("CAMERA:RECCEPTION",(()=>null==t?void 0:t.cameraTransitionByModelname("前台"))),Ot.on("CAMERA:OFFICE",(()=>null==t?void 0:t.cameraTransitionByModelname("办公"))),Ot.on("CAMERA:LCR",(()=>null==t?void 0:t.cameraTransitionByModelname("大会议室"))),Ot.on("CAMERA:BOSS",(()=>null==t?void 0:t.cameraTransitionByModelname("总裁"))),Ot.on("PERSON:ADD",(()=>null==t?void 0:t.personSpeed())),Ot.on("PERSON:SUB",(()=>null==t?void 0:t.personSpeed(-1))),Ot.on("LIGHT:RECCEPTION",((e,i)=>{null==t||t.lightSwitch({data:{bind:"前台聚光灯"}},e,i)})),Ot.on("LIGHT:AILSE",((e,i)=>{null==t||t.lightSwitch({data:{bind:"区域A"}},e,i)})),Ot.on("LIGHT:PM",((e,i)=>{null==t||t.lightSwitch({data:{bind:"区域B"}},e,i)})),Ot.on("LIGHT:HOST",((e,i)=>{null==t||t.lightSwitch({data:{bind:"主机照明灯"}},e,i)})),Ot.on("LIGHT:LCR",((e,i)=>{null==t||t.lightSwitch({data:{bind:"大会议室照明灯"}},e,i)})),Ot.on("LIGHT:CLG",(e=>{null==t||t.lightSwitch({data:{bind:"公司主灯光组"}},e)})),Ot.on("LIGHT:FIRSTFLOOR",(e=>{null==t||t.lightSwitch({data:{bind:"一楼灯光组"}},e)})),Ot.on("LIGHT:CLOSE",(e=>null==t?void 0:t.closeLightGroup(e))),Ot.on("LIGHT:AUTO",((e,i,o)=>null==t?void 0:t.lightSwitch(e,i,o))),Ot.on("CURTAIN:TOGGLE",(e=>{const i=null==t?void 0:t.toggleCurtain({data:{bind:"_GROUP_013_grp"}},e);console.log("窗帘关闭状态",i)})),Ot.on("DOOR:COMPANY",(()=>{null==t||t.dubleHorizontalDoor({data:{bind:"_公司大门_grp",axle:"x"}},5.4)})),Ot.on("DOOR:LCR",(()=>{null==t||t.dubleRotateDoor({data:{bind:"_大会议室-门_grp",axle:"y"}})})),Ot.on("DOOR:BOSS",(()=>{null==t||t.dubleRotateDoor({data:{bind:"_老板办公室-门_grp",autoClose:0}})})),Ot.on("SCREEN:COMPANY",(()=>{null==t||t.videoPlay({data:{bind:"公司大屏"}})})),Ot.on("SCREEN:WELCOM",(e=>null==t?void 0:t.drawCanvas(e))),Ot.on("SCREEN:SCR",(()=>{null==t||t.videoPlay({data:{bind:"小会议室大屏"}})})),Ot.on("SCREEN:LCR",(()=>{null==t||t.videoPlay({data:{bind:"大会议电视屏幕"}})})),Ot.on("AIR:MAIN",(e=>{null==t||t.toggleAir({data:{bind:""}},e)})),Ot.on("AIR:ODD",((e,i)=>{null==t||t.toggleAir(e,i)})),Ot.on("AIR:WINDADD",(()=>t.changeAirWindSpeed(.02))),Ot.on("AIR:WINDSUB",(()=>t.changeAirWindSpeed(-.02))),Ot.on("SCENE:POS",(()=>null==t?void 0:t.getPosition())),Ot.on("SCENE:TEST",(()=>null==t?void 0:t.openTest())),Ot.on("SCENE:SCREENSHOT",(()=>null==t?void 0:t.exportImage())),Ot.on("SKY:DAY",(()=>null==t?void 0:t.toByday(t.style))),Ot.on("SKY:EVENING",(()=>null==t?void 0:t.toEvening(t.style))),Ot.on("SKY:NIGHT",(()=>null==t?void 0:t.toNight(t.style))),Ot.on("EFFECT:FLEETING",(e=>null==t?void 0:t.toggleFleeting(e))),Ot.on("BIRD:COMPANY",(()=>null==t?void 0:t.toggleBridCompany())),Ot.on("UPDATE:DOT3",(e=>null==t?void 0:t.updateDot3(e)))})(D)},U=t=>{_.content=t,ct(ai,_.content||""),Ot.emit("SCREEN:WELCOM",_.content)};return C((()=>{I.container=O.value,D=new ni(I,{canvas:A.value,onHoverCall:(t,e)=>{const i=!!t&&(t.object._isAnchor_||t.object._isEmptyMesh_);if(m.show=i,i){const i=t.object;m.style.top=e.top,m.style.left=e.left;const o=i.data||{};m.msg=`\n          <p>${o.name||i.name}</p>\n          <p>类型：${o.type||"无"}</p>\n          <p>绑定：${o.bind||"无"}</p>\n        `}},onClickLeft:(t,e)=>{t&&t.data&&(t=>{const e=t.data;switch(null==e?void 0:e.type){case wt.M_ANCHOR_POS:D.cameraTransition(t);break;case wt.M_WAIT_LIFT:g.targetName=t.data.target,D.waitLift(t);break;case wt.M_LIGHT_SWITCH:Ot.emit("LIGHT:AUTO",t);break;case wt.M_LIGHT_MAIN_SWITCH:t.__close__=!t.__close__,Ot.emit("LIGHT:CLOSE",!t.__close__);break;case wt.M_GATE_SWITCH:D.openGate(t);break;case wt.M_DOUBLE_HORIZONTAL_SWITCH:D.dubleHorizontalDoor(t,5.4);break;case wt.M_ODD_ROTATE_SWITCH:D.oddRotateDoor(t);break;case wt.M_DOUBLE_ROTATE_SWITCH:D.dubleRotateDoor(t);break;case wt.M_CURTAIN_SWITCH:Ot.emit("CURTAIN:TOGGLE");break;case wt.M_VIDEO_SWITCH:D.videoPlay(t);break;case wt.M_SCREEN_EDIT:_.show=!0,m.show=!1;break;case wt.M_AIR_SWITCH:Ot.emit("AIR:ODD",t);break;case wt.M_MODE_SWITCH:console.log(Q(t.data))}})(t)},onClickRight:()=>{(null==D?void 0:D.getBridStatus())&&(null==D||D.toggleCompanyFocus(!0))},onClickGround:(t,e)=>{D.personMove(e).then((t=>{g.show=Et.liftGroundMeshName.includes(e.object.name)})).catch((()=>{}))},emptyGroupClick:t=>{D.cameraTransition({data:t})}}).run(),pt(D).resize(),B()})),(t,e)=>{const i=tt;return r(),l("div",{class:d(["three-page",t.$style.page])},[p(Dt,{list:f(N),scene:f(D),onChange:G},null,8,["list","scene"]),c("div",{class:"h-100",ref_key:"containerRef",ref:O},null,512),p(it,{modelValue:f(S).show,"onUpdate:modelValue":e[0]||(e[0]=t=>f(S).show=t),progress:f(S).percentage,"bg-src":f(Et).bgSrc},null,8,["modelValue","progress","bg-src"]),p(_t,{modelValue:f(m).show,"onUpdate:modelValue":e[1]||(e[1]=t=>f(m).show=t),style:h(f(m).style),msg:f(m).msg},null,8,["modelValue","style","msg"]),p(Rt),c("canvas",{class:d(t.$style["canvas-texture"]),ref_key:"canvasTextureRef",ref:A},null,2),n(c("div",{class:d(t.$style["floor-select"])},[(r(!0),l(y,null,v(f(w),(t=>(r(),b(i,{type:"primary",disabled:f(g).active===t.key,onClick:e=>(t=>{g.active=t.key;const e=t.bind;console.log(t);const i={data:{bind:e,to:{y:t.y},target:g.targetName}};null==D||D.waitLift(i,!0)})(t)},{default:x((()=>[T(u(t.name),1)])),_:2},1032,["disabled","onClick"])))),256))],2),[[a,f(g).show]]),p(bt,{modelValue:f(_).show,"onUpdate:modelValue":e[2]||(e[2]=t=>f(_).show=t),title:f(_).title,content:f(_).content,"onUpdate:content":e[3]||(e[3]=t=>f(_).content=t),"err-message":f(_).errMessage,onConfirm:U},null,8,["modelValue","title","content","err-message"])],2)}}}),[["__cssModules",{$style:{"canvas-texture":"_canvas-texture_yz1w8_2","floor-select":"_floor-select_yz1w8_14",page:"_page_yz1w8_20"}}]]);export{ri as default};
