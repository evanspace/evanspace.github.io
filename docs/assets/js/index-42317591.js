import{w as e,af as t,e as a,i as s,l as n,o,g as i,h as l,n as r}from"./vendor-9734da72.js";import{d as c,A as p,c as d,_ as m}from"./index-dbb4b4ea.js";import{E as u,e as f}from"./index-d713c0fb.js";const h=e=>{let t='\n    <div class="map-tooltip">\n    ';return e.city&&(t+=`\n      <div class="city flex">\n        <span class="name">${e.city||""}</span>\n        <span class="to">共${e.count??0}个项目</span>\n      </div>`),e.title&&(t+=`\n        <div class="project flex flex-ac">\n          <img src="https://raw.githubusercontent.com/zlevan/3d-demo-data/main/imgs/map/pos.png" alt="">\n          <span class="name">${e.title}</span>\n        </div>\n      `),t+='<div class="count">',t+=e.list.map((e=>`\n        <div class="item">\n          <span>${e.label||""}</span>\n          <span>${e.value??0}</span>\n          <span>${e.unit||""}</span>\n        </div>\n      `)).join(""),t+="\n      </div>\n    </div>\n  ",t},v=(e=1,t=!0)=>({map:"map",zoom:e,roam:t,label:{color:"#fff"},itemStyle:{borderColor:"rgba(19, 122, 202, .9)",areaColor:"#0B4187",borderWidth:1,shadowColor:"rgba(0, 0, 0, .9)",shadowBlur:1,shadowOffsetX:1,shadowOffsetY:1},select:null,emphasis:{itemStyle:{areaColor:"#091859"},label:{show:!1,color:"#ffffff"}}}),g=a=>({resize:()=>{const s=()=>null==a?void 0:a.resize();e((()=>d().sidebar.opened),(()=>{setTimeout(s,300)})),window.addEventListener("resize",s,!1),t((()=>{null==a||a.dispose(),window.removeEventListener("resize",s)}))}}),b=m(a({__name:"index",setup(e){const t=s(),a=s();let d;const m=async(e,t)=>{const s=a.value,n="china",o=await fetch("https://raw.githubusercontent.com/zlevan/3d-demo-data/main/map/china.json"),i=await o.json();if(window.MapData=e,null==d?void 0:d.getOption())return;f.registerMap(n,i);let l=((e="map",t)=>{const a=t.cityJson||[],s=t.scatters||[],n=t.points||[],o=t.lines||[];return{title:{},tooltip:{trigger:"item",padding:0,enterable:!1,transitionDuration:1,backgroundColor:"rgba(9, 24, 89, 1)",borderColor:"transparent",formatter:e=>{let t=e.seriesType,a={title:"",list:[]};if("map"==t||"map3D"==t){if(!e.data)return;const t=window.MapData.cityJson.find((t=>t.code==e.data.code));if(!t)return;a.city=t.city,a.count=t.count,a.list=[{label:"今日用电量",value:t.value,unit:"kWh"}]}else if("effectScatter"==t){let t=e.value;a.title=e.name,a.list=[{label:"经度",value:t[0],color:"#25f4f2"},{label:"维度",value:t[1],color:"#25f4f2"}]}else if("scatter"==t){const t=window.MapData.scatters.find((t=>t.id==e.data.id));if(!t)return"";a.city=t.city,a.count=t.count,a.title=t.name,a.list=[{label:"今日用电量",value:t.use,unit:"kWh"},{label:"今日碳排放",value:t.carbon,unit:"kgCO₂"}]}else if("lines"==t){let t=e.data.path,s=e.data.coords;a.title=t,a.list=[{label:"起点",value:s[0].join("-"),color:"#25f4f2"},{label:"终点",value:s[1].join("-"),color:"#25f4f2"}]}return h(a)}},visualMap:[{left:"2%",bottom:"2%",type:"continuous",show:!0,max:1e3,seriesIndex:[0],calculable:!0,inRange:{color:["#1e72ba","#33b1e7"]},textStyle:{color:"#ffffff",fontSize:16}}],globe:{show:!1},geo:{...v(1.25,!0),map:e},series:[{type:"map",map:e,geoIndex:0,data:a},{type:"scatter",showEffectOn:"render",coordinateSystem:"geo",symbol:"image://https://raw.githubusercontent.com/zlevan/3d-demo-data/main/imgs/map/map.png",symbolSize:32,itemStyle:{color:"#ffffff",borderWidth:1,borderColor:"#1DE9B6"},data:s},{type:"effectScatter",showEffectOn:"render",coordinateSystem:"geo",zlevel:1,rippleEffect:{color:"#1DE9B6",period:4,scale:3,brushType:"fill"},hoverAnimation:!0,itemStyle:{color:"#1DE9B6",shadowColor:"#333"},data:n},{type:"lines",zlevel:2,effect:{show:!0,period:3,trailLength:.1,symbol:"arrow",symbolSize:10},lineStyle:{width:1,opacity:.5,curveness:.3},data:o}]}})(n,e);l.visualMap&&(l.visualMap[0].max=t??1e3),d?d.Echarts.setOption(l):(d=new u(s,l),g(d).resize()),d.Echarts.hideLoading()},b=e=>{c.get(p.echarts.map).then((e=>{const t=[];let a=0;const s=e.map((e=>{const s=e.projects.length;let n=e.province;e.projects.forEach((a=>{t.push({value:[a.lng,a.lat],name:a.name,carbon:a.carbon,use:a.use,count:s,city:e.province,id:a.id})}));const o=e.total;return o>a&&(a=o),{name:n,code:e.code,count:s,city:e.province,value:0}}));return{projects:t,citys:s,max:100*Math.ceil(a/100)||100}})).then((t=>{const{citys:a,projects:s,max:n}=t;e.cityJson=a,e.scatters=s,m(e,n)}))};return n((async()=>{(()=>{const e=t.value;let a=(()=>{const e="https://raw.githubusercontent.com/zlevan/3d-demo-data/main";return{backgroundColor:"#000",globe:{globeRadius:80,baseTexture:`${e}/imgs/map/earth.jpg`,shading:"lambert",environment:`${e}/imgs/map/starfield.jpg`,atmosphere:{show:!0},light:{ambient:{intensity:.1},main:{intensity:1.8}},viewControl:{autoRotate:!0,autoRotateSpeed:25,alpha:50,beta:170,rotateSensitivity:3,panSensitivity:1,panMouseButton:"right",distance:180,minAlpha:5,maxAlpha:100,animation:!0,animationDurationUpdate:1e3,animationEasingUpdate:"cubicInOut"}},series:[]}})();const s=new u(e,a);g(s).resize()})();const e=await c.get(p.echarts.get);b(e)})),(e,s)=>(o(),i("div",{class:r(e.$style.page)},[l("div",{class:r(e.$style["echarts-view"])},[l("div",{ref_key:"earthRef",ref:t,class:"h-100"},null,512)],2),l("div",{class:r(e.$style["echarts-view"])},[l("div",{ref_key:"mapRef",ref:a,class:"h-100"},null,512)],2)],2))}}),[["__cssModules",{$style:{page:"_page_1571p_2","echarts-view":"_echarts-view_1571p_10",earth:"_earth_1571p_14",map:"_map_1571p_19"}}]]);export{b as default};
