var t=Object.defineProperty,e=(e,i,o)=>(((e,i,o)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[i]=o})(e,"symbol"!=typeof i?i+"":i,o),o);import{t as i}from"./index-8a4a68a0.js";import{e as o,A as s,_ as n}from"./index-14dfb97f.js";import{be as r,bs as a,ed as l,dL as c,c as h,dv as d,bh as u,e as p,Y as g,i as m,l as f,f as _,aa as v,o as y,g as b,h as C,u as k,F as G,r as x,t as w,n as A,q as D,a9 as P,B as S}from"./vendor-9759b632.js";import{m as j,l as M,A as O,u as T}from"./scene-resize-6de18767.js";const z="ANCHOR_POS",F="ANCHOR_TARGET",R="MAIN_SCENE",L="ROBOT",B="CHARACTER",E="floor_common",N="OPEN_DOOR",I="LIGHT_SWITCH",U=27.5,$=100,H=300,q=M,J=O,{raycaster:W,pointer:K,update:V,style:Y}=q.useRaycaster(),{initCSS2DRender:Q,createCSS2DDom:X}=q.useCSS2D(),{createDiffusion:Z,updateDiffusion:tt}=q.useDiffusion(),{createMove:et,moveAnimate:it}=q.useMoveAnimate(),{createFence:ot,fenceAnimate:st}=q.useFence(),{createRoam:nt,executeRoam:rt,pause:at,play:lt,getStatus:ct}=q.useRoam(),{floorAnimate:ht}=q.useFloor(),{keyboardPressed:dt,destroyEvent:ut,insertEvent:pt}=q.useKeyboardState(),{checkCollide:gt}=q.useCollide(),mt="FULL",ft="NPC";class _t extends j{constructor(t,i){super(t),e(this,"buildingGroup"),e(this,"anchorGroup"),e(this,"dotGroup"),e(this,"lightGroup"),e(this,"extend"),e(this,"css2DRender"),e(this,"mouseClickDiffusion"),e(this,"character"),e(this,"floorGroup"),e(this,"currentSight"),e(this,"historyTarget"),e(this,"historyCameraPosition"),e(this,"animateModels"),e(this,"moveFactor",1),e(this,"fence"),this.extend=i,this.css2DRender=Q(this.options,this.container),this.css2DRender.domElement.className="three-scene__dot-wrap",this.mouseClickDiffusion=Z(4,void 0,6),this.mouseClickDiffusion.rotation.x=.5*-Math.PI,this.mouseClickDiffusion.position.y=.5,this.mouseClickDiffusion.visible=!1,this.addObject(this.mouseClickDiffusion),this.createClock(),this.currentSight=mt,this.historyTarget=new r,this.historyCameraPosition=new r,this.animateModels=[],this.bindEvent(),this.addBuildingGroup(),this.addFloorGroup(),this.addAnchorGroup(),this.addDotGroup(),this.addLightGroup()}addBuildingGroup(){const t=new a;t.name="建筑组",this.buildingGroup=t,this.addObject(t)}clearBuilding(){this.buildingGroup&&this.disposeObj(this.buildingGroup),this.animateModels=[],this.addBuildingGroup(),this.clearAnchor(),this.clearDot(),this.clearFloor()}addBuilding(...t){this.buildingGroup&&this.buildingGroup.add(...t)}addAnchorGroup(){const t=new a;t.name="锚点组",this.anchorGroup=t,this.addObject(t)}clearAnchor(){this.anchorGroup&&this.disposeObj(this.anchorGroup),this.addAnchorGroup()}addAnchor(t){this.anchorGroup&&this.anchorGroup.add(t);const{x:e,y:i,z:o}=t.position;J.createSpriteAnimate(t,[e,i,o],1,8)}addDotGroup(){const t=new a;t.name="点位组",this.dotGroup=t,this.addObject(t)}clearDot(){this.dotGroup&&this.disposeObj(this.dotGroup),this.addDotGroup()}addDot(t,e){var i;const o=t.position,{size:s,color:n}=t.font||{},{x:r=0,y:a=0,z:l=0}=o||{},c=X({name:`\n        <div class="bg"></div>\n        <span class="inner" style="${null!=s?`font-size: ${"string"==typeof s?s:s+"px"};`:""} ${null!=n?`color: ${n}`:""}"></span>\n      `,className:"dot-2D-label",position:[r,a,l],onClick:e});return c.name=t.name,c.data=t,c._position_={x:r,y:a,z:l},null==(i=this.dotGroup)||i.add(c),c}addFloorGroup(){const t=new a;t.name="楼层组",this.floorGroup=t,this.addObject(t)}clearFloor(){this.floorGroup&&this.disposeObj(this.floorGroup),this.addFloorGroup()}addFloor(...t){this.floorGroup&&this.floorGroup.add(...t)}addLightGroup(){const t=new a;t.name="灯光组",this.lightGroup=t,this.addObject(t)}clearLightGroup(){this.lightGroup&&this.disposeObj(this.lightGroup),this.addLightGroup()}closeLightGroup(t=!1){var e;null==(e=this.lightGroup)||e.children.forEach((e=>{e.isSpotLight&&(e.visible=t)}))}addLight(t,e,i){if(this.lightGroup){e.name=t.name;const o=t.position||{x:0,y:0,z:0},{to:s={x:o.x,y:o.y-2,z:o.z}}=t;if(e.target.position.set(s.x,s.y,s.z),e.visible=!0,this.lightGroup.add(e),this.lightGroup.add(e.target),i){const t=new l(e,e.color);this.lightGroup.add(t)}}}lightSwitch(t){var e,i;const o=null==(i=this.lightGroup)?void 0:i.getObjectsByProperty("name",null==(e=t.data)?void 0:e.bind);o&&o.forEach((t=>{t.visible=!t.visible}))}addCharacter(t,e){const{x:i,y:o,z:s}=e;t.position.set(i,o,s),this.character=t;const n=t.animations,r=new c(t),a={};for(let c=0;c<n.length;c++){const t=n[c],e=r.clipAction(t);a[t.name]=e}const l="Idle";a[l].play();const h=a.Walking;t.extra={key:l,mixer:r,actions:a,runging:h},this.addObject(t);const d=["W","S"].map((t=>t.toUpperCase().charCodeAt(0)));pt((e=>{t.__runing__||d.includes(e.keyCode)&&h.play()}),(e=>{t.__runing__||d.includes(e.keyCode)&&h.stop()}))}changeCharacterAction(){if(!this.character)return;let{key:t,actions:e}=this.character.extra;const i=["Idle","Running","Dance","Death","Sitting","Standing","Jump","Punch","ThumbsUp","WalkJump","Yes","No","Wave"];let o=i.findIndex((e=>e===t))||0;e[t].stop(),o++,o>=i.length&&(o=0),t=i[o],e[t].play(),h.success({message:["空闲","跑步","舞蹈","散架","坐着","站立","弹跳","出拳","点赞","行走跳跃","点头","摇头","打招呼"][o],grouping:!0}),this.character.extra.key=t}toggleSight(t){if(this.judgeCruise())return;const e=this.currentSight==mt?ft:mt;this.currentSight=e;const i=e===ft;if(!this.controls)return;if(this.controls.maxDistance=i?3==t?20:0:800,this.controls.screenSpacePanning=!i,this.controls.enablePan=!i,this.controls.maxPolarAngle=Math.PI*(i?.8:.48),!this.character)return;const o=this.character.position,s=new r(0,2,0);if(i){this.historyTarget=this.controls.target.clone(),this.historyCameraPosition=this.camera.position.clone();const t=o.clone().add(s);this.camera.lookAt(t)}else this.camera.position.copy(this.historyCameraPosition),this.camera.lookAt(o);const n=(i?o:this.historyTarget).clone().add(s);this.controls.target.copy(n)}isPerspectives(){return this.currentSight==ft}characterAccelerate(t=1){this.moveFactor+=t,this.moveFactor>=10?this.moveFactor=10:this.moveFactor<=1&&(this.moveFactor=1),h.success({message:"人物速度："+this.moveFactor,grouping:!0})}setControlTarget(t){if(!this.controls)return;const{x:e,y:i,z:o}=t;this.controls.target.set(e,i+3,o),this.camera.lookAt(this.controls.target)}mouseClickGround(t){if(this.currentSight!==ft)return Promise.reject();const e=this.character;if(!e)return Promise.reject();const{runing:i}=this.options.cruise;if(i)return Promise.reject();const o=t.point,s=this.mouseClickDiffusion,{runging:n}=e.extra;n.play();const{x:r,y:a,z:l}=o;return s.position.set(r,a,l),s.visible=!0,e.__runing__=!0,new Promise((t=>{et(e,o,((t,i)=>{this.setControlTarget(t),this.checkCharacterCollide(t,2)&&(i(),n.stop(),e.__runing__=!1,s.visible=!1)}),(i=>{this.setControlTarget(i),n.stop(),e.__runing__=!1,s.visible=!1,t(e)}))}))}checkCharacterCollide(t,e=.3){var i;if(!this.character)return;const o=gt(this.character,t,(null==(i=this.buildingGroup)?void 0:i.children)||[],!0,new r(0,e,0));if(o.length){if(o[0].distance<.5)return h.warning({message:"撞到了！",grouping:!0}),!0}}getAnimTargetPos(t,e,i){if(!this.controls)return;const o=e||t.to||{x:-104,y:7,z:58},s=i||t.target||{x:0,y:0,z:0};return this.controls.target.set(s.x,s.y,s.z),o}addModelAnimate(t,e=[],i=!0,o=1){if(!e.length)return;const s=new c(t),n=e.reduce(((t,e)=>{const n=e.name||"";return t[n]=s.clipAction(e),i&&t[n].play(),t[n].timeScale=o,t}),{});t.__action__=n,t.__mixer__=s,this.animateModels.push(t)}cameraTransition(t){var e;if(this.judgeCruise())return;if(this.mouseClickDiffusion.visible)return void h.warning({message:"人物移动中，不可操作！",grouping:!0});this.isPerspectives()&&this.toggleSight();const{to:i,target:o=t.position}=t.data;if(!i)return;this.isCameraMove(i)||J.cameraLinkageControlsAnimate(this.controls,this.camera,i,o);const{bind:s}=t.data;if(!s)return;const n=null==(e=this.buildingGroup)?void 0:e.getObjectByName(s);this.addFence(n)}addFence(t){if(this.fence&&(this.disposeObj(this.fence),this.fence=void 0),t){const e=ot(t,5439406);this.fence=e,this.addObject(e)}}cameraLookatMoveTo(t){return new Promise(((e,i)=>this.judgeCruise(!0)||this.isPerspectives()?i(!1):void(this.controls&&(this.controls.maxDistance=100,J.cameraLookatAnimate(this.camera,t,this.controls.target).then((()=>{this.controls&&(this.controls.maxDistance=800),e(this.camera)}))))))}toggleCruise(t){ct()?h.warning({message:"请退出漫游！",grouping:!0}):super.toggleCruise(t)}judgeCruise(t){return this.options.cruise.runing?!t&&(h.warning({message:"请退出巡航！",grouping:!0}),!0):!!ct()&&(!t&&(h.warning({message:"请退出漫游！",grouping:!0}),!0))}controlReset(){this.judgeCruise()||(this.isPerspectives()&&this.toggleSight(),super.controlReset(),this.controls&&(this.historyTarget=(new r).copy(this.controls.target),this.historyCameraPosition=(new r).copy(this.camera.position)))}toggleRoam(){if(!this.controls)return;if(ct())return at(),void(this.controls.maxDistance=800);const t=this.extend.roamPoints||[];0!=t.length&&(this.controls.maxDistance=20,nt({points:t,tension:.3}),lt())}floorExpand(t){const e=t.data,i=this.getFloorByGroup(e.group);if(!i.length)return;const o=i.findIndex((e=>t.uuid===e.uuid));ht(i,o,(t=>this.getFlowMark(t)))}getMachineRoomStatus(t){const e=this.scene.getObjectByName(t);return{isFocus:null==e?void 0:e.__isFocus__,room:e}}toCoolMachineRoom(t){if(!this.controls)return;let e=this.historyTarget,i=this.historyCameraPosition;t&&(this.historyTarget=(new r).copy(this.controls.target),this.historyCameraPosition=(new r).copy(this.camera.position),e=new r(-182.4,14.7,67.7),i={x:-189.7,y:18,z:53.4}),J.cameraLinkageControlsAnimate(this.controls,this.camera,i,e)}openTheDoor(t){const e=this.scene.getObjectByName(t.data.bind);e&&(e.__open__=!e.__open__,new d(e.rotation).to({y:e.__open__?.5*Math.PI:0},1500).delay(0).start())}modelAnimate(){var t,e;this.css2DRender.render(this.scene,this.camera),"function"==typeof this.extend.animateCall&&this.extend.animateCall(),this.restoreAnchorMaterial();let i=(null==(t=this.clock)?void 0:t.getDelta())||0;if(this.animateModels.length&&this.animateModels.forEach((t=>{t.__mixer__&&t.__mixer__.update(i)})),this.anchorGroup){if(this.anchorGroup.children.forEach((t=>{t.__mixer__&&t.__mixer__.update(i)})),this.character){this.character.extra.mixer.update(i),it(.5*this.moveFactor)}if(this.mouseClickDiffusion.visible&&tt(),st(),rt(this.camera,this.controls),this.isPerspectives()&&!(null==(e=this.character)?void 0:e.__runing__)){const t=10*i,e=.4*Math.PI*i,o=this.character;if(!o)return;const s=dt("S");if(dt("W")||s){const e=new r;null==o||o.getWorldDirection(e);const i=e.clone().multiplyScalar(s?-t:t),n=(null==o?void 0:o.position.clone().add(i))||new r;this.checkCharacterCollide(n)||(null==o||o.position.copy(n),this.setControlTarget(null==o?void 0:o.position))}dt("A")?(o.rotation.y+=e,this.keyboardToTotation()):dt("D")&&(o.rotation.y-=e,this.keyboardToTotation())}}}keyboardToTotation(){var t;const e=this.character,i=new r;null==e||e.getWorldDirection(i);const o=(null==(t=this.controls)?void 0:t.maxDistance)||1,s=i.clone().multiplyScalar(-o),n=(null==e?void 0:e.position.clone().setY(this.camera.position.y).add(s))||new r;this.camera.position.copy(n),this.setControlTarget(null==e?void 0:e.position)}onDblclick(t){var e;const i=this.container,o=this.options.scale;if(V(t,i,o),this.floorGroup){W.setFromCamera(K,this.camera);const t=this.floorGroup.children,i=W.intersectObjects(t);if(i.length){const t=i[0].object,o=this.findParentGroup(t);if(!o)return;"function"==typeof(null==(e=this.extend)?void 0:e.onDblclick)&&this.extend.onDblclick(o)}}}onPointerMove(t){this.checkIntersectObjects(t)}onPointerUp(t){var e;super.onPointerUp(t);const i=t.timeStamp-this.pointer.tsp<H;2==t.button?i&&"function"==typeof(null==(e=this.extend)?void 0:e.onClickRight)&&this.extend.onClickRight(t):0==t.button?i&&this.checkIntersectObjects(t):t.button}checkIntersectObjects(t){var e,i,o,s,n;const r=this.container,a=this.options.scale;V(t,r,a);let l="pointerdown"==t.type||"pointerup"==t.type;const c=(null==(i=this.buildingGroup)?void 0:i.children.filter((t=>t.visible&&(l||t.__ground__))).concat((null==(e=this.anchorGroup)?void 0:e.children)||[]))||[];W.setFromCamera(K,this.camera);let h=W.intersectObjects(c,l);if(l)if(r.style.cursor="auto",h.length){const t=h[0],e=t.object;console.log(t);const i="string"==typeof e.name&&(this.extend.groundMeshName||[]).some((t=>e.name.indexOf(t)>-1)),n=this.findParentGroup(e);if(i&&"function"==typeof(null==(o=this.extend)?void 0:o.onClickGround)&&this.extend.onClickGround(n,t),!n)return;"function"==typeof(null==(s=this.extend)?void 0:s.onClickLeft)&&this.extend.onClickLeft(n,t)}else"function"==typeof(null==(n=this.extend)?void 0:n.onClickLeft)&&this.extend.onClickLeft();else this.hoverAnchor(h)}hoverAnchor(t){var e,i;if("function"==typeof this.extend.onHoverAnchor&&this.extend.onHoverAnchor(t[0],Y),t.length){const i=t[0].object;if(this.container.style.cursor=i._isAnchor_?"pointer":"auto",!i._isAnchor_)return;const o=i.material;void 0===i.__mat_color__&&(i.__mat_color__=o.color),o.color=new u(16715760),null==(e=this.anchorGroup)||e.children.forEach((t=>{t.__change_color__=t.uuid===i.uuid}))}else this.container.style.cursor="auto",null==(i=this.anchorGroup)||i.children.forEach((t=>{t.__change_color__=!1}))}restoreAnchorMaterial(){var t;null==(t=this.anchorGroup)||t.traverse((t=>{t.isSprite&&!t.__change_color__&&t.__mat_color__&&(t.material.color=t.__mat_color__)}))}findParentGroup(t){const e=t=>{if(t._isBuilding_)return t;let i=t.parent;return i?i&&i._isBuilding_?i:e(i):void 0};return e(t)}getAll(){var t,e,i,o;return(null==(o=this.buildingGroup)?void 0:o.children.concat((null==(t=this.dotGroup)?void 0:t.children)||[]).concat((null==(e=this.floorGroup)?void 0:e.children)||[]).concat((null==(i=this.anchorGroup)?void 0:i.children)||[]))||[]}getFloorByGroup(t){var e;return null==(e=this.floorGroup)?void 0:e.children.filter((e=>e.data.group===t))}getFlowMark(t){return this.getAll().filter((e=>{var i;return(null==(i=e.data)?void 0:i.followMark)===t}))}resize(){super.resize();const{width:t,height:e}=this.options;this.css2DRender.setSize(t,e)}dispose(){ut(),this.animateModels=[],this.disposeObj(this.buildingGroup),this.disposeObj(this.character),this.disposeObj(this.dotGroup),this.disposeObj(this.anchorGroup),this.disposeObj(this.fence),this.disposeObj(this.mouseClickDiffusion),this.disposeObj(this.floorGroup),this.disposeObj(this.lightGroup),this.clock=void 0,this.css2DRender=void 0,this.buildingGroup=void 0,this.character=void 0,this.dotGroup=void 0,this.anchorGroup=void 0,this.fence=void 0,this.mouseClickDiffusion=void 0,this.floorGroup=void 0,this.lightGroup=void 0,this.extend={},super.dispose()}}const vt=(t,e)=>{const i=40*Math.random();return void 0!==i&&(t.value=i),t.show=Math.random()>.5,t.value=Number(Number(t.value||0).toFixed(2)),{value:t.value,show:t.show,font:{...t.font||{},color:"#"+(16777215+1e6*i).toString(16).substring(0,6)}}},yt={class:"scene-operation"},bt=["onClick"],Ct=["innerHTML"],kt="机房",Gt=n(p({__name:"index",setup(t){const e=g((n=(t,e,i,o)=>{if(rt){(o+=.02)>1&&(o-=1),t=((t,e=0)=>new r(t.x,t.y+e,t.z))(i.getPointAt(o));let s=o+.001;s>1&&(s-=1),e=i.getPointAt(s),rt.position.set(t.x,U,t.z);const n=Math.atan2(-e.z+t.z,e.x-t.x);rt.rotation.z=.5*Math.PI+n}},{devEnv:!1,baseUrl:"",bgColor:"",skyCode:"221",env:"/oss/textures/hdr/6.hdr",dotKey:"DOT",dotShowStrict:!1,config:{},anchorType:[z,F,N,I],animationModelType:[R],floorModelType:[E],models:[{key:R,name:"场景",size:50.4,url:"/深圳北站.glb"},{key:"machine_room",name:"机房",size:19.6,url:"/机房.glb"},{key:"building",name:"楼宇",size:.3,url:"/楼宇.glb"},{key:"residential",name:"居民楼",size:.08,url:"/居民楼.glb"},{key:"small_residential",name:"小型居民楼",size:.08,url:"/小型居民楼.glb"},{key:E,name:"楼层",size:6.3,url:"/楼层.glb"},{key:z,name:"定位",type:"sprite",range:{x:4,y:4},mapUrl:"/dw.png"},{key:F,name:"锚点",type:"sprite",range:{x:4,y:4},mapUrl:"/dw.png"},{key:N,name:"开门",type:"sprite",range:{x:2,y:2},mapUrl:"/pos.png"},{key:L,name:"机器人",size:.3,url:"/oss/model/park/机器人.glb"},{key:B,name:"人物",size:2.2,url:"/oss/model/park/RobotExpressive.glb"},{key:"waiting_room_spot_light",type:"spotlight",name:"聚光灯",intensity:8,color:16775378,distance:40},{key:I,name:"开关灯",type:"sprite",mapUrl:"/light.png",range:{x:2,y:2}}].map((t=>(t.url&&t.url.indexOf("oss")<0&&(t.url="/oss/model/station"+t.url),t.mapUrl&&(t.mapUrl="/oss/textures/station"+t.mapUrl),t))),cruise:{visible:!0,auto:!0,mapUrl:"/oss/textures/cruise/line5.png",repeat:[.1,1],width:2,segment:100,tension:0,speed:20,mapSpeed:.01,points:[[102.5,U,9.9],[102.5,U,291.9],[76,U,291.9],[76,U,129],[-76,U,129],[-76,U,291.9],[-107.7,U,291.9],[-107.7,U,9.9]],offset:1.8,animateBack:n},roamPoints:[[-286,$,257],[286,$,257],[286,$,-600],[-286,$,-600]]}));var n;const a=g({show:!1,style:{left:0,top:0},msg:""}),{changeBackground:l,backgroundLoad:c}=M.useBackground(),{progress:d,loadModels:u,getModel:p,virtualization:j,closeVirtualization:H}=M.useModelLoader({baseUrl:e.baseUrl,indexDB:{cache:!0,dbName:"THREE__STATION__DB",tbName:"TB",version:44}}),{options:q}=M.useDialog(),J=m(),W={baseUrl:e.baseUrl,env:e.env,cruise:e.cruise,controls:{enableDamping:!0,dampingFactor:.48,maxPolarAngle:.48*Math.PI,screenSpacePanning:!1,maxDistance:800},camera:{near:3},directionalLight:{intensity:2.2}};let K;f((()=>{W.container=J.value,K=new _t(W,{groundMeshName:["行走地面","平面125","平面126","平面127","平面128","平面129","平面130","楼梯","机房地面","地面002","立方体128","立方体780_1","11111","22222"],roamPoints:e.roamPoints,onDblclick:t=>{K.floorExpand(t)},onClickLeft:(t,e)=>{if(q.select=[],q.show=!1,t&&t.data){const e=t.data;switch(null==e?void 0:e.type){case z:ct(),K.cameraTransition(t);break;case F:q.select=[t],nt();break;case N:K.openTheDoor(t);break;case I:K.lightSwitch(t)}}},onClickGround:(t,e)=>{K.mouseClickGround(e)},onHoverAnchor:(t,e)=>{const i=!!t&&t.object._isAnchor_;if(a.show=i,i){a.style.top=e.top,a.style.left=e.left;const i=t.object.data;a.msg=`\n          <p>${i.name}</p>\n          <p>类型：${i.type}</p>\n          <p>绑定：${i.bind||"无"}</p>\n        `}},animateCall:()=>{if(q.show&&q.select&&q.select.length){const t=q.select[0];st(t)}}}),K.run(),T(K).resize(),V()}));const V=()=>{X(),c(K,e.skyCode)},Y=m([]),Q=_((()=>Y.value.filter((t=>t.type===z)))),X=()=>{u(e.models,(()=>{o.get(s.d3.station).then((async t=>{let i={};if(t.ConfigJson instanceof Object)i=t.ConfigJson;else if("string"==typeof t.ConfigJson)try{i=JSON.parse(t.ConfigJson)}catch(o){}Y.value=t.JsonList,Object.keys(i).forEach((t=>{e.config&&(e.config[t]=i[t])})),await Z(),at(),lt()}))}))},Z=async()=>{d.percentage=100,d.show=!1,K.clearBuilding(),await v(),await tt(),K.setCruisePoint(e.cruise.points);const t=K.getAnimTargetPos(e.config||{});O.cameraInSceneAnimate(K.camera,t,K.controls.target).then((()=>{K.controlSave(),setTimeout((()=>{K.closeLightGroup()}),100)}))},tt=()=>{let t=0,e=Y.value.length;return new Promise((i=>{if(0==e)return i(null);const o=async()=>{const s=Y.value[t];await et(s),t++,t<e?o():i(t)};o()}))},et=async t=>{if(!t)return;const{type:i}=t,o=p(i);if(!o)return void(i===e.dotKey&&ot(t));const{anchorType:s=[],animationModelType:n=[],floorModelType:r=[]}=e;let a=O.modelDeepClone(o);const{position:l,scale:c,rotation:h}=O.get_P_S_R_param(a,t),[d,u,g]=l;return a.scale.set(...c),a.position.set(d,u,g),a.rotation.set(...h),a._isBuilding_=!0,a.data=t,n.includes(i)&&K.addModelAnimate(a,o.animations,!0,1),(t.followMark||t.mark)&&(a._position_={x:d,y:u,z:g}),s.includes(i)?(a._isAnchor_=!0,K.addAnchor(a)):a.isSpotLight?K.addLight(t,a,!0):r.includes(i)?(a._position_={x:d,y:u,z:g},a._isFloor_=!0,K.addFloor(a)):K.addBuilding(a),Promise.resolve()},it=t=>{var i;const o=t.data;{const t=vt(o,K.buildingGroup);"object"==typeof t&&Object.keys(t).forEach((e=>{o[e]=t[e]}))}t.visible=o.show||!e.dotShowStrict;const s=null==(i=t.element)?void 0:i.getElementsByClassName("inner")[0];if(s){const{size:t,color:e}=o.font||{};null!=t&&(s.style.fontSize="string"==typeof t?t:t+"px"),null!=e&&(s.style.color=e),s.textContent=`${o.value||0}${o.unit}`}},ot=t=>{it(K.addDot(t,((e,i)=>{q.select=[i],nt(),K.cameraLookatMoveTo(t.position).then((()=>{}))})))},st=t=>{const e=J.value,i=O.getPlanePosition(e,t,K.camera);return q.position=i,q.style&&(q.style.left=i.left+"px",q.style.top=i.top+"px"),i},nt=()=>{if(!q.select)return;const t=q.select[0].data;q.data=t,q.title=(null==t?void 0:t.name)||"",q.list=[{name:"属性 1",value:(100*Math.random()).toFixed(2),unit:"%"},{name:"属性 2",value:(100*Math.random()).toFixed(2),unit:"%"}],q.show=!0};let rt;const at=()=>{rt=p(L),rt.position.z=U,rt.rotation.z=.5*Math.PI,K.addObject(rt)},lt=()=>{const t=p(B);t.traverse((t=>{t.isMesh&&(t.castShadow=!0)}));K.addCharacter(t,{x:0,y:27.5,z:122})},ct=()=>{var t;const{isFocus:e}=K.getMachineRoomStatus(kt);e&&H(null==(t=K.buildingGroup)?void 0:t.children)},ht=t=>{ct(),null==K||K.toggleSight(t)};return(t,o)=>(y(),b("div",{class:A(t.$style.page)},[C("div",yt,[C("div",{class:"btn",onClick:o[0]||(o[0]=()=>{K.getAll().forEach(((t,i)=>{t.data&&(t.data.type!==e.dotKey||it(t))}))})},"随机更新"),C("div",{class:"btn",onClick:o[1]||(o[1]=()=>{var t;return null==(t=k(K))?void 0:t.getPosition()})},"场景坐标"),C("div",{class:"item",onClick:o[2]||(o[2]=()=>(ct(),void(null==K||K.toggleRoam())))},"全景漫游"),C("div",{class:"item",onClick:o[3]||(o[3]=()=>(()=>{var t,e;if(K.judgeCruise())return;K.isPerspectives()&&K.toggleSight();const{room:i,isFocus:o}=K.getMachineRoomStatus(kt);if(i){if(i.__isFocus__=!o,o)return H(null==(t=K.buildingGroup)?void 0:t.children),void K.toCoolMachineRoom(!1);K.toCoolMachineRoom(!0),j((null==(e=K.buildingGroup)?void 0:e.children)||[],i,{wireframe:!0,hidden:!0,opacity:.1,filter:["_基础_grp","平面109_1","地面001","地面012","地面002","平面601","平面613","平面642","平面643","平面241","平面243","Landscape001","Landscape002","Landscape003","Landscape008","Landscape009"]})}else h.warning({message:"未找到机房模块！",grouping:!0})})())},"制冷机房"),(y(!0),b(G,null,x(k(Q),(t=>(y(),b("div",{class:"item",onClick:e=>(t=>{var e;const{room:i,isFocus:o}=K.getMachineRoomStatus(kt);o&&H(null==(e=K.buildingGroup)?void 0:e.children),i.__isFocus__=!1,K.cameraTransition({position:t.position,data:t})})(t)},w(t.name),9,bt)))),256)),C("div",{class:"item",onClick:o[4]||(o[4]=()=>{var t;return null==(t=k(K))?void 0:t.toggleCruise()})},"定点巡航"),C("div",{class:"item",onClick:o[5]||(o[5]=()=>{var t;return null==(t=k(K))?void 0:t.controlReset()})},"视角重置"),C("div",{class:"item",onClick:o[6]||(o[6]=()=>ht(1))},"第一人称"),C("div",{class:"item",onClick:o[7]||(o[7]=()=>ht(3))},"第三人称"),C("div",{class:"item",onClick:o[8]||(o[8]=()=>k(K).changeCharacterAction())},"人物动作"),C("div",{class:"item",onClick:o[9]||(o[9]=()=>k(K).characterAccelerate())},"人物加速"),C("div",{class:"item",onClick:o[10]||(o[10]=()=>k(K).characterAccelerate(-1))},"人物减速"),C("div",{class:"item",onClick:o[11]||(o[11]=()=>k(l)(k(K)))},"切换背景")]),C("div",{class:A(t.$style.container),ref_key:"containerRef",ref:J},null,2),D(i,{modelValue:k(d).show,"onUpdate:modelValue":o[12]||(o[12]=t=>k(d).show=t),progress:k(d).percentage},null,8,["modelValue","progress"]),k(a).show?(y(),b("div",{key:0,class:A(t.$style.tip),style:P({left:k(a).style.left+"px",top:k(a).style.top+"px"})},[C("div",{class:A(t.$style.msg),innerHTML:k(a).msg},null,10,Ct)],6)):S("",!0),k(q).show?(y(),b("div",{key:1,class:A(t.$style.dialog),style:P(k(q).style)},[C("div",{class:A(t.$style.wrap)},[C("div",null,w(k(q).title),1),C("div",{class:A(t.$style.content)},[(y(!0),b(G,null,x(k(q).list,(e=>(y(),b("div",{class:A(t.$style.item)},[C("span",null,w(e.name)+"：",1),C("span",null,w(e.value)+w(e.unit||""),1)],2)))),256))],2)],2)],6)):S("",!0)],2))}}),[["__cssModules",{$style:{page:"_page_lbnq2_2",container:"_container_lbnq2_10",tip:"_tip_lbnq2_14",dialog:"_dialog_lbnq2_15",msg:"_msg_lbnq2_24",wrap:"_wrap_lbnq2_38",title:"_title_lbnq2_49",content:"_content_lbnq2_52",item:"_item_lbnq2_55"}}]]);export{Gt as default};
