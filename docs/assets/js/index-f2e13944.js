var e=Object.defineProperty,s=(s,t,a)=>(((s,t,a)=>{t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a})(s,"symbol"!=typeof t?t+"":t,a),a);import{d4 as t,bi as a,eY as o,ez as n,bc as r,eA as i,dU as d,dS as l,da as c,bs as u,cZ as h,bg as m,be as p,bk as g,eB as b,e as v,Y as w,i as y,l as f,o as M,g as P,h as j}from"./vendor-5431a8ac.js";import{u as S,v as _,a as x,o as C}from"./scene-resize-ef21d22a.js";import"./index-8c37d8b7.js";const{pass:k,uniform:E,time:z,oscSine:O}=b,{pointer:L,update:R,raycaster:A}=S.useRaycaster(),G=E(3),H=E(0),N=E(1),U=E(0),B=E(new t(16777215)),D=E(new t(5125686));class T extends _{constructor(e){super(e),s(this,"gui"),s(this,"group",new a),s(this,"select",[]),s(this,"outlinePass"),s(this,"postProcessing"),this.addObject(this.group);const t=o(this.scene,this.camera,{selectedObjects:this.select,edgeGlow:H,edgeThickness:N});this.outlinePass=t;const{visibleEdge:i,hiddenEdge:d}=t,l=z.div(U).mul(2),c=O(l).mul(.5).add(.5),u=i.mul(B).add(d.mul(D)).mul(G),h=U.greaterThan(0).select(u.mul(c),u),m=k(this.scene,this.camera),p=new n(this.renderer);p.outputNode=h.add(m),this.postProcessing=p,this.gui=new r,this.addGui(),this.bindEvent()}createRender(){return new i}createAmbientLight(e,s){return new d(e,s)}createDirectionalLight(e,s){return new l(e,s)}addModel(e){this.group.children.length=0;let s=1;e.traverse((e=>{if(e.isMesh){e.geometry.center(),e.geometry.computeBoundingSphere(),s=.2*e.geometry.boundingSphere.radius;const t=new c({color:16777215,specular:1118481,shininess:5});e.material=t,e.receiveShadow=!0,e.castShadow=!0}})),e.position.y=1,e.scale.divideScalar(s),this.group.add(e);const t=new u(3,48,24);for(let o=0;o<20;o++){const e=new h;e.color.setHSL(Math.random(),1,.3);const s=new m(t,e);s.position.set(4*Math.random()-2,4*Math.random()-2,4*Math.random()-2),s.scale.multiplyScalar(.3*Math.random()+.1),this.group.add(s)}const a=new m(new p(12,12),new h({color:3235718,side:g}));a.rotation.x-=.5*Math.PI,a.position.y-=1.5,a.receiveShadow=!0,this.group.add(a)}onPointerMove(e){if(!e.isPrimary)return;R(e,this.container),A.setFromCamera(L,this.camera);const s=A.intersectObject(this.group,!0);if(s.length>0){const e=s[0].object;this.select=[],this.select.push(e),this.outlinePass.selectedObjects=this.select}}addGui(){var e;const s=this.gui;s.add(G,"value",.01,10).name("边缘强度"),s.add(H,"value",0,1).step(.01).name("边缘发光"),s.add(N,"value",0,6).step(.01).name("边缘厚度"),s.add(U,"value",0,6).step(.01).name("脉冲周期"),s.addColor({color:B.value.getHex()},"color").name("可见区域颜色").onChange((e=>{B.value.set(e)})),s.addColor({color:D.value.getHex()},"color").name("不可见区域颜色").onChange((e=>{D.value.set(e)})),s.domElement.className+=" gui-wrap",null==(e=this.container.parentNode)||e.appendChild(s.domElement)}setEnv(e){this.scene.environment=e,this.scene.background=e}animate(){this.postProcessing.renderAsync()}}const Y={class:"three-page"},F=v({__name:"index",setup(e){const s=w({base:"",models:[{key:"tree",name:"大树",size:.1,url:"/oss/model/gpu/tree.glb"}],objects:[{type:"tree",name:"大树"}]}),{progress:t,loadModels:a,getModel:o,initModels:n}=S.useModelLoader({baseUrl:s.base}),r=y(),i={baseUrl:s.base,env:"/oss/textures/hdr/moonless_golf_1k.hdr",camera:{position:[0,0,15]}};let d;return f((()=>{i.container=r.value,d=new T(i).run(),x(d).resize(),a(s.models,(()=>{t.percentage=100,t.show=!1,n(s.objects,(e=>{const{type:s}=e,t=o(s);if(!t)return Promise.resolve();let a=C.modelDeepClone(t);const{position:n,scale:r,rotation:i}=C.get_P_S_R_param(a,e),[l,c,u]=n;return a.scale.set(...r),a.position.set(l,c,u),a.rotation.set(...i),d.addModel(a),Promise.resolve()}))}))})),(e,s)=>(M(),P("div",Y,[j("div",{class:"h-100",ref_key:"containerRef",ref:r},null,512)]))}});export{F as default};
