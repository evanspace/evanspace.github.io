var t=Object.defineProperty,e=(e,i,o)=>(((e,i,o)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[i]=o})(e,"symbol"!=typeof i?i+"":i,o),o);import{e as i,eC as o,eD as s,o as n,g as a,h as r,t as l,q as c,B as h,c as d,au as u,F as p,r as g,n as m,bv as _,bx as v,ed as y,eb as f,da as C,eI as b,eK as S,eL as A,eS as G,e7 as E,dV as R,eT as x,ds as O,eU as k,eV as L,dt as T,bw as w,dl as M,Y as D,i as I,f as P,l as N,u as j,a7 as H,a8 as z,m as F,p as U,I as B,a9 as V,aP as W,ak as $,aa as Y}from"./vendor-9734da72.js";import{t as K,_ as J,g as Z,d as X,A as q,j as Q,s as tt}from"./index-61d77f8a.js";import{t as et}from"./index-86388067.js";import{f as it,w as ot,i as st,u as nt}from"./scene-resize-1312646b.js";import{u as at}from"./dialog-226deff3.js";const rt={key:0,class:"screen-welcom-dialog"},lt={class:"wrap"},ct={class:"body"},ht={class:"title"},dt={class:"bg"},ut={class:"text"},pt={class:"content"},gt=i({__name:"edit-dialog",props:o({title:{},errMessage:{}},{modelValue:{type:Boolean},modelModifiers:{},content:{},contentModifiers:{}}),emits:o(["confirm"],["update:modelValue","update:content"]),setup(t,{emit:e}){const i=t,o=s(t,"modelValue"),p=s(t,"content"),g=e,m=()=>{K(p.value||"")?(o.value=!1,g("confirm",p.value)):d.warning({message:i.errMessage,grouping:!0})};return(t,e)=>{const i=u;return o.value?(n(),a("div",rt,[r("div",{class:"mask",onClick:e[0]||(e[0]=t=>o.value=!o.value)}),r("div",lt,[r("div",ct,[r("div",ht,[r("div",dt,l(t.title),1),r("div",ut,l(t.title),1)]),r("div",pt,[c(i,{type:"textarea",modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),placeholder:"请输入",maxlength:"24","show-word-limit":""},null,8,["modelValue"])]),r("div",{class:"footer"},[r("div",{class:"btn",onClick:m})])])])])):h("",!0)}}}),mt=J(i({__name:"first-person",setup(t){const e=[{code:"W",desc:"前进"},{code:"S",desc:"后退"},{code:"A",desc:"向左转向"},{code:"D",desc:"向右转向"},{code:"X",desc:"加速"},{code:"Z",desc:"减速"}];return(t,i)=>(n(),a("div",{class:m([t.$style.page,"character-sight"])},[r("div",{class:m(t.$style.tip)},[(n(),a(p,null,g(e,(e=>r("div",{class:m(t.$style.item)},[r("span",null,l(e.code),1),r("span",null,l(e.desc),1)],2))),64))],2),r("div",{class:m(t.$style.center)},null,2)],2))}}),[["__cssModules",{$style:{page:"_page_13ksh_2",tip:"_tip_13ksh_15",item:"_item_13ksh_22",center:"_center_13ksh_34"}}]]),_t="https://ye6.atomgit.net/3d-demo-data",vt="ANCHOR_POS",yt="ANCHOR_TARGET",ft="MAIN_SCENE",Ct="campany_floor",bt="curtain",St="ROBOT",At="CHARACTER",Gt="WAIT_LIFT",Et="LIGHT_SWITCH",Rt="LIGHT_MAIN_SWITCH",xt="AIR_SWITCH",Ot="GATE_SWITCH",kt="DOUBLE_HORIZONTAL_SWITCH",Lt="DOUBLE_ROTATE_SWITCH",Tt="ODD_ROTATE_SWITCH",wt="VIDEO_SWITCH",Mt="SCREEN_EDIT",Dt="CURTAIN_SWITCH",It="MODE_SWITCH",Pt=["CAMERA:ROAM","CAMERA:CRUISE","CAMERA:RESET","CAMERA:FIRST","CAMERA:THREE","CAMERA:GATE","CAMERA:RECCEPTION","CAMERA:OFFICE","CAMERA:LCR","CAMERA:BOSS","PERSON:ADD","PERSON:SUB","LIGHT:RECCEPTION","LIGHT:AILSE","LIGHT:PM","LIGHT:HOST","LIGHT:LCR","LIGHT:CLG","LIGHT:FIRSTFLOOR","LIGHT:CLOSE","LIGHT:AUTO","CURTAIN:TOGGLE","DOOR:COMPANY","DOOR:LCR","DOOR:BOSS","SCREEN:COMPANY","SCREEN:WELCOM","SCREEN:SCR","SCREEN:LCR","AIR:MAIN","AIR:ODD","SCENE:POS","SKY:DAY","SKY:EVENING","SKY:NIGHT","EFFECT:FLEETING","BIRD:COMPANY"];const Nt=new class{constructor(){e(this,"listteners",Pt.reduce(((t,e)=>(t[e]=new Set,t)),{}))}on(t,e){this.listteners[t].forEach((i=>{i.toString()===e.toString()&&this.listteners[t].delete(i)})),this.listteners[t].add(e)}emit(t,...e){this.listteners[t].forEach((t=>t(...e)))}},jt=300,Ht={x:0,y:3.5,z:.1},zt="PlayOne-Headnod",Ft="PlayOne-Walk",Ut=1,Bt=1,Vt=[[8,18],[18,20],[20,8]],Wt=[[[-1247.3804124641044,1.5,275.8568665121467],[-385.54913233299317,1.5,235.37414186604545],[-74.15440788927455,1.5,249.36770549275383],[465.22573985771027,1.5,245.43607244481086],[725.5941701917296,1.5,249.85748872521614],[1298.4540604962947,1.5,246.2826397113465],[1540.3121752120794,1.5,248.16462011553776],[2035.0305758526924,1.5,250.3197618335575],[2247.330156763603,1.5,247.35851806181827],[2614.171817337305,1.5,241.05764461471873]],[[653.0182392436438,1.5,186.20541161524878],[640.5314650233396,1.5,-478.1628829727225],[641.5186617371273,1.5,-741.7856284596322],[641.8860570932816,1.5,-1180.303297128374],[636.5706330757,1.5,-1435.6099074377244],[651.4496990930706,1.5,-2151.481360404476]],[[-184.48466894299744,1.5,2447.03846990951],[-186.588766153597,1.5,1617.8540886409082],[-184.69458845133832,1.5,1300.1784227505875],[-186.39769511236557,1.5,361.1691127475875],[-181.39186291802253,1.5,100.79623785390046],[-153.08794728573116,1.5,-361.6354243767241],[-149.96162120866242,1.5,-670.0291574302669],[-143.93274083461012,1.5,-1094.1977278309487],[-146.55180744515872,1.5,-1375.823600978301],[-116.02623152983233,1.5,-2108.4946603582016]],[[254.9890486347282,1.5,188.40181034697815],[248.52761744154438,1.5,-519.7744116293145]],[[-1247.9079420458377,1.5,301.9431764689599],[-383.5097210507664,1.5,264.71915732788005],[-71.23512580197027,1.5,275.3629302523157],[466.128250712296,1.5,275.2716282312793],[741.6370632026585,1.5,277.66102510376084],[1297.4737719762595,1.5,277.2168628506806],[1541.7297005023304,1.5,280.31972525507285],[2037.2405649559382,1.5,280.98678580599466],[2246.595015753523,1.5,283.1011600230837],[2617.1867659153927,1.5,278.8253659556488]],[[2611.3420640520076,1.5,163.96935494305524],[2239.038081627408,1.5,174.12102368223074],[2032.5550985659966,1.5,188.6090112066963],[1532.405982209116,1.5,189.6348998853747],[1298.330733919915,1.5,185.10779629834326],[732.0840195081455,1.5,187.16481480781331],[470.24205339525065,1.5,189.90699833376397],[-84.06660102385868,1.5,192.15782227582906],[-384.7643865790769,1.5,185.23744642336993],[-1257.0964658502476,1.5,220.7083203147085]],[[-1494.2513045295325,1.5,-523.9699855391409],[-347.25187028816856,1.5,-474.65671096988984],[-15.027389984711675,1.5,-487.5419186263196],[460.1280047533312,1.5,-554.9641189234129],[769.3595908495539,1.5,-610.2755139698855],[1295.7126441671367,1.5,-685.7478189381841],[1514.966726681715,1.5,-702.0163690628412],[2028.26504557221,1.5,-708.4714990968719],[2229.5644216212645,1.5,-702.2878946149901],[2629.0123847430777,1.5,-711.4343799242977]],[[2617.633985591895,1.5,201.60419658108776],[2243.909428783476,1.5,206.87474446964558],[2034.8776601667457,1.5,214.17713607035415],[1533.6654999142486,1.5,216.16096497050023],[1292.917491810635,1.5,211.694521877535],[733.5212884806997,1.5,212.4150255097067],[468.0441428401828,1.5,211.83554003650767],[-81.88484692151263,1.5,215.50162318985943],[-385.33313200911095,1.5,208.79517510379873],[-1252.2402103549757,1.5,246.2595475811134]],[[-216.74411496965007,1.5,2446.1899911004953],[-212.54025051280874,1.5,1618.4430966822365],[-213.1531765155122,1.5,1299.5372821282467],[-212.88029306826311,1.5,361.004463092096],[-204.31776521867644,1.5,95.17239553880012],[-175.35362468958635,1.5,-361.2624545092945],[-176.90039928865932,1.5,-675.9746927279216],[-169.7193594972355,1.5,-1094.745742326411],[-170.74265977198806,1.5,-1381.291722860903],[-143.83153846069854,1.5,-2106.089132268412]],[[-166.69061346783928,1.5,-2106.8143772513126],[-198.0488246554272,1.5,-1381.582043826204],[-199.7107069657603,1.5,-1095.6028221394768],[-206.74060670641225,1.5,-677.0697121202405],[-202.700259003459,1.5,-365.7406797551388],[-230.01591899796063,1.5,91.60705400934745],[-242.9062425497127,1.5,359.4021473586805],[-242.27821018691782,1.5,1297.7164477844215],[-242.66307406448757,1.5,1615.4387891061058],[-243.2521320513111,1.5,2442.9364318668368]],[[-191.438779413371,1.5,-2106.3282094666683],[-220.73958879833555,1.5,-1384.5763798106966],[-227.4255891103798,1.5,-1097.5557009252084],[-232.3590701921136,1.5,-676.5102411464416],[-229.60449004853604,1.5,-363.66500472487803],[-254.03347391022893,1.5,88.02859900453808],[-270.9119445790846,1.5,355.8050561117999],[-271.8960506127454,1.5,1297.4563069322603],[-269.32241688262354,1.5,1619.2232293653196],[-269.6085197110389,1.5,2442.486822687859]],[[-1490.9279956818982,1.5,-546.4210301147804],[-347.46827976878035,1.5,-499.19644259345415],[-10.407826447936372,1.5,-512.7596249145535],[456.4211224463379,1.5,-576.9125511231589],[759.2761525703872,1.5,-631.8081248108039],[1293.0791107409004,1.5,-705.0280213831614],[1508.7704296505792,1.5,-728.3802290028357],[2032.6982432385287,1.5,-731.5117672205906],[2219.6072248811265,1.5,-734.637580331011],[2625.643276984354,1.5,-743.8101299753371]],[[2626.3901700736037,1.5,-781.1017696857378],[2220.8514498299905,1.5,-769.0356255284045],[2032.2913703532724,1.5,-762.8575496165022],[1511.3552256541166,1.5,-759.2404009381686],[1286.7820276626376,1.5,-730.1059576100947],[756.3682832855267,1.5,-652.7145464611291],[452.61843137679864,1.5,-606.8682449037161],[-12.78416595913032,1.5,-543.2368997160044],[-343.08772274031026,1.5,-527.962481270673],[-1489.2130939698452,1.5,-574.8731410713193]],[[2623.1011840628594,1.5,-814.6475022807425],[2216.036849549517,1.5,-801.011576545054],[2030.0825780786195,1.5,-787.8840257205616],[1506.3601369519993,1.5,-784.4496008940721],[1287.1959219288165,1.5,-752.7952322380231],[752.9829675686118,1.5,-673.170208139215],[445.89106268451593,1.5,-631.647110579748],[-19.911685547898884,1.5,-566.4904449943363],[-345.4294265338732,1.5,-548.87622952709],[-1491.0183116346152,1.5,-596.5878109151417]],[[231.82903145902645,1.5,189.17638213146898],[224.3313036580691,1.5,-523.6629269807526]],[[199.34569678838128,1.5,-519.3457911109576],[206.1046050573263,1.5,188.7851087774285]],[[174.1270577790077,1.5,-515.3193396429033],[182.4833928328745,1.5,188.894326911243]],[[622.1583807823386,1.5,185.58693904691773],[615.5669746892655,1.5,-478.02316117666794],[616.5459390204022,1.5,-744.0007790209756],[613.1324539553776,1.5,-1181.9088663464408],[611.6114090950623,1.5,-1438.6207884389128],[628.3415357586932,1.5,-2153.3845865461985]],[[602.78350309092,1.5,-2154.719743541784],[583.8038920679553,1.5,-1440.8315284661855],[586.7498907865534,1.5,-1180.8808974289223],[586.8406384033154,1.5,-747.7377094033409],[586.8508956121347,1.5,-484.2064033588732],[593.0310370827052,1.5,185.91229223707006]],[[578.7234766214117,1.5,-2156.363001113399],[561.8484645719363,1.5,-1438.6215071324666],[560.7857436547948,1.5,-1182.8499596656188],[560.3517043728388,1.5,-745.4949702873103],[557.7773034922892,1.5,-480.2852643380643],[558.7645775584266,1.5,186.38583329069326]],[[-1484.025498440763,1.5,1589.088331309893],[-393.96910868208226,1.5,1516.2559403282253],[-74.7466791237108,1.5,1497.2077562666695],[1256.1050380329816,1.5,1412.9053951256778],[1545.7613661614432,1.5,1375.475445534589],[2019.3052651779678,1.5,1347.0045562400246],[2264.380569551577,1.5,1321.736985473143],[2621.038902449388,1.5,1303.2632694976223]],[[2615.521068926143,1.5,1238.5780936003941],[2258.3918670930802,1.5,1261.9895519289669],[2015.9065155623832,1.5,1279.1369316700068],[1543.5687412388943,1.5,1313.0857264496485],[1255.9910752964493,1.5,1347.0259911383498],[-74.73105195415519,1.5,1433.156851131467],[-395.3144573092685,1.5,1450.856342285389],[-1484.7746552134213,1.5,1518.2654466877468]],[[-1486.2521698460682,1.5,1553.8383362668728],[-396.19750801269345,1.5,1482.7486065742262],[-71.92088044886327,1.5,1464.5297925685127],[1256.918068908873,1.5,1380.3764995293263],[1545.485404268628,1.5,1347.0908211842523],[2017.8608712283437,1.5,1312.5458999512684],[2263.3526606706505,1.5,1291.6292619335034],[2618.0900692681894,1.5,1271.7679045071297]],[[2609.2336753049603,1.5,1207.2326715997492],[2258.0447448771533,1.5,1234.200060988093],[2013.2433453232213,1.5,1246.4385924864744],[1537.9497670856265,1.5,1285.6015154261588],[1246.9671405964586,1.5,1319.4097956914059],[-76.34105135541756,1.5,1400.1133691807436],[-403.6761898257357,1.5,1426.2143591380525],[-1488.8439414589297,1.5,1488.4834195052688]],[[-1489.9127119985296,1.5,-1305.0787226341486],[-354.29187759205456,1.5,-1199.4424925727942],[-17.325336635572626,1.5,-1210.9973136817894],[479.38519152284806,1.5,-1253.4931898814023],[712.7186683885026,1.5,-1277.225823638084],[1251.9705359784543,1.5,-1323.1594271542313],[1536.9075733445457,1.5,-1342.4231138533764],[2633.970640303025,1.5,-1441.150769865169]],[[2626.7360744966045,1.5,-1500.0907029322143],[1536.1874247547,1.5,-1393.944739235368],[1249.9934542169772,1.5,-1372.6442832591213],[706.0316536599506,1.5,-1323.3622498761565],[475.75181205384024,1.5,-1304.4244974268722],[-23.831381496092263,1.5,-1258.6965801793433],[-345.81148653711205,1.5,-1246.9140156460867],[-1488.2813502899066,1.5,-1360.6189050427602]],[[-1489.3330840643912,1.5,-1333.3203188878533],[-345.07038603482135,1.5,-1224.0929300365299],[-19.92873696625179,1.5,-1232.701480252149],[481.0928175641447,1.5,-1277.4934279216766],[713.0346817725144,1.5,-1300.2035395183932],[1253.4400925497391,1.5,-1349.6955854297387],[1531.382167354786,1.5,-1367.9632989336503],[2628.8682212127546,1.5,-1472.9252382891727]],[[2628.36687079996,1.5,-1531.557671018591],[1531.4864401770299,1.5,-1420.701301081861],[1240.9120402885014,1.5,-1394.9797637220593],[704.2016429913713,1.5,-1347.7184457859767],[476.2658333877147,1.5,-1322.90344068362],[-26.623918325591035,1.5,-1281.7971567634181],[-345.49130989835896,1.5,-1270.872303562496],[-1485.277362327018,1.5,-1387.7346376410196]],[[-46.1903895919887,1.5,59.136985945807055],[-46.439397828073744,369,58.52252946350882]],[[68.25106554892753,1.5,51.86429774323446],[63.7908538956505,369,57.045329175485975]],[[67.50324038296253,1.5,-56.944390890241394],[67.5025689086097,369,-56.8684607939044]],[[-46.26753928126887,1.5,-62.88156810249967],[-46.26753928126887,369,-62.88156810249967]]],$t=[[-374.6,30,284.2],[-372,30,168.8],[-95.35,30,299.24],[-95.31,30,168.33],[272.61,30,299.17],[276.47,30,168.4],[271.04,30,-58.709],[159.86,30,-56.24],[-134.27,30,30.457],[-247.92,30,-302.57]],Yt=[[-13,169.8,447.2],[668,114.9,481.9]],Kt="二十五楼",Jt=ot,Zt=st,{raycaster:Xt,pointer:qt,update:Qt,style:te}=Jt.useRaycaster(),{initCSS2DRender:ee,createCSS2DDom:ie}=Jt.useCSS2D(),{createDiffusion:oe,updateDiffusion:se}=Jt.useDiffusion(),{createMove:ne,moveAnimate:ae}=Jt.useMoveAnimate(),{createFence:re,fenceAnimate:le}=Jt.useFence(),{keyboardPressed:ce,destroyEvent:he,insertEvent:de}=Jt.useKeyboardState(),{checkCollide:ue}=Jt.useCollide(),{dubleHorizontal:pe,dubleRotate:ge,oddRotate:me}=Jt.useOpenTheDoor(),{createRoam:_e,executeRoam:ve,pause:ye,play:fe,getStatus:Ce}=Jt.useRoam(),{createFleeting:be,fleetingAnimate:Se}=Jt.useFleeting(),{virtualization:Ae,closeVirtualization:Ge}=Jt.useModelLoader({}),Ee="https://ye6.atomgit.net/3d-demo-data",Re="FULL",xe="NPC",Oe=t=>{const e=document.createElement("video");return e.src=""+(t||"/video/sintel.mp4"),e.loop=!0,e},ke=(new _).load(Ee+"/textures/office/cover.jpg"),Le=(new _).load(Ee+"/textures/office/wind.png");class Te extends it{constructor(t,i){super(t),e(this,"buildingGroup"),e(this,"anchorGroup"),e(this,"dotGroup"),e(this,"lightGroup"),e(this,"extend"),e(this,"css2DRender"),e(this,"mouseClickDiffusion"),e(this,"character"),e(this,"characterSightOffset",new v(Ht.x,Ht.y,Ht.z)),e(this,"currentSight"),e(this,"controlCache",{target:new v,cameraPosition:new v,maxDistance:0}),e(this,"animateModels",[]),e(this,"videoModels",[]),e(this,"canvasTextures",[]),e(this,"moveFactor",Bt),e(this,"collisionSpace",Ut),e(this,"fence"),e(this,"ambientLight",new y),e(this,"directionalLight",new f),e(this,"style",-1),e(this,"styleTimes",Vt),e(this,"fleetingGroup"),e(this,"streetLampGroup"),e(this,"residentLightGroup"),this.extend=i,this.css2DRender=ee(this.options,this.container),this.css2DRender.domElement.className="three-scene__dot-wrap",this.mouseClickDiffusion=oe(4,void 0,6),this.mouseClickDiffusion.rotation.x=.5*-Math.PI,this.mouseClickDiffusion.position.y=.5,this.mouseClickDiffusion.visible=!1,this.addObject(this.mouseClickDiffusion),this.createClock(),this.currentSight=Re,this.controlCache.maxDistance=this.options.controls.maxDistance,this.findLight(),this.bindEvent(),this.addBuildingGroup(),this.addAnchorGroup(),this.addDotGroup(),this.addLightGroup(),this.addFleeting(),this.addStreetLamp(),this.addResidentLight(),console.log(this)}setEnv(t){this.scene.environment=t,this.scene.background=t}findLight(){const t=this.scene.getObjectByProperty("isAmbientLight",!0);this.ambientLight=t;const e=this.scene.getObjectByProperty("isDirectionalLight",!0);this.directionalLight=e}toByday(t=1){var e;this.style=t,this.ambientLight.intensity=this.options.ambientLight.intensity,this.directionalLight.intensity=this.options.directionalLight.intensity,this.fleetingGroup&&(this.fleetingGroup.visible=!1),this.streetLampGroup&&(this.streetLampGroup.visible=!1),this.residentLightGroup&&(this.residentLightGroup.visible=!1);const i=null==(e=this.extend.sky)?void 0:e.day;this.loadEnvTexture(i)}toEvening(t=2){var e;this.style=t,this.ambientLight.intensity=.01,this.directionalLight.intensity=.5,this.fleetingGroup&&(this.fleetingGroup.visible=!1),this.streetLampGroup&&(this.streetLampGroup.visible=!1),this.residentLightGroup&&(this.residentLightGroup.visible=!1);const i=null==(e=this.extend.sky)?void 0:e.evening;this.loadEnvTexture(i)}toNight(t=3){var e;this.style=t,this.ambientLight.intensity=.01,this.directionalLight.intensity=0,this.fleetingGroup&&(this.fleetingGroup.visible=!0),this.streetLampGroup&&(this.streetLampGroup.visible=!0),this.residentLightGroup&&(this.residentLightGroup.visible=!0);const i=null==(e=this.extend.sky)?void 0:e.night;this.loadEnvTexture(i)}autoChangeStyle(){const t=this.styleTimes,e=(new Date).getHours(),i=t.findIndex(((i,o)=>o==t.length-1?e>=i[0]||e<i[1]:e>=i[0]&&e<i[1]));this.style!=i+1&&(0==i?this.toByday():1==i?this.toEvening():2==i&&this.toNight())}addBuildingGroup(){const t=new C;t.name="建筑组",this.buildingGroup=t,this.addObject(t)}clearBuilding(){this.buildingGroup&&this.disposeObj(this.buildingGroup),this.animateModels=[],this.addBuildingGroup(),this.clearAnchor(),this.clearDot()}addBuilding(...t){this.buildingGroup&&this.buildingGroup.add(...t)}addAnchorGroup(){const t=new C;t.name="锚点组",this.anchorGroup=t,this.addObject(t)}clearAnchor(){this.anchorGroup&&this.disposeObj(this.anchorGroup),this.addAnchorGroup()}addAnchor(t){this.anchorGroup&&this.anchorGroup.add(t);const{x:e,y:i,z:o}=t.position;Zt.createSpriteAnimate(t,[e,i,o],.2,8)}addDotGroup(){const t=new C;t.name="点位组",this.dotGroup=t,this.scene.add(t)}clearDot(){this.dotGroup&&this.disposeObj(this.dotGroup),this.addDotGroup()}addDot(t,e){var i;const o=t.position,{size:s,color:n}=t.font||{},{x:a=0,y:r=0,z:l=0}=o||{},c=ie({name:`\n        <div class="bg"></div>\n        <span class="inner" style="${null!=s?`font-size: ${"string"==typeof s?s:s+"px"};`:""} ${null!=n?`color: ${n}`:""}"></span>\n      `,className:"dot-2D-label",position:[a,r,l],onClick:e});return c.name=t.name,c.data=t,c._position_={x:a,y:r,z:l},null==(i=this.dotGroup)||i.add(c),c}addLightGroup(){const t=new C;t.name="灯光组",this.lightGroup=t,this.addObject(t)}clearLightGroup(){this.lightGroup&&this.disposeObj(this.lightGroup),this.addLightGroup()}closeLightGroup(t=!1){var e;null==(e=this.lightGroup)||e.children.forEach((e=>{(e.isSpotLight||e.isRectAreaLight)&&(e.visible=t)}))}addLight(t,e,i){if(this.lightGroup){e.name=t.name;const o=t.position||{x:0,y:0,z:0},{to:s={x:o.x,y:o.y-2,z:o.z}}=t;if(e.isRectAreaLight||(e.target.position.set(s.x,s.y,s.z),this.lightGroup.add(e.target)),e.visible=!0,this.lightGroup.add(e),i)if(e.isRectAreaLight){const t=new b(e);this.lightGroup.add(t)}else{const t=new S(e,e.color);this.lightGroup.add(t)}}}addFleeting(){const t=new C,e=Wt;for(let i=0;i<e.length;i++){const o=e[i],s=be({points:o,color:"#"+(Math.random()+"000000").substring(2,8),intensity:10,tubularSegments:1e3,radius:.6,repeat:{x:2,y:4}});t.add(s)}t.name="流光组",this.fleetingGroup=t,this.addObject(t)}toggleFleeting(t){this.fleetingGroup&&(this.fleetingGroup.visible=t??!this.fleetingGroup.visible)}addStreetLamp(){const t=new C,e=$t,i=new A(16777215,10,100,.6*Math.PI,.6,.4);for(let o=0;o<e.length;o++){const s=i.clone(),[n,a,r]=e[o];s.position.set(n,a,r),s.target.position.set(n,a-1,r),s.add(i.target),t.add(s);const l=new S(s);l.visible=!1,t.add(l)}t.name="路灯组",t.visible=!1,this.addObject(t),this.streetLampGroup=t}addResidentLight(){const t=new C,e=Yt,i=new G(16777215,10,100,.4);for(let o=0;o<e.length;o++){const s=i.clone(),[n,a,r]=e[o];s.position.set(n,a,r),t.add(s)}t.name="居民灯",t.visible=!1,this.addObject(t),this.residentLightGroup=t}drawCanvas(t=""){if(!this.extend.canvas)return;const e=this.extend.canvas,i=e.offsetWidth,o=e.offsetHeight;e.width=i,e.height=o;const s=e.getContext("2d");if(!s)return;s.clearRect(0,0,i,o),s.fillStyle="#f00";const n=t.length,a=n>12?Math.ceil(n/2):12;let r=[],l=0;for(;l<n;){const e=l+a;r.push(t.substring(l,e)),l=e}s.font="100 40px 微软雅黑",s.textAlign="center",s.textBaseline="middle";const c=r.length;r.forEach(((t,e)=>{const n=e*c+1;s.fillText(t,i/2,o/c/2*n)})),this.canvasTextures.length&&this.canvasTextures.forEach((t=>{t.needsUpdate=!0}))}addCharacter(t,e){const{x:i,y:o,z:s}=e;t.position.set(i,o,s),this.character=t;const n=t.animations,a=new E(t),r={};for(let h=0;h<n.length;h++){const t=n[h],e=a.clipAction(t);r[t.name]=e}r[zt].play();const l=r[Ft];t.extra={mixer:a,actions:r,runging:l},this.addObject(t);const c=["W","S"].map((t=>t.toUpperCase().charCodeAt(0)));de((e=>{t.__runing__||(c.includes(e.keyCode)&&l.play(),this.isCharacterSight()&&(ce("X")&&this.characterAccelerate(1),ce("Z")&&this.characterAccelerate(-1)))}),(e=>{t.__runing__||c.includes(e.keyCode)&&l.stop()}))}toggleSight(t){if(this.judgeCruise())return;this.judgeAndStopRoam();const e=this.currentSight==Re?xe:Re;this.currentSight=e;const i=e===xe;if(!this.controls)return;let{target:o,to:s,maxDistance:n}=this.getControlsCache();if(!this.character)return;const a=this.character.position;this.toggleCharacterView();const r=this.characterSightOffset.clone();if(i){d.success({message:"鼠标点击地面移动，或键盘 W、S 前后移动，A、D调整左右方向，X 加速，Z 减速!",grouping:!0}),this.setControlCache();const t=a.clone().add(r);this.camera.lookAt(t),Math.abs(this.camera.position.y-t.y)>8&&(this.camera.position.setY(t.y),this.camera.position.setZ(t.z))}else this.camera.position.copy(s),this.camera.lookAt(this.controls.target);this.controls.maxDistance=i?3==t?10:0:n,this.controls.screenSpacePanning=!i,this.controls.enablePan=!i;const l=i?a.clone().add(r):o;this.controls.target.copy(l)}isCharacterSight(){return this.currentSight==xe}clearCharacterSight(){this.currentSight=Re,this.toggleCharacterView()}toggleCharacterView(){var t;const e=null==(t=this.container.parentNode)?void 0:t.querySelector(".character-sight");if(!e)return;const i=this.currentSight===xe;e.style.display=i?"block":"none"}characterAccelerate(t=1){this.moveFactor+=t,this.moveFactor>=10?this.moveFactor=10:this.moveFactor<=1&&(this.moveFactor=1),d.success({message:"人物速度："+this.moveFactor,grouping:!0})}setControlTarget(t){this.controls&&(this.controls.target.copy(t.clone().add(this.characterSightOffset.clone())),this.camera.lookAt(this.controls.target))}waitLift(t,e){var i;const o=t.data.target,s=this.scene.getObjectByName(o);s||d.error({message:`【${o}】模块未找到！`,grouping:!0}),console.log(s,o);const n=null==(i=t.data)?void 0:i.to;if(!s||!n)return;const a=s.position;if(Math.abs(n.y-a.y)>.2){const i=s.__bind_lift__;void 0!==i&&this.dubleHorizontalDoor({data:{bind:i}},2.3,!1),this.dubleHorizontalDoor({data:{bind:o}},2.3,!1).then((()=>{const i=5e3;d.success({message:`${o}移动中，请稍候，5秒后到达!`,duration:i});const r=this.character;new R(a).to({y:n.y},i).delay(0).start().onUpdate((t=>{if(e){if(!this.character)return;this.character.position.setY(t.y);const e=new v;null==r||r.getWorldDirection(e);const i=e.clone().multiplyScalar(.1),o=(null==r?void 0:r.position.clone().add(i))||new v;this.camera.position.y=t.y+this.characterSightOffset.y,this.setControlTarget(o)}})).onComplete((()=>{console.log("电梯到了！",s),s.__bind_lift__=t.data.bind,this.openLift(t,o)}))}))}else this.openLift(t,o)}openLift(t,e){this.dubleHorizontalDoor(t,2.3),this.dubleHorizontalDoor({data:{bind:e}},2.3)}lightSwitch(t,e,i){var o,s;const n=null==(s=this.lightGroup)?void 0:s.getObjectsByProperty("name",null==(o=t.data)?void 0:o.bind);n&&(console.log("控制灯数量:",null!=i&&i>=0?i:"全部"),n.forEach(((t,o)=>{let s=!(null!=i&&i>=0)&&(null!=e?e:!t.visible);null!=i&&i>=0&&o<i&&(s=null==e||e),t.visible=s})))}dubleHorizontalDoor(t,e=400,i){const{bind:o,axle:s="z"}=t.data;return pe(this.scene,{value:o,axle:s,scale:e,isOpen:i})}oddRotateDoor(t){const{bind:e,axle:i="y",internal:o,autoClose:s=!1}=t.data;return me(this.scene,{value:e,axle:i,angle:Math.PI*(o?-.5:.5),autoClose:s})}dubleRotateDoor(t){const{bind:e,axle:i="y",left:o="右",right:s="左",internal:n,autoClose:a=!0}=t.data;return ge(this.scene,{value:e,axle:i,autoClose:a,angle:Math.PI*(n?-.5:.5),leftMatch:o,rightMatch:s})}openGate(t){return this.dubleRotateDoor(t)}toggleCurtain(t,e){const i=this.animateModels.find((e=>{var i;return e.name===(null==(i=t.data)?void 0:i.bind)}));if(console.log(i),!i)return;i.__close__=e??!i.__close__;const{__action__:o,__mixer__:s}=i;return Object.keys(o).forEach((t=>{i.__close__&&(o[t].loop=x,o[t].clampWhenFinished=!0,o[t].play())})),i.__close__||s.stopAllAction(),i.__close__}addVideoMaterial(t){var e,i;const o=new O({map:ke});this.videoModels=[];for(let s=0;s<t.length;s++){const n=t[s],a=null==(e=this.buildingGroup)?void 0:e.getObjectByName(n);if(!a)continue;const r=null==(i=this.lightGroup)?void 0:i.getObjectByName(n+"-照明灯");r&&(r.visible=!0);const l=Oe(),c=new k(l);a.__video_texture__=c,a.__cover_texture__=ke.clone(),a.material=o.clone(),a.__video__=l,this.videoModels.push(a)}}addCanvasMaterial(t){var e;if(!this.extend.canvas)return;const i=new O({map:new L(this.extend.canvas),side:T});this.canvasTextures=[];for(let o=0;o<t.length;o++){const s=this.scene.getObjectByName(t[o]);s&&(s.material=i.clone(),s.__cover_texture__=null==(e=i.map)?void 0:e.clone(),this.canvasTextures.push(s.material.map))}}clearVideo(){const t=this.videoModels;for(let e=0;e<t.length;e++){const i=t[e],{__video__:o,__cover_texture__:s,__video_texture__:n}=i;o&&(o.pause(),o.remove(),null==s||s.dispose(),null==n||n.dispose())}}videoPlay(t){const e=this.scene.getObjectByName(t.data.bind);if(e&&e.__video__){const t=e.__video__;t.paused?(e.material.map=e.__video_texture__,null==t||t.play()):(null==t||t.pause(),e.material.map=e.__cover_texture__)}}addAirWindMaterial(t){var e;Le.wrapS=w,Le.repeat.x=1;const i=new O({color:13033215,map:Le,transparent:!0,side:T,emissive:7780095,emissiveIntensity:1});for(let o=0;o<t.length;o++){const s=null==(e=this.buildingGroup)?void 0:e.getObjectByName(t[o]);if(!s)return;s.traverse((t=>{t.isMesh&&(t.material=i)})),s.visible=!1}}toggleAir(t,e){var i;const o=null==(i=this.buildingGroup)?void 0:i.getObjectByName(t.data.bind);if(!o)return console.log(o,this.buildingGroup);o.__open__=e??!o.__open__,o.visible=o.__open__}mouseClickGround(t,e){if(this.currentSight!==xe)return Promise.reject();const i=this.character;if(!i)return Promise.reject();const{runing:o}=this.options.cruise;if(o)return Promise.reject();const s=t.point,n=this.mouseClickDiffusion,{runging:a}=i.extra;return a.play(),n.position.copy(s),n.visible=!0,i.__runing__=!0,new Promise((o=>{ne(i,s,((o,s)=>{this.setControlTarget(o),this.checkCharacterCollide(o,e.includes(t.object.name)?2:.3)&&(s(),a.stop(),i.__runing__=!1,n.visible=!1)}),(t=>{this.setControlTarget(t),a.stop(),i.__runing__=!1,n.visible=!1,o(i)}))}))}checkCharacterCollide(t,e=.3){var i;if(!this.character)return;const o=ue(this.character,t,(null==(i=this.buildingGroup)?void 0:i.children)||[],!0,new v(0,e,0));if(o.length){if(o[0].distance<this.collisionSpace)return d.warning({message:"撞到了！",grouping:!0}),!0}}cameraLookatMoveTo(t){this.controls&&Zt.cameraLookatAnimate(this.camera,t,this.controls.target)}toggleCruise(t){this.clearCharacterSight(),this.judgeAndStopRoam(),super.toggleCruise(t)}judgeCruise(){return!!this.options.cruise.runing&&(d.warning({message:"请退出巡航！",grouping:!0}),!0)}addModelAnimate(t,e=[],i=!0,o=1){if(!e.length)return;const s=new E(t),n=e.reduce(((t,e)=>{const n=e.name||"";return t[n]=s.clipAction(e),i&&t[n].play(),t[n].timeScale=o,t}),{});t.__action__=n,t.__mixer__=s,this.animateModels.push(t)}cameraTransition(t){var e;if(this.judgeCruise())return;if(this.mouseClickDiffusion.visible)return void d.warning({message:"人物移动中，不可操作！",grouping:!0});this.clearCharacterSight();const{to:i,target:o=t.position}=t.data;if(!i)return;!this.isCameraMove(i)&&this.controls&&(this.judgeAndStopRoam(),this.controls.enablePan=!0,this.controls.maxDistance=5,Zt.cameraLinkageControlsAnimate(this.controls,this.camera,i,o));const{bind:s}=t.data;if(!s)return;const n=null==(e=this.buildingGroup)?void 0:e.getObjectByName(s);this.addFence(n)}toggleBridCompany(){var t,e;if(this.judgeCruise())return;this.clearCharacterSight(),this.judgeAndStopRoam();const i=Kt,o=null==(t=this.buildingGroup)?void 0:t.getObjectByName(i);if(console.log(o),o){if(o.__isFocus__=!o.__isFocus__,!o.__isFocus__)return this.closeVirtualization(),void this.toggleCompanyFocus(!1);this.toggleCompanyFocus(!0),Ae((null==(e=this.buildingGroup)?void 0:e.children)||[],o,{wireframe:!0,hidden:!0,opacity:.1,filter:["电梯-1"]})}else d.warning({message:`未找到【${i}】模块！`,grouping:!0})}closeVirtualization(){var t,e;const i=Kt;(null==(t=this.buildingGroup)?void 0:t.getObjectByName(i)).__isFocus__=!1,Ge(null==(e=this.buildingGroup)?void 0:e.children,{filter:["_空调风_grp"]})}toggleCompanyFocus(t){if(!this.controls)return;let{target:e,to:i,maxDistance:o}=this.getControlsCache();t&&(this.setControlCache(),e=new v(8.5,185,0),i=new v(8.5,290,135),o=320),this.controls.maxDistance=o,Zt.cameraLinkageControlsAnimate(this.controls,this.camera,i,e)}addFence(t){if(this.fence&&(this.disposeObj(this.fence),this.fence=void 0),t){const e=re(t,5439406);this.fence=e,this.addObject(e)}}controlReset(){if(this.judgeAndStopRoam(),this.clearCharacterSight(),this.closeVirtualization(),!this.controls)return;const t=this.options.controls;Object.keys(t).forEach((e=>{this.controls&&(this.controls[e]=t[e])})),super.controlReset()}setControlCache(){if(!this.controls)return;const t=this.controlCache;t.target=t.target.copy(this.controls.target),t.cameraPosition=t.cameraPosition.copy(this.camera.position),t.maxDistance=this.controls.maxDistance}getControlsCache(){const t=this.controlCache;return{target:t.target,to:t.cameraPosition,maxDistance:t.maxDistance}}judgeAndStopRoam(){return!!Ce()&&(this.controls&&(this.controls.maxDistance=this.options.controls.maxDistance),ye(),!0)}setRoamPoint(t){this.extend.roamPoints=t}toggleRoam(){if(this.clearCharacterSight(),this.judgeAndStopRoam())return;const t=this.extend.roamPoints||[];0!=t.length&&this.controls&&(this.controls.maxDistance=5,_e({points:t,segment:6,tension:0,speed:2,close:!1,factor:1}),fe())}modelAnimate(){var t,e,i,o;this.css2DRender.render(this.scene,this.camera),"function"==typeof this.extend.animateCall&&this.extend.animateCall(),this.restoreAnchorMaterial();let s=null==(t=this.clock)?void 0:t.getDelta();if(this.animateModels.length&&this.animateModels.forEach((t=>{t.__mixer__&&t.__mixer__.update(s)})),null==(e=this.anchorGroup)||e.children.forEach((t=>{t.__mixer__&&t.__mixer__.update(s)})),this.character){this.character.extra.mixer.update(s),ae(.2*this.moveFactor)}if(this.mouseClickDiffusion.visible&&se(),le(),this.isCharacterSight()&&!(null==(i=this.character)?void 0:i.__runing__)){const t=1+this.moveFactor/5,e=5*s*t,i=.2*Math.PI*s*t,o=this.character;if(!o)return;const n=ce("S");if(ce("W")||n){const t=new v;null==o||o.getWorldDirection(t);const i=t.clone().multiplyScalar(n?-e:e),s=(null==o?void 0:o.position.clone().add(i))||new v;if(this.checkCharacterCollide(s));else{if(null==o||o.position.copy(s),n){const i=t.clone().multiplyScalar(2*-e);this.camera.position.copy(this.camera.position.clone().add(i))}this.setControlTarget(null==o?void 0:o.position)}}ce("A")?(o.rotation.y+=i,this.keyboardToTotation()):ce("D")&&(o.rotation.y-=i,this.keyboardToTotation())}ve(this.camera,this.controls),Le&&(Le.offset.x+=.02),this.autoChangeStyle(),(null==(o=this.fleetingGroup)?void 0:o.visible)&&Se()}keyboardToTotation(){var t;const e=this.character,i=new v;null==e||e.getWorldDirection(i);const o=(null==(t=this.controls)?void 0:t.maxDistance)||1,s=i.clone().multiplyScalar(-o),n=(null==e?void 0:e.position.clone().setY(this.camera.position.y).add(s))||new v;this.camera.position.copy(n),this.setControlTarget(null==e?void 0:e.position)}onPointerMove(t){this.checkIntersectObjects(t)}onPointerUp(t){var e;super.onPointerUp(t);const i=t.timeStamp-this.pointer.tsp<jt;2==t.button?i&&"function"==typeof(null==(e=this.extend)?void 0:e.onClickRight)&&this.extend.onClickRight(t):0==t.button?i&&this.checkIntersectObjects(t):t.button}checkIntersectObjects(t){var e,i,o,s,n;const a=this.container,r=this.options.scale;Qt(t,a,r);let l="pointerdown"==t.type||"pointerup"==t.type;const c=(null==(i=this.buildingGroup)?void 0:i.children.filter((t=>l&&t.visible)).map((t=>(t.children=t.children.filter((t=>t.visible)),t))).concat((null==(e=this.anchorGroup)?void 0:e.children)||[]))||[];Xt.setFromCamera(qt,this.camera);let h=Xt.intersectObjects(c,l);if(l)if(a.style.cursor="auto",h.length){const t=h[0],e=t.object;console.log(t);const{x:i,z:n}=t.point;Z(`[ ${i}, 1.5, ${n} ],\n        `);const a="string"==typeof e.name&&(this.extend.groundMeshName||[]).some((t=>e.name.indexOf(t)>-1)),r=this.findParentGroup(e);if(a&&"function"==typeof(null==(o=this.extend)?void 0:o.onClickGround)&&this.extend.onClickGround(r,t),!r)return;"function"==typeof(null==(s=this.extend)?void 0:s.onClickLeft)&&this.extend.onClickLeft(r,t)}else"function"==typeof(null==(n=this.extend)?void 0:n.onClickLeft)&&this.extend.onClickLeft();else this.hoverAnchor(h)}hoverAnchor(t){var e,i;if("function"==typeof this.extend.onHoverAnchor&&this.extend.onHoverAnchor(t[0],te),t.length){const i=t[0].object;if(this.container.style.cursor=i._isAnchor_?"pointer":"auto",!i._isAnchor_)return;const o=i.material;void 0===i.__mat_color__&&(i.__mat_color__=o.color),o.color=new M(16715760),null==(e=this.anchorGroup)||e.children.forEach((t=>{t.__change_color__=t.uuid===i.uuid}))}else this.container.style.cursor="auto",null==(i=this.anchorGroup)||i.children.forEach((t=>{t.__change_color__=!1}))}restoreAnchorMaterial(){var t;null==(t=this.anchorGroup)||t.traverse((t=>{t.isSprite&&!t.__change_color__&&t.__mat_color__&&(t.material.color=t.__mat_color__)}))}findParentGroup(t){const e=t=>{if(t._isBuilding_)return t;let i=t.parent;return i?i&&i._isBuilding_?i:e(i):void 0};return e(t)}getAll(){var t,e;return(null==(e=this.buildingGroup)?void 0:e.children.concat((null==(t=this.dotGroup)?void 0:t.children)||[]))||[]}resize(){super.resize();const{width:t,height:e}=this.options;this.css2DRender.setSize(t,e)}dispose(){he(),this.animateModels=[],this.clearVideo(),this.videoModels=[],this.canvasTextures=[],this.disposeObj(this.buildingGroup),this.disposeObj(this.character),this.disposeObj(this.dotGroup),this.disposeObj(this.anchorGroup),this.disposeObj(this.fence),this.disposeObj(this.lightGroup),this.disposeObj(this.mouseClickDiffusion),this.disposeObj(this.fleetingGroup),this.disposeObj(this.streetLampGroup),this.disposeObj(this.residentLightGroup),this.clock=void 0,this.css2DRender=void 0,this.buildingGroup=void 0,this.character=void 0,this.dotGroup=void 0,this.anchorGroup=void 0,this.lightGroup=void 0,this.fence=void 0,this.mouseClickDiffusion=void 0,this.fleetingGroup=void 0,this.streetLampGroup=void 0,this.residentLightGroup=void 0,this.extend={},super.dispose()}}const we=(t,e)=>{const i=40*Math.random();return void 0!==i&&(t.value=i),t.show=Math.random()>.5,t.value=Number(Number(t.value||0).toFixed(2)),{value:t.value,show:t.show,font:{...t.font||{},color:"#"+(16777215+1e6*i).toString(16).substring(0,6)}}},Me={class:"scene-operation"},De=["onClick"],Ie=["innerHTML"],Pe="welcom.key",Ne=J(i({__name:"index",setup(t){const e=st,i=ot,o=D((s=(t,e,i,o)=>{if(!w)return;(o+=.02)>1&&(o-=1),t=((t,e=0)=>new v(t.x,t.y+e,t.z))(i.getPointAt(o));let s=o+.001;s>1&&(s-=1),e=i.getPointAt(s),w.position.set(t.x,.1,t.z);const n=Math.atan2(-e.z+t.z,e.x-t.x);w.rotation.z=.5*Math.PI+n},{devEnv:!0,baseUrl:_t,bgSrc:_t+"/imgs/office/bg.jpg",env:"/textures/hdr/101.hdr",sky:{day:"/textures/hdr/101.hdr",evening:"/textures/hdr/201.hdr",night:"/textures/hdr/301.hdr"},config:{},dotKey:"DOT",dotShowStrict:!1,anchorType:[vt,yt,Gt,Et,Rt,xt,Ot,wt,Mt,kt,Tt,Lt,Dt,It],animationModelType:[ft,Ct,bt],models:[{key:ft,name:"场景",size:13.6,url:"/公司总部.glb"},{key:"floor_low",name:"低层",size:6.1,url:"/低层.glb"},{key:bt,name:"窗帘",size:.2,url:"/窗帘.glb"},{key:"floor_heigh",name:"高层",size:2.7,url:"/高层.glb"},{key:Ct,name:"公司",size:14.5,url:"/二十五楼.glb"},{key:vt,name:"定位",type:"sprite",range:{x:4,y:4},mapUrl:"/pos.png"},{key:yt,name:"锚点",type:"sprite",mapUrl:"/dw.png"},{key:Gt,name:"电梯门",type:"sprite",mapUrl:"/lift.png"},{key:kt,name:"双横推开关门",type:"sprite",mapUrl:"/lift.png",range:{x:.3,y:.3}},{key:Lt,name:"双旋转开关门",type:"sprite",mapUrl:"/lift.png",range:{x:.3,y:.3}},{key:Tt,name:"单旋转开关门",type:"sprite",mapUrl:"/lift.png",range:{x:.3,y:.3}},{key:Ot,name:"闸机",type:"sprite",mapUrl:"/gate.png"},{key:wt,name:"视频",type:"sprite",mapUrl:"/video.png"},{key:Mt,name:"编辑",type:"sprite",mapUrl:"/edit.png"},{key:Dt,name:"窗帘",type:"sprite",mapUrl:"/curtain.png"},{key:St,name:"机器人",size:.3,url:"/models/common/机器人.glb"},{key:At,name:"人物",size:1.8,url:"/models/common/人物.glb"},{key:"spot_light_floor_1",type:"spotlight",name:"主机聚光灯",intensity:8,color:16777197,distance:20},{key:"spot_light_floor_2",type:"spotlight",name:"会议室聚光灯",intensity:2,color:16777197,castShadow:!1,distance:10},{key:"spot_light_floor_3",type:"spotlight",name:"屏幕聚光灯",intensity:1,color:16777197,distance:15,penumbra:.5,castShadow:!1,angle:.36*Math.PI},{key:"spot_light_floor_4",type:"spotlight",name:"屏幕聚光灯",intensity:2,color:16777197,distance:12,penumbra:.5,castShadow:!1,angle:.4*Math.PI},{key:"spot_light_floor_5",type:"spotlight",name:"屏幕聚光灯",intensity:2,color:16777197,distance:8,penumbra:.5,castShadow:!1,angle:.23*Math.PI},{key:"rect_area_light_1",type:"planelight",name:"面光灯",intensity:1.2,color:16777215,width:134,height:134},{key:"rect_area_light_2",type:"planelight",name:"面光灯",intensity:.8,color:16777215,width:134,height:134},{key:Et,name:"开关灯",type:"sprite",mapUrl:"/light.png"},{key:Rt,name:"开关灯",type:"sprite",mapUrl:"/light.png"},{key:xt,name:"空调",type:"sprite",mapUrl:"/air.png"},{key:It,name:"模式",type:"sprite",mapUrl:"/mode.png"}].map((t=>(t.url&&t.url.indexOf("models")<0&&(t.url="/models/office"+t.url),t.mapUrl&&t.mapUrl.indexOf("models")<0&&(t.mapUrl="/textures/office"+t.mapUrl),t.range||(t.range={x:.5,y:.5}),t))),cruise:{visible:!0,auto:!0,mapUrl:_t+"/textures/cruise/line18.png",repeat:[1,1],width:2,segment:100,tension:.01,speed:10,mapSpeed:.1,points:[],close:!0,offset:5.2,animateBack:s},roamPoints:[]}));var s;const d=D({active:2,show:!1,targetName:"",list:[{target:"电梯-2",items:[{name:"一楼",key:1,y:.1,bind:"_一楼电梯门-2_grp"},{name:"公司",key:2,y:184.7,bind:"_电梯外门_2_grp"}]},{target:"电梯-1",items:[{name:"一楼",key:1,y:.1,bind:"_一楼电梯门-1_grp"},{name:"公司",key:2,y:184.7,bind:"_电梯外门_1_grp"}]}]}),u=D({show:!1,style:{left:0,top:0},msg:""}),{progress:_,loadModels:y,getModel:f}=i.useModelLoader({baseUrl:o.baseUrl,indexDB:{cache:!0,dbName:"THREE__OFFICE__DB",tbName:"TB",version:78}}),C=I(),b=I(),S={baseUrl:o.baseUrl,cruise:o.cruise,controls:{visible:!0,enableDamping:!0,dampingFactor:.25,maxPolarAngle:.48*Math.PI,screenSpacePanning:!1,maxDistance:1500},render:{alpha:!0,preserveDrawingBuffer:!0},camera:{near:1.8,fov:52,position:[-799.2,55,376.3]},directionalLight:{intensity:4,light2:!1},ambientLight:{intensity:.01},axes:{visible:!0,size:1e3}};let A;const G=P((()=>{var t;return(null==(t=d.list.find((t=>t.target===d.targetName)))?void 0:t.items)||[]})),{options:E}=at({title:"编辑欢迎词",content:Q(Pe)||"中碳能源",errMessage:"请输入欢迎词！"}),R=t=>{var e;const i=t.data;{const t=we(i,A.buildingGroup);"object"==typeof t&&Object.keys(t).forEach((e=>{i[e]=t[e]}))}t.visible=i.show||!o.dotShowStrict;const s=null==(e=t.element)?void 0:e.getElementsByClassName("inner")[0];if(s){const{size:t,color:e}=i.font||{};null!=t&&(s.style.fontSize="string"==typeof t?t:t+"px"),null!=e&&(s.style.color=e),s.textContent=`${i.value||0}${i.unit}`}},x=async t=>{if(!t)return;const{type:i}=t;if(i===vt)return;const s=f(i);if(!s)return void(i===o.dotKey&&(t=>{R(A.addDot(t,(e=>{A.cameraLookatMoveTo(t.position)})))})(t));const{anchorType:n=[],animationModelType:a=[]}=o;let r=e.modelDeepClone(s);const{position:l,scale:c,rotation:h}=e.get_P_S_R_param(r,t),[d,u,p]=l;return r.scale.set(...c),r.position.set(d,u,p),r.rotation.set(...h),r._isBuilding_=!0,r.data=t,a.includes(i)&&A.addModelAnimate(r,s.animations,i!==bt,1),n.includes(i)?(r._isAnchor_=!0,A.addAnchor(r)):r.isSpotLight||r.isRectAreaLight?A.addLight(t,r,!1):A.addBuilding(r),Promise.resolve()},O=()=>new Promise((async t=>{A.clearBuilding(),await Y(),await(()=>{let t=0,e=k.value.length;return new Promise((i=>{if(0==e)return i(null);const o=async()=>{const s=k.value[t];await x(s),t++,t<e?o():i(t)};o()}))})(),A.setRoamPoint(o.roamPoints),A.setCruisePoint(o.cruise.points);const e=A.getValidTargetPosition(o.config||{});A.camera.position.set(e.x,e.y,e.z),A.controlSave(),_.percentage=100,_.show=!1,Y((()=>{Nt.emit("LIGHT:CLOSE"),t(1)}))})),k=I([]),L=P((()=>k.value.filter((t=>t.type===vt)))),T=()=>{y(o.models,(()=>{X.get(q.d3.office).then((t=>X.get(q.d3.office_mode).then((e=>(e.forEach(((e,i)=>{t.JsonList.push({...e,type:It,position:{x:19-.6*i,y:186.8,z:49}})})),t))))).then((t=>{let e={};if(t.ConfigJson instanceof Object)e=t.ConfigJson;else if("string"==typeof t.ConfigJson)try{e=JSON.parse(t.ConfigJson)}catch(i){}k.value=t.JsonList,Object.keys(e).forEach((t=>{o.config&&(o.config[t]=e[t])})),o.cruise.points=e.cruise||[],o.roamPoints=e.roamPoints||[],setTimeout((()=>{(async t=>{await O(),M(),K(),Nt.emit("SCREEN:WELCOM",E.content),A.addVideoMaterial(t.JsonList.filter((t=>t.type===wt)).map((t=>t.bind))),A.addCanvasMaterial(t.JsonList.filter((t=>t.type===Mt)).map((t=>t.bind))),A.addAirWindMaterial(t.JsonList.filter((t=>t.type===xt)).map((t=>t.bind)))})(t)}),100)}))}))};let w;const M=()=>{w=f(St),w.position.z=.1,w.rotation.z=.5*Math.PI,A.addObject(w)},K=()=>{const t=f(At);t.traverse((t=>{t.isMesh&&(t.castShadow=!0)}));t.rotateY(1*Math.PI),t.scale.setScalar(2),A.addCharacter(t,{x:14.4,y:184.6,z:37.6})},J=()=>{T(),(t=>{Nt.on("CAMERA:ROAM",(()=>null==t?void 0:t.toggleRoam())),Nt.on("CAMERA:CRUISE",(()=>null==t?void 0:t.toggleCruise())),Nt.on("CAMERA:RESET",(()=>null==t?void 0:t.controlReset())),Nt.on("CAMERA:FIRST",(()=>null==t?void 0:t.toggleSight(1))),Nt.on("CAMERA:THREE",(()=>null==t?void 0:t.toggleSight(3))),Nt.on("CAMERA:GATE",(()=>{null==t||t.cameraTransition({data:{name:"一楼大门",type:"ANCHOR_POS",to:{x:-1.3,y:6.2,z:102.3},target:{x:-1.4,y:5.8,z:97.4}}})})),Nt.on("CAMERA:RECCEPTION",(()=>{null==t||t.cameraTransition({data:{name:"公司前台",type:"ANCHOR_POS",to:{x:15.3,y:188,z:33.2},target:{x:15.3,y:188,z:36.3}}})})),Nt.on("CAMERA:OFFICE",(()=>{null==t||t.cameraTransition({data:{name:"办公区域",type:"ANCHOR_POS",to:{x:-38,y:188,z:35.3},target:{x:-35.4,y:188,z:36.4}}})})),Nt.on("CAMERA:LCR",(()=>{null==t||t.cameraTransition({data:{name:"大会议室",type:"ANCHOR_POS",to:{x:-28.8,y:188,z:52.7},target:{x:-33.7,y:188,z:53.4}}})})),Nt.on("CAMERA:BOSS",(()=>{null==t||t.cameraTransition({data:{name:"领导办公",type:"ANCHOR_POS",to:{x:69.4,y:188,z:-.4},target:{x:65,y:188,z:-2.7}}})})),Nt.on("PERSON:ADD",(()=>null==t?void 0:t.characterAccelerate())),Nt.on("PERSON:SUB",(()=>null==t?void 0:t.characterAccelerate(-1))),Nt.on("LIGHT:RECCEPTION",((e,i)=>{null==t||t.lightSwitch({data:{bind:"前台聚光灯"}},e,i)})),Nt.on("LIGHT:AILSE",((e,i)=>{null==t||t.lightSwitch({data:{bind:"区域A"}},e,i)})),Nt.on("LIGHT:PM",((e,i)=>{null==t||t.lightSwitch({data:{bind:"区域B"}},e,i)})),Nt.on("LIGHT:HOST",((e,i)=>{null==t||t.lightSwitch({data:{bind:"主机照明灯"}},e,i)})),Nt.on("LIGHT:LCR",((e,i)=>{null==t||t.lightSwitch({data:{bind:"大会议室照明灯"}},e,i)})),Nt.on("LIGHT:CLG",(e=>{null==t||t.lightSwitch({data:{bind:"公司主灯光组"}},e)})),Nt.on("LIGHT:FIRSTFLOOR",(e=>{null==t||t.lightSwitch({data:{bind:"一楼灯光组"}},e)})),Nt.on("LIGHT:CLOSE",(e=>null==t?void 0:t.closeLightGroup(e))),Nt.on("LIGHT:AUTO",((e,i,o)=>null==t?void 0:t.lightSwitch(e,i,o))),Nt.on("CURTAIN:TOGGLE",(e=>{const i=null==t?void 0:t.toggleCurtain({data:{bind:"_GROUP_013_grp"}},e);console.log("窗帘关闭状态",i)})),Nt.on("DOOR:COMPANY",(()=>{null==t||t.dubleHorizontalDoor({data:{bind:"_公司大门_grp",axle:"x"}},5.4)})),Nt.on("DOOR:LCR",(()=>{null==t||t.dubleRotateDoor({data:{bind:"_大会议室-门_grp",axle:"y"}})})),Nt.on("DOOR:BOSS",(()=>{null==t||t.dubleRotateDoor({data:{bind:"_老板办公室-门_grp",autoClose:0}})})),Nt.on("SCREEN:COMPANY",(()=>{null==t||t.videoPlay({data:{bind:"公司大屏"}})})),Nt.on("SCREEN:WELCOM",(e=>null==t?void 0:t.drawCanvas(e))),Nt.on("SCREEN:SCR",(()=>{null==t||t.videoPlay({data:{bind:"小会议室大屏"}})})),Nt.on("SCREEN:LCR",(()=>{null==t||t.videoPlay({data:{bind:"大会议电视屏幕"}})})),Nt.on("AIR:MAIN",(e=>{null==t||t.toggleAir({data:{bind:"_空调风_grp"}},e)})),Nt.on("AIR:ODD",((e,i)=>{null==t||t.toggleAir(e,i)})),Nt.on("SCENE:POS",(()=>null==t?void 0:t.getPosition())),Nt.on("SKY:DAY",(()=>null==t?void 0:t.toByday(t.style))),Nt.on("SKY:EVENING",(()=>null==t?void 0:t.toEvening(t.style))),Nt.on("SKY:NIGHT",(()=>null==t?void 0:t.toNight(t.style))),Nt.on("EFFECT:FLEETING",(e=>null==t?void 0:t.toggleFleeting(e))),Nt.on("BIRD:COMPANY",(()=>null==t?void 0:t.toggleBridCompany()))})(A)},Z=t=>{E.content=t,tt(Pe,E.content||""),Nt.emit("SCREEN:WELCOM",E.content)},it=t=>{const e=t.data;switch(null==e?void 0:e.type){case vt:A.cameraTransition(t);break;case Gt:d.targetName=t.data.target,A.waitLift(t);break;case Et:Nt.emit("LIGHT:AUTO",t);break;case Rt:t.__close__=!t.__close__,Nt.emit("LIGHT:CLOSE",!t.__close__);break;case Ot:A.openGate(t);break;case kt:A.dubleHorizontalDoor(t,5.4);break;case Tt:A.oddRotateDoor(t);break;case Lt:A.dubleRotateDoor(t);break;case Dt:Nt.emit("CURTAIN:TOGGLE");break;case wt:A.videoPlay(t);break;case Mt:E.show=!0;break;case xt:Nt.emit("AIR:ODD",t);break;case It:console.log(W(t.data))}};return N((()=>{S.container=C.value;const t=["电梯地板002","电梯地板"];A=new Te(S,{canvas:b.value,groundMeshName:["地面002","立方体306","平面118","立方体475","立方体514","立方体552","地面020","地面","平面391","立方体474","立方体1617","ground",...t],roamPoints:o.roamPoints,sky:o.sky,onClickLeft:(t,e)=>{t&&t.data&&it(t)},onClickGround:(e,i)=>{A.mouseClickGround(i,t).then((e=>{d.show=t.includes(i.object.name)})).catch((()=>{}))},onHoverAnchor:(t,e)=>{const i=!!t&&t.object._isAnchor_;if(u.show=i,i){u.style.top=e.top,u.style.left=e.left;const i=t.object.data;u.msg=`\n          <p>${i.name}</p>\n          <p>类型：${i.type}</p>\n          <p>绑定：${i.bind||"无"}</p>\n        `}}}),A.run(),nt(A).resize(),J()})),(t,e)=>{const i=$;return n(),a("div",{class:m(t.$style.page)},[r("div",Me,[r("div",{class:"btn",onClick:e[0]||(e[0]=()=>{A.getAll().forEach(((t,e)=>{t.data&&(t.data.type!==o.dotKey||R(t))}))})},"随机更新"),r("div",{class:"btn",onClick:e[1]||(e[1]=()=>j(Nt).emit("SCENE:POS"))},"场景坐标"),r("div",{class:"item",onClick:e[2]||(e[2]=t=>j(A).exportImage())},"截图"),r("div",{class:"item",onClick:e[3]||(e[3]=()=>j(Nt).emit("CAMERA:ROAM"))},"全景漫游"),(n(!0),a(p,null,g(j(L),(t=>(n(),a("div",{class:"item",onClick:e=>(t=>{A.cameraTransition({position:t.position,data:t})})(t)},l(t.name),9,De)))),256)),r("div",{class:"item",onClick:e[4]||(e[4]=()=>j(Nt).emit("CAMERA:CRUISE"))},"定点巡航"),r("div",{class:"item",onClick:e[5]||(e[5]=()=>j(Nt).emit("CAMERA:RESET"))},"视角重置"),r("div",{class:"item",onClick:e[6]||(e[6]=()=>j(Nt).emit("AIR:MAIN"))},"空调开关"),r("div",{class:"item",onClick:e[7]||(e[7]=()=>j(Nt).emit("LIGHT:CLG"))},"灯组开关"),r("div",{class:"item",onClick:e[8]||(e[8]=()=>j(Nt).emit("LIGHT:FIRSTFLOOR"))},"一楼开关"),r("div",{class:"item",onClick:e[9]||(e[9]=()=>j(Nt).emit("CURTAIN:TOGGLE"))},"窗帘开关"),r("div",{class:"item",onClick:e[10]||(e[10]=()=>j(Nt).emit("EFFECT:FLEETING"))},"流光开关"),r("div",{class:"item",onClick:e[11]||(e[11]=()=>j(Nt).emit("SKY:DAY"))},"白天"),r("div",{class:"item",onClick:e[12]||(e[12]=()=>j(Nt).emit("SKY:EVENING"))},"傍晚"),r("div",{class:"item",onClick:e[13]||(e[13]=()=>j(Nt).emit("SKY:NIGHT"))},"夜间"),r("div",{class:"item",onClick:e[14]||(e[14]=()=>j(Nt).emit("LIGHT:LCR",null,Math.floor(5*Math.random())))}," 大会议室灯 "),r("div",{class:"item",onClick:e[15]||(e[15]=()=>j(Nt).emit("CAMERA:FIRST"))},"第一人称"),r("div",{class:"item",onClick:e[16]||(e[16]=()=>j(Nt).emit("CAMERA:THREE"))},"第三人称"),r("div",{class:"item",onClick:e[17]||(e[17]=()=>j(Nt).emit("PERSON:ADD"))},"人物加速"),r("div",{class:"item",onClick:e[18]||(e[18]=()=>j(Nt).emit("PERSON:SUB"))},"人物减速"),r("div",{class:"item",onClick:e[19]||(e[19]=()=>j(Nt).emit("BIRD:COMPANY"))},"鸟瞰")]),r("div",{class:m(t.$style.container),ref_key:"containerRef",ref:C},null,2),r("canvas",{class:m(t.$style["canvas-texture"]),ref_key:"canvasTextureRef",ref:b},null,2),c(mt),c(et,{modelValue:j(_).show,"onUpdate:modelValue":e[20]||(e[20]=t=>j(_).show=t),progress:j(_).percentage,"bg-src":j(o).bgSrc},null,8,["modelValue","progress","bg-src"]),H(r("div",{class:m(t.$style["floor-select"])},[(n(!0),a(p,null,g(j(G),(t=>(n(),F(i,{type:"primary",disabled:j(d).active===t.key,onClick:e=>(t=>{d.active=t.key;const e=t.bind;A.waitLift({data:{bind:e,to:{y:t.y},target:d.targetName}},!0)})(t)},{default:U((()=>[B(l(t.name),1)])),_:2},1032,["disabled","onClick"])))),256))],2),[[z,j(d).show]]),j(u).show?(n(),a("div",{key:0,class:m(t.$style.tip),style:V({left:j(u).style.left+"px",top:j(u).style.top+"px"})},[r("div",{class:m(t.$style.msg),innerHTML:j(u).msg},null,10,Ie)],6)):h("",!0),c(gt,{modelValue:j(E).show,"onUpdate:modelValue":e[21]||(e[21]=t=>j(E).show=t),title:j(E).title,content:j(E).content,"onUpdate:content":e[22]||(e[22]=t=>j(E).content=t),"err-message":j(E).errMessage,onConfirm:Z},null,8,["modelValue","title","content","err-message"])],2)}}}),[["__cssModules",{$style:{page:"_page_p3kwz_2",container:"_container_p3kwz_10","floor-select":"_floor-select_p3kwz_14",tip:"_tip_p3kwz_20",msg:"_msg_p3kwz_30","canvas-texture":"_canvas-texture_p3kwz_39"}}]]);export{Ne as default};
