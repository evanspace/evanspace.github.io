var e,t,i=Object.defineProperty,n=(e,t,n)=>(((e,t,n)=>{t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n),s=(e,t,i)=>(((e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)})(e,t,"access private method"),i);import{bm as r,bn as o,b4 as a,bw as c,bx as h,b2 as d,ch as l,by as p,b3 as b,bp as u,bq as m,br as w,bs as g,bt as f,bu as v,bv as y,bA as C,c1 as x,b9 as k,bb as E,aU as j,ci as L,bf as A,bd as P,be as O,b0 as S,aW as M,cj as U,aX as z,aY as D,bc as T,bk as F,bl as B,aZ as H,ba as W,w as G,ad as I}from"./vendor-eaf8386d.js";import{u as R}from"./common-6b6d0500.js";const Z=e=>((e,t)=>Object.prototype.toString.call(t)===`[object ${e}]`)("Object",e),q=(e,t=new Map)=>{if(null!=e&&Z(e)){let i=t.get(e);if(i)return i;const n=Array.isArray(e);let s=n?[]:{};return i=t.set(e,s),n?e.forEach(((e,t)=>{s[t]=q(e,i)})):Object.keys(e).forEach((t=>{Z(s[t])?s[t]=q(e[t],i):s[t]=e[t]})),s}return e},N=(e,t)=>{e=q(e);for(let i in t)i in e&&Z(t[i])&&Z(e[i])?e[i]=N(e[i],t[i]):e[i]=t[i];return e},X=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,$=(e,t="")=>Array.isArray(e)?e.map((e=>$(e,t))):!(e=>(!e&&(e=""),!!/^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/)[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,}(\/\S*)?$/.test(e)))(e)&&e.indexOf(t)<0?t+e:e,_=(e=0,t=2)=>{if(Math.abs(e)>=1e8){return 1*(e/1e8).toFixed(t)+"亿"}if(Math.abs(e)>=1e4){return 1*(e/1e4).toFixed(t)+"万"}return 1*e.toFixed(t)},Y={container:document.body,width:window.innerWidth,height:window.innerHeight,baseUrl:"",bgColor:null,bgUrl:null,env:null,scale:1,fog:{visible:!1,near:100,far:1e3},render:{antialias:!0,logarithmicDepthBuffer:!0,preserveDrawingBuffer:!1},controls:{visible:!0,enableDamping:!1,dampingFactor:.25,autoRotate:!1,enableZoom:!0,enablePan:!0,screenSpacePanning:!0,minDistance:1,maxDistance:2e3},ambientLight:{visible:!0,color:16777215,intensity:1.5},directionalLight:{visible:!0,helper:!1,light2:!0,color:16777215,intensity:1.5},camera:{helper:!1,near:1,far:1e4,position:[-350,510,700]},cruise:{visible:!1,enabled:!1,runing:!1,helper:!1,points:[],segment:2,tension:0,baseUrl:"",mapUrl:"/oss/textures/cruise/arrow.png",repeat:[.1,1],width:15,speed:1,mapSpeed:.006,offset:10,factor:1,index:0},grid:{visible:!1,opacity:.3,transparent:!0,width:800,divisions:80,centerLineColor:10592673,gridColor:10592673,fork:!1,forkSize:1.4,forkColor:10592673},axes:{visible:!1,size:50}},{createCruise:J,cruiseAnimate:K,updateCruise:Q,bindEvent:V,removeEvent:ee}=(()=>{let e,t,i,n={visible:!0,enabled:!1,runing:!1,helper:!1,points:[],segment:2,tension:0,baseUrl:"",mapUrl:"/oss/textures/cruise/arrow.png",repeat:[.1,1],width:15,speed:1,mapSpeed:.006,offset:10,factor:1,index:0};const s=(t,s)=>{i=new b(new u(2),new m({color:0,opacity:.8,transparent:!0})),t.add(i);const r=(new w).setFromPoints(s),o=new g({color:255,opacity:1,transparent:!0}),a=new f(r,o);t.add(a);const c=new v(e,100,n.width/2,3,!0),h=new y({color:16711935,opacity:.1,transparent:!0}),d=new b(c,h),l=new m({color:16715760,opacity:.3,wireframe:!0,transparent:!0}),p=new b(c,l);d.add(p),t.add(d)},x=()=>1e3*(n.segment??2),k=(e,t)=>new r(t.x,t.y+e,t.z),E=e=>{if(!n.enabled)return;switch(e.keyCode){case 38:case 87:n.runing?(n.factor*=1.5,n.factor>10&&(n.factor=10)):n.index+=5;break;case 83:case 40:n.runing||(n.index-=5,n.index<0&&(n.index=x()))}},j=e=>{if(!n.enabled)return;n.factor=1;switch(e.keyCode){case 32:n.runing=!n.runing;break;case 38:case 87:n.runing||(n.index+=10);break;case 83:case 40:n.runing||(n.index-=10,n.index<0&&(n.index=x()))}};return{createCruise:(i={},u)=>{n=N(n,i);const{points:m,tension:w,mapUrl:g,baseUrl:f,repeat:v,width:y,helper:x}=n,k=[];for(let e=0;e<m.length;e++){const t=m[e];k.push(new r(t[0],t[1],t[2]))}e=new o(k,!0,"catmullrom",w??0);const E=new a;t=(new c).load($(g,f),(e=>{e.wrapS=h,e.repeat.x=v[0],e.repeat.y=v[1],e.anisotropy=u.capabilities.getMaxAnisotropy()}));const j=new d({map:t,opacity:.5,transparent:!0,depthTest:!1,blending:l}),L=new r(0,1,0),A=new C;A.set(e.getPoints(1e3),5,1,L,!1);const P=new p;P.update(A,{width:y,arrow:!1});const O=new b(P,j);return E.add(O),E.name="cruise",x&&s(E,k),E.renderOrder=99,E},updateCruise:(e={})=>{n=N(n,e)},cruiseAnimate:s=>{if(!s)return;if(!e)return;const{mapSpeed:r,speed:o,factor:a,enabled:c,runing:h,offset:d,helper:l}=n;t&&(t.offset.x-=r),h&&c&&(n.index+=a*o);const p=x(),b=n.index%p/p,u=e.getPointAt(b);if(l&&i){const e=k(d,u);i.position.copy(e)}const m=.03;let w=b-m;b<m&&(w=b+.97);const g=k(d,e.getPointAt(w));s.position.copy(g),s.lookAt(k(d,u))},bindEvent:()=>{window.addEventListener("keydown",E,!1),window.addEventListener("keyup",j,!1)},removeEvent:()=>{window.removeEventListener("keyup",j),window.removeEventListener("keydown",E)}}})(),{createFork:te}={createFork:(e={})=>{const{width:t=800,divisions:i=80,forkSize:n=1.4,forkColor:s=10592673}=e;let r=t/i,o=-t/2;const c=new a;for(let a=0;a<=i;a++)for(let e=0;e<=i;e++){const t=o+a*r,i=o+e*r,h=new x(n,n/5),d=new y({color:s,transparent:!0,opacity:.9}),l=new b(h,d);l.rotateX(.5*-Math.PI),l.position.set(t,0,i);const p=l.clone();p.rotateZ(.5*Math.PI),c.add(l,p)}return c}},ie=class i{constructor(t={}){((e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)})(this,e),n(this,"options"),n(this,"container"),n(this,"scene"),n(this,"renderer"),n(this,"baseCamera"),n(this,"cruiseCamera"),n(this,"cruiseGroup"),n(this,"controls"),n(this,"grid"),n(this,"animationId"),n(this,"pointer"),n(this,"forkName",Symbol("辅助交叉点")),n(this,"clear",(e=>{e&&e.traverse&&(e.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),null==e||e.clear()})),null==e||e.clear())})),n(this,"disposeObj",(e=>{e&&e.traverse&&(e.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),null==e||e.clear()})),null==e||e.clear(),this.scene.remove(e))}));const s=Y;var r;this.options=N(s,t),i.total++,this.pointer={tsp:0,isClick:!1},(r=this.options.container)&&("object"==typeof HTMLElement?r instanceof HTMLElement:r&&"object"==typeof r&&1===r.nodeType&&"string"==typeof r.nodeName)?this.container=this.options.container:this.container=document.querySelector(this.options.container),this.options.width=this.container.offsetWidth,this.options.height=this.container.offsetHeight,this.scene=new k,this.renderer=this.initRenderer(),this.init(),this.baseCamera=this.initCamera(),this.controls=this.initControls(),this.initCruise()}get camera(){const{visible:e,runing:t}=this.options.cruise;return e&&t?this.cruiseCamera:this.baseCamera}init(){this.initLight(),this.initGrid(),this.initAxes(),this.initModel()}run(){this.loop()}loop(){this.animationId=window.requestAnimationFrame((()=>{this.loop()})),this.animate(),this.modelAnimate()}animate(){this.renderer&&this.renderer.render(this.scene,this.camera),this.options.controls.visible&&this.controls.update(),K(this.cruiseCamera),E()}initModel(){}modelAnimate(){}initRenderer(){const{width:e,height:t,bgColor:i,bgUrl:n,env:s}=this.options,r=new j(this.options.render);if(s&&this.setEnvironment(s),n?this.setBgTexture(n):this.setBgColor(i),this.options.fog.visible){const{color:e,near:t,far:i}=this.options.fog;this.scene.fog=new L(e??this.scene.background,t,i)}return r.sortObjects=!0,r.shadowMap.enabled=!0,r.shadowMap.type=A,r.setSize(e,t),r.setPixelRatio(window.devicePixelRatio),this.container.appendChild(r.domElement),r}initLight(){const{ambientLight:e,directionalLight:t}=this.options;if(e.visible){const t=new P(e.color,e.intensity);this.addObject(t)}if(t.visible){const e=this.createDirectionalLight();if(this.addObject(e),t.helper){const t=new O(e,1);this.addObject(t)}if(t.light2){const e=this.createDirectionalLight(!1);if(e.position.set(-500,800,-800),this.addObject(e),t.helper){const t=new O(e,1);this.addObject(t)}}}}createDirectionalLight(e=!0,t=800,i=4096,n=1,s=2e3){const{color:r,intensity:o}=this.options.directionalLight,a=new S(r,o);if(a.position.set(500,800,800),e){a.shadow.mapSize.setScalar(i),a.shadow.bias=-1e-5,a.shadow.normalBias=.01,a.castShadow=e;const r=a.shadow.camera;r.radius=10,r.near=n,r.far=s,r.top=r.right=t,r.left=r.bottom=-t,r.updateProjectionMatrix()}return a}initCamera(){const{width:e,height:t,camera:i}=this.options,n=new M(36,e/t,i.near,i.far);if(n.position.set(...i.position),i.helper){const e=new U(n);this.addObject(e)}return this.addObject(n),n}initControls(){const e=this.options.controls;if(!e.visible)return;const t=new z(this.camera,this.renderer.domElement);return Object.keys(e).forEach((i=>{t[i]=e[i]})),t.target.set(0,0,0),t}initCruise(){const{visible:i}=this.options.cruise;i&&(this.cruiseCamera=this.initCamera(),s(this,e,t).call(this))}initGrid(){const e=this.options.grid;if(!e.visible)return;const{width:t,divisions:i,centerLineColor:n,gridColor:s,opacity:r,transparent:o,fork:a}=e,c=new D(t,i,n,s);if(c.material.opacity=r,c.material.transparent=o,this.grid=c,this.addObject(c),a){const t=te(e);t.name=this.forkName,this.addObject(t)}}initAxes(){if(!this.options.axes.visible)return;const e=new T(this.options.axes.size);this.addObject(e)}setCruisePoint(e){this.options.cruise.points=e,this.createCruise()}createCruise(){const{visible:e,points:t}=this.options.cruise;if(!e)return;if(this.cruiseGroup&&this.disposeObj(this.cruiseGroup),V(),!t||0==t.length)return;const i=J(this.options.cruise,this.renderer);this.cruiseGroup=i,this.addObject(i)}toggleCruise(){const{visible:e,runing:t}=this.options.cruise;e&&(this.options.cruise.runing=!t,this.options.cruise.enabled=!t,this.controls.enabled=t,Q(this.options.cruise))}setScale(e){this.options.scale=e}setEnvironment(e){(new F).load($(e),(e=>{e.mapping=B,this.scene.environment=e}))}setBgTexture(e){if(Array.isArray(e)){const t=(new H).load($(e));this.scene.background=t}else this.scene.background=(new c).load($(e))}setBgColor(e){this.scene.background=e?new W(e):null}bindEvent(){const e=this.renderer.domElement;e.addEventListener("dblclick",this.onDblclick.bind(this)),e.addEventListener("pointerdown",this.onPointerDown.bind(this)),e.addEventListener("pointermove",this.onPointerMove.bind(this)),e.addEventListener("pointerup",this.onPointerUp.bind(this))}onDblclick(e){}onPointerDown(e){this.pointer.isClick=!0,this.pointer.tsp=e.timeStamp}onPointerMove(e){}onPointerUp(e){this.pointer.isClick=!1}exportImage(){const e=document.createElement("a");e.download="render.png",e.href=this.renderer.domElement.toDataURL().replace("image/png","image/octet-stream"),e.click()}addObject(...e){this.scene.add(...e)}resize(){this.options.width=this.container.offsetWidth||window.innerWidth,this.options.height=this.container.offsetHeight||window.innerHeight;const{width:e,height:t}=this.options,i=e/t;this.baseCamera.aspect=i,this.baseCamera.updateProjectionMatrix(),this.cruiseCamera&&(this.cruiseCamera.aspect=i,this.cruiseCamera.updateProjectionMatrix()),this.renderer.setSize(e,t)}stopAnimate(){window.cancelAnimationFrame(this.animationId)}dispose(){ee();try{this.scene.clear(),this.renderer.dispose(),this.renderer.forceContextLoss(),this.renderer.content=null;let e=this.renderer.domElement.getContext("webgl");e&&e.getExtension("WEBGL_lose_context").loseContext()}catch(e){}}};e=new WeakSet,t=function(){const e=this.options.cruise;e.enabled=!1,e.runing=!1,this.cruiseCamera.lookAt(this.controls.target),e.baseUrl&&(e.baseUrl=this.options.baseUrl),e.factor=1,e.index=0},n(ie,"total",0);let ne=ie;const se=e=>({resize:()=>{const t=()=>null==e?void 0:e.resize();G((()=>R().sidebar.opened),(()=>{setTimeout(t,300)})),window.addEventListener("resize",t,!1),I((()=>{null==e||e.stopAnimate(),null==e||e.dispose(),window.removeEventListener("resize",t)}))}});export{ne as T,N as d,$ as g,_ as n,X as r,se as u};
