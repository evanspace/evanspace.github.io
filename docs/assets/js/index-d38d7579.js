var e=Object.defineProperty,s=(s,t,a)=>(((s,t,a)=>{t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a})(s,"symbol"!=typeof t?t+"":t,a),a);import{dl as t,da as a,fy as o,eZ as n,bC as r,e_ as i,ed as d,eb as l,ds as c,by as h,dc as u,bA as m,bt as p,dt as g,e$ as b,c as v,X as w,h as y,k as f,o as M,f as P,g as j}from"./vendor-5a37ffe2.js";import{i as S,S as _,u as x,a as C}from"./scene-resize-c6b34593.js";import"./index-0b477ca8.js";const{pass:k,uniform:E,time:O,oscSine:L}=b,{pointer:R,update:z,raycaster:A}=S.useRaycaster(),D=E(3),G=E(0),H=E(1),N=E(0),T=E(new t(16777215)),U=E(new t(5125686));class B extends _{constructor(e){super(e),s(this,"gui"),s(this,"group",new a),s(this,"select",[]),s(this,"outlinePass"),s(this,"postProcessing"),this.addObject(this.group);const t=o(this.scene,this.camera,{selectedObjects:this.select,edgeGlow:G,edgeThickness:H});this.outlinePass=t;const{visibleEdge:i,hiddenEdge:d}=t,l=O.div(N).mul(2),c=L(l).mul(.5).add(.5),h=i.mul(T).add(d.mul(U)).mul(D),u=N.greaterThan(0).select(h.mul(c),h),m=k(this.scene,this.camera),p=new n(this.renderer);p.outputNode=u.add(m),this.postProcessing=p,this.gui=new r,this.addGui(),this.bindEvent()}createRender(){return new i}createAmbientLight(e,s){return new d(e,s)}createDirectionalLight(e,s){return new l(e,s)}addModel(e){this.group.children.length=0;let s=1;e.traverse((e=>{if(e.isMesh){e.geometry.center(),e.geometry.computeBoundingSphere(),s=.2*e.geometry.boundingSphere.radius;const t=new c({color:16777215,specular:1118481,shininess:5});e.material=t,e.receiveShadow=!0,e.castShadow=!0}})),e.position.y=1,e.scale.divideScalar(s),this.group.add(e);const t=new h(3,48,24);for(let o=0;o<20;o++){const e=new u;e.color.setHSL(Math.random(),1,.3);const s=new m(t,e);s.position.set(4*Math.random()-2,4*Math.random()-2,4*Math.random()-2),s.scale.multiplyScalar(.3*Math.random()+.1),this.group.add(s)}const a=new m(new p(12,12),new u({color:3235718,side:g}));a.rotation.x-=.5*Math.PI,a.position.y-=1.5,a.receiveShadow=!0,this.group.add(a)}onPointerMove(e){if(!e.isPrimary)return;z(e,this.container),A.setFromCamera(R,this.camera);const s=A.intersectObject(this.group,!0);if(s.length>0){const e=s[0].object;this.select=[],this.select.push(e),this.outlinePass.selectedObjects=this.select}}addGui(){var e;const s=this.gui;s.add(D,"value",.01,10).name("边缘强度"),s.add(G,"value",0,1).step(.01).name("边缘发光"),s.add(H,"value",0,6).step(.01).name("边缘厚度"),s.add(N,"value",0,6).step(.01).name("脉冲周期"),s.addColor({color:T.value.getHex()},"color").name("可见区域颜色").onChange((e=>{T.value.set(e)})),s.addColor({color:U.value.getHex()},"color").name("不可见区域颜色").onChange((e=>{U.value.set(e)})),s.domElement.className+=" gui-wrap",null==(e=this.container.parentNode)||e.appendChild(s.domElement)}setEnv(e){this.scene.environment=e,this.scene.background=e}animate(){this.postProcessing.renderAsync()}}const F={class:"three-page"},I=v({__name:"index",setup(e){const s=w({base:"https://ye6.atomgit.net/3d-demo-data",models:[{key:"tree",name:"大树",size:.01,url:"/models/gpu/tree.glb"}],objects:[{type:"tree",name:"大树"}]}),{progress:t,loadModels:a,getModel:o,initModels:n}=S.useModelLoader({baseUrl:s.base}),r=y(),i={baseUrl:s.base,env:"/textures/hdr/moonless_golf_1k.hdr",camera:{position:[0,0,15]}};let d;return f((()=>{i.container=r.value,d=new B(i).run(),x(d).resize(),a(s.models,(()=>{t.percentage=100,t.show=!1,n(s.objects,(e=>{const{type:s}=e,t=o(s);if(!t)return Promise.resolve();let a=C.modelDeepClone(t);const{position:n,scale:r,rotation:i}=C.get_P_S_R_param(a,e),[l,c,h]=n;return a.scale.set(...r),a.position.set(l,c,h),a.rotation.set(...i),d.addModel(a),Promise.resolve()}))}))})),(e,s)=>(M(),P("div",F,[j("div",{class:"h-100",ref_key:"containerRef",ref:r},null,512)]))}});export{I as default};
