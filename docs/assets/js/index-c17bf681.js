import{e,ch as a,i as s,Y as l,l as o,o as r,g as n,h as t,q as i,p as c,I as d,n as p,t as g,u,B as m,ci as v,c as _,al as y,_ as b}from"./vendor-509147fa.js";import{e as f,A as h,n as C}from"./index-e7e71650.js";import{u as k}from"./scene-resize-2cf1f3dc.js";const $={depth:2,scale:40,plateRadius:100},j={main:3377879,mainHover:9633791,borderColor:9633791,borderHoverColor:1066618,light:1066618,lightHover:9633791,plateColor:3377879,plateLight:1066618,line:9559027,line2:6421501,gridColor:663606,gridFork:927811,outline:11856636,markColor1:13303807,markColor2:6945023,flyColor1:9559027,flyColor2:6421501,scatterColor1:9559027,scatterColor2:6421501},x=["src"],z=b(e({__name:"index",setup(e){const{load:b}=a(),z=s(),w=l({devEnv:!0,baseUrl:"",bgColor:464681,color:j,config:{...$,areaLabel:!0,markLight:!0,map:{}},camera:{position:[0,100,200]},directionalLight:{helper:!0},fog:{visible:!1,near:2e3,far:3e3},render:{preserveDrawingBuffer:!0},grid:{visible:!0,gridColor:j.gridColor,centerLineColor:j.gridColor,fork:!0,divisions:40,width:2*$.plateRadius*$.scale,forkSize:1.4*$.scale,forkColor:j.gridFork},controls:{maxPolarAngle:.46*Math.PI,maxDistance:5e3,enableDamping:!0,screenSpacePanning:!1},axes:{visible:!0},mapJson:null,outlineJson:null,flywire:[],barList:[],scatters:[]}),L=()=>{var e;return null==(e=z.value)?void 0:e.exportImage()},J=e=>{const a=w.baseUrl;b(`${a}/oss/map/china.json`).then((e=>{w.mapJson=e})),b(`${a}/oss/map/china-outline.json`).then((e=>{w.outlineJson=e})),k(e).resize()},S=e=>{_.info({message:e.name,grouping:!0})},I=e=>{const{name:a="",value:s=0,unit:l=""}=e;return{name:`\n      <div class="label-wrap">\n        <div class="name">${a}</div>\n        <div class="text">\n          <span class="value">${C(s)}</span>\n          <span class="unit">${l}</span>\n        </div>\n      </div>\n    `,className:"map-bar-label"}},U=()=>{f.get(h.d3.map).then((e=>{const a=[],s=[];return e.list.forEach((e=>{const l=e.projects.length;let o=e.province;["重庆","北京","天津","上海"].includes(o)&&(o+="市"),["台湾"].includes(o)&&(o+="省"),e.projects.forEach((s=>{a.push({coord:[s.lng,s.lat],name:s.name,carbon:s.carbon,value:s.use,total:l,city:e.province,id:s.id})}));const r=e.total;-1===s.findIndex((e=>e.name===o))&&s.push({id:e.code,name:o,total:l,value:r,unit:"kWh"})})),{citys:s,projects:a,lines:e.lines}})).then((e=>{w.flywire=e.lines,w.barList=e.citys,w.scatters=e.projects}))};return o((()=>{U()})),(e,a)=>{const s=y;return r(),n("div",{class:p([e.$style.page,"h-100 o-h"])},[t("div",{class:p(e.$style.operate)},[i(s,{type:"primary",size:"small",onClick:L},{default:c((()=>a[0]||(a[0]=[d("导出")]))),_:1})],2),i(v,{ref_key:"threeSceneRef",ref:z,"dev-env":u(w).devEnv,"base-url":u(w).baseUrl,"bg-color":u(w).bgColor,"bg-url":u(w).bgUrl,env:u(w).env,"sky-code":u(w).skyCode,camera:u(w).camera,cruise:u(w).cruise,render:u(w).render,controls:u(w).controls,"directional-light":u(w).directionalLight,grid:u(w).grid,axes:u(w).axes,config:u(w).config,color:u(w).color,"map-json":u(w).mapJson,"outline-json":u(w).outlineJson,flywire:u(w).flywire,"bar-list":u(w).barList,scatters:u(w).scatters,"bar-label-render":I,onInit:J,onClick:S},{dialog:c((({data:s})=>[t("div",{class:p(e.$style["dialog-view"])},[t("div",{class:p([e.$style.city,"flex"])},[t("span",{class:p(e.$style.name)},g(s.isScatter?s.city:s.name),3),t("span",{class:p(e.$style.total)},g(s.total)+"个项目",3)],2),s.isScatter?(r(),n("div",{key:0,class:p([e.$style.project,"flex flex-ac"])},[t("img",{src:`${u(w).baseUrl}/oss/img/map/pos.png`,alt:""},null,8,x),t("span",{class:p(e.$style.name)},g(s.name),3)],2)):m("",!0),t("div",{class:p(e.$style.count)},[t("div",{class:p(e.$style.item)},[a[1]||(a[1]=t("span",null,"今日用电量",-1)),t("span",null,g(u(C)(s.value)),1),a[2]||(a[2]=t("span",null,"kWh",-1))],2),s.isScatter?(r(),n("div",{key:0,class:p(e.$style.item)},[a[3]||(a[3]=t("span",null,"今日碳排放",-1)),t("span",null,g(u(C)(s.carbon)),1),a[4]||(a[4]=t("span",null,"kgCO₂",-1))],2)):m("",!0)],2)],2)])),_:1},8,["dev-env","base-url","bg-color","bg-url","env","sky-code","camera","cruise","render","controls","directional-light","grid","axes","config","color","map-json","outline-json","flywire","bar-list","scatters"])],2)}}}),[["__cssModules",{$style:{page:"_page_dcgzt_2",operate:"_operate_dcgzt_8","dialog-view":"_dialog-view_dcgzt_15",city:"_city_dcgzt_20",name:"_name_dcgzt_20",total:"_total_dcgzt_28",project:"_project_dcgzt_33",count:"_count_dcgzt_48",item:"_item_dcgzt_52"}}]]);export{z as default};
