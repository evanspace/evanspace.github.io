var e=Object.defineProperty,s=(s,a,t)=>(((s,a,t)=>{a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t})(s,"symbol"!=typeof a?a+"":a,t),t);import{b7 as a,b8 as t,b5 as r,b6 as o,bd as n,bl as i,bm as l,bn as u,bh as h,bb as p,bo as d,bp as c,be as m,bq as b,br as f,bs as w,bt as y,bg as g,bf as O,bu as S,bv as v,bw as G,bj as B,b9 as C,ba as R,bx as x,by as E,e as I,i as M,l as _,o as T,g as N,h as W,n as j}from"./vendor-fdf0d3de.js";import{u as A}from"./scene-resize-c9309c3a.js";import{_ as U}from"./common-9bcd4cdd.js";const z={glb:"/oss/model/csg/bunny.glb",operation:b,wireframe:!1,displayBrushes:!1,shadows:!0,useGroups:!0,consolidateGroups:!0},F=new Map,D=new a({opacity:.15,transparent:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:.1,polygonOffsetUnits:.1,side:t,premultipliedAlpha:!0,roughness:.25,color:5099745}),L=50;let H=new r;H.attributes=["position","normal"],H.useGroups=!1;class P extends o{constructor(e){super(e),s(this,"bunnyBrush"),s(this,"brushResult"),s(this,"wireframeResult"),s(this,"brushes"),s(this,"surfaceSampler"),this.brushes=[],this.addModel()}initModel(){const e=new n(new i(1e3,1e3),new l({color:16442329,transparent:!0,opacity:.35,side:t}));e.rotation.x=-Math.PI/2,e.scale.setScalar(10),e.receiveShadow=!0,this.addObject(e)}async addModel(){const e=await(async()=>{const e=(await(new S).setMeshoptDecoder(v).loadAsync(z.glb)).scene.children[0];e.updateMatrixWorld();const s=e.geometry.clone(),r=new G,o=new B(0,0,0),n=new x,i=new E,l=new B(L,L,L);n.setFromEuler(i),r.compose(o,n,l),s.applyMatrix4(r),s.computeVertexNormals();const u=new C(s,new a);return u.updateMatrixWorld(),u.castShadow=!0,u.name="兔子",u.material.opacity=.15,u.material.transparent=!0,u.material.depthWrite=!1,u.material.polygonOffset=!0,u.material.polygonOffsetFactor=.1,u.material.polygonOffsetUnits=.1,u.material.side=t,u.material.premultipliedAlpha=!0,u.material.color.set(14743546),u})();this.bunnyBrush=e,this.addObject(e);const s=new u(e);s.build(),this.surfaceSampler=s;const{brushes:r,material:o}=(e=>{let s=[];for(let a=0;a<50;a++){const a=new C(new R(50,15,15),D);a.receiveShadow=!0,e.add(a),s.push(a)}return{brushes:s,material:D}})(this.scene);let i;this.brushes=r,i=e.material.clone(),i.opacity=1,i.transparent=!1,i.depthWrite=!0,F.set(e.material,i),i=o.clone(),i.opacity=1,i.transparent=!1,i.depthWrite=!0,F.set(o,i);const l=new n(new h,new a({roughness:.1,flatShading:!1,polygonOffset:!0,polygonOffsetUnits:L,polygonOffsetFactor:L}));l.castShadow=!0,l.receiveShadow=!0,this.brushResult=l,this.addObject(l);const d=new n(l.geometry,new p({wireframe:!0,color:0,opacity:.15,transparent:!0}));d.material.color.set(5398),this.wireframeResult=d,this.addObject(d),this.randomizeBrushes(),this.updateCSG(),this.createGUI()}randomizeBrushes(){const e=this.surfaceSampler;if(!e)return;const s=this.brushes,a=this.bunnyBrush;for(let t=0;t<s.length;t++){const r=s[t];e.sample(r.position),r.position.applyMatrix4(a.matrixWorld),r.scale.setScalar(d.lerp(.05,.15,Math.random())),r.updateMatrixWorld()}}updateCSG(){const{brushes:e,bunnyBrush:s,brushResult:a}=this;let t=e[0];H.useGroups=z.useGroups,H.consolidateGroups=z.consolidateGroups;for(let r=1,o=e.length;r<o;r++){const s=e[r];t=H.evaluate(t,s,c),t.material=D}H.evaluate(s,t,z.operation,a),a.material=z.useGroups?a.material.map((e=>F.get(e))):F.get(s.material)}createGUI(){var e;const s=new m;s.add(z,"operation",{ADDITION:c,SUBTRACTION:b,REVERSE_SUBTRACTION:f,INTERSECTION:w,DIFFERENCE:y,HOLLOW_SUBTRACTION:g,HOLLOW_INTERSECTION:O}).name("布尔类型").onChange((()=>{this.updateCSG()})),s.add(z,"wireframe").name("线框材质"),s.add(z,"displayBrushes").name("计算元素"),s.add(z,"useGroups").name("使用组合").onChange((()=>{this.updateCSG()})),s.add(z,"consolidateGroups").name("合并组").onChange((()=>{this.updateCSG()})),s.add({randomize:()=>{this.randomizeBrushes(),this.updateCSG()}},"randomize").name("随机更新"),s.domElement.style="position: absolute; top: 10px; right: 10px",null==(e=this.container)||e.appendChild(s.domElement)}modelAnimate(){this.bunnyBrush&&(this.bunnyBrush.visible=z.displayBrushes),this.brushes.length&&this.brushes.forEach((e=>e.visible=z.displayBrushes)),this.wireframeResult&&(this.wireframeResult.visible=z.wireframe)}}const V=U(I({__name:"index",setup(e){const s=M(),a={camera:{position:[0,80,300]},grid:{visible:!0},axes:{visible:!0}};let t;return _((()=>{a.container=s.value,t=new P(a),t.run(),A(t).resize()})),(e,a)=>(T(),N("div",{class:j([e.$style.page,"h-100 o-h"])},[W("div",{ref_key:"containerRef",ref:s,class:"h-100"},null,512)],2))}}),[["__cssModules",{$style:{page:"_page_12f6y_2"}}]]);export{V as default};
