var e=Object.defineProperty,s=(s,t,a)=>(((s,t,a)=>{t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a})(s,"symbol"!=typeof t?t+"":t,a),a);import{t}from"./index-09881d37.js";import{f as a,w as o,u as n,i as r}from"./scene-resize-3e3c778b.js";import{fe as i,dt as d,bC as l,ed as c,eb as u,e_ as m,fv as h,e$ as p,e as g,Y as v,i as b,l as f,o as y,g as w,h as x,q as M,u as j}from"./vendor-9734da72.js";import"./index-b99a3f01.js";const{uniform:P,color:_,atan:I,PI2:z,Fn:C,If:L,positionLocal:D,output:N,frontFacing:S,vec4:V}=p,k=new i({metalness:.5,roughness:.25,envMapIntensity:.5,color:"#858080"}),E=new i({metalness:.5,roughness:.25,envMapIntensity:.5,color:"#858080",side:d}),F=P(1.75),G=P(1.25),O=P(_("#b62f58")),R=C((([e,s,t])=>{const a=I(e.y,e.x).sub(s).mod(z).toVar();return a.greaterThan(0).and(a.lessThan(t))}));E.outputNode=C((()=>{R(D.xy,F,G).discard();const e=N;return L(S.not(),(()=>{e.assign(V(O,1))})),e}))(),E.castShadowNode=C((()=>(R(D.xy,F,G).discard(),V(0,0,0,1))))();class T extends a{constructor(e){super(e),s(this,"gui");const t=this.createGround(1e3,1e3,11184810);this.addObject(t),this.gui=new l,this.addGui()}render(){this.renderer.renderAsync(this.scene,this.camera)}createAmbientLight(e,s){return new c(e,s)}createDirectionalLight(e,s){return new u(e,s)}createRender(){return new m}setEnv(e){e.mapping=h;const s=this.convertPmremTexture(e);this.scene.environment=s,this.scene.background=e}addModel(e){e.traverse((e=>{e.isMesh&&("outerHull"===e.name?e.material=E:e.material=k,e.castShadow=!0,e.receiveShadow=!0)})),console.log(e),this.addObject(e)}addGui(){var e;const s=this.gui;s.add(F,"value",-Math.PI,Math.PI,.001).name("开始位置"),s.add(G,"value",0,2*Math.PI,.001).name("角度"),s.addColor({color:O.value.getHex()},"color").onChange((e=>O.value.set(e))),s.domElement.className+=" gui-wrap",null==(e=this.container.parentNode)||e.appendChild(s.domElement)}}const U={class:"three-page"},A=g({__name:"index",setup(e){const s=v({base:"https://ye6.atomgit.net/3d-demo-data",models:[{key:"gears",name:"齿轮",size:.07,url:"/models/gpu/gears.glb"}],objects:[{type:"gears",name:"齿轮",position:{x:0,y:150,z:0},scale:{x:50,y:50,z:50}}]}),{progress:a,loadModels:i,initModels:d,getModel:l}=o.useModelLoader({baseUrl:s.base,indexDB:{}}),c=b(),u={baseUrl:s.base,env:"/textures/hdr/8.hdr",directionalLight:{intensity:4}};let m;return f((()=>{u.container=c.value,m=new T(u).run(),n(m).resize(),i(s.models,(()=>{a.percentage=100,a.show=!1,d(s.objects,(e=>{const{type:s}=e,t=l(s);if(!t)return Promise.resolve();console.log(t);let a=r.modelDeepClone(t);const{position:o,scale:n,rotation:i}=r.get_P_S_R_param(a,e),[d,c,u]=o;return a.scale.set(...n),a.position.set(d,c,u),a.rotation.set(...i),m.addModel(a),Promise.resolve()}))}))})),(e,s)=>(y(),w("div",U,[x("div",{class:"h-100",ref_key:"containerRef",ref:c},null,512),M(t,{modelValue:j(a).show,"onUpdate:modelValue":s[0]||(s[0]=e=>j(a).show=e),progress:j(a).percentage},null,8,["modelValue","progress"])]))}});export{A as default};
