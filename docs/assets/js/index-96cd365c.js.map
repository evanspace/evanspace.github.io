{"version":3,"file":"index-96cd365c.js","sources":["../../../code/src/pages/webgl/scene/device/data.ts","../../../code/src/pages/webgl/scene/device/index.vue","../../../code/src/pages/webgl/scene/device/request.ts"],"sourcesContent":["const base = import.meta.env.VITE_BEFORE_STATIC_PATH\n\nconst devEnv = import.meta.env.VITE_MODE !== 'production-'\n\nexport const getPageOpts = (): {} & Omit<\n  import('@/components/device-scene/index').Props,\n  'formatObject'\n> => ({\n  devEnv,\n  baseUrl: base,\n  bgColor: '',\n  // skyCode: '221',\n  // bgUrl: '/oss/img/map/earth.jpg',\n  // bgUrl: [`/posX.jpeg`, `/negX.jpeg`, `/posY.jpeg`, `/negY.jpeg`, `/posZ.jpeg`, `/negZ.jpeg`].map(\n  //   u => `/oss/img/sky/216${u}`\n  // ),\n  env: '/oss/textures/hdr/skidpan_2k.hdr',\n\n  colors: {\n    normal: {\n      main: [0x88a1b5, 0x292e31],\n      text: 0xb9dbff,\n      FM: 0x88a1b5\n    },\n    runing: {\n      main: 0x2e77f8,\n      FM: 0x00590f\n    },\n    error: {\n      FM: 0xb53e09\n    }\n  },\n\n  indexDB: {\n    cache: true,\n    dbName: 'THREE__DEVICE__DB',\n    tbName: 'TB',\n    version: 2\n  },\n  camera: {\n    far: 1000000\n  },\n  cruise: {\n    visible: true,\n    // helper: true,\n    points: [\n      [450, 0.1, 450],\n      [450, 0.1, -450],\n      [-450, 0.1, -450],\n      [-450, 0.1, 450]\n    ],\n    offset: 10\n  },\n  render: {\n    alpha: true,\n    preserveDrawingBuffer: true\n  },\n  controls: {\n    screenSpacePanning: false,\n    maxDistance: 1500,\n    maxPolarAngle: Math.PI * 0.46\n  },\n  grid: {\n    visible: !true,\n    gridColor: 0x00adb5,\n    centerLineColor: 0x00adb5,\n    fork: true,\n    forkColor: 0x00adb5\n  },\n  axes: {\n    visible: true\n  },\n  ambientLight: {\n    intensity: 2\n  },\n  directionalLight: {\n    helper: !true\n    // intensity: 1\n    // position: [0, 500, -400],\n    // position2: [0, 500, 400]\n  },\n  config: {},\n\n  models: [\n    {\n      key: 'JSQ',\n      name: '分集水器',\n      size: 2,\n      url: '/分集水器.glb'\n    },\n    {\n      key: 'LXJ',\n      name: '离心机',\n      size: 1.4,\n      url: '/离心机.glb'\n    },\n    {\n      key: 'LGJ',\n      name: '螺杆机',\n      size: 1.2,\n      url: '/螺杆机.glb'\n    },\n    {\n      key: 'LQT',\n      name: '冷却塔',\n      size: 0.8,\n      url: '/冷却塔.glb'\n    },\n    {\n      key: 'LDB',\n      name: '冷冻泵',\n      size: 2.5,\n      url: '/冷冻泵.glb'\n    },\n    {\n      key: 'LQB',\n      name: '冷却泵',\n      size: 2.5,\n      url: '/冷却泵.glb'\n    },\n    {\n      key: 'FM',\n      name: '阀门',\n      size: 0.05,\n      url: '/阀门.glb'\n    },\n    {\n      key: 'BSHLQ',\n      name: '板式换热器-制冷',\n      size: 0.4,\n      url: '/板式换热器-制冷.glb'\n    },\n\n    {\n      key: 'JGBS',\n      name: '警告标识',\n      size: 0.2,\n      type: 'warning',\n      url: '/警告标识.glb'\n    },\n    {\n      key: 'JDBS',\n      name: '就地标识',\n      size: 0.2,\n      type: 'local',\n      url: '/就地.glb'\n    },\n    {\n      key: 'JYBS',\n      name: '禁用标识',\n      size: 0.03,\n      type: 'disabled',\n      url: '/禁用.glb'\n    },\n\n    {\n      key: 'COLD_CAMERA',\n      name: '摄像头',\n      type: 'sprite',\n      size: 1,\n      range: { x: 37, y: 77 },\n      mapUrl: '/sxt.png'\n    },\n    {\n      key: 'COLD_ROOM_INLET',\n      name: '房间入口',\n      type: 'sprite',\n      size: 1,\n      range: { x: 37, y: 77 },\n      mapUrl: '/fjdw.png'\n    },\n    {\n      key: 'COLD_GPS',\n      name: '定位',\n      type: 'sprite',\n      size: 1,\n      range: { x: 51, y: 56 },\n      mapUrl: '/dw.png'\n    },\n\n    {\n      key: 'FONT_WRYH',\n      name: '微软雅黑字体',\n      type: 'font',\n      size: 26.35,\n      url: '/oss/font/YaHei_Regular.json'\n    }\n  ].map(item => {\n    if (item.type !== 'sprite' && item.url && item.url.indexOf('/oss') < 0) {\n      item.url = '/oss/model/ncl' + item.url\n    }\n    if (item.mapUrl) {\n      item.mapUrl = '/oss/textures/floor' + item.mapUrl\n    }\n    return item as import('three-scene/types/model').ModelItem\n  }),\n  objects: [],\n  dotShowStrict: true,\n  mainBodyChangeColor: true,\n\n  anchorType: ['COLD_CAMERA', 'COLD_ROOM_INLET', 'COLD_GPS'],\n  colorMeshName: ['叶轮', '电动阀门'],\n  animationModelType: ['LDB', 'LQB', 'SB', 'LXJ', 'LGJ', 'LQT'],\n  textModelType: ['LDB', 'LQB', 'JSQ', 'LXJ', 'LGJ', 'LQT', 'BSHLQ']\n})\n","<template>\n  <div :class=\"$style.page\" class=\"h-100 o-h\">\n    <div :class=\"$style.operate\">\n      <div class=\"flex flex-ac\">\n        <span>点位：</span>\n        <el-switch\n          v-model=\"pageOpts.dotShowStrict\"\n          active-text=\"严格\"\n          inactive-text=\"全显\"\n          inline-prompt\n        ></el-switch>\n      </div>\n      <el-link type=\"success\" @click=\"onChangeCruisePoint\">切换巡航点位</el-link>\n      <el-link type=\"primary\" size=\"small\" @click=\"onExport\">导出</el-link>\n    </div>\n\n    <t-device-scene\n      ref=\"threeSceneRef\"\n      :dev-env=\"pageOpts.devEnv\"\n      :base-url=\"pageOpts.baseUrl\"\n      :bg-color=\"pageOpts.bgColor\"\n      :bg-url=\"pageOpts.bgUrl\"\n      :sky-code=\"pageOpts.skyCode\"\n      :env=\"pageOpts.env\"\n      :colors=\"pageOpts.colors\"\n      :indexDB=\"pageOpts.indexDB\"\n      :camera=\"pageOpts.camera\"\n      :cruise=\"pageOpts.cruise\"\n      :render=\"pageOpts.render\"\n      :controls=\"pageOpts.controls\"\n      :config=\"pageOpts.config\"\n      :grid=\"pageOpts.grid\"\n      :axes=\"pageOpts.axes\"\n      :ambient-light=\"pageOpts.ambientLight\"\n      :directional-light=\"pageOpts.directionalLight\"\n      :models=\"pageOpts.models\"\n      :objects=\"pageOpts.objects\"\n      :dot-show-strict=\"pageOpts.dotShowStrict\"\n      :anchor-type=\"pageOpts.anchorType\"\n      :main-body-change-color=\"pageOpts.mainBodyChangeColor\"\n      :color-mesh-name=\"pageOpts.colorMeshName\"\n      :animation-model-type=\"pageOpts.animationModelType\"\n      :text-model-type=\"pageOpts.textModelType\"\n      :format-object=\"formatObject\"\n      :dot-update-object-call=\"dotUpdateObjectCall\"\n      :update-object-call=\"updateObjectCall\"\n      @init=\"onInit\"\n      @click-dot=\"onClickDot\"\n      @dblclick=\"onDbclick\"\n    >\n      <template #dialog=\"{ data, title }\">\n        <div :class=\"$style['dialog-wrap']\">\n          <div :class=\"$style.circle\"></div>\n          <div :class=\"$style.line\"></div>\n          <div :class=\"$style.content\">\n            <div :class=\"$style.title\">{{ title }}</div>\n            <div :class=\"$style.data\">{{ data }}</div>\n          </div>\n        </div>\n      </template>\n    </t-device-scene>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport tDeviceScene from '@/components/device-scene/index.vue'\n\nimport { getPageOpts } from './data'\nimport * as request from './request'\n\nimport { useWsStore } from '@/stores'\nimport { useResize } from '@/hooks/scene-resize'\n\nimport type { ObjectItem, ThreeModelItem } from 'three-scene/types/model'\n\nconst wsStore = useWsStore()\n\nconst pageOpts = reactive(getPageOpts())\nconst threeSceneRef = ref()\n\n// 格式化\nconst formatObject = list => {\n  return wsStore.formatData(list)\n}\n\n// 点位更新回调\nconst dotUpdateObjectCall = (obj: ObjectItem, list: ThreeModelItem[]) => {\n  const code = obj.deviceCode || ''\n  // const val = wsStore.getKeyValue( code ).value\n  const val = Math.random() * 40\n  if (val !== void 0) {\n    obj.value = val\n  }\n  const c = code.split('_')[0] || ''\n  // const so = wsStore.getRunStatus( c ) > 0\n  const so =\n    list.findIndex(it => it.data && it.data.deviceCode === c && (it.data?.status || 0) > 0) > -1\n\n  // 判断在运行则展示 不存在的则为公共参数也展示\n  if (so || ['SYS', 'CSC'].includes(c)) {\n    obj.show = true\n  } else {\n    obj.show = false\n  }\n  obj.value = Number(Number(obj.value || 0).toFixed(2))\n  return {\n    value: obj.value,\n    show: obj.show,\n    font: {\n      ...(obj.font || {}),\n      color: '#' + (0xffffff + val * 1000000).toString(16).substring(0, 6)\n    }\n  }\n}\n\n// 更新回调\nconst updateObjectCall = (_obj: ObjectItem, isRandom) => {\n  console.log(isRandom)\n  // const code = _obj.deviceCode || ''\n  // console.log( code )\n  const status = Math.random() > 0.5 ? 1 : 0\n  const error = Math.random() > 0.5 ? 1 : 0\n  const disabled = Math.random() > 0.8 ? 1 : 0\n  const ctl = Math.floor(Math.random() * 3)\n  return {\n    status: disabled > 0 ? 0 : status,\n    error: disabled > 0 ? 0 : error,\n    remote: ctl == 1 ? 1 : 0,\n    local: ctl == 2 ? 1 : 0,\n    disabled\n  }\n}\n\nconst onInit = scene => {\n  useResize(scene).resize()\n}\n\nconst onClickDot = (item, e) => {\n  console.log(item, e)\n}\n\nconst onDbclick = e => {\n  console.log(e)\n}\n\n// 切换巡航点位\nconst onChangeCruisePoint = () => {\n  const points = [\n    [450, 0.1, 350],\n    [450, 0.1, -350],\n    [-450, 0.1, -350],\n    [-450, 0.1, 350]\n  ].map(items => {\n    return items.map(t => t * (0.2 - Math.random() * 0.2 + 1))\n  })\n  pageOpts.cruise && (pageOpts.cruise.points = points)\n}\n\nconst onExport = () => threeSceneRef.value?.exportImage()\n\nonMounted(() => {\n  request.getConfig().then(res => {\n    let list = res.JsonList\n    const url = res.ModelUrl\n    list.unshift({\n      name: res.Name,\n      type: '',\n      url: url ? `${pageOpts.baseUrl}${url}` : ''\n    })\n    let json: any = {}\n    if (res.ConfigJson instanceof Object) {\n      json = res.ConfigJson\n    } else if (typeof res.ConfigJson == 'string') {\n      try {\n        json = JSON.parse(res.ConfigJson)\n      } catch (er) {}\n    }\n\n    if (json.cruise) {\n      pageOpts.cruise && (pageOpts.cruise.points = json.cruise)\n    }\n    Object.keys(json).forEach(key => {\n      pageOpts.config && (pageOpts.config[key] = json[key])\n    })\n\n    pageOpts.objects = list.map(item => {\n      if (item.type === 'COLD_ROOM_INLET') {\n        item.onClick = e => {\n          ElMessage.success({\n            message: e.name,\n            grouping: true\n          })\n        }\n      }\n      return item\n    })\n  })\n})\n</script>\n\n<style lang=\"scss\" module>\n@import './style.scss';\n</style>\n","import { Axios, Api } from '@/config'\n\nexport const getConfig = () => {\n  return Axios.get(Api.d3.device)\n}\n"],"names":["wsStore","useWsStore","pageOpts","reactive","devEnv","baseUrl","bgColor","env","colors","normal","main","text","FM","runing","error","indexDB","cache","dbName","tbName","version","camera","far","cruise","visible","points","offset","render","alpha","preserveDrawingBuffer","controls","screenSpacePanning","maxDistance","maxPolarAngle","Math","PI","grid","gridColor","centerLineColor","fork","forkColor","axes","ambientLight","intensity","directionalLight","helper","config","models","key","name","size","url","type","range","x","y","mapUrl","map","item","indexOf","objects","dotShowStrict","mainBodyChangeColor","anchorType","colorMeshName","animationModelType","textModelType","threeSceneRef","ref","formatObject","list","formatData","dotUpdateObjectCall","obj","code","deviceCode","val","random","value","c","split","findIndex","it","data","_a","status","includes","show","Number","toFixed","font","color","toString","substring","updateObjectCall","_obj","isRandom","console","log","disabled","ctl","floor","remote","local","onInit","scene","useResize","resize","onClickDot","e","onDbclick","onChangeCruisePoint","items","t","onExport","exportImage","onMounted","Axios","get","Api","d3","device","then","res","JsonList","ModelUrl","unshift","Name","json","ConfigJson","Object","JSON","parse","er","keys","forEach","onClick","ElMessage","success","message","grouping"],"mappings":"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"}