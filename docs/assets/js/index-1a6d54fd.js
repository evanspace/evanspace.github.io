var e=Object.defineProperty,t=(t,n,o)=>(((t,n,o)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o})(t,"symbol"!=typeof n?n+"":n,o),o);import{bC as n,cp as o,cO as i,cP as s,bk as a,cB as r,bh as l,bQ as c,b7 as d,bc as u,bN as h,bH as p,bi as _,bO as m,ci as g,cg as y,cQ as f,bK as b,cR as v,c9 as x,cj as w,bP as k,bn as C,e as z,Y as P,i as O,l as D,o as M,g as A,h as T,u as S,a7 as j,a8 as G,F as E,r as R,m as N,p as U,I as L,t as B,n as I,a9 as $,s as F,B as H,aP as K,ak as J,aa as V}from"./vendor-7f6cb255.js";import{d as W,h as Q,i as q,j as X,k as Y,l as Z,T as ee,u as te}from"./scene-resize-a9ec2e62.js";import{u as ne,a as oe}from"./background-abedecce.js";import{u as ie,s as se,b as ae,a as re,c as le,d as ce,e as de}from"./model-loader-59ce6813.js";import{e as ue,A as he,_ as pe}from"./index-cf96eee7.js";const _e="ROBOT",me="CHARACTER",ge="GROUND",ye="PARK_VIDEO",fe="OPEN_THE_DOOR",be="HALF_OPEN_THE_DOOR",ve="DOUBLE_OPEN_THE_DOOR",xe="WAIT_LIFT",we="SLIDING_DOOR",ke=.2,Ce=e=>new URL(Object.assign({"../assets/imgs/texttures/lensflare/lensflare0.png":Q,"../assets/imgs/texttures/lensflare/lensflare0_alpha.png":q,"../assets/imgs/texttures/lensflare/lensflare1.png":X,"../assets/imgs/texttures/lensflare/lensflare2.png":Y,"../assets/imgs/texttures/lensflare/lensflare3.png":Z})[`../assets/imgs/texttures/lensflare/${e}`],self.location).href,ze=300,{raycaster:Pe,pointer:Oe,update:De,style:Me}=ne(),{initCSS2DRender:Ae,createCSS2DDom:Te}=ie(),{createDiffusion:Se,updateDiffusion:je}=(()=>{let e;return{createDiffusion:(t=10,n=16715760,o=5)=>{const i=new a(t,t,1,1);e=new r({uniforms:{uColor:{value:new l(n)},uOpacity:{value:1},uSpeed:{value:.1},uSge:{value:o},uRadius:{value:t/2},time:{value:0}},transparent:!0,vertexShader:"\n      varying vec2 vUv;\n      void main() {\n        vUv = uv;\n        // 最终顶点位置信息=投影矩阵*模型视图矩阵*每个顶点坐标\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n      }\n    ",fragmentShader:"\n      varying vec2 vUv;\n      uniform vec3 uColor;\n      uniform float uOpacity;\n      uniform float uSpeed;\n      uniform float uSge;\n      uniform float time;\n      float PI = 3.14159265;\n      float drawCircle(float index, float range) {\n        float opacity = 1.0;\n        if (index >= 1.0 - range) {\n          opacity = 1.0 - (index - (1.0 - range)) / range;\n        } else if(index <= range) {\n          opacity = index / range;\n        }\n        return opacity;\n      }\n      float distanceTo(vec2 src, vec2 dst) {\n        float dx = src.x - dst.x;\n        float dy = src.y - dst.y;\n        float dv = dx * dx + dy * dy;\n        return sqrt(dv);\n      }\n      void main() {\n        float iTime = -time * uSpeed;\n        float opacity = 0.0;\n        float len = distanceTo(vec2(0.5, 0.5), vec2(vUv.x, vUv.y));\n\n        float size = 1.0 / uSge;\n        vec2 range = vec2(0.65, 0.75);\n        float index = mod(iTime + len, size);\n        // 中心圆\n        vec2 cRadius = vec2(0.06, 0.12);\n\n        if (index < size && len <= 0.5) {\n          float i = sin(index / size * PI);\n\n          // 处理边缘锯齿\n          if (i >= range.x && i <= range.y){\n            // 归一\n            float t = (i - range.x) / (range.y - range.x);\n            // 边缘锯齿范围\n            float r = 0.3;\n            opacity = drawCircle(t, r);\n          }\n          // 渐变\n          opacity *=  1.0 - len / 0.5;\n        };\n        gl_FragColor = vec4(uColor, uOpacity * opacity);\n      }\n    ",depthTest:!1,blending:c,side:d});return new u(i,e)},updateDiffusion:(t=1)=>{if(!e)return;const n=.001*performance.now()*t;e.uniforms.time.value=n}}})(),{createMove:Ge,moveAnimate:Ee}=(()=>{let e;const t={index:0,length:0,runing:!1,model:void 0,speed:1,endCallback:void 0,rungingCall:void 0},n=t=>null==e?void 0:e.getPoints(t);return{createMove:(o,i,s,a)=>{const r=o.position,l=Math.atan2(-i.z+r.z,i.x-r.x);o.rotation.y=.5*Math.PI+l;const c=r.distanceTo(i);let d=Math.floor(c/t.speed);d<2&&(d=2);e=new h([r,i],!1,"catmullrom",0),e=new h(n(d),!1,"catmullrom",0),t.model=o,t.index=0,t.length=d,t.rungingCall=s,t.endCallback=a,t.runing=!0},moveAnimate:(n=1)=>{if(!t.runing)return;t.index+=n;let o=t.index/t.length;o>1&&(o=1);const i=e.getPointAt(o),{x:s,y:a,z:r}=i;t.model.position.set(s,a,r),o>=1?(t.runing=!1,"function"==typeof t.endCallback&&t.endCallback(i)):"function"==typeof t.rungingCall&&t.rungingCall(i)}}})(),{addLensflare:Re}=((e={})=>{let t=W({mainTextureUrl:Ce("lensflare0.png"),minorTextureUrl:Ce("lensflare3.png")},e);const a=new n,r=a.load(t.mainTextureUrl),l=a.load(t.minorTextureUrl);return{addLensflare:(e,t,n,a)=>{const c=new o(16777215,1,2e3,0);c.color.set(e),c.position.set(t,n,a);const d=new i;return d.addElement(new s(r,700,0,c.color)),d.addElement(new s(l,60,.6)),d.addElement(new s(l,70,.7)),d.addElement(new s(l,120,.9)),d.addElement(new s(l,70,1)),c.add(d),c}}})(),Ne={}.VITE_BEFORE_STATIC_PAT||"",Ue=e=>{const t=document.createElement("video");return t.src=Ne+(e||"/oss/textures/park/sintel.mp4"),t.loop=!0,t},Le=(new n).load(Ne+"/oss/textures/park/ztny.png"),Be="FULL",Ie="NPC";class $e extends ee{constructor(e,n){super(e),t(this,"water"),t(this,"sky"),t(this,"sun"),t(this,"buildingGroup"),t(this,"anchorGroup"),t(this,"dotGroup"),t(this,"extend"),t(this,"css2DRender"),t(this,"mouseClickDiffusion"),t(this,"character"),t(this,"clock"),t(this,"currentSight"),t(this,"historyTarget"),t(this,"historyCameraPosition"),t(this,"animateModels"),this.extend=n,this.css2DRender=Ae(this.options,this.container),this.css2DRender.domElement.className="three-scene__dot-wrap",this.mouseClickDiffusion=Se(4,void 0,6),this.mouseClickDiffusion.rotation.x=.5*-Math.PI,this.mouseClickDiffusion.position.y=.5,this.mouseClickDiffusion.visible=!1,this.addObject(this.mouseClickDiffusion),this.clock=new p,this.currentSight=Be,this.historyTarget=new _,this.historyCameraPosition=new _,this.animateModels=[],this.bindEvent(),this.addBuildingGroup(),this.addAnchorGroup(),this.addDotGroup(),this.addLensflare()}addBuildingGroup(){const e=new m;e.name="建筑组",this.buildingGroup=e,this.addObject(e)}clearBuilding(){this.buildingGroup&&this.disposeObj(this.buildingGroup),this.animateModels=[],this.addBuildingGroup(),this.clearAnchor(),this.clearDot()}addBuilding(...e){this.buildingGroup&&this.buildingGroup.add(...e)}addAnchorGroup(){const e=new m;e.name="锚点组",this.anchorGroup=e,this.addObject(e)}clearAnchor(){this.anchorGroup&&this.disposeObj(this.anchorGroup),this.addAnchorGroup()}addAnchor(...e){this.anchorGroup&&this.anchorGroup.add(...e)}addDotGroup(){const e=new m;e.name="点位组",this.dotGroup=e,this.scene.add(e)}clearDot(){this.dotGroup&&this.disposeObj(this.dotGroup),this.addDotGroup()}addDot(e,t){const n=e.position,{size:o,color:i}=e.font||{},{x:s=0,y:a=0,z:r=0}=n||{},l=Te({name:`\n        <div class="bg"></div>\n        <span class="inner" style="${null!=o?`font-size: ${"string"==typeof o?o:o+"px"};`:""} ${null!=i?`color: ${i}`:""}"></span>\n      `,className:"dot-2D-label",position:[s,a,r],onClick:t});return l.name=e.name,l.data=e,l._position_={x:s,y:a,z:r},this.dotGroup.add(l),l}addLensflare(){const{position:e=[500,1e3,800],color:t=16777215}=this.options.directionalLight,[o,i,s]=e,r=Re(t,o,i,s);this.addObject(r),this.sun=new _(o,i,s),this.water=(()=>{const e=new a(900,50),t=new w(e,{textureWidth:512,textureHeight:512,waterNormals:(new n).load(Ne+"/oss/textures/waternormals.jpg",(e=>{e.wrapS=e.wrapT=k})),sunDirection:new _,sunColor:15732480,waterColor:92299,distortionScale:3.5});return t.rotation.x=-Math.PI/2,t.rotation.z=.05*Math.PI,t.material.uniforms.size.value=.5,t.position.y=-1,t.position.x=65,t.position.z=230,t})(),this.addObject(this.water)}updateSkyAndSun(){const{water:e,sky:t,sun:n}=this,o=t.material.uniforms,i=10,s=1,a=.005,r=.2,l=4,c=180,d=null;o.turbidity.value=i,o.rayleigh.value=s,o.mieCoefficient.value=a,o.mieDirectionalG.value=r;const u=C.degToRad(90-l),h=C.degToRad(c);n.setFromSphericalCoords(1,u,h),t.material.uniforms.sunPosition.value.copy(n),e.material.uniforms.sunDirection.value.copy(n).normalize();const p=new g(this.renderer);this.scene.environment=p.fromScene(t).texture,this.renderer.toneMappingExposure=d}addCharacter(e,t){const{x:n,y:o,z:i}=t;e.position.set(n,o,i),this.character=e;const s=e.animations,a=new y(e),r={};for(let c=0;c<s.length;c++){const e=s[c],t=a.clipAction(e);r[e.name]=t}r.Dance.play();const l=r.Walking;e.extra={mixer:a,actions:r,runging:l},this.addObject(e)}toggleSight(){if(this.options.cruise.runing)return void this.toggleCruise(!0);const e=this.currentSight==Be?Ie:Be;this.currentSight=e;const t=e===Ie;this.controls.maxDistance=t?15:150,this.controls.screenSpacePanning=!t,this.controls.enablePan=!t,this.controls.maxPolarAngle=Math.PI*(t?.49:.45);const n=this.controls.target,o=this.character.position;if(t){const{x:e,y:t,z:i}=n;this.historyTarget=new _(e,t,i);const{x:s,y:a,z:r}=o;this.historyCameraPosition=new _(s,a,r),this.camera.lookAt(new _(s,a+3,r))}else{const{x:e,y:t,z:n}=this.historyCameraPosition;this.camera.position.set(e,t,n),this.camera.lookAt(o)}const{x:i,y:s,z:a}=t?o:this.historyTarget;n.set(i,s,a)}setControlTarget(e){const{x:t,y:n,z:o}=e;this.controls.target.set(t,n+3,o),this.camera.lookAt(this.controls.target)}mouseClickGround(e){if(this.currentSight!==Ie)return Promise.reject();const t=this.character;if(!t)return Promise.reject();const{runing:n}=this.options.cruise;if(n)return Promise.reject();const o=e.point,i=this.mouseClickDiffusion,{runging:s}=t.extra;s.play();const{x:a,y:r,z:l}=o;return i.position.set(a,r,l),i.visible=!0,new Promise((e=>{Ge(t,o,(e=>{this.setControlTarget(e)}),(n=>{s.stop(),i.visible=!1,e(t)}))}))}addVideoMaterial(){const e=Ue(),t=new f(e),n=new a(10,5),o=new b({map:Le}),i=new u(n,o);i.__video_texture__=t,i.__cover_texture__=Le,i.position.set(-75,2.66,133),i.name="small_video",i.__video__=e,this.addObject(i);const s=new v(new a(20,20),{clipBias:.003,textureWidth:window.innerWidth*window.devicePixelRatio,textureHeight:window.innerHeight*window.devicePixelRatio,color:11908533});s.position.set(-75,.17,160),s.rotateX(-Math.PI/2),this.addObject(s);const r=this.scene.getObjectByName("大屏幕");if(!r)return;const l=Ue(),c=new f(l);r.__video_texture__=c,r.__cover_texture__=Le.clone(),r.material=o.clone(),r.__video__=l}videoPlay(e){const t=this.scene.getObjectByName(e.data.bind);if(t&&t.__video__){const e=t.__video__;e.paused?(t.material.map=t.__video_texture__,null==e||e.play()):(null==e||e.pause(),t.material.map=t.__cover_texture__)}}openTheDoor(e,t){const n=this.scene.getObjectByName(e.data.bind);if(n)if(t)n.__open__=!n.__open__,new x(n.rotation).to({z:n.__open__?.5*Math.PI:0},1500).delay(0).start();else{const e=n.position;if(null==n.__open__){const{x:t,y:o,z:i}=e;n.__position__=new _(t,o,i)}n.__open__=!n.__open__,new x(e).to({x:n.__position__.x+(n.__open__?800:0)},1500).delay(0).start()}}openTheDoubleSlidingDoor(e,t=400,n){const o=this.scene.getObjectByName(e.data.bind);if(!o)return Promise.reject();const i=o.children.find((e=>e.name.indexOf("左")>-1)),s=o.children.find((e=>e.name.indexOf("右")>-1)),a=i.position,r=s.position;if(null==o.__open__){const{x:e,y:t,z:n}=a,{x:o,y:l,z:c}=r;i.__position__=new _(e,t,n),s.__position__=new _(o,l,c)}return o.__open__=void 0!==n?n:!o.__open__,new Promise((e=>{const n=s.__position__.x+(o.__open__?t:0);if(r.x===n)return e(o);new x(a).to({x:i.__position__.x+(o.__open__?-t:0)},1500).delay(0).start(),new x(r).to({x:n},1500).delay(0).start().onComplete((()=>{e(o)}))}))}openTheSlidingDoor(e){const t=this.scene.getObjectByName(e.data.bind);if(!t)return;const n=t.children.find((e=>e.name.indexOf("左")>-1)),o=n.position;if(null==t.__open__){const{x:e,y:t,z:i}=o;n.__position__=new _(e,t,i)}t.__open__=!t.__open__;const i=n.__position__.y+(t.__open__?4.5:0);o.y!==i&&new x(o).to({y:n.__position__.y+(t.__open__?4.5:0)},1500).delay(0).start()}waitLift(e,t){var n;const o="单元1号电梯",i=this.scene.getObjectByName(o),s=null==(n=e.data)?void 0:n.to;if(!i||!s)return;const a=i.position;if(s.y!=a.y){const n=i.__bind_lift__;void 0!==n&&this.openTheDoubleSlidingDoor({data:{bind:n}},200,!1),this.openTheDoubleSlidingDoor({data:{bind:o}},4,!1).then((()=>{new x(a).to({y:s.y},1500).delay(0).start().onUpdate((e=>{t&&(this.character.position.y=e.y,this.camera.position.y=e.y,this.setControlTarget(this.character.position))})).onComplete((()=>{i.__bind_lift__=e.data.bind,this.openLift(e,o)}))}))}else this.openLift(e,o)}openLift(e,t){this.openTheDoubleSlidingDoor(e,200),this.openTheDoubleSlidingDoor({data:{bind:t}},4)}addModelAnimate(e,t=[],n=!0,o=1){if(!t.length)return;const i=new y(e),s=t.reduce(((e,t)=>{const s=t.name||"";return e[s]=i.clipAction(t),n&&e[s].play(),e[s].timeScale=o,e}),{});e.__action__=s,e.__mixer__=i,this.animateModels.push(e)}modelAnimate(){this.css2DRender.render(this.scene,this.camera),"function"==typeof this.extend.animateCall&&this.extend.animateCall(),this.water.material.uniforms.time.value+=1/60,this.mouseClickDiffusion.visible&&je();let e=this.clock.getDelta();if(this.character){this.character.extra.mixer.update(e),Ee(.5)}this.restoreAnchorMaterial(),this.animateModels.length&&this.animateModels.forEach((t=>{t.__mixer__.update(e)}))}onPointerMove(e){this.checkIntersectObjects(e)}onPointerUp(e){var t;super.onPointerUp(e);const n=e.timeStamp-this.pointer.tsp<ze;2==e.button?n&&"function"==typeof(null==(t=this.extend)?void 0:t.onClickRight)&&this.extend.onClickRight(e):0==e.button?n&&this.checkIntersectObjects(e):e.button}checkIntersectObjects(e){var t,n,o;const i=this.container,s=this.options.scale;De(e,i,s);let a="pointerdown"==e.type||"pointerup"==e.type;const r=this.buildingGroup.children.filter((e=>e.visible&&(a||e.__ground__))).concat(this.anchorGroup.children);Pe.setFromCamera(Oe,this.camera);let l=Pe.intersectObjects(r,a);if(i.style.cursor=!a&&l.length>0?"pointer":"auto",a)if(l.length){const e=l[0],o=e.object,i="string"==typeof o.name&&(this.extend.groundMeshName||[]).some((e=>o.name.indexOf(e)>-1)),s=this.findParentGroupGroup(o);if(i&&"function"==typeof(null==(t=this.extend)?void 0:t.onClickGround)&&this.extend.onClickGround(s,e),!s)return;"function"==typeof(null==(n=this.extend)?void 0:n.onClickLeft)&&this.extend.onClickLeft(s,e)}else"function"==typeof(null==(o=this.extend)?void 0:o.onClickLeft)&&this.extend.onClickLeft();else this.hoverAnchor(l)}hoverAnchor(e){if("function"==typeof this.extend.onHoverAnchor&&this.extend.onHoverAnchor(e[0],Me),e.length){const t=e[0].object;if(!t._isAnchor_)return;const n=t.material;void 0===t.__mat_color__&&(t.__mat_color__=n.color),n.color=new l(16715760),this.anchorGroup.children.forEach((e=>{e.__change_color__=e.uuid===t.uuid}))}else this.anchorGroup.children.forEach((e=>{e.__change_color__=!1}))}restoreAnchorMaterial(){this.anchorGroup.traverse((e=>{e.isSprite&&!e.__change_color__&&e.__mat_color__&&(e.material.color=e.__mat_color__)}))}findParentGroupGroup(e){const t=e=>{if(e._isBuilding_)return e;let n=e.parent;return n?n&&n._isBuilding_?n:t(n):void 0};return t(e)}getFloor(){return this.buildingGroup.children.filter((e=>e._isFloor_))}hideOmitFloor(e){this.buildingGroup.children.forEach((t=>{t.visible=t._isFloor_||e}))}getAll(){return this.buildingGroup.children.concat(this.dotGroup.children)}getFlowMark(e){return this.getAll().filter((t=>{var n;return(null==(n=t.data)?void 0:n.followMark)===e}))}getAnimTargetPos(e,t,n){const o=t||e.to||{x:-104,y:7,z:58},i=n||e.target||{x:0,y:0,z:0};return this.controls.target.set(i.x,i.y,i.z),o}getPosition(){}resize(){super.resize();const{width:e,height:t}=this.options;this.css2DRender.setSize(e,t)}}const Fe=(e,t)=>{const n=40*Math.random();return void 0!==n&&(e.value=n),e.show=Math.random()>.5,e.value=Number(Number(e.value||0).toFixed(2)),{value:e.value,show:e.show,font:{...e.font||{},color:"#"+(16777215+1e6*n).toString(16).substring(0,6)}}},He=(e,t)=>{const n=Math.random()>.5?1:0,o=Math.random()>.5?1:0,i=Math.random()>.8?1:0,s=Math.floor(3*Math.random());return{status:i>0?0:n,error:i>0?0:o,remote:1==s?1:0,local:2==s?1:0,disabled:i}},Ke={normal:{color:8954293,main:[8954293,2698801],text:12180479,FM:6319220},runing:{color:3045368,main:3045368,FM:422935},error:{color:12717056,main:11879461,FM:15215899}},Je={class:"scene-operation"},Ve=["innerHTML"],We=pe(z({__name:"index",setup(e){const t=P({devEnv:!0,baseUrl:"",bgColor:"",skyCode:"221",env:"/oss/textures/hdr/3.hdr",dotKey:"DOT",dotShowStrict:!1,colorMeshName:[],floorModelType:["FLOOR_COMMON"],anchorType:["PARK_CAMERA","PARK_ROOM_INLET",ye,fe,be,ve,xe,we],carType:["car_tanker","car_goods","car_trailer","car_crane"],animationModelType:["building_commercial_2"],colors:{},config:{},cruise:{visible:!0,auto:!0,mapUrl:"/oss/textures/cruise/line2.png",repeat:[.1,1],width:2,segment:100,tension:.1,speed:20,mapSpeed:.01,points:[[-89.57,ke,179.4],[-52.28,ke,179.4],[-52.28,ke,123.05],[-4.43,ke,123.05],[-4.43,ke,99.18],[6.26,ke,99.18],[6.26,ke,153.83],[92.71,ke,153.83],[147.75,ke,148.23],[147.75,ke,135.93],[144.21,ke,133.13],[144.21,ke,126.7],[86.6,ke,126.7],[86.6,ke,152.35],[77.55,ke,152.35],[77.55,ke,-137.3],[3.34,ke,-137.3],[3.34,ke,-52.04],[-89.57,ke,-52.04]],offset:1.8,animateBack:(e,t,n,o)=>{if(g){(o+=.02)>1&&(o-=1),e=((e,t=0)=>new _(e.x,e.y+t,e.z))(n.getPointAt(o));let i=o+.001;i>1&&(i-=1),t=n.getPointAt(i),g.position.set(e.x,.16,e.z);const s=Math.atan2(-t.z+e.z,t.x-e.x);g.rotation.z=.5*Math.PI+s}}},models:[{key:"SCENE",name:"场景",size:14.7,url:"/场景.glb"},{key:ge,name:"地面",size:4,url:"/地面.glb"},{key:"PARKING_SPACE",name:"停车位",size:.06,url:"/停车位.glb"},{key:"building_1",name:"楼栋1",size:1.2,url:"/楼栋1.glb"},{key:"building_2",name:"楼栋2",size:2,url:"/楼栋2.glb"},{key:"building_3",name:"楼栋3",size:1.6,url:"/楼栋3.glb"},{key:"building_4",name:"楼栋4",size:2.8,url:"/楼栋4.glb"},{key:"building_5",name:"楼栋5",size:1.6,url:"/楼栋5.glb"},{key:"building_warehouse",name:"仓库",size:.7,url:"/仓库.glb"},{key:"building_commercial_1",name:"商业楼1",size:.6,url:"/商业楼1.glb"},{key:"building_commercial_2",name:"商业楼2",size:19,url:"/商业楼2.glb"},{key:"building_commercial_3",name:"商业楼3",size:.6,url:"/商业楼3.glb"},{key:"building_commercial_4",name:"电梯房",size:9.6,url:"/电梯房.glb"},{key:"building_commercial_5",name:"现代门窗",size:78,url:"/现代门窗.glb"},{key:"car_tanker",name:"油罐车",size:1,url:"/油罐车.glb"},{key:"car_goods",name:"货车",size:6.4,url:"/货车.glb"},{key:"car_trailer",name:"拖车",size:2,url:"/拖车.glb"},{key:"car_crane",name:"吊车",size:4.4,url:"/吊车.glb"},{key:"car_aodi",name:"奥迪",size:1,url:"/奥迪.glb"},{key:"car_kaidilake",name:"凯迪拉克",size:1.6,url:"/凯迪拉克.glb"},{key:"ARBOR_ONE",name:"小树",size:2,url:"/小树.glb"},{key:"FENCE",name:"围栏",size:.8,url:"/围栏.glb"},{key:"HANDRAIL",name:"栏杆",size:.1,url:"/栏杆.glb"},{key:_e,name:"机器人",size:.3,url:"/机器人.glb"},{key:me,name:"人物",size:2.2,url:"/RobotExpressive.glb"},{key:"PARK_CAMERA",name:"摄像头",type:"sprite",size:1,range:{x:18.5,y:38.5},mapUrl:"/sxt.png"},{key:ye,name:"视频播放",type:"sprite",size:1,range:{x:1,y:1},mapUrl:"/video.png"},{key:fe,name:"开门",type:"sprite",size:1,range:{x:1,y:1},mapUrl:"/open.png"},{key:be,name:"半开门",type:"sprite",size:1,range:{x:1,y:1},mapUrl:"/open.png"},{key:ve,name:"双开门",type:"sprite",size:1,range:{x:1,y:1},mapUrl:"/open.png"},{key:we,name:"推拉门",type:"sprite",size:1,range:{x:1,y:1},mapUrl:"/open.png"},{key:xe,name:"电梯门",type:"sprite",size:1,range:{x:1,y:1},mapUrl:"/lift.png"}].map((e=>(e.url&&(e.url="/oss/model/park"+e.url),e.mapUrl&&(e.mapUrl="/oss/textures/park"+e.mapUrl),e)))});const n=P({active:1,show:!1,list:[{name:"一楼",key:1,y:.2},{name:"二楼",key:2,y:13.8},{name:"三楼",key:3,y:19.83},{name:"五楼",key:5,y:31.76}]}),o=P({show:!1,style:{left:0,top:0},msg:""}),i=O(),s=W(Ke,t.colors),{changeBackground:a,backgroundLoad:r}=oe(),{progress:l,loadModels:c,getModel:d}=re({baseUrl:t.baseUrl,colors:s,colorMeshName:t.colorMeshName,indexDB:{cache:!0,dbName:"THREE__PARK__DB",tbName:"TB",version:61}}),u={env:"/oss/textures/hdr/3.hdr",controls:{maxDistance:150,maxPolarAngle:.45*Math.PI,screenSpacePanning:!1,enablePan:!1},camera:{position:[-85.7,3.6,208.6]},cruise:t.cruise,grid:{visible:!1},axes:{visible:!0},directionalLight:{visible:!0,intensity:2}},h=e=>{var n;const o=e.data;{const e=Fe(o,v.buildingGroup);"object"==typeof e&&Object.keys(e).forEach((t=>{o[t]=e[t]}))}e.visible=o.show||!t.dotShowStrict;const i=null==(n=e.element)?void 0:n.getElementsByClassName("inner")[0];if(i){const{size:e,color:t}=o.font||{};null!=e&&(i.style.fontSize="string"==typeof e?e:e+"px"),null!=t&&(i.style.color=t),i.textContent=`${o.value||0}${o.unit}`}},p=async e=>{if(!e)return;const{type:n,url:o}=e,i=d(n);if(!i)return void(o||n===t.dotKey&&(e=>{h(v.addDot(e,(e=>{})))})(e));const{floorModelType:s=[],anchorType:a=[],carType:r=[],animationModelType:l=[]}=t;let c=ce(i);const{position:u,scale:p,rotation:_}=de(c,e),[m,g,y]=u;return c.scale.set(...p),c.position.set(m,g,y),c.rotation.set(..._),c._isBuilding_=!0,c.data=e,r.includes(n)&&(e=>{const t=e.data,{to:n,position:o}=t;if(!n)return;const i=C.randInt(0,1e4);e.tween1=new x(e.position).to(n,3e4).delay(i).onUpdate((({x:t,y:n,z:o})=>{e.position.x=t,e.position.y=n,e.position.z=o})),e.tween2=new x(o).to(n,3e4).onUpdate((({x:t,y:n,z:o})=>{e.position.x=t,e.position.y=n,e.position.z=o})),e.tween1.chain(e.tween2),e.tween2.chain(e.tween1),e.tween1.start()})(c),l.includes(n)&&v.addModelAnimate(c,i.animations,!0,.1),s.includes(n)&&(c._position_={x:m,y:g,z:y},c._isFloor_=!0),c.__ground__=n===ge,a.includes(n)?(c._isAnchor_=!0,v.addAnchor(c)):v.addBuilding(c),Promise.resolve()},m=async()=>{l.percentage=100,l.show=!1,v.clearBuilding(),await V(),await(()=>{let e=0,t=y.value.length;return new Promise((n=>{if(0==t)return n(null);const o=async()=>{const i=y.value[e];await p(i),e++,e<t?o():n(e)};o()}))})(),v.setCruisePoint(t.cruise.points);const e=v.getAnimTargetPos(t.config||{});le(v.camera,e,v.controls.target).then((()=>{v.controlSave()}))};let g;const y=O([]),f=()=>{c(t.models,(()=>{ue.get(he.d3.park).then((async e=>{let n={};if(e.ConfigJson instanceof Object)n=e.ConfigJson;else if("string"==typeof e.ConfigJson)try{n=JSON.parse(e.ConfigJson)}catch(o){}y.value=e.JsonList,Object.keys(n).forEach((e=>{t.config&&(t.config[e]=n[e])})),await m(),g=d(_e),g.position.z=.16,g.rotation.z=.5*Math.PI,v.addObject(g),(()=>{const e=d(me);e.traverse((e=>{e.isMesh&&(e.castShadow=!0)}));const t={x:-80.6,y:.16,z:193.4};t.x=98.4,t.z=-87,v.addCharacter(e,t)})(),v.addVideoMaterial()}))}))},b=e=>{const n=[];v.getAll().forEach(((e,o)=>{if(!e.data)return;const i=e.data;let a=i.type;if(a===t.dotKey)return void h(e);{const e=He();if(!e)return;Object.keys(e).forEach((t=>{i[t]=e[t]}))}n.push(K(i));let{status:r=0,error:l=0,remote:c=0,local:d=0,disabled:u=0}=i;const p=s[l>0?"error":r>0?"runing":"normal"];(e=>{let{el:t,type:n,colorObj:o,color:i,paused:s}=e,a=ae(i);i=a[0];const r=t.extra;r&&(r.action&&(r.action.paused=s),null!=i)&&(r.meshs||[]).forEach((e=>{se(e,i)}))})({type:a,el:e,colorObj:p,color:null!=p[a]?p[a]:p.color,paused:0==r,error:l>0,remote:c>0,local:d>0,disabled:u>0})}))};let v;return D((()=>{u.container=i.value;const e="轿厢-ground";v=new $e(u,{groundMeshName:["Plane001","Plane002","Plane003","楼板","mesh_0_4","ground",e],onDblclick:e=>{},onClickLeft(e,t){if(e&&e.data){const t=e.data;switch(null==t?void 0:t.type){case ye:v.videoPlay(e);break;case fe:case be:v.openTheDoor(e,t.type===be);break;case ve:v.openTheDoubleSlidingDoor(e);break;case xe:v.waitLift(e);break;case we:v.openTheSlidingDoor(e)}}},onClickGround:(t,o)=>{v.mouseClickGround(o).then((t=>{n.show=o.object.name===e}))},onClickRight:e=>{},onHoverAnchor:(e,t)=>{const n=!!e&&e.object._isAnchor_;if(o.show=n,n){o.style.top=t.top,o.style.left=t.left;const n=e.object.data;o.msg=`\n          <p>${n.name}</p>\n          <p>类型：${n.type}</p>\n          <p>绑定：${n.bind}</p>\n        `}}}),v.run(),te(v).resize(),f(),r(v,t.skyCode)})),(e,s)=>{const r=J;return M(),A("div",{class:I(e.$style.page)},[T("div",Je,[T("div",{class:"btn",onClick:s[0]||(s[0]=()=>b())},"随机更新"),T("div",{class:"btn",onClick:s[1]||(s[1]=()=>S(v).toggleSight())},"人物视角切换"),T("div",{class:"btn",onClick:s[2]||(s[2]=()=>{var e;return null==(e=S(v))?void 0:e.toggleCruise()})},"定点巡航"),T("div",{class:"btn",onClick:s[3]||(s[3]=()=>{var e;return null==(e=S(v))?void 0:e.getPosition()})},"场景坐标"),T("div",{class:"btn",onClick:s[4]||(s[4]=()=>S(a)(S(v)))},"切换背景"),T("div",{class:"btn",onClick:s[5]||(s[5]=()=>{var e;return null==(e=S(v))?void 0:e.controlReset()})},"控制器重置"),T("div",{class:"btn",onClick:s[6]||(s[6]=()=>{var e;return null==(e=S(v))?void 0:e.toggleCruiseDepthTest()})},"巡航深度")]),j(T("div",{class:I(e.$style["floor-select"])},[(M(!0),A(E,null,R(S(n).list,(e=>(M(),N(r,{type:"primary",disabled:S(n).active===e.key,onClick:t=>(e=>{n.active=e.key;const t="电梯门"+e.key;v.waitLift({data:{bind:t,to:{y:e.y}}},!0)})(e)},{default:U((()=>[L(B(e.name),1)])),_:2},1032,["disabled","onClick"])))),256))],2),[[G,S(n).show]]),T("div",{class:I(e.$style.container),ref_key:"containerRef",ref:i},null,2),S(l).show?(M(),A("div",{key:0,class:I(["loading",e.$style.loading]),style:$({"--bg-color":S(t).bgColor?String(S(t).bgColor):""}),onDblclick:s[7]||(s[7]=F((()=>{}),["stop"]))},[T("div",{class:I(e.$style.progress),style:$({"--percentage":S(l).percentage+"%"})},[T("div",{class:I(e.$style["bar-out"])},[T("div",{class:I(e.$style.bar)},null,2)],2),T("div",{class:I(e.$style.text)},B(S(l).percentage)+"%",3)],6)],38)):H("",!0),S(o).show?(M(),A("div",{key:1,class:I(e.$style.tip),style:$({left:S(o).style.left+"px",top:S(o).style.top+"px"})},[T("div",{class:I(e.$style.msg),innerHTML:S(o).msg},null,10,Ve)],6)):H("",!0)],2)}}}),[["__cssModules",{$style:{page:"_page_2ho4u_2",container:"_container_2ho4u_9","floor-select":"_floor-select_2ho4u_13",tip:"_tip_2ho4u_19",msg:"_msg_2ho4u_27",loading:"_loading_2ho4u_32",progress:"_progress_2ho4u_47","bar-out":"_bar-out_2ho4u_51",bar:"_bar_2ho4u_51","striped-flow":"_striped-flow_2ho4u_1",text:"_text_2ho4u_75"}}]]);export{We as default};
