var e,t,i=Object.defineProperty,s=(e,t,s)=>(((e,t,s)=>{t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s),n=(e,t,i)=>(((e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)})(e,t,"access private method"),i);import{bm as o,bn as r,b4 as a,bw as c,bx as h,b2 as d,ch as l,by as p,b3 as u,bp as b,bq as m,br as w,bs as g,bt as f,bu as v,bv as y,bA as C,c1 as x,b9 as k,bb as E,aU as j,ci as L,bf as A,bd as P,be as S,b0 as O,aW as M,cj as T,aX as U,aY as z,bc as D,bk as F,bl as G,aZ as B,ba as H,w as R,ad as W}from"./vendor-eaf8386d.js";import{u as I}from"./common-164461ea.js";const Z=e=>((e,t)=>Object.prototype.toString.call(t)===`[object ${e}]`)("Object",e),_=(e,t=new Map)=>{if(null!=e&&Z(e)){let i=t.get(e);if(i)return i;const s=Array.isArray(e);let n=s?[]:{};return i=t.set(e,n),s?e.forEach(((e,t)=>{n[t]=_(e,i)})):Object.keys(e).forEach((t=>{Z(n[t])?n[t]=_(e[t],i):n[t]=e[t]})),n}return e},q=(e,t)=>{e=_(e);for(let i in t)i in e&&Z(t[i])&&Z(e[i])?e[i]=q(e[i],t[i]):e[i]=t[i];return e},X=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,$=(e,t="")=>Array.isArray(e)?e.map((e=>$(e,t))):!(e=>(!e&&(e=""),!!/^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/)[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,}(\/\S*)?$/.test(e)))(e)&&e.indexOf(t)<0?t+e:e,N=(e=0,t=2)=>{if(Math.abs(e)>=1e8){return 1*(e/1e8).toFixed(t)+"亿"}if(Math.abs(e)>=1e4){return 1*(e/1e4).toFixed(t)+"万"}return 1*e.toFixed(t)},Y={container:document.body,width:window.innerWidth,height:window.innerHeight,baseUrl:"",bgColor:null,bgUrl:null,env:null,scale:1,fog:{visible:!1,near:100,far:1e3},render:{antialias:!0,logarithmicDepthBuffer:!0,preserveDrawingBuffer:!1},controls:{visible:!0,enableDamping:!1,dampingFactor:.25,autoRotate:!1,enableZoom:!0,enablePan:!0,screenSpacePanning:!0,minDistance:1,maxDistance:2e3},ambientLight:{visible:!0,color:16777215,intensity:1.5},directionalLight:{visible:!0,helper:!1,position:[500,1e3,800],position2:[-500,800,-800],light2:!0,color:16777215,intensity:1.5},camera:{helper:!1,near:1,far:1e4,position:[-350,510,700]},cruise:{visible:!1,enabled:!1,runing:!1,helper:!1,points:[],segment:2,tension:0,baseUrl:"",repeat:[.1,1],width:15,speed:1,mapSpeed:.006,offset:10,factor:1,index:0},grid:{visible:!1,opacity:.3,transparent:!0,width:800,divisions:80,centerLineColor:10592673,gridColor:10592673,fork:!1,forkSize:1.4,forkColor:10592673},axes:{visible:!1,size:50}},{createCruise:J,cruiseAnimate:K,updateCruise:Q,bindEvent:V,removeEvent:ee}=(()=>{let e,t,i,s={visible:!0,enabled:!1,runing:!1,helper:!1,points:[],segment:2,tension:0,baseUrl:"",mapUrl:new URL("/imgs/arrow-388f6ce2.png",self.location).href,repeat:[.1,1],width:15,speed:1,mapSpeed:.006,offset:10,factor:1,index:0};const n=(t,n)=>{i=new u(new b(2),new m({color:0,opacity:.8,depthTest:!1,transparent:!0})),t.add(i);const o=(new w).setFromPoints(n.concat(n[0])),r=new g({color:255,opacity:1,depthTest:!1,transparent:!0}),a=new f(o,r);t.add(a);const c=new v(e,100,s.width/2,3,!0),h=new y({color:16711935,opacity:.1,depthTest:!1,transparent:!0}),d=new u(c,h),l=new m({color:16715760,opacity:.3,wireframe:!0,depthTest:!1,transparent:!0}),p=new u(c,l);d.add(p),t.add(d)},x=()=>1e3*(s.segment??2),k=(e,t)=>new o(t.x,t.y+e,t.z),E=e=>{if(!s.enabled)return;switch(e.keyCode){case 38:case 87:s.runing?(s.factor*=1.5,s.factor>10&&(s.factor=10)):s.index+=5;break;case 83:case 40:s.runing||(s.index-=5,s.index<0&&(s.index=x()))}},j=e=>{if(!s.enabled)return;s.factor=1;switch(e.keyCode){case 32:s.runing=!s.runing;break;case 38:case 87:s.runing||(s.index+=10);break;case 83:case 40:s.runing||(s.index-=10,s.index<0&&(s.index=x()))}};return{createCruise:(i={},b)=>{s=q(s,i);const{points:m,tension:w,mapUrl:g,baseUrl:f,repeat:v,width:y,helper:x}=s,k=[];for(let e=0;e<m.length;e++){const t=m[e];k.push(new o(t[0],t[1],t[2]))}e=new r(k,!0,"catmullrom",w??0);const E=new a;t=(new c).load($(g,f),(e=>{e.wrapS=h,e.repeat.x=v[0],e.repeat.y=v[1],e.anisotropy=b.capabilities.getMaxAnisotropy()}));const j=new d({map:t,opacity:.5,transparent:!0,depthTest:!1,blending:l}),L=new o(0,1,0),A=new C;A.set(e.getPoints(1e3),5,1,L,!1);const P=new p;P.update(A,{width:y,arrow:!1});const S=new u(P,j);return E.add(S),E.name="cruise",x&&n(E,k),E.renderOrder=99,E},updateCruise:(e={})=>{s=q(s,e)},cruiseAnimate:n=>{if(!n)return;if(!e)return;const{mapSpeed:o,speed:r,factor:a,enabled:c,runing:h,offset:d,helper:l}=s;t&&(t.offset.x-=o),h&&c&&(s.index+=a*r);const p=x(),u=s.index%p/p,b=e.getPointAt(u);if(l&&i){const e=k(d,b);i.position.copy(e)}const m=.03;let w=u-m;u<m&&(w=u+.97);const g=k(d,e.getPointAt(w));n.position.copy(g),n.lookAt(k(d,b))},bindEvent:()=>{window.addEventListener("keydown",E,!1),window.addEventListener("keyup",j,!1)},removeEvent:()=>{window.removeEventListener("keyup",j),window.removeEventListener("keydown",E)}}})(),{createFork:te}={createFork:(e={})=>{const{width:t=800,divisions:i=80,forkSize:s=1.4,forkColor:n=10592673}=e;let o=t/i,r=-t/2;const c=new a;for(let a=0;a<=i;a++)for(let e=0;e<=i;e++){const t=r+a*o,i=r+e*o,h=new x(s,s/5),d=new y({color:n,transparent:!0,opacity:.9}),l=new u(h,d);l.rotateX(.5*-Math.PI),l.position.set(t,0,i);const p=l.clone();p.rotateZ(.5*Math.PI),c.add(l,p)}return c}},ie=class i{constructor(t={}){((e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)})(this,e),s(this,"options"),s(this,"container"),s(this,"scene"),s(this,"renderer"),s(this,"baseCamera"),s(this,"cruiseCamera"),s(this,"cruiseGroup"),s(this,"controls"),s(this,"grid"),s(this,"animationId"),s(this,"pointer");const n=Y;var o;this.options=q(n,t),i.total++,this.pointer={tsp:0,isClick:!1},(o=this.options.container)&&("object"==typeof HTMLElement?o instanceof HTMLElement:o&&"object"==typeof o&&1===o.nodeType&&"string"==typeof o.nodeName)?this.container=this.options.container:this.container=document.querySelector(this.options.container),this.options.width=this.container.offsetWidth,this.options.height=this.container.offsetHeight,this.scene=new k,this.renderer=this.initRenderer(),this.init(),this.baseCamera=this.initCamera(),this.controls=this.initControls(),this.initCruise()}get camera(){const{visible:e,runing:t}=this.options.cruise;return e&&t?this.cruiseCamera:this.baseCamera}init(){this.initLight(),this.initGrid(),this.initAxes(),this.initModel()}run(){this.loop()}loop(){this.animationId=window.requestAnimationFrame((()=>{this.loop()})),this.animate(),this.modelAnimate()}animate(){this.renderer&&this.renderer.render(this.scene,this.camera),this.options.controls.visible&&this.controls.update(),K(this.cruiseCamera),E()}initModel(){}modelAnimate(){}initRenderer(){const{width:e,height:t,bgColor:i,bgUrl:s,env:n}=this.options,o=new j(this.options.render);if(n&&this.setEnvironment(n),s?this.setBgTexture(s):this.setBgColor(i),this.options.fog.visible){const{color:e,near:t,far:i}=this.options.fog;this.scene.fog=new L(e??this.scene.background,t,i)}return o.sortObjects=!0,o.shadowMap.enabled=!0,o.shadowMap.type=A,o.setSize(e,t),o.setPixelRatio(window.devicePixelRatio),this.container.appendChild(o.domElement),o}initLight(){const{ambientLight:e,directionalLight:t}=this.options;if(e.visible){const t=new P(e.color,e.intensity);this.addObject(t)}if(t.visible){const e=this.createDirectionalLight();if(e.position.set(...t.position),this.addObject(e),t.helper){const t=new S(e,1);this.addObject(t)}if(t.light2){const e=this.createDirectionalLight(!1);if(e.position.set(...t.position2),this.addObject(e),t.helper){const t=new S(e,1);this.addObject(t)}}}}createDirectionalLight(e=!0,t=2e3,i=4096,s=1,n=2e4){const{color:o,intensity:r}=this.options.directionalLight,a=new O(o,r);if(e){a.shadow.mapSize.setScalar(i),a.shadow.bias=-1e-5,a.shadow.normalBias=.01,a.castShadow=e;const o=a.shadow.camera;o.radius=10,o.near=s,o.far=n,o.top=o.right=t,o.left=o.bottom=-t,o.updateProjectionMatrix()}return a}initCamera(){const{width:e,height:t,camera:i}=this.options,s=new M(36,e/t,i.near,i.far);if(s.position.set(...i.position),i.helper){const e=new T(s);this.addObject(e)}return this.addObject(s),s}initControls(){const e=this.options.controls;if(!e.visible)return;const t=new U(this.camera,this.renderer.domElement);return Object.keys(e).forEach((i=>{t[i]=e[i]})),t.target.set(0,0,0),t.saveState(),t}initCruise(){const{visible:i}=this.options.cruise;i&&(this.cruiseCamera=this.initCamera(),n(this,e,t).call(this))}initGrid(){const e=this.options.grid;if(!e.visible)return;const{width:t,divisions:i,centerLineColor:s,gridColor:n,opacity:o,transparent:r,fork:a}=e,c=new z(t,i,s,n);if(c.material.opacity=o,c.material.transparent=r,this.grid=c,this.addObject(c),a){const t=te(e);t.name="辅助交叉点",t._isGridFork_=!0,this.addObject(t)}}initAxes(){if(!this.options.axes.visible)return;const e=new D(this.options.axes.size);this.addObject(e)}setCruisePoint(e){this.options.cruise.points=e,this.createCruise()}createCruise(){const{visible:e,points:t}=this.options.cruise;if(!e)return;if(this.cruiseGroup&&this.disposeObj(this.cruiseGroup),V(),!t||0==t.length)return;const i=J(this.options.cruise,this.renderer);this.cruiseGroup=i,this.addObject(i)}toggleCruise(){const{visible:e,runing:t}=this.options.cruise;e&&(this.options.cruise.runing=!t,this.options.cruise.enabled=!t,this.controls.enabled=t,Q(this.options.cruise))}toggleCruiseDepthTest(e){this.cruiseGroup.traverse((t=>{(t.isMesh||t.isLine)&&(t.material.depthTest=null!=e?e:!t.material.depthTest)}))}setScale(e){this.options.scale=e}setEnvironment(e){(new F).load($(e),(e=>{e.mapping=G,this.scene.environment=e}))}setBgTexture(e){if(Array.isArray(e)){const t=(new B).load($(e));this.scene.background=t}else this.scene.background=(new c).load($(e))}setBgColor(e){this.scene.background=e?new H(e):null}bindEvent(){const e=this.renderer.domElement;e.addEventListener("dblclick",this.onDblclick.bind(this)),e.addEventListener("pointerdown",this.onPointerDown.bind(this)),e.addEventListener("pointermove",this.onPointerMove.bind(this)),e.addEventListener("pointerup",this.onPointerUp.bind(this))}onDblclick(e){}onPointerDown(e){this.pointer.isClick=!0,this.pointer.tsp=e.timeStamp}onPointerMove(e){}onPointerUp(e){this.pointer.isClick=!1}exportImage(){const e=document.createElement("a");e.download="render.png",e.href=this.renderer.domElement.toDataURL().replace("image/png","image/octet-stream"),e.click()}addObject(...e){this.scene.add(...e)}controlSave(){this.controls.saveState()}controlReset(){this.controls.reset()}resize(){this.options.width=this.container.offsetWidth||window.innerWidth,this.options.height=this.container.offsetHeight||window.innerHeight;const{width:e,height:t}=this.options,i=e/t;this.baseCamera.aspect=i,this.baseCamera.updateProjectionMatrix(),this.cruiseCamera&&(this.cruiseCamera.aspect=i,this.cruiseCamera.updateProjectionMatrix()),this.renderer.setSize(e,t)}stopAnimate(){window.cancelAnimationFrame(this.animationId)}clear(e){e&&e.traverse&&(e.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),null==e||e.clear()})),null==e||e.clear())}disposeObj(e){e&&e.traverse&&(e.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),null==e||e.clear()})),null==e||e.clear(),this.scene.remove(e))}dispose(){ee();try{this.scene.clear(),this.renderer.dispose(),this.renderer.forceContextLoss(),this.renderer.content=null;let e=this.renderer.domElement.getContext("webgl");e&&e.getExtension("WEBGL_lose_context").loseContext()}catch(e){}}};e=new WeakSet,t=function(){const e=this.options.cruise;e.enabled=!1,e.runing=!1,this.cruiseCamera.lookAt(this.controls.target),e.baseUrl&&(e.baseUrl=this.options.baseUrl),e.factor=1,e.index=0},s(ie,"total",0);let se=ie;const ne=e=>({resize:()=>{const t=()=>null==e?void 0:e.resize();R((()=>I().sidebar.opened),(()=>{setTimeout(t,300)})),window.addEventListener("resize",t,!1),W((()=>{null==e||e.stopAnimate(),null==e||e.dispose(),window.removeEventListener("resize",t)}))}});export{se as T,q as d,$ as g,N as n,X as r,ne as u};
