var e=Object.defineProperty,t=(t,s,o)=>(((t,s,o)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o})(t,"symbol"!=typeof s?s+"":s,o),o);import{bq as s,br as o,eT as i,eY as a,bn as n,bi as r,bc as d,eE as l,dW as c,en as h,dD as p,bg as u,eG as m,d0 as g,db as w,eX as b,eD as y,eF as v,e as x,i as f,l as N,o as D,g as P,h as j}from"./vendor-08e99294.js";import{D as M,u as T}from"./scene-resize-fddd461d.js";import"./index-6edcbd78.js";const k=v,{color:L,vec2:O,pass:_,linearDepth:C,normalWorld:W,triplanarTexture:z,texture:A,objectPosition:E,screenUV:G,viewportLinearDepth:S,viewportDepthTexture:R,viewportSharedTexture:U,mx_worley_noise_float:V,positionWorld:q,time:B}=k,F=(new s).load("/oss/textures/gpu/water.jpg");F.wrapS=o,F.wrapT=o,F.colorSpace=i;const I=z(A(F)).add(L(26367)).mul(.8),X=new a({colorNode:I});class Y extends M{constructor(e){super(e),t(this,"postProcessing"),t(this,"group"),t(this,"cylinder"),t(this,"gui"),t(this,"floorPosition",new n(0,.2,0)),this.createClock(),this.scene.backgroundNode=W.y.mix(L(296930),L(26367)),this.camera.lookAt(0,1,0),this.addLight(),this.group=new r,this.addModel(),this.addWater(),this.addProcessing(),this.gui=new d,this.addGui()}createRender(){return new l}createDirectionalLight(e,t){return new c(e,t)}addLight(){const e=new h(3355494,7654644,5),t=new h(7654644,0,1);this.addObject(t),this.addObject(e)}addModel(){const e=3.5,t=new r,s=new p(1,3);for(let o=0;o<100;o++){const i=o%10,a=o/10,n=new u(s,X);n.position.set(i*e,0,a*e),n.rotation.set(Math.random(),Math.random(),Math.random()),t.add(n)}t.position.set(-15.75,-1,-17.5),this.addObject(t),this.group=t}addWater(){var e;const t=B.mul(.8),s=q.xzy,o=V(s.mul(4).add(t)),i=V(s.mul(2).add(t)),n=o.mul(i),r=n.mul(1.4).mix(L(296930),L(7654644)),d=C(),l=S.sub(d).remapClamp(-.002,.04),c=G.add(O(0,n.mul(.1))),h=C(R(c)).sub(d),p=h.remapClamp(0,.1),b=h.lessThan(0).select(G,c),y=U(b),v=new m;v.colorNode=r,v.backdropNode=l.mix(U(),y.mul(p.mix(1,r))),v.backdropAlphaNode=p.oneMinus(),v.transparent=!0;const x=new u(new g(50,.001,50),v);x.position.set(0,0,0),this.addObject(x);const f=new u(new w(1.1,1.1,10),new a({colorNode:I}));f.position.set(0,-5,0),this.addObject(f);const N=q.y.sub(x.position.y);let D=N.add(.1).saturate().oneMinus();D=N.lessThan(0).select(D,W.y.mix(D,0)).toVar();const P=D.mix(X.colorNode,null==(e=X.colorNode)?void 0:e.add(o));f.material.colorNode=P,this.cylinder=f}addProcessing(){var e;null==(e=this.controls)||e.target.set(0,.2,0);const{camera:t,scene:s,renderer:o}=this,i=_(s,t),a=i.getTextureNode(),n=i.getLinearDepthNode().remapClamp(.3,.5),r=E(t).y.greaterThan(G.y.sub(.5).mul(t.near)),d=b(a);d.directionNode=r.select(n,i.getLinearDepthNode().mul(5));const l=G.distance(.5).mul(1.35).clamp().oneMinus(),c=new y(o);c.needsUpdate=!0,c.outputNode=r.select(d,d.mul(L(7654644)).mul(l)),this.postProcessing=c}addGui(){var e;const t=this.gui;t.add(this.floorPosition,"y",-1,1,.001).name("移动柱子"),t.domElement.className+=" gui-wrap",null==(e=this.container.parentNode)||e.appendChild(t.domElement)}animate(){var e,t,s;this.postProcessing&&this.postProcessing.renderAsync(),this.cylinder&&(this.cylinder.position.y=this.floorPosition.y-5);const o=null==(e=this.clock)?void 0:e.getDelta();for(const i of(null==(t=this.group)?void 0:t.children)||[])i.position.y=.3*Math.sin(((null==(s=this.clock)?void 0:s.elapsedTime)??0)+i.id),i.rotation.y+=.3*o}dispose(){this.disposeObj(this.group),this.group=void 0,super.dispose()}}const H={class:"three-page"},J=x({__name:"index",setup(e){const t=f(),s={directionalLight:{position:[.5,3,.5],color:16770201,intensity:5,light2:!1},ambientLight:{visible:!1},render:{logarithmicDepthBuffer:!1},camera:{near:.25,far:25,position:[3,2,4]},controls:{minDistance:1,maxDistance:10,maxPolarAngle:.9*Math.PI}};let o;return N((()=>{s.container=t.value,o=new Y(s),o.run(),T(o).resize()})),(e,s)=>(D(),P("div",H,[j("div",{class:"h-100",ref_key:"containerRef",ref:t},null,512)]))}});export{J as default};
//# sourceMappingURL=index-8daa983f.js.map
