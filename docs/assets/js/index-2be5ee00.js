var e=Object.defineProperty,s=(s,a,t)=>(((s,a,t)=>{a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t})(s,"symbol"!=typeof a?a+"":a,t),t);import{t as a}from"./index-cafd24aa.js";import{E as t,w as n,u as r,i as o}from"./scene-resize-bd4c29f6.js";import{eT as i,bk as d,bc as l,dW as c,dU as u,eD as m,f8 as h,eE as p,e as g,Y as v,i as b,l as f,o as w,g as y,h as x,q as M,u as j}from"./vendor-f4cca9b5.js";import"./index-dfaab5bf.js";const{uniform:P,color:I,atan:_,PI2:z,Fn:E,If:L,positionLocal:k,output:C,frontFacing:D,vec4:G}=p,N=new i({metalness:.5,roughness:.25,envMapIntensity:.5,color:"#858080"}),S=new i({metalness:.5,roughness:.25,envMapIntensity:.5,color:"#858080",side:d}),U=P(1.75),V=P(1.25),O=P(I("#b62f58")),R=E((([e,s,a])=>{const t=_(e.y,e.x).sub(s).mod(z).toVar();return t.greaterThan(0).and(t.lessThan(a))}));S.outputNode=E((()=>{R(k.xy,U,V).discard();const e=C;return L(D.not(),(()=>{e.assign(G(O,1))})),e}))(),S.castShadowNode=E((()=>(R(k.xy,U,V).discard(),G(0,0,0,1))))();class T extends t{constructor(e){super(e),s(this,"gui");const a=this.createGround(1e3,1e3,11184810);this.addObject(a),this.gui=new l,this.addGui()}render(){this.renderer.renderAsync(this.scene,this.camera)}createAmbientLight(e,s){return new c(e,s)}createDirectionalLight(e,s){return new u(e,s)}createRender(){return new m}setEnv(e){e.mapping=h,this.scene.environment=e,this.scene.background=this.scene.environment}addModel(e){e.traverse((e=>{e.isMesh&&("outerHull"===e.name?e.material=S:e.material=N,e.castShadow=!0,e.receiveShadow=!0)})),this.addObject(e)}addGui(){var e;const s=this.gui;s.add(U,"value",-Math.PI,Math.PI,.001).name("开始位置"),s.add(V,"value",0,2*Math.PI,.001).name("角度"),s.addColor({color:O.value.getHex()},"color").onChange((e=>O.value.set(e))),s.domElement.className+=" gui-wrap",null==(e=this.container.parentNode)||e.appendChild(s.domElement)}}const A={class:"three-page"},F=g({__name:"index",setup(e){const s=v({base:"",models:[{key:"gears",name:"齿轮",size:.07,url:"/oss/model/gpu/gears.glb"}],objects:[{type:"gears",name:"齿轮",position:{x:0,y:150,z:0},scale:{x:50,y:50,z:50}}]}),{progress:t,loadModels:i,initModels:d,getModel:l}=n.useModelLoader({baseUrl:s.base,indexDB:{}}),c=b(),u={baseUrl:s.base,env:"/oss/textures/hdr/8.hdr",directionalLight:{intensity:4}};let m;return f((()=>{u.container=c.value,m=new T(u).run(),r(m).resize(),i(s.models,(()=>{t.percentage=100,t.show=!1,d(s.objects,(e=>{const{type:s}=e,a=l(s);if(!a)return Promise.resolve();let t=o.modelDeepClone(a);const{position:n,scale:r,rotation:i}=o.get_P_S_R_param(t,e),[d,c,u]=n;return t.scale.set(...r),t.position.set(d,c,u),t.rotation.set(...i),m.addModel(t),Promise.resolve()}))}))})),(e,s)=>(w(),y("div",A,[x("div",{class:"h-100",ref_key:"containerRef",ref:c},null,512),M(a,{modelValue:j(t).show,"onUpdate:modelValue":s[0]||(s[0]=e=>j(t).show=e),progress:j(t).percentage},null,8,["modelValue","progress"])]))}});export{F as default};
