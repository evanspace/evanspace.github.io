var e=Object.defineProperty,t=(t,o,n)=>(((t,o,n)=>{o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n})(t,"symbol"!=typeof o?o+"":o,n),n);import{bz as o,bH as n,b4 as a,a_ as s,a$ as i,Y as r,bE as l,bF as c,bw as d,bx as p,bv as u,bG as m,bj as h,bB as f,bC as y,bD as g,e as b,i as v,w as _,l as x,aM as w,o as C,g as O,u as M,q as E,p as k,I as D,m as j,B as z,h as N,n as S,a9 as B,s as L,t as U,a5 as T,aH as P,aa as R,c as F,R as A}from"./vendor-eaf8386d.js";import{T as G,d as $,g as I,u as K}from"./scene-resize-0e0961d7.js";import{u as V}from"./raycaster-d24ff307.js";import{D as H,u as J,a as Q}from"./dialog-99bfb39d.js";import{_ as W,j as X,A as q,k as Y}from"./common-3738a1ed.js";const{raycaster:Z,pointer:ee,update:te}=V(),{initCSS2DRender:oe,createCSS2DDom:ne}={initCSS2DRender:(e,t)=>{const{width:n,height:a}=e,s=new o;return s.setSize(n,a),s.domElement.style.position="absolute",s.domElement.style.left="0px",s.domElement.style.top="0px",s.domElement.style.pointerEvents="none",t.appendChild(s.domElement),s},createCSS2DDom:e=>{const{name:t,className:o="",onClick:a,position:s}=e,i=document.createElement("div");i.innerHTML=t,i.className=o;const r=new n(i);return i.style.pointerEvents=a?"auto":"none",i.style.position="absolute","function"==typeof a&&i.addEventListener("click",a),s&&r.position.set(...s),r}};class ae extends G{constructor(e,o){super(e),t(this,"deviceGroup"),t(this,"dotGroup"),t(this,"extend"),t(this,"css2DRender"),this.extend=o,this.css2DRender=oe(this.options,this.container),this.css2DRender.domElement.className="three-scene__dot-wrap",this.deviceGroup=new a,this.bindEvent(),this.addDotGroup()}addDotGroup(){const e=new a;this.scene.add(e),this.dotGroup=e}createDot(e,t){const o=e.position,{size:n,color:a}=e.font||{},{x:s=0,y:i=0,z:r=0}=o||{},l=ne({name:`\n        <div class="bg"></div>\n        <span class="inner" style="${null!=n?`font-size: ${"string"==typeof n?n:n+"px"};`:""} ${null!=a?`color: ${a}`:""}"></span>\n      `,className:"dot-2D-label",position:[s,i,r],onClick:t});return l.name=e.name,l.data=e,l._position_={x:s,y:i,z:r},this.dotGroup.add(l),l}modelAnimate(){this.css2DRender.render(this.scene,this.camera),"function"==typeof this.extend.animateCall&&this.extend.animateCall()}onDblclick(e){var t;const o=this.container,n=this.options.scale;if(te(e,o,n),this.deviceGroup){Z.setFromCamera(ee,this.camera);const e=[this.deviceGroup],o=Z.intersectObjects(e);if(o.length){const e=o[0].object,n=this.findParentGroupGroup(e);if(!n)return;"function"==typeof(null==(t=this.extend)?void 0:t.onDblclick)&&this.extend.onDblclick(n)}}}onPointerMove(e){this.checkIntersectObjects(e)}onPointerUp(e){var t;super.onPointerUp(e);const o=e.timeStamp-this.pointer.tsp<H.rightClickBackDiffTime;2==e.button?o&&"function"==typeof(null==(t=this.extend)?void 0:t.onClickRight)&&this.extend.onClickRight(e):0==e.button?o&&this.checkIntersectObjects(e):e.button}checkIntersectObjects(e){var t,o;const n=this.container,a=this.options.scale;te(e,n,a);let s="pointerdown"==e.type||"pointerup"==e.type;const i=this.deviceGroup.children.filter((e=>e.visible&&e._isAnchor_));Z.setFromCamera(ee,this.camera);let r=Z.intersectObjects(i,s);if(n.style.cursor=r.length>0?"pointer":"auto",s)if(r.length){const e=r[0].object;if(!e)return;"function"==typeof(null==(t=this.extend)?void 0:t.onClickLeft)&&this.extend.onClickLeft(e)}else"function"==typeof(null==(o=this.extend)?void 0:o.onClickLeft)&&this.extend.onClickLeft()}findParentGroupGroup(e){const t=e=>{let o=e.parent;if(o)return o&&o._isDevice_?o:t(o)};return t(e)}clearDevice(){this.deviceGroup&&(this.disposeObj(this.deviceGroup),this.deviceGroup=new a,this.addObject(this.deviceGroup))}addDevice(...e){this.deviceGroup&&this.deviceGroup.add(...e)}getFloor(){return this.deviceGroup.children.filter((e=>e._isFloor_))}hideOmitFloor(e){this.deviceGroup.children.forEach((t=>{t.visible=t._isFloor_||e}))}getAll(){return this.deviceGroup.children.concat(this.dotGroup.children)}getFlowMark(e){return this.getAll().filter((t=>{var o;return(null==(o=t.data)?void 0:o.followMark)===e}))}getAnimTargetPos(e,t,o){const n=t||e.to||{x:-104,y:7,z:58},a=o||e.target||{x:0,y:0,z:0};return this.controls.target.set(a.x,a.y,a.z),n}getPosition(){}resize(){super.resize();const{width:e,height:t}=this.options;this.css2DRender.setSize(e,t)}}const se={normal:{color:8954293,main:[8954293,2698801],text:12180479,FM:6319220},runing:{color:3045368,main:3045368,FM:422935},error:{color:12717056,main:11879461,FM:15215899}},ie=(e,t,o=1)=>{const n=e.position,a=e.rotation,s=e.scale,i=t.position||{x:0,y:0,z:0},r=t.rotation||{x:0,y:0,z:0},l=t.scale||{x:1,y:1,z:1},c=Math.abs(r.x)<2?1:180,d=Math.abs(r.y)<2?1:180,p=Math.abs(r.z)<2?1:180;return{position:[n.x+i.x,n.y+i.y,n.z+i.z],rotation:[a.x+Math.PI/c*r.x,a.y+Math.PI/d*r.y,a.z+Math.PI/p*r.z],scale:[s.x*o*l.x,s.y*o*l.y,s.z*o*l.z]}},re=e=>e.map((e=>(e.children&&e.children.length>0?e.children=re(e.children):e.material&&(e.material instanceof Array?e.material=e.material.map((e=>e.clone())):e.material=e.material.clone()),e))),le=e=>{let t=e.clone();return t.children=re(t.children),t},ce=e=>{let t=[];return Array.isArray(e)?t=e:null!=e&&(t=[e]),t},de=(e,t)=>{e.traverse((e=>{e.isMesh&&(Array.isArray(e.material)?e.material.forEach((e=>{e.color.set(t)})):e.material.color.set(t))}))},pe=(e,t,o)=>(e.lookAt(o),new Promise((n=>{new s(e.position).to(t,1e3).easing(i.Quadratic.In).start().onUpdate((()=>{e.lookAt(o)})).onComplete((()=>{n(e)}))}))),ue=e=>new Promise((t=>{const o=window.indexedDB.deleteDatabase(e);o.onsuccess=e=>{t(!0)},o.onerror=e=>{t(!1)}})),me=async(e,t="THREE__MODEL_DB",o=1)=>{if(!window.indexedDB)return Promise.resolve(void 0);await((e,t,o)=>new Promise((n=>{window.indexedDB.open(e).onsuccess=a=>{const s=a.target.result,i=s.version;s.close(),i!==t?ue(e).then((e=>{n(e?t:i)})):s.objectStoreNames.contains(o)?n(i):ue(e).then((e=>{n(e?t:i)}))}})))(t,o,e);let n=window.indexedDB.open(t,o);return new Promise((t=>{n.onupgradeneeded=t=>{const o=t.target.result;o.objectStoreNames.contains(e)||o.createObjectStore(e,{keyPath:"path"})},n.onsuccess=e=>{const o=e.target.result;t(o)},n.onerror=e=>{t(void 0)}}))},he=(e={})=>{let t;const o=$({baseUrl:"",dracoPath:"/draco/gltf/",modelSizeKB:1048576,colors:{normal:{color:8954293},runing:{color:3045368},error:{color:12717056}},loadCache:!0,colorMeshName:[],indexDB:{cache:!0}},e),n=r({percentage:0,show:!1,isEnd:!1,list:[],total:0,loaded:0}),a={base:"base",device:"device",font:"font",sprite:"sprite",pipe:"pipe",warning:"warning",remote:"remote",local:"local",disabled:"disabled"},s=new Map,i=new l;i.setDecoderPath(o.baseUrl+o.dracoPath);const b=new c;b.setDRACOLoader(i);const v=e=>{const t=e.loaded,o=n.total;let a=Number((t+n.loaded)/o*100);a>100&&(a=100),n.percentage=Number(a.toFixed(2))},_=(e,t,n,a)=>{if(!n)return;const{baseUrl:i,colorMeshName:r}=o,{mapUrl:l,key:c,mapMeshName:h,repeat:f=[1,1]}=e;let y;l&&h&&(y=(new d).load(I(l,i)),y.wrapS=p,y.wrapT=p,y.repeat.set(f[0],f[1]));const g=le(n);return g.traverse((e=>{e.isMesh&&y&&e.name.indexOf(h)?e.material=new u({side:m,transparent:!0,opacity:0,map:y.clone()}):((e,t=6776165,o,n)=>{const{type:a,name:s}=e;a.indexOf("Light"),H.mesh.receiveShadowName.some((e=>s.indexOf(e)>-1))?e.traverse((e=>{e.isMesh&&(e.receiveShadow=!0)})):o.some((e=>s.indexOf(e)>-1))?de(e,t):e.isMesh&&(n&&(e.material.envMap=n),e.castShadow=!0)})(e,t,r||[])})),g.animations=a,s.set(c,g),g},x=(e,n=0)=>{const a=new c;return new Promise((async s=>{var i;o.indexDB.cache||s(null);const r=h.get(e);if(r)r instanceof ArrayBuffer?(v({loaded:r.byteLength}),a.parse(r,"",(t=>{h.add(e,t),s(t)}))):(v({loaded:n*o.modelSizeKB}),setTimeout((()=>{s(r)}),10));else{const n=await((e,t,o)=>{if(!e||!t||!o)return Promise.resolve(null);const n=e.transaction([t],"readonly").objectStore(t).get(o);return new Promise(((e,t)=>{n.onsuccess=t=>{const o=t.target.result;e(o)},n.onerror=e=>{t(e)}}))})(t,(null==(i=o.indexDB)?void 0:i.tbName)||H.indexdb.tbName,e);if(n&&n.data){const e=n.data;"string"==typeof e?(v({loaded:e.length}),h.add(n.path,e),setTimeout((()=>{s(e)}),10)):(v({loaded:e.byteLength}),a.parse(e,"",(e=>{h.add(n.path,e),s(e)})))}else s(null)}}))},w=e=>{var n;if(!o.indexDB.cache)return;const a=h.get(e);if(a&&t){const s=(null==(n=o.indexDB)?void 0:n.tbName)||H.indexdb.tbName;t.transaction(s,"readwrite").objectStore(s).add({path:e,data:a})}},C=(e,t)=>{const{key:n,url:a="",size:s=0}=e,{baseUrl:i,colors:r}=o;return new Promise((async(o,l)=>{let c=r.normal[n]||r.normal.color;c=ce(c)[0];const d=I(a,i),p=await x(a,s);if(p){const t=p.scene.children[0],n=_(e,c,t,p.animations);return void o(n)}let u=d.split(".").pop().toLowerCase();if("glb"!==u)throw new Error("模型类型错误,必须为 GLB 格式，当前格式："+u);b.load(d,(t=>{let n=t.scene.children[0];const a=_(e,c,n,t.animations);w(d),o(a)}),(e=>{v(e),"function"==typeof t&&t(e)}),l)}))};let O;return{progress:n,MODEL_MAP:a,loadModel:C,loadModels:async(e,i,r)=>{var l,c,p;await me((null==(l=o.indexDB)?void 0:l.tbName)||H.indexdb.tbName,(null==(c=o.indexDB)?void 0:c.dbName)||H.indexdb.dbName,(null==(p=o.indexDB)?void 0:p.version)||H.indexdb.version).then((e=>(e&&(h.enabled=!0,t=e),e)));const u=e.length;if(!(0==u?(n.isEnd=!0,n.show=!1,0):(n.isEnd=!1,n.percentage=0,n.show=!0,1)))return;(e=>{for(let t=0;t<e.length;t++)n.total+=e[t].size*o.modelSizeKB})(e);let m=0;const b=async()=>{const t=e[m],{type:l=a.device,size:c=0}=t;switch(l){case a.device:await C(t,r);break;case a.sprite:(e=>{const{key:t,range:n={x:1,y:1},mapUrl:a=""}=e;let i=(new d).load(o.baseUrl+a),r=new f({map:i}),l=new y(r),c=n.x,p=n.y;l.scale.set(c,p,1),l.name="sprite",s.set(t,l)})(t);break;case a.font:(e=>{const{url:t="",size:n=0}=e,{baseUrl:a}=o,s=I(t,a),i=new g;new Promise((async e=>{const o=await x(s,n);if(o)return O=i.parse(JSON.parse(o)),void setTimeout((()=>{e(O)}),10);i.load(s,(o=>{O=o,w(t),e(o)}))}))})(t)}m++,n.loaded+=c*o.modelSizeKB,m>=u?i():b()};b()},getModel:e=>s.get(e)}},fe={key:0,class:"scene-operation"},ye=W(b({__name:"index",props:{devEnv:{type:Boolean},baseUrl:{},dracoUrl:{default:""},bgColor:{},skyCode:{},bgUrl:{},env:{},scale:{},indexDB:{default:()=>({cache:!0})},camera:{default:()=>({})},cruise:{default:()=>({})},fog:{default:()=>({})},render:{default:()=>({})},controls:{default:()=>({})},grid:{default:()=>({})},axes:{default:()=>({})},directionalLight:{default:()=>({})},models:{},config:{},objects:{},dotKey:{default:"DOT"},dotShowStrict:{type:Boolean,default:!0},colorMeshName:{default:()=>[]},getColorCall:{},formatObject:{},dotUpdateObjectCall:{},updateObjectCall:{},randomUpdateObjectCall:{},animationModelType:{},floorModelType:{},textModelType:{},anchorType:{default:()=>[]},mainBodyChangeColor:{type:Boolean},mainBodyMeshName:{default:()=>["主体"]}},emits:["init","loaded","update","select","dblclick","click-dot","click-dialog-dot"],setup(e,{expose:t,emit:o}){const n=e,{change:r,load:l}=J(),{progress:c,loadModel:d,loadModels:p,getModel:u}=he({baseUrl:n.dracoUrl,colors:se,colorMeshName:n.colorMeshName,indexDB:n.indexDB}),{dialog:m}=Q(),h=o,f=v(),y=n.devEnv,g={baseUrl:n.baseUrl,bgUrl:n.bgUrl,env:n.env,bgColor:n.bgColor,camera:n.camera,cruise:n.cruise,fog:n.fog,render:n.render,grid:n.grid,controls:n.controls,axes:n.axes,directionalLight:n.directionalLight};let b;_((()=>n.dotShowStrict),(()=>F())),_((()=>n.scale),(e=>{null==b||b.setScale(e||1)})),_((()=>n.cruise.points),(e=>{b.setCruisePoint(e)}));const F=()=>{const e=b.dotGroup.children;for(let t=0;t<e.length;t++){const o=e[t];if(!o.data)continue;o.data.type===n.dotKey&&I(o)}},A=e=>{var t,o,a,r;const l=b.getFloor();if(0===l.length)return;const c=void 0!==e&&e>-1;if((null==(t=n.config)?void 0:t.floorExpandHiddenOther)&&b.hideOmitFloor(!c),l.forEach(((t,o)=>{var a,r,l;const d=t._position_;let p=o-(c?e:o);const u=(null==(a=n.config)?void 0:a.floorExpandMargin)||200,m=(null==(r=n.config)?void 0:r.floorExpandMode)||"UD",h=p*u,f=((null==d?void 0:d.y)??0)+h,y=e==o?((null==d?void 0:d.z)??0)+u:(null==d?void 0:d.z)??0;if("UD"===m){if(t.position.y===f)return}else if("BA"===m&&t.position.z===y)return;if(null==(l=t.data)?void 0:l.mark){const n=t.data.mark,a=b.getFlowMark(n);$(m,a,h,e==o?u:0)}new s(t.position).to({y:"UD"===m?f:t.position.y,z:"BA"===m?y:t.position.z},500).easing(i.Quadratic.Out).start()})),!(null==(o=n.config)?void 0:o.floorExpandChangeViewAngle))return;let d,p;if(c){const t=l[e]||{};d=null==(a=t.data)?void 0:a.to,d&&(p=(null==(r=t.data)?void 0:r.target)||t._position_)}d=b.getAnimTargetPos(n.config||{},d,p),G(d)||pe(b.camera,d,b.controls.target)},G=e=>{const t=b.camera.position;return Math.abs(t.x-e.x)<1&&Math.abs(t.y-e.y)<1&&Math.abs(t.z-e.z)<1},$=(e,t,o,n)=>{0!==t.length&&t.forEach((t=>{const a=t._position_,r="UD"==e?((null==a?void 0:a.y)??0)+o:(null==a?void 0:a.y)??0,l="BA"==e?((null==a?void 0:a.z)??0)+n:(null==a?void 0:a.z)??0;new s(t.position).to({y:r,z:l},500).easing(i.Quadratic.Out).start()}))},I=e=>{var t;if("function"!=typeof n.dotUpdateObjectCall)throw Error("未传人点位更新对象回调方法 dotUpdateObjectCall");const o=e.data,a=n.dotUpdateObjectCall(o,b.deviceGroup);if("object"!=typeof a)throw Error("点位更新回调方法返回类型不是 Object，当前返回类型为："+typeof a);Object.keys(a).forEach((e=>{o[e]=a[e]})),e.visible=o.show||!n.dotShowStrict;const s=null==(t=e.element)?void 0:t.getElementsByClassName("inner")[0];if(s){const{size:e,color:t}=o.font||{};null!=e&&(s.style.fontSize="string"==typeof e?e:e+"px"),null!=t&&(s.style.color=t),s.textContent=`${o.value||0}${o.unit}`}},K=e=>{const t=((e,t,o)=>{let n=e.clientWidth/2,a=e.clientHeight/2,s=t.position.clone();const i=t.scale;s.y+=i.x/2;let r=s.project(o);return{left:r.x*n+n,top:-r.y*a+a}})(f.value,e,b.camera);return m.position=t,m.style.left=t.left+"px",m.style.top=t.top+"px",t},V=async e=>{var t;if(!e)return;const{type:o,url:s}=e,i=u(o);if(!i)return void(s?await(async e=>{const{type:t,url:o="",name:n}=e,a=await d({key:t,url:o,name:n,size:0}),{position:s,scale:i,rotation:r}=ie(a,e);return a.scale.set(...i),a.position.set(...s),a.rotation.set(...r),a._isBase_=!0,b.addDevice(a),Promise.resolve(a)})(e):o===n.dotKey&&(e=>{I(b.createDot(e,(e=>{})))})(e));const r=n.floorModelType||[],l=n.anchorType||[];let c=le(i);const{position:p,scale:m,rotation:h}=ie(c,e),[f,y,g]=p;c.scale.set(...m),c.position.set(f,y,g),c.rotation.set(...h);if((n.animationModelType||[]).includes(o)){if("Group"!==c.type){const e=new a;e.add(c),c=e}if(n.mainBodyChangeColor){const e=((null==(t=c.children[0])?void 0:t.children)||[]).filter((e=>(n.mainBodyMeshName||[]).some((t=>e.name.indexOf(t)>-1)))),o=se.normal;let a=o.main||o.color,s=ce(a);s.length&&e.forEach(((e,t)=>{de(e,s[t%s.length])})),c[H.meshKey.body]=e}}return c._isDevice_=!0,c.data=e,r.includes(o)&&(c._position_={x:f,y:y,z:g},c._isFloor_=!0),l.includes(o)&&(c._isAnchor_=!0),b.addDevice(c),Promise.resolve()},W=v([]),X=async()=>{var e,t,o,a;c.percentage=100,c.show=!1,b.clearDevice(),await R(),(()=>{W.value.length=0;const e=w(n.objects)||[];if("function"!=typeof n.formatObject)throw W.value=e,Error("未传入格式化函数 formatObject");{const t=n.formatObject(e);W.value=t}})(),await(()=>{let e=0,t=W.value.length;return new Promise((o=>{if(0==t)return o(null);const n=async()=>{const a=W.value[e];await V(a),e++,e<t?n():o(e)};n()}))})(),b.createCruise(),"function"==typeof(null==(e=n.config)?void 0:e.load)&&(null==(t=n.config)||t.load(b));const s=(null==(o=n.config)?void 0:o.floorExpandIndex)||-1,i=b.getAnimTargetPos(n.config||{}),r=b.getFloor();s>-1&&r.length?(A(s),(null==(a=n.config)?void 0:a.floorExpandChangeViewAngle)||pe(b.camera,i,b.controls.target).then((()=>{h("loaded")}))):pe(b.camera,i,b.controls.target).then((()=>{h("loaded")}))},q=()=>{p(n.models,(()=>{X()})),n.skyCode&&l(b,n.skyCode)},Y=()=>{const e=[];if("function"!=typeof n.randomUpdateObjectCall)throw Error("未传入随机更新回调函数 randomUpdateObjectCall");b.getAll().forEach(((t,o)=>{if(!t.data)return;const a=t.data;let s=a.type;if(s===n.dotKey)return void I(t);const i=n.randomUpdateObjectCall(a);if(!i)return;if("object"!=typeof i)throw Error("更新回调函数返回对象不为 Object，当前类型："+typeof i);Object.keys(i).forEach((e=>{a[e]=i[e]})),e.push(w(a));let{status:r=0,error:l=0,remote:c=0,local:d=0,disabled:p=0}=a;const u=se[l>0?"error":r>0?"runing":"normal"];let m=u[s]||u.color;if("function"==typeof n.getColorCall){const e=n.getColorCall(a);e&&(m=e)}Z({type:s,el:t,colorObj:u,color:m,paused:0==r,error:l>0,remote:c>0,local:d>0,disabled:p>0})})),h("update",e,!0)},Z=e=>{let{el:t,colorObj:o,color:a,type:s,paused:i,error:r}=e,l=ce(a);a=l[0];const c=t.extra;if(c&&(c.action&&(c.action.paused=i),null!=a)){(c.meshs||[]).forEach((e=>{de(e,a)}))}if(n.mainBodyChangeColor&&t[H.meshKey.body]){const e=o.main;let n=ce(e);n.length&&t[H.meshKey.body].forEach(((e,t)=>{de(e,n[t%n.length])}))}};return x((()=>{g.container=f.value,b=new ae(g,{onDblclick:e=>{const t=e.data,o=b.getFloor().findIndex((t=>e.uuid===t.uuid));"function"==typeof t.onDblclick&&t.onDblclick(w(t),e,o),o>-1&&A(o)},onClickLeft(e){if(e){const t=e.data,o=w(t);h("select",o),"function"==typeof t.onClick?t.onClick(o):(m.select=[e],(()=>{const e=m.select[0],t=e.data;m.data=t,m.title=(null==t?void 0:t.name)||"";const o=K(e);h("click-dialog-dot",t,o)})())}else m.select=[];m.show=!!e},onClickRight:e=>{var t;"function"==typeof(null==(t=n.config)?void 0:t.back)?n.config.back(b):A(-1)},animateCall:()=>{if(m.show&&m.select.length){const e=m.select[0];K(e)}}}),b.run(),h("init",b),q()})),t({floorAnimate:A}),(e,t)=>{const o=P;return C(),O("div",{class:S(e.$style["floor-scene"])},[M(y)?(C(),O("div",fe,[E(o,{type:"success",onClick:Y},{default:k((()=>t[4]||(t[4]=[D("随机更新")]))),_:1}),e.cruise.visible?(C(),j(o,{key:0,onClick:t[0]||(t[0]=()=>{var e;return null==(e=M(b))?void 0:e.toggleCruise()}),type:"danger"},{default:k((()=>t[5]||(t[5]=[D("定点巡航")]))),_:1})):z("",!0),E(o,{onClick:t[1]||(t[1]=()=>{var e;return null==(e=M(b))?void 0:e.getPosition()}),type:"success"},{default:k((()=>t[6]||(t[6]=[D("场景坐标")]))),_:1}),E(o,{type:"warning",onClick:t[2]||(t[2]=()=>M(r)(M(b)))},{default:k((()=>t[7]||(t[7]=[D("切换背景")]))),_:1})])):z("",!0),N("div",{class:S(e.$style.container),ref_key:"containerRef",ref:f},null,2),M(c).show?(C(),O("div",{key:1,class:S(["loading",e.$style.loading]),style:B({"--bg-color":e.bgColor?String(e.bgColor):""}),onDblclick:t[3]||(t[3]=L((()=>{}),["stop"]))},[N("div",{class:S(e.$style.progress),style:B({"--percentage":M(c).percentage+"%"})},[N("div",{class:S(e.$style["bar-out"])},[N("div",{class:S(e.$style.bar)},null,2)],2),N("div",{class:S(e.$style.text)},U(M(c).percentage)+"%",3)],6)],38)):z("",!0),M(m).show?(C(),O("div",{key:2,class:S(e.$style.dialog),style:B(M(m).style)},[T(e.$slots,"dialog",{data:M(m).data,title:M(m).title,position:M(m).position})],6)):z("",!0)],2)}}}),[["__cssModules",{$style:{"floor-scene":"_floor-scene_130hp_2",container:"_container_130hp_8",loading:"_loading_130hp_12",progress:"_progress_130hp_27","bar-out":"_bar-out_130hp_31",bar:"_bar_130hp_31","striped-flow":"_striped-flow_130hp_1",text:"_text_130hp_47",dialog:"_dialog_130hp_63"}}]]),ge={class:"flex flex-ac"},be={class:"flex flex-ac"},ve=W(b({__name:"index",setup(e){const t=Y(),o=r({devEnv:!0,baseUrl:"",bgColor:"",skyCode:"221",render:{alpha:!0},env:"/oss/textures/hdr/skidpan_2k.hdr",camera:{far:1e6},cruise:{visible:!0,points:[[450,490,450],[450,490,-450],[-450,490,-450],[-450,490,450]],offset:10},controls:{screenSpacePanning:!1,maxDistance:5e4,maxPolarAngle:.46*Math.PI},directionalLight:{helper:!0},grid:{visible:!0},models:[{key:"FLOOR_ONE",name:"大堂",size:8.5,url:"/1楼.glb"},{key:"FLOOR_COMMON",name:"楼层",size:13.7,url:"/楼层.glb"},{key:"FLOOR_ATTIC",name:"楼顶",size:.1,url:"/楼顶.glb"},{key:"COLD_CAMERA",name:"摄像头",type:"sprite",size:1,range:{x:37,y:77},mapUrl:"/sxt.png"},{key:"COLD_ROOM_INLET",name:"房间入口",type:"sprite",size:1,range:{x:37,y:77},mapUrl:"/fjdw.png"},{key:"COLD_GPS",name:"定位",type:"sprite",size:1,range:{x:51,y:56},mapUrl:"/dw.png"}].map((e=>(e.url&&(e.url="/oss/model/floor"+e.url),e.mapUrl&&(e.mapUrl="/oss/textures/floor"+e.mapUrl),e))),objects:[],config:{},indexDB:{cache:!0,dbName:"THREE__FLOOR__DB",tbName:"TB",version:1},dotShowStrict:!1,colorMeshName:[],floorModelType:["FLOOR_COMMON","FLOOR_ONE","FLOOR_TWO_FIVE","FLOOR_SIX","FLOOR_SEVEN_ELEVEN","FLOOR_TWELVE_THIRTEEN","FLOOR_FOURTEEN_SIXTEEN","FLOOR_SEVENTEEN_EIGHTEEN"],anchorType:["COLD_CAMERA","COLD_ROOM_INLET","COLD_GPS"],mainBodyChangeColor:!0,mainBodyMeshName:["立方体062"],animationModelType:["FLOOR_COMMON"]}),n=v(),a=e=>t.formatData(e),s=(e,t)=>{const o=40*Math.random();return void 0!==o&&(e.value=o),e.show=Math.random()>.5,e.value=Number(Number(e.value||0).toFixed(2)),{value:e.value,show:e.show,font:{...e.font||{},color:e.value>35?"#f00":null}}},i=e=>{const t=Math.random()>.5?1:0,o=Math.random()>.5?1:0,n=Math.random()>.8?1:0,a=Math.floor(3*Math.random());return{status:n>0?0:t,error:n>0?0:o,remote:1==a?1:0,local:2==a?1:0,disabled:n}},l=e=>{K(e).resize()},c=()=>{const e=[[450,1,450],[450,1,-450],[-450,1,-450],[-450,1,450]].map((e=>e.map((e=>e*(.5-.5*Math.random()+1)))));o.cruise&&(o.cruise.points=e)};return x((()=>{X.get(q.d3.floor).then((e=>{let t=e.JsonList;const n=e.ModelUrl;t.unshift({name:e.Name,type:"",url:n?`${o.baseUrl}${n}`:""});let a={};if(e.ConfigJson instanceof Object)a=e.ConfigJson;else if("string"==typeof e.ConfigJson)try{a=JSON.parse(e.ConfigJson)}catch(s){}Object.keys(a).forEach((e=>{o.config&&(o.config[e]=a[e])})),o.objects=t.map((e=>("COLD_ROOM_INLET"===e.type&&(e.onClick=e=>{F.success({message:e.name,grouping:!0})}),e)))}))})),(e,t)=>{const r=A,d=P;return C(),O("div",{class:S([e.$style.page,"h-100 o-h"])},[N("div",{class:S(e.$style.operate)},[N("div",ge,[t[1]||(t[1]=N("span",null,"点位：",-1)),E(r,{modelValue:M(o).dotShowStrict,"onUpdate:modelValue":t[0]||(t[0]=e=>M(o).dotShowStrict=e),"active-text":"严格","inactive-text":"全显","inline-prompt":""},null,8,["modelValue"])]),N("div",be,[E(d,{type:"success",onClick:c},{default:k((()=>t[2]||(t[2]=[D("切换巡航点位")]))),_:1})])],2),E(ye,{ref_key:"threeSceneRef",ref:n,"dev-env":M(o).devEnv,"base-url":M(o).baseUrl,"bg-color":M(o).bgColor,"bg-url":M(o).bgUrl,env:M(o).env,indexDB:M(o).indexDB,"sky-code":M(o).skyCode,camera:M(o).camera,cruise:M(o).cruise,render:M(o).render,controls:M(o).controls,grid:M(o).grid,"directional-light":M(o).directionalLight,config:M(o).config,models:M(o).models,"anchor-type":M(o).anchorType,"dot-show-strict":M(o).dotShowStrict,"floor-model-type":M(o).floorModelType,"main-body-change-color":M(o).mainBodyChangeColor,"main-body-mesh-name":M(o).mainBodyMeshName,"animation-model-type":M(o).animationModelType,objects:M(o).objects,"format-object":a,"dot-update-object-call":s,"random-update-object-call":i,onInit:l},{dialog:k((({data:t,title:o})=>[N("div",{class:S(e.$style["dialog-wrap"])},[N("div",{class:S(e.$style.circle)},null,2),N("div",{class:S(e.$style.line)},null,2),N("div",{class:S(e.$style.content)},[N("div",{class:S(e.$style.title)},U(o),3),N("div",{class:S(e.$style.data)},U(t),3)],2)],2)])),_:1},8,["dev-env","base-url","bg-color","bg-url","env","indexDB","sky-code","camera","cruise","render","controls","grid","directional-light","config","models","anchor-type","dot-show-strict","floor-model-type","main-body-change-color","main-body-mesh-name","animation-model-type","objects"])],2)}}}),[["__cssModules",{$style:{page:"_page_m4oc3_2",operate:"_operate_m4oc3_8","dialog-wrap":"_dialog-wrap_m4oc3_16",circle:"_circle_m4oc3_22",line:"_line_m4oc3_52",content:"_content_m4oc3_78",title:"_title_m4oc3_85",data:"_data_m4oc3_89"}}]]);export{ve as default};
