import{_ as e,a as t,b as n,c as o,d as s,e as i,f as a,g as r,h as l,i as c,j as d,k as p,l as u,m as g,n as m,o as h,p as f,q as v,r as y,s as w,t as x,u as b,v as _,w as k,x as C,y as S,z as j,A as L,B as M,C as z,D as P,E as O,F as A,G as T,H as B,I as E,J as D,K as I,L as U,M as R,N as F,O as X,P as N,Q as G,R as Z,S as J,T as Y,U as Q,V as H,W,X as K,Y as V,Z as $,$ as q,a0 as ee,a1 as te,a2 as ne,a3 as oe,a4 as se,a5 as ie,a6 as ae,a7 as re,a8 as le,a9 as ce,aa as de,ab as pe}from"./posZ-95d90af9.js";import{bv as ue,bw as ge,bx as me,by as he,bz as fe,bA as ve,bB as ye,bC as we,bD as xe,bE as be,bF as _e,bG as ke,bH as Ce,bI as Se,bJ as je,bK as Le,ba as Me,bo as ze,bc as Pe,b7 as Oe,bL as Ae,bM as Te,b5 as Be,b6 as Ee,bh as De,bN as Ie,bO as Ue,bP as Re,be as Fe,bQ as Xe,bR as Ne,bS as Ge,bT as Ze,bs as Je,bU as Ye,bV as Qe,i as He,bf as We,bW as Ke,bX as Ve,bY as $e,bZ as qe,b_ as et,b$ as tt,bk as nt,c0 as ot,c1 as st,c2 as it,c3 as at,c4 as rt,Y as lt,c5 as ct,c6 as dt,c7 as pt,c8 as ut,c9 as gt,ca as mt,cb as ht,cc as ft,cd as vt,ce as yt,cf as wt,bd as xt,cg as bt,ch as _t,ci as kt,bp as Ct,cj as St,ck as jt,cl as Lt,cm as Mt,cn as zt,co as Pt,cp as Ot,cq as At,cr as Tt,cs as Bt,ct as Et,bb as Dt,cu as It,cv as Ut,cw as Rt,cx as Ft,cy as Xt,cz as Nt,cA as Gt,cB as Zt,cC as Jt,cD as Yt}from"./vendor-d68cddd1.js";function Qt(e,t,n,o){return new(n||(n=Promise))((function(s,i){function a(e){try{l(o.next(e))}catch(t){i(t)}}function r(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}l((o=o.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const Ht=e=>new URL(Object.assign({})[`../assets/imgs/texttures/${e}`],self.location).href,Wt=e=>{!e&&(e="");if(!/^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/)[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,}(\/\S*)?$/.test(e)){return/^(https?:\/\/)(?:\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::\d{1,5})?(?:[/?#]\S*)?$/.test(e)}return!0},Kt=(e,t="")=>Array.isArray(e)?e.map((e=>Kt(e,t))):!Wt(e)&&e.indexOf(t)<0?t+e:e,Vt=e=>new Promise((t=>{const n=window.indexedDB.deleteDatabase(e);n.onsuccess=e=>{t(!0)},n.onerror=e=>{t(!1)}})),$t=(e,t,n)=>new Promise((o=>{window.indexedDB.open(e).onsuccess=s=>{const i=s.target.result,a=i.version;i.close(),a!==t?Vt(e).then((e=>{o(e?t:a)})):i.objectStoreNames.contains(n)?o(a):Vt(e).then((e=>{o(e?t:a)}))}})),qt=(e,...t)=>Qt(void 0,[e,...t],void 0,(function*(e,t="THREE__MODEL_DB",n=1){if(!window.indexedDB)return Promise.resolve(void 0);yield $t(t,n,e);let o=window.indexedDB.open(t,n);return new Promise((t=>{o.onupgradeneeded=t=>{const n=t.target.result;n.objectStoreNames.contains(e)||n.createObjectStore(e,{keyPath:"path"})},o.onsuccess=e=>{const n=e.target.result;t(n)},o.onerror=e=>{t(void 0)}}))})),en=(e,t,n)=>{if(!e||!t||!n)return Promise.resolve(null);const o=e.transaction([t],"readonly").objectStore(t).get(n);return new Promise(((e,t)=>{o.onsuccess=t=>{const n=t.target.result;e(n)},o.onerror=e=>{t(e)}}))},tn={TEXT:"TEXT",JSQ:"JSQ",LDB:"LDB",LQB:"LQB",XBC:"XBC",LXJ:"LXJ",LGJ:"LGJ",LGJ_2:"LGJ_2",LGJ_3:"LGJ_3",LGJ_4:"LGJ_4",LQT:"LQT",GL:"GL",BSHRQ:"BSHRQ",BSHLQ:"BSHLQ",FLRB:"FLRB",FJY_X:"FJY_X",FJZ_X:"FJZ_X",FJY:"FJY",FJZ:"FJZ",FM:"FM",XFM:"XFM"};var nn={indexdb:{dbName:"THREE__MODEL__DB",tbName:"TB",version:1},mesh:{receiveShadowName:["楼板","地面","底座","底板","基础","基础底座","冷却塔基础","草地","ground","Ground"],animatehName:["动画","螺杆A","螺杆B","螺杆A001","螺杆B001","螺杆A002","螺杆B002","叶轮A","叶轮B","叶轮C","阀门"],transparentName:["透明","透明外壳"]},keys:tn,rightClickBackDiffTime:300,meshKey:{body:"__BODY_",color:"__COLOR_",warning:"__WARNING_",local:"__LOCAL_",disabled:"__DISABLED_",pipe:"__PIPE__"},statusOffset:{TEXT:{[tn.JSQ]:{position:{x:-20,y:10,z:0},rotation:{x:0,y:270,z:0}},[tn.LDB]:{position:{x:-60,y:0,z:0}},[tn.LQB]:{position:{x:0,y:0,z:60},rotation:{x:0,y:270,z:0}},[tn.LXJ]:{position:{x:0,y:16,z:50},rotation:{x:-20,y:0,z:0}},[tn.LGJ]:{position:{x:0,y:16,z:50},rotation:{x:-20,y:0,z:0}},[tn.LQT]:{position:{x:-60,y:0,z:0}},[tn.BSHLQ]:{position:{x:0,y:16,z:40}}},WARNING:{[tn.JSQ]:{position:{x:0,y:62,z:0}},[tn.LDB]:{position:{x:-4,y:45,z:0}},[tn.LQB]:{position:{x:0,y:45,z:4},rotation:{x:0,y:270,z:0}},[tn.LXJ]:{position:{x:0,y:78,z:0}},[tn.LGJ]:{position:{x:0,y:78,z:0}},[tn.LQT]:{position:{x:0,y:85,z:0}},[tn.BSHLQ]:{position:{x:0,y:88,z:0}}},STATUS:{[tn.LDB]:{position:{x:9,y:47,z:0}},[tn.LQB]:{position:{x:0,y:47,z:-9},rotation:{x:0,y:270,z:0}},[tn.LXJ]:{position:{x:27,y:67,z:42}},[tn.LGJ]:{position:{x:-47,y:67,z:42}},[tn.LQT]:{position:{x:-35,y:69,z:26}}},DISABLED:{[tn.LDB]:{position:{x:22,y:47,z:0}},[tn.LQB]:{position:{x:0,y:47,z:-22},rotation:{x:0,y:270,z:0}},[tn.LXJ]:{position:{x:40,y:67,z:42}},[tn.LGJ]:{position:{x:-34,y:67,z:42}},[tn.LQT]:{position:{x:-22,y:69,z:26}}}}};const on=e=>{e.material instanceof Array?e.material=e.material.map((e=>e.clone())):e.material=e.material.clone()},sn=e=>{let t=e.clone();return(e.isMesh||e.isSprite)&&on(e),t.traverse((e=>{e.isMesh&&on(e)})),t},an=(e,t=6776165,n,o)=>{const{type:s,name:i}=e;s.indexOf("Light"),nn.mesh.receiveShadowName.some((e=>i.indexOf(e)>-1))?e.traverse((e=>{e.isMesh&&(e.receiveShadow=!0)})):n.some((e=>i.indexOf(e)>-1))?ln(e,t):e.isMesh&&(o&&(e.material.envMap=o),e.castShadow=!0,e.receiveShadow=!0)},rn=e=>{let t=[];return Array.isArray(e)?t=e:null!=e&&(t=[e]),t},ln=(e,t)=>{e.traverse((e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0,Array.isArray(e.material)?e.material.forEach((e=>{e.color.set(t)})):e.material.color.set(t))}))},cn=nn.statusOffset,dn=(e,t,n={})=>{const o=t.type,s=cn[e]||{},i=n[o]||s[o]||{};let a=hn({x:0,y:0,z:0},i.position||{}),r=hn({x:0,y:0,z:0},i.rotation||{});return r.x=Math.PI/180*r.x,r.y=Math.PI/180*r.y,r.z=Math.PI/180*r.z,{position:a,rotation:r}},pn=(e,t)=>Object.prototype.toString.call(t)===`[object ${e}]`,un=e=>pn("Object",e),gn=e=>e&&("object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName),mn=(e,t=new Map)=>{if(null!=e&&un(e)){let n=t.get(e);if(n)return n;const o=Array.isArray(e);let s=o?[]:{};return n=t.set(e,s),o?e.forEach(((e,t)=>{s[t]=mn(e,n)})):Object.keys(e).forEach((t=>{un(s[t])?s[t]=mn(e[t],n):s[t]=e[t]})),s}return e},hn=(e,t)=>{e=mn(e);for(let n in t)n in e&&un(t[n])&&un(e[n])?e[n]=hn(e[n],t[n]):e[n]=t[n];return e},fn=(e,t)=>Math.floor(Math.random()*(t-e+1))+e;var vn=Object.freeze({__proto__:null,getTextturesUrl:Ht,numConverter:(e=0,t=2)=>{if(Math.abs(e)>=1e8){return 1*(e/1e8).toFixed(t)+"亿"}if(Math.abs(e)>=1e4){return 1*(e/1e4).toFixed(t)+"万"}return 1*e.toFixed(t)},getUrl:Kt,deleteDB:Vt,getDBVersion:$t,createDB:qt,getDataByKey:en,getAllData:(e,t)=>{const n=e.transaction(t,"readonly").objectStore(t).getAll();return new Promise(((e,t)=>{n.onsuccess=t=>{const n=t.target.result;e(n)},n.onerror=e=>{t(e)}}))},get_P_S_R_param:(e,t,n=1)=>{const o=e.position,s=e.rotation,i=e.scale,a=t.position||{x:0,y:0,z:0},r=t.rotation||{x:0,y:0,z:0},l=t.scale||{x:1,y:1,z:1},c=Math.abs(r.x)<2?1:180,d=Math.abs(r.y)<2?1:180,p=Math.abs(r.z)<2?1:180;return{position:[o.x+a.x,o.y+a.y,o.z+a.z],rotation:[s.x+Math.PI/c*r.x,s.y+Math.PI/d*r.y,s.z+Math.PI/p*r.z],scale:[i.x*n*l.x,i.y*n*l.y,i.z*n*l.z]}},modelDeepClone:sn,replaceMaterial:an,getColorArr:rn,setMaterialColor:ln,cameraInSceneAnimate:(e,t,n=new Fe)=>(e.lookAt(n),e._lookAt_=n,new Promise((o=>{new Ue(e.position).to(t,1e3).easing(Re.Quadratic.In).start().onUpdate((()=>{e.lookAt(n),e._lookAt_=n})).onComplete((()=>{o(e)}))}))),cameraLookatAnimate:(e,t,n)=>new Promise((o=>{new Ue(n).to(t,1e3).easing(Re.Quadratic.In).start().onUpdate((t=>{e.lookAt(t),e._lookAt_=t})).onComplete((()=>{o(e)}))})),cameraLinkageControlsAnimate:(e,t,n,o)=>new Promise((s=>{new Ue(t.position).to(n,1e3).easing(Re.Quadratic.In).start().onUpdate((()=>{const n=e.target;t.lookAt(n),t._lookAt_=n})),new Ue(e.target).to(o,1e3).easing(Re.Quadratic.In).start().onComplete((()=>{s(t)}))})),createSpriteAnimate:(e,t,n=1,o=10)=>{let s=[0,o/2,o],i=[...t,t[0],t[1]+n,t[2],...t],a=new Xe("sprite.position",s,i),r=new Ne("sprite_up_down",o,[a]);const l=new Ge(e),c=l.clipAction(r);return c.timeScale=5,c.play(),e.__action__=c,e.__mixer__=l,e},getPlanePosition:(e,t,n)=>{let o=e.clientWidth/2,s=e.clientHeight/2,i=t.position.clone();const a=t.scale;i.y+=a.x/2;let r=i.project(n);return{left:r.x*o+o,top:-r.y*s+s}},findObjectsByHasProperty:(e,t,n="name")=>{let o=[];if(!e||!e.length)return[];return function e(s){s.forEach((s=>{const i=s[n];"string"==typeof i&&t.some((e=>i.indexOf(e)>-1))&&o.push(s),s.children&&e(s.children)}))}(e),o},getStatusOffset:dn,createText:(e,t,n=16777215,o)=>{const s=dn("TEXT",e,o);let i=e.font||{},a=new Ze(e.name||"",{font:t,size:i.size||10,depth:0,curveSegments:12,bevelThickness:1,bevelSize:.1,bevelEnabled:!0});const r=s.rotation;a.rotateX(r.x),a.rotateY(r.y),a.rotateZ(r.z);const l=s.position;a.computeBoundingBox(),a.computeVertexNormals();let c=.5*(a.boundingBox.max.x-a.boundingBox.min.x),d=.5*(a.boundingBox.max.z-a.boundingBox.min.z),p=new ze({color:null!=i.color?i.color:n,flatShading:!1}),u=new Pe(a,p);return u.castShadow=!0,u.position.set((l.x||0)-c,l.y||0,(l.z||0)-d),u.name="text",u._isText_=!0,u},createWarning:(e,t,n,o,s=100,i=1)=>{if(!n)return;const a=dn("WARNING",t,o);let r=new Je,l=sn(n);l.scale.set(i,i,i);const c=a.position;l.position.set(c.x,c.y,c.z);const d=a.rotation;l.rotation.set(d.x,d.y,d.z),r.add(l);let p=new Ye(12717056,8,s,0);p.name="灯光",p.position.y=c.y+30,r.add(p),r.name=e;let u=new Ge(r),g=new Xe("红色.material.color",[0,.25,.75],[1,0,0,1,1,0,1,0,0]),m=new Xe("灯光.color",[0,.25,.75],[1,0,0,1,1,0,1,0,0]),h=new Xe("警告标识.scale",[0,.5,1],[1,1,1,1.2,1.2,2,1,1,1]),f=new Ne("warning_",1,[g,m,h]),v=u.clipAction(f);return v.paused=!0,v.play(),r.visible=!1,r._isWarning_=!0,{group:r,action:v,mixer:u}},createStatusMark:(e,t,n,o)=>{if(!t)return;const s=dn(o?"DISABLED":"STATUS",e,n);let i=sn(t);const a=s.position;i.position.set(a.x,a.y,a.z);const r=s.rotation;return i.rotation.set(r.x,r.y,r.z),i.visible=!1,i._isStatus_=!0,i},isType:pn,isObject:un,isDOM:gn,deepClone:mn,deepMerge:hn,checkUrl:Wt,random:fn}),yn={container:document.body,width:window.innerWidth,height:window.innerHeight,baseUrl:"",bgColor:null,bgUrl:null,env:null,scale:1,fog:{visible:!1,near:100,far:1e3},render:{antialias:!0,logarithmicDepthBuffer:!0,preserveDrawingBuffer:!1},controls:{visible:!0,autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.25,enablePan:!0,enableRotate:!0,enableZoom:!0,maxAzimuthAngle:1/0,minAzimuthAngle:1/0,minDistance:1,maxDistance:2e3,minPolarAngle:0,maxPolarAngle:Math.PI,maxTargetRadius:1/0,rotateSpeed:1,screenSpacePanning:!0},ambientLight:{visible:!0,color:16777215,intensity:1.5},directionalLight:{visible:!0,helper:!1,position:[500,1e3,800],position2:[-500,800,-800],light2:!0,color:16777215,intensity:1.5},camera:{helper:!1,near:1,far:1e4,position:[-350,510,700]},cruise:{visible:!1,enabled:!1,runing:!1,helper:!1,points:[],segment:2,tension:0,baseUrl:"",repeat:[.1,1],width:15,speed:1,mapSpeed:.006,offset:10,factor:1,auto:!1,animateBack:void 0,alway:!1},grid:{visible:!1,opacity:.3,transparent:!0,width:800,divisions:80,centerLineColor:10592673,gridColor:10592673,fork:!1,forkSize:1.4,forkColor:10592673},axes:{visible:!1,size:50}};const wn=()=>({initCSS3DRender:(e,t)=>{const{width:n,height:o}=e,s=new ge;return s.setSize(n,o),s.domElement.style.position="absolute",s.domElement.style.left="0px",s.domElement.style.top="0px",s.domElement.style.pointerEvents="none",t.appendChild(s.domElement),s},createCSS3DDom:e=>{const{name:t,className:n="",onClick:o,position:s,sprite:i}=e,a=document.createElement("div");a.innerHTML=t,a.className=n;const r=i?new yt(a):new wt(a);return a.style.pointerEvents=o?"auto":"none",a.style.position="absolute","function"==typeof o&&a.addEventListener("click",o),s&&r.position.set(...s),r}}),{createCSS3DDom:xn}=wn(),bn=()=>({visible:!0,enabled:!1,runing:!1,helper:!1,points:[],segment:2,close:!0,tension:0,baseUrl:"",mapUrl:Ht("arrow.png"),repeat:[.1,1],width:15,speed:1,mapSpeed:.006,offset:10,factor:1,index:0,auto:!1,tube:!1,color:16777215,radius:1,radialSegments:1,animateBack:void 0,alway:!1}),_n=()=>{let e,t,n,o=bn();const s=(t,s)=>{n=new Pe(new tt(2),new nt({color:0,opacity:.8,depthTest:!1,transparent:!0})),t.add(n);const i=(new ot).setFromPoints(s.concat(s[0])),a=new st({color:255,opacity:1,depthTest:!1,transparent:!0}),r=new it(i,a);t.add(r);const l=new at(e,100,o.width/2,3,!0),c=new rt({color:16711935,opacity:.1,depthTest:!1,transparent:!0}),d=new Pe(l,c),p=new nt({color:16715760,opacity:.3,wireframe:!0,depthTest:!1,transparent:!0}),u=new Pe(l,p);d.add(u),t.add(d)},i=()=>{var e;return 900*(null!==(e=o.segment)&&void 0!==e?e:2)},a=()=>null==e?void 0:e.getPoints(i()),r=(e,t)=>new Fe(t.x,t.y+e,t.z),l=e=>{if(!o.enabled)return;switch(e.keyCode){case 38:case 87:o.runing?(o.factor*=1.5,o.factor>10&&(o.factor=10)):o.index+=5;break;case 83:case 40:o.runing||(o.index-=5,o.index<0&&(o.index=i()))}},c=e=>{if(!o.enabled)return;o.factor=1;switch(e.keyCode){case 32:o.runing=!o.runing;break;case 38:case 87:o.runing||(o.index+=10);break;case 83:case 40:o.runing||(o.index-=10,o.index<0&&(o.index=i()))}};return{createCruise:(n,i)=>{o=hn(bn(),n);const{points:r,tension:l,mapUrl:c,baseUrl:d,repeat:p,width:u,helper:g,close:m,tube:h,color:f,radius:v,radialSegments:y}=o,w=[];for(let e=0;e<r.length;e++){const t=r[e];w.push(new Fe(t[0],t[1],t[2]))}e=new Ve(w,m,"catmullrom",null!=l?l:0),e=new Ve(a(),m,"catmullrom",null!=l?l:0);const x=new Je;t=(new Ee).load(Kt(c,d),(e=>{e.wrapS=Qe,e.repeat.x=p[0],e.repeat.y=p[1],e.anisotropy=i.capabilities.getMaxAnisotropy()}));const b=new ze({color:f,map:t,opacity:.9,transparent:!0,depthTest:!0,side:$e}),_=new Fe(0,1,0),k=new Tt;k.set(a(),v,y,_,!1);const C=h?new qe:new et;C.update(k,h?{radius:v,radialSegments:y,progress:1,startRad:0}:{width:u,arrow:!1,progress:1,side:"both"},!1);const S=new Pe(C,b);return x.add(S),x.name="cruise",g&&s(x,w),x.renderOrder=99,x},updateCruise:e=>{o=hn(o,e)},cruiseAnimate:s=>{if(!s)return;if(!e)return;const{mapSpeed:a,speed:l,factor:c,enabled:d,runing:p,offset:u,helper:g,auto:m,animateBack:h}=o;if(t&&(t.offset.x-=a),!(m||p&&d))return;(m||p&&d)&&(o.index+=c*l);const f=i(),v=o.index%f/f;let y=v+.001;y>1&&(y-=1);const w=e.getPointAt(y);if(g&&n){const e=r(u,w);n.position.copy(e)}const x=r(u,e.getPointAt(v));if(!m||p&&d){s.position.copy(x);const e=r(u,w);s._lookAt_=e,s.lookAt(e)}"function"==typeof h&&h(x,w,e,v)},bindEvent:()=>{window.addEventListener("keydown",l,!1),window.addEventListener("keyup",c,!1)},removeEvent:()=>{window.removeEventListener("keyup",c),window.removeEventListener("keydown",l)}}},kn=()=>({createFork:(e={})=>{const{width:t=800,divisions:n=80,forkSize:o=1.4,forkColor:s=10592673}=e;let i=t/n,a=-t/2;const r=new Je;for(let l=0;l<=n;l++)for(let e=0;e<=n;e++){const t=a+l*i,n=a+e*i,c=new Me(o,o/5),d=new rt({color:s,transparent:!0,opacity:.9}),p=new Pe(c,d);p.rotateX(.5*-Math.PI),p.position.set(t,0,n);const u=p.clone();u.rotateZ(.5*Math.PI),r.add(p,u)}return r}}),Cn=["216","217","218","219","220","221","222","223","224","225","226"];var Sn,jn,Ln=Object.freeze({__proto__:null,useConvertData:()=>({transformGeoJSON:e=>{let t=e.features;for(let n=0;n<t.length;n++){const e=t[n];"Polygon"===e.geometry.type&&(e.geometry.coordinates=[e.geometry.coordinates])}return e}}),useCountryLine:()=>{const e=(e,t,n="LineLoop")=>{let o;if("Line2"===n){const n=new ht;n.setPositions(e),o=new ft(n,t),o.name="countryLine2",o.computeLineDistances()}else{const s=new ot;s.setFromPoints(e),o=new vt[n](s,t),o.name="countryLine"}return o};return{createCountryFlatLine:(t,n,o="LineLoop")=>{let s={color:65535,linewidth:1,depthTest:!1};s=hn(s,n);let i=new st(s);"Line2"===o&&(i=new mt(s));let a=t.features,r=new Je;for(let l=0;l<a.length;l++){const t=a[l].geometry.coordinates;for(let n=0;n<t.length;n++){const s=t[n],a=[];"Line2"===o?s.forEach((e=>{e.forEach((e=>{a.push(e[0],0,-e[1])}))})):s.forEach((e=>{e.forEach((e=>{a.push(new Fe(e[0],e[1],0))}))}));let l=e(a,i,o);r.add(l)}}return r},getPoints:(e,t=0,n)=>{let o=e.features;const s=[];for(let i=0;i<o.length;i++){const e=o[i].geometry.coordinates;for(let o=0;o<e.length;o++)e[o].forEach((e=>{e.forEach((e=>{n?s.push(new Fe(e[0],t,-e[1])):s.push(e[0],t,-e[1])}))}))}return s}}},useMapBar:(e={})=>{let t=hn({height:10,size:2,factor:1,color1:1048575,color2:16777215},e);return{createBar:(e={},n={})=>{var o;t=hn(t,n);let{size:s,height:i,factor:a,color1:r,color2:l}=t;s*=a,i*=a,i*=null!==(o=e.heightRatio)&&void 0!==o?o:a;const[c,d,p]=e.position||[0,0,0],u=new Je,g=new xt(s,s,i),m=new bt({depthTest:!1,transparent:!0,vertexColors:!1,uniforms:{uColor1:{value:new De(r)},uColor2:{value:new De(l)},uOpacity:{value:.6}},vertexShader:"\n\t\t\t\tvarying vec3 vColor;\n\t\t\t\tuniform vec3 uColor1;\n\t\t\t\tuniform vec3 uColor2;\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat percent = (position.z + 0.0) / 100.0; // 计算当前像素点在立方体高度上的百分比\n\t\t\t\t\tvColor = mix(uColor1.rgb, uColor2.rgb, percent);\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\t\tvarying vec3 vColor;\n\t\t\t\tuniform float uOpacity;\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = vec4(vColor, uOpacity);\n\t\t\t\t}\n\t\t\t"}),h=new Pe(g,m);if(u.add(h),u.name="柱状图",u.position.set(c,d,p+i/2),u.renderOrder=99,e.label){const{name:t="",className:n="",onClick:o}=e.label,s=xn({name:t,className:n,position:[0,0,i/2],onClick:o});s.rotateX(.5*Math.PI),u.add(s)}return u}}},useOutline:(e={})=>{let t=hn({size:.1,color:16085360,range:500,factor:1,speed:6},e);const n=e=>{const n=e.material,o=n.uniforms.uLength.value;n.uniforms.uIndex.value+=t.speed,n.uniforms.uIndex.value>=o&&(n.uniforms.uIndex.value=0)};return{createOutline:(e,n={})=>{t=hn(t,n);const{size:o,factor:s,range:i,color:a}=t,r=new Float32Array(e),l=new ot;l.setAttribute("position",new _t(r,3));const c=new Float32Array(Math.floor(r.length/3)).map(((e,t)=>t));l.setAttribute("aIndex",new _t(c,1));const d=new bt({vertexShader:"\n\t\t\t\tattribute float aOpacity;\n\t\t\t\tuniform float uSize;\n\n\t\t\t\tattribute float aIndex;\n\t\t\t\tvarying vec3 vp;\n\t\t\t\tvarying float vertexIndex;\n\n\t\t\t\tvoid main(){\n\t\t\t\t\tgl_Position = projectionMatrix*modelViewMatrix*vec4(position,1.0);\n\t\t\t\t\tgl_PointSize = uSize;\n\n\t\t\t\t\tvp = position;\n\t\t\t\t\tvertexIndex = aIndex;\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\t\tvarying float vertexIndex;\n\t\t\t\tuniform vec3 uColor;\n\t\t\t\tuniform float uIndex;\n\t\t\t\tuniform float uRange;\n\n\t\t\t\tfloat invert(float n){\n\t\t\t\t\treturn 1.-n;\n\t\t\t\t}\n\n\t\t\t\tvoid main(){\n\t\t\t\t\tfloat uOpacity = 1.0;\n\t\t\t\t\tif(vertexIndex <= uIndex || vertexIndex >= (uRange + uIndex)){\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t\tuOpacity = (vertexIndex - uIndex)/uRange;\n\t\t\t\t\tif ( uOpacity < 0.2) {\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t\tvec2 uv=vec2(gl_PointCoord.x,invert(gl_PointCoord.y));\n\t\t\t\t\tvec2 cUv=2.*uv-1.;\n\t\t\t\t\tvec4 color=vec4(1./length(cUv));\n\t\t\t\t\tcolor*=uOpacity;\n\t\t\t\t\tcolor.rgb*=uColor;\n\t\t\t\t\tgl_FragColor=color;\n\t\t\t\t}\n\t\t\t",transparent:!0,depthTest:!1,uniforms:{uSize:{value:o*s},uIndex:{value:0},uLength:{value:c.length},uRange:{value:i},uColor:{value:new De(a)}}}),p=new kt(l,d);return p.name="轮廓",p.scale.setScalar(s),p},update:n,outlineUpdate:n}},useMarkLight:(e={})=>{let t=hn({pointTextureUrl:Ht("point.png"),circleTextureUrl:Ht("circle.png"),lightTextureUrl:Ht("light.png"),factor:1,color:65535},e);const n=new Ee;return{createMarkLight:(e=[0,0,0],o=10,s={})=>{t=hn(t,s);const i=new Je,a=new Me(o/6.219,o);a.rotateX(-Math.PI/2),a.translate(0,0,o/2);const r=new nt({map:n.load(t.lightTextureUrl),color:t.color,transparent:!0,depthWrite:!1,side:Ct});let l=new Pe(a,r);l.rotateX(Math.PI),l.position.z=o,l.renderOrder=3,l.name="光柱 01";let c=l.clone();c.name="光柱 02",c.rotateZ(Math.PI/2);const d=(()=>{const e=new Me(3,3),o=new nt({map:n.load(t.pointTextureUrl),color:t.color,side:Ct,transparent:!0,depthWrite:!1});let s=new Pe(e,o);s.renderOrder=1,s.name="底部光点";const i=.3*t.factor;return s.scale.setScalar(i),s})(),p=(()=>{const e=new Me(3,3),o=new nt({map:n.load(t.circleTextureUrl),color:t.color,side:Ct,opacity:0,transparent:!0,depthWrite:!1});let s=new Pe(e,o);s.renderOrder=2,s.name="createLightHalo";const i=.5*t.factor;s.scale.setScalar(i);const a=fn(0,2e3);return s.tween1=new Ue({scale:i,opacity:0}).to({scale:1.5*i,opacity:1},1e3).delay(a).onUpdate((e=>{let{scale:t,opacity:n}=e;s.scale.setScalar(t),s.material.opacity=n})),s.tween2=new Ue({scale:1.5*i,opacity:1}).to({scale:2*i,opacity:0},1e3).onUpdate((e=>{let{scale:t,opacity:n}=e;s.scale.setScalar(t),s.material.opacity=n})),s.tween1.chain(s.tween2),s.tween2.chain(s.tween1),s.tween1.start(),s})();i.add(l,c,d,p);const[u,g,m]=e;return i.position.set(u,g,m),i.rotateX(.5*Math.PI),i.name="光柱标记",i}}},useFence:()=>{const e=[1,.8],t=.2,n=(new Ee).load(Ht("fenceMap0.png"),(n=>{n.wrapT=Qe,n.repeat.x=e[0],n.repeat.y=e[1],n.offset.y=t})),o=(new Ee).load(Ht("fenceMap1.png"),(n=>{n.wrapT=Qe,n.repeat.x=e[0],n.repeat.y=e[1],n.offset.x=t})),s=(new Ee).load(Ht("fenceMap2.png"),(e=>{e.wrapS=Qe,e.wrapT=Qe})),i=(e,t,i)=>{const a=[];for(let n=0;n<t.length;n++){const o=t[n];a.push(...e[o])}const r=new ot,l=new Float32Array(a);r.setAttribute("position",new _t(l,3));const c=t.length,d=new _t(new Float32Array(3*c),3);r.setAttribute("normal",d);for(let n=0;n<c;n++)d.setXYZ(n,0,0,0);const p=new _t(new Float32Array([1,1,0,1,0,0,0,0,1,0,1,1]),2);r.setAttribute("uv",p);const u=new ze({color:i,map:n,transparent:!0,blending:Lt,side:Ct}),g=new ze({color:i,map:o,transparent:!0,blending:Lt,side:Ct});var m=new ze({color:i,map:s,opacity:.5,transparent:!0,side:Ct});const h=new Pe(r,u),f=new Je,v=new Pe(r,g),y=new Pe(r,m);return f.add(h,v,y),f};return{createFence:(e,t=11009923)=>{const n=new Je;var o=new St(e,t);o.update();const s=o.geometry.getAttribute("position").array,a=[];for(let i=0;i<s.length;i+=3){const e=s[i],t=s[i+1],n=s[i+2];a.push([e,t,n])}const r=i(a,[0,1,2,2,3,0],t),l=i(a,[4,5,6,6,7,4],t),c=i(a,[4,0,3,3,7,4],t),d=i(a,[1,5,6,6,2,1],t);return n.add(r,l,c,d),n},fenceAnimate:(e=1)=>{const s=.008*e;if(n){let e=n.offset.y-s;e<0&&(e=t),n.offset.y=e}if(o){let e=o.offset.y-s;e<0&&(e=t),o.offset.y=e}}}},useCorrugatedPlate:(e={})=>{let t=hn({range:100,interval:.8,size:.2,color:47273,light:881527,factor:1},e);const n=(e,t)=>{const n=e.material,o=n.uniforms.uRange.value,s=n.uniforms.uLength.value;n.uniforms.uRadius.value+=t*(o/4),n.uniforms.uRadius.value>=o+s&&(n.uniforms.uRadius.value=0)};return{createCorrugatedPlate:(e={})=>{t=hn(t,e);let{range:n,color:o,light:s,factor:i}=t;n*=i;const a=(()=>{let{range:e,interval:n,size:o,factor:s}=t;e*=s,n*=s,o*=s;const i=[],a=Math.floor(e/n);for(let t=-a;t<=a;t++)for(let e=-a;e<=a;e++){const s=new Me(o,o),a=t*n,r=e*n,l=new Ft,c=new Fe(a,-o,r),d=new Nt,p=new Rt,u=new Fe(1,1,1);d.setFromEuler(p),l.compose(c,d,u),s.applyMatrix4(l),i.push(s)}return i})(),r=jt(a),l=new bt({uniforms:{uColor:{value:new De(s)},uTcolor:{value:new De(o)},uRadius:{value:1.25},uLength:{value:n/10},uRange:{value:n}},vertexShader:"\n\t\t\t\tvarying vec3 vp;\n\t\t\t\tvoid main(){\n\t\t\t\t\tvp = position;\n\t\t\t\t\tgl_Position\t= projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\t\tvarying vec3 vp;\n\t\t\t\tuniform vec3 uColor;\n\t\t\t\tuniform vec3 uTcolor;\n\t\t\t\tuniform float uRadius;\n\t\t\t\tuniform float uLength;\n\t\t\t\tfloat getLeng(float x, float y){\n\t\t\t\t\treturn\tsqrt((x-0.0)*(x-0.0)+(y-0.0)*(y-0.0));\n\t\t\t\t}\n\t\t\t\tvoid main(){\n\t\t\t\t\tfloat uOpacity = 0.8;\n\t\t\t\t\tvec3 vColor = uColor;\n\t\t\t\t\tfloat length = getLeng(vp.x,vp.z);\n\t\t\t\t\tif ( length <= uRadius && length > uRadius - uLength ) {\n\t\t\t\t\t\tfloat op = sin( (uRadius - length) / uLength ) ;\n\t\t\t\t\t\tuOpacity = op;\n\t\t\t\t\t\tif ( vp.y < 0.0 ) {\n\t\t\t\t\t\t\tvColor = uColor * op;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvColor = uTcolor;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tvColor = uTcolor;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(vColor,uOpacity);\n\t\t\t\t}\n\t\t\t",transparent:!0,depthWrite:!1,side:Ct}),c=new Pe(r,l);return c.name="波纹板",c},update:n,corrugatedPlateUpdate:n}},useDiffusion:()=>{let e;return{createDiffusion:(t=10,n=16715760,o=5)=>{const s=new Me(t,t,1,1),i=["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(""),a=["varying vec2 vUv;","uniform vec3 uColor;","uniform float uOpacity;","uniform float uSpeed;","uniform float uSge;","uniform float time;","float PI = 3.14159265;","float drawCircle(float index, float range) {","\tfloat opacity = 1.0;","\tif (index >= 1.0 - range) {","\t\topacity = 1.0 - (index - (1.0 - range)) / range;","\t} else if(index <= range) {","\t\topacity = index / range;","\t}","\treturn opacity;","}","float distanceTo(vec2 src, vec2 dst) {","\tfloat dx = src.x - dst.x;","\tfloat dy = src.y - dst.y;","\tfloat dv = dx * dx + dy * dy;","\treturn sqrt(dv);","}","void main() {","\tfloat iTime = -time * uSpeed;","\tfloat opacity = 0.0;","\tfloat len = distanceTo(vec2(0.5, 0.5), vec2(vUv.x, vUv.y));","\tfloat size = 1.0 / uSge;","\tvec2 range = vec2(0.65, 0.75);","\tfloat index = mod(iTime + len, size);","\tvec2 cRadius = vec2(0.06, 0.12);","\tif (index < size && len <= 0.5) {","\t\tfloat i = sin(index / size * PI);","\t\tif (i >= range.x && i <= range.y){","\t\t\tfloat t = (i - range.x) / (range.y - range.x);","\t\t\tfloat r = 0.3;","\t\t\topacity = drawCircle(t, r);","\t\t}","\t\topacity *=\t1.0 - len / 0.5;","\t};","\tgl_FragColor = vec4(uColor, uOpacity * opacity);","}"].join("");e=new bt({uniforms:{uColor:{value:new De(n)},uOpacity:{value:1},uSpeed:{value:.1},uSge:{value:o},uRadius:{value:t/2},time:{value:0}},transparent:!0,vertexShader:i,fragmentShader:a,depthTest:!1,blending:Lt,side:Ct});return new Pe(s,e)},updateDiffusion:(t=1)=>{if(!e)return;const n=.001*performance.now()*t;e.uniforms.time.value=n}}},useFlywire:(e={})=>{let t,n,o=hn({depth:0,height:4,divisions:1e3,color:16777215,flyColor:16761095,pointColor:16715760,pointWidth:2.5,flyPointWidth:2.4,tubularSegments:256,radius:.5,radialSegments:8,closed:!1,length:100,factor:1,speed:4},e);const s=e=>{const[t,s]=e;let{pointWidth:i,depth:a,factor:r}=o;const l=i*r;a*=r;const c=new Me(l,l,1,1),d=new Pe(c,n);return d.position.set(t,a,-s),d.rotateX(.5*-Math.PI),d},i=(e={})=>{o=hn(o,e),t=new bt({depthTest:!1,uniforms:{uColor:{value:new De(o.flyColor)},uIndex:{value:0},uTotal:{value:o.divisions},uWidth:{value:o.flyPointWidth},uLength:{value:o.length}},vertexShader:["attribute float aIndex;","uniform float uIndex;","uniform float uWidth;","uniform vec3 uColor;","varying float vSize;","uniform float uLength;","void main(){","\t\tvec4 viewPosition = viewMatrix * modelMatrix * vec4(position,1);","\t\tgl_Position = projectionMatrix * viewPosition;","\t\tif(aIndex >= uIndex - uLength && aIndex < uIndex){","\t\t\tvSize = uWidth * ((aIndex - uIndex + uLength) / uLength);","\t\t}","\t\tgl_PointSize = vSize;","}"].join(""),side:Ct,fragmentShader:["varying float vSize;","uniform vec3 uColor;","void main(){","\t\tif(vSize<=0.0){","\t\t\tgl_FragColor = vec4(1,0,0,0);","\t\t}else{","\t\t\tgl_FragColor = vec4(uColor,1);","\t\t}","}"].join(""),transparent:!0,vertexColors:!1}),n=new bt({uniforms:{uColor:{value:new De(o.pointColor)},uOpacity:{value:1},uSpeed:{value:.1},uSge:{value:4},uRadius:{value:o.pointWidth*o.factor/2},time:{value:0}},transparent:!0,depthTest:!1,vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(""),fragmentShader:["varying vec2 vUv;","uniform vec3 uColor;","uniform float uOpacity;","uniform float uSpeed;","uniform float uSge;","uniform float time;","float PI = 3.14159265;","float drawCircle(float index, float range) {","\tfloat opacity = 1.0;","\tif (index >= 1.0 - range) {","\t\topacity = 1.0 - (index - (1.0 - range)) / range;","\t} else if(index <= range) {","\t\topacity = index / range;","\t}","\treturn opacity;","}","float distanceTo(vec2 src, vec2 dst) {","\tfloat dx = src.x - dst.x;","\tfloat dy = src.y - dst.y;","\tfloat dv = dx * dx + dy * dy;","\treturn sqrt(dv);","}","void main() {","\tfloat iTime = -time * uSpeed;","\tfloat opacity = 0.0;","\tfloat len = distanceTo(vec2(0.5, 0.5), vec2(vUv.x, vUv.y));","\tfloat size = 1.0 / uSge;","\tvec2 range = vec2(0.65, 0.75);","\tfloat index = mod(iTime + len, size);","\tvec2 cRadius = vec2(0.06, 0.12);","\tif (index < size && len <= 0.5) {","\t\tfloat i = sin(index / size * PI);","\t\tif (i >= range.x && i <= range.y){","\t\t\t// 归一","\t\t\tfloat t = (i - range.x) / (range.y - range.x);","\t\t\t// 边缘锯齿范围","\t\t\tfloat r = 0.3;","\t\t\topacity = drawCircle(t, r);","\t\t}","\t\t// 渐变","\t\topacity *=\t1.0 - len / 0.5;","\t};","\tgl_FragColor = vec4(uColor, uOpacity * opacity);","}"].join("\n"),side:Ct})},a=()=>{const e=t,s=e.uniforms.uTotal.value;e.uniforms.uIndex.value+=o.speed,e.uniforms.uIndex.value>=s&&(e.uniforms.uIndex.value=0);const i=.001*performance.now();n.uniforms.time.value=i};return i(),{createFlywireTexture:i,createFlywire:e=>{const n=new Je,i=s(e[0]),a=s(e[1]);n.add(i,a);const r=(e=>{const[t,n]=e[0],[s,i]=e[1];let{depth:a,height:r,factor:l,divisions:c}=o;r=(a+r)*l,a*=l;const d=new Fe(t,a,-n),p=new Fe(t+(s-t)/4,r,-(n+(i-n)/4)),u=new Fe(t+3*(s-t)/4,r,-(n+3*(i-n)/4)),g=new Fe(s,a,-i);return new Xt(d,p,u,g).getPoints(c)})(e),l=new Ve(r,!1,"centripetal",.5),c=new at(l,o.tubularSegments,o.radius,o.radialSegments,o.closed),d=new bt({transparent:!0,opacity:1,depthTest:!1,vertexColors:!1,uniforms:{uColor:{value:new De(o.color)},uOpacity:{value:.6}},vertexShader:["varying vec3 vColor;","uniform vec3 uColor;","void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join(""),fragmentShader:["uniform vec3 uColor;","uniform float uOpacity;","void main() {","\tgl_FragColor = vec4(uColor, uOpacity);","}"].join("")}),p=new Pe(c,d);p.renderOrder=10;const u=(e=>{const n=new Float32Array(e.map(((e,t)=>t))),o=(new ot).setFromPoints(e);return o.setAttribute("aIndex",new _t(n,1)),new kt(o,t)})(r);return n.add(p,u),n},update:a,flywireUpdate:a}},useLensflare:(e={})=>{let t=hn({mainTextureUrl:Ht("lensflare0.png"),minorTextureUrl:Ht("lensflare3.png")},e);const n=new Ee,o=n.load(t.mainTextureUrl),s=n.load(t.minorTextureUrl);return{addLensflare:(e,t,n,i)=>{const a=new Ye(16777215,1,2e3,0);a.color.set(e),a.position.set(t,n,i);const r=new Mt;return r.addElement(new zt(o,700,0,a.color)),r.addElement(new zt(s,60,.6)),r.addElement(new zt(s,70,.7)),r.addElement(new zt(s,120,.9)),r.addElement(new zt(s,70,1)),a.add(r),a}}},useFileLoader:()=>{const e=He(0);return{load:t=>{const n=new Pt;return new Promise(((o,s)=>{n.load(t,(e=>{let t={};try{t=JSON.parse(e)}catch(n){}o(t)}),(t=>{let{loaded:n,total:o}=t;e.value=Number((n/o*100).toFixed(0))}),s)}))},progress:e}},useUpload:e=>{const t=hn({baseUrl:"",dracoPath:"/three/draco/gltf/",basisPath:"/three/basis/"},e);return{uploadModel:(e,n,o)=>{const{baseUrl:s,dracoPath:i,basisPath:a}=t,r=e[0],l=r.name,c=l.split(".").pop().toLowerCase(),d=new FileReader;d.addEventListener("progress",(e=>{const t="("+Math.floor(e.total/1e3)+" KB)",n=Math.floor(e.loaded/e.total*100)+"%";o&&o({progress:n,filename:l,size:t})})),d.addEventListener("load",(e=>Qt(void 0,void 0,void 0,(function*(){const t=e.target.result;if(["glb","gltf"].includes(c)){const e=new pt,o=new dt;o.setDecoderPath(`${s}${i}`),e.setDRACOLoader(o);const r=new ut;r.setTranscoderPath(`${s}${a}`),e.setKTX2Loader(r),e.setMeshoptDecoder(gt),e.parse(t,"",(t=>{var o,s,i;const a=t.scene.children;let r=new Je;a.length>1?r.add(...a):r=a[a.length-1],r.name=(null===(o=r.userData)||void 0===o?void 0:o.name)||l,r.animations.push(...t.animations),n(r),null===(s=e.dracoLoader)||void 0===s||s.dispose(),null===(i=e.ktx2Loader)||void 0===i||i.dispose()}))}else if("fbx"==c){const e=(new Ot).parse(t,"");n(e)}})))),d.readAsArrayBuffer(r)}}},useCollide:()=>{const e=new We,t=new Fe(0,2,0);return{checkCollide:(n,o,s,i=!0,a=t)=>{const r=o.clone().add(a),l=new Fe;n.getWorldDirection(l),l.normalize(),e.ray.origin.copy(r),e.ray.direction.copy(l);return e.intersectObjects(s,i)}}},useCoord:()=>({getBoundingBox:e=>{var t=new At;t.expandByObject(e);var n=new Fe;t.getSize(n);var o=new Fe;return t.getCenter(o),{box3:t,center:o,size:n}}}),useRaycaster:()=>{const e=new We,t=new Ke,n={left:0,top:0};return{raycaster:e,pointer:t,style:n,update:(e,o,s=1)=>{const i=o.getBoundingClientRect()||{left:0,top:0};t.x=(e.clientX-i.left)/(o.clientWidth*s)*2-1,t.y=-(e.clientY-i.top)/(o.clientHeight*s)*2+1;const a=o.clientWidth/2,r=o.clientHeight/2;n.left=t.x*a+a,n.top=-t.y*r+r}}},useCruise:_n,useCSS2D:()=>({initCSS2DRender:(e,t)=>{const{width:n,height:o}=e,s=new ue;return s.setSize(n,o),s.domElement.style.position="absolute",s.domElement.style.left="0px",s.domElement.style.top="0px",s.domElement.style.pointerEvents="none",t.appendChild(s.domElement),s},createCSS2DDom:e=>{const{name:t,className:n="",onClick:o,position:s}=e,i=document.createElement("div");i.innerHTML=t,i.className=n;const a=new Bt(i);return i.style.pointerEvents=o?"auto":"none",i.style.position="absolute","function"==typeof o&&i.addEventListener("click",(e=>o(e,a))),s&&a.position.set(...s),a}}),CSS2DRenderer:ue,useCSS3D:wn,CSS3DRenderer:ge,useFloor:(e={})=>{const t=hn({mode:"BA",margin:50},e),n=(e,t,n,o)=>{0!==t.length&&t.forEach((t=>{var s,i,a,r;const l=t._position_,c="UD"==e?(null!==(s=l.y)&&void 0!==s?s:0)+n:null!==(i=l.y)&&void 0!==i?i:0,d="BA"==e?(null!==(a=l.z)&&void 0!==a?a:0)+o:null!==(r=l.z)&&void 0!==r?r:0;new Ue(t.position).to({y:c,z:d},500).easing(Re.Quadratic.Out).start()}))};return{floorAnimate:(e,o,s)=>{var i,a,r,l,c,d;const p=void 0!==o&&o>-1,{margin:u,mode:g}=t;for(let t=0;t<e.length;t++){const m=e[t],h=m._position_;const f=(t-(p?o:t))*u;let v=(null!==(i=h.y)&&void 0!==i?i:0)+f,y=o==t?(null!==(a=h.z)&&void 0!==a?a:0)+u:null!==(r=h.z)&&void 0!==r?r:0;const w=o===t&&("UD"===g&&v===m.position.y||"BA"===g&&y===m.position.z);if(w&&(v=null!==(l=h.y)&&void 0!==l?l:0,y=null!==(c=h.z)&&void 0!==c?c:0),"UD"===g){if(m.position.y===v)continue}else if("BA"===g&&m.position.z===y)continue;if(null===(d=m.data)||void 0===d?void 0:d.mark){const e=s(m.data.mark);let i=o==t?u:0;w&&(i=0),n(g,e,f,i)}new Ue(m.position).to({y:"UD"===g?v:m.position.y,z:"BA"===g?y:m.position.z},500).easing(Re.Quadratic.Out).start()}}}},useDialog:(e={})=>{const t=lt(hn({show:!1,style:{left:"",top:""},select:[],data:{},title:"",position:{top:0,left:0}},e));return{dialog:t,options:t,show:ct(t.show)}},useGrid:kn,useMaterial:()=>{const e=(e,t=.5)=>{const n=e=>{e.material.transparent=!0,e.material.opacity=t};e.isMesh?n(e):e.traverse((e=>{e.isMesh&&n(e)}))},t=e=>({color:e.color,map:e.map,emissive:e.emissive,emissiveIntensity:e.emissiveIntensity,emissiveMap:e.emissiveMap,bumpMap:e.bumpMap,normalMap:e.normalMap,displacementMap:e.displacementMap,opacity:e.opacity,transparent:e.transparent,side:e.side}),n=(e,o,s)=>{if(e instanceof Array){let t=e.map((e=>n(e,o,s)));e=t}else o?(e.metalness=.5,e.roughness=0):(e.metalness=.5,e.roughness=1),e=new Dt(Object.assign(Object.assign({},t(e)),{metalness:e.metalness,roughness:e.roughness,side:s?Ct:$e}));return e},o=(e,t)=>{const n=document.createElement("a");n.style.display="none",document.body.appendChild(n),n.href=URL.createObjectURL(e),n.download=t,n.click(),n.remove()};return{materialReplace:(t,o,s,i=1211922)=>{const a=nn.mesh,r=a.animatehName,l=a.transparentName,{type:c,name:d}=s;if(c.indexOf("Light")>-1){if(!s.shadow)return;let e=800;if(s.castShadow=!0,s.shadow.camera.right=e,s.shadow.camera.left=-e,s.shadow.camera.top=e,s.shadow.camera.bottom=-e,"SpotLight"===c){let e=new Et(s,s.color);t.add(e)}}else if(o.transformMaterial&&s.isMesh)if(o.opacitySkin&&l.find((e=>d.indexOf(e)>-1))&&e(s,o.opacity),a.receiveShadowName.find((e=>d.indexOf(e)>-1))){s.receiveShadow=!0;const e=o.groundReflection;s.material=n(s.material,e,o.side)}else if(r.find((e=>d.indexOf(e)>-1))){let e=new Dt({color:i,metalness:.6,roughness:.6});s.material=e}else s.isMesh&&(s.castShadow=!0,s.receiveShadow=!0,s.material=n(s.material,o.glisten,o.side))},changeTransparent:e,exportGlb:(e,t,n,s=!0)=>{if(!e)return;const i={binary:s,animations:t};(new It).parse(e,(e=>{if(e instanceof ArrayBuffer)t=n+".glb",o(new Blob([e],{type:"application/octet-stream"}),t);else{((e,t)=>{o(new Blob([e],{type:"text/plain"}),t)})(JSON.stringify(e,null,2),n+".gltf")}var t}),(e=>{}),i)},getAnimations:e=>{const t=[];e.traverse((e=>{t.push(...e.animations)}));const n=[];for(const o of t)n.push(o.clone().optimize());return n},setMetalnessMaterial:(e={color:16777215},n,o)=>new Dt(Object.assign(Object.assign({},t(e)),{metalness:n,roughness:o})),setGlassMaterial:(e={color:16777215},{metalness:n=0,roughness:o=0,envMapIntensity:s=0,transmission:i=0,ior:a=0})=>new Ut(Object.assign(Object.assign({},t(e)),{metalness:n,roughness:o,envMapIntensity:s,transmission:i,ior:a})),centerBoxHelper:(e,t=16711680)=>{var n=new St(e,t);n.update();return{helper:n,center:(new At).setFromObject(e).getCenter(new Fe)}}}},useMoveAnimate:()=>{let e;const t={index:0,length:0,runing:!1,model:void 0,speed:1,endCallback:void 0,rungingCall:void 0},n=t=>null==e?void 0:e.getPoints(t),o=(n=!0)=>{if(t.runing=!1,n){const n=t.index-1;t.model.position.copy((n=>{let o=n/t.length;return o>1?o=1:o<0&&(o=0),e.getPointAt(o)})(n))}};return{createMove:(o,s,i,a)=>{const r=o.position,l=Math.atan2(-s.z+r.z,s.x-r.x);o.rotation.y=.5*Math.PI+l;const c=r.distanceTo(s);let d=Math.floor(c/t.speed);d<2&&(d=2);e=new Ve([r,s],!1,"catmullrom",0),e=new Ve(n(d),!1,"catmullrom",0),t.model=o,t.index=0,t.length=d,t.rungingCall=i,t.endCallback=a,t.runing=!0},moveAnimate:(n=1)=>{if(!t.runing)return;t.index+=n;let s=t.index/t.length;s>1&&(s=1);const i=e.getPointAt(s);t.model.position.copy(i),s>=1?(t.runing=!1,"function"==typeof t.endCallback&&t.endCallback(i)):"function"==typeof t.rungingCall&&t.rungingCall(i,o)}}},useRoam:()=>{let e,t={runing:!1,segment:2,close:!0,tension:0,offset:0,points:[],factor:1,speed:1,index:0,animateBack:void 0};const n=(n={})=>{if(e)return;t=hn({runing:!1,segment:2,close:!0,tension:0,offset:0,points:[],factor:1,speed:1,index:0,animateBack:void 0},n);const{points:s,tension:i,close:a}=t,r=[];for(let e=0;e<s.length;e++){const t=s[e];r.push(new Fe(t[0],t[1],t[2]))}e=new Ve(r,a,"catmullrom",null!=i?i:0),e=new Ve(o(),a,"catmullrom",null!=i?i:0)},o=()=>null==e?void 0:e.getPoints(s()),s=()=>{var e;return 1e3*(null!==(e=t.segment)&&void 0!==e?e:2)},i=(e,t)=>new Fe(t.x,t.y+e,t.z);return{createRoam:n,updateRoam:e=>{t=hn(t,e)},executeRoam:(n,o)=>{if(!n||!o)return;if(!e)return;const{runing:a,offset:r,factor:l,speed:c,animateBack:d}=t;if(!a)return;t.index+=l*c;const p=s(),u=t.index%p/p;let g=u+.01;g>1&&(g-=1);const m=e.getPointAt(g),h=i(r,e.getPointAt(u)),f=i(r,m);o.target=f,n._lookAt_=f,n.lookAt(o.target),"function"==typeof d&&d(h,m,e,u)},pause:()=>{t.runing=!1},play:()=>{t.runing=!0},reset:t=>{e=void 0,n(t)},getStatus:()=>t.runing}},useOpenTheDoor:()=>{let e={propertyName:"name",value:"",scale:10,axle:"z",isOpen:void 0,leftMatch:"左",rightMatch:"右",duration:1e3,angle:.5*Math.PI,autoClose:!0,delay:1e4};const t=(n,o)=>{const{propertyName:s,value:i,scale:a,axle:r,isOpen:l,leftMatch:c,rightMatch:d,duration:p,autoClose:u,delay:g}=hn(e,o),m=n.getObjectByProperty(s,i);if(!m)return Promise.reject();const h=m.children.find((e=>e.name.indexOf(c)>-1)),f=m.children.find((e=>e.name.indexOf(d)>-1));if(!h||!f)return Promise.reject();u&&clearTimeout(m.__timer__);const v=h.position,y=f.position;return null==m.__open__&&(h.__position__=(new Fe).copy(v),f.__position__=(new Fe).copy(y)),m.__open__=void 0!==l?l:!m.__open__,new Promise((e=>{const s=f.__position__[r]+(m.__open__?-a:0);if(y[r]===s)return e(m);new Ue(v).to({[r]:h.__position__[r]+(m.__open__?a:0)},p).delay(0).start(),new Ue(y).to({[r]:s},p).delay(0).start().onComplete((()=>{e(m)})),u&&m.__open__&&(m.__timer__=setTimeout((()=>{t(n,o)}),g+p))}))},n=(t,o)=>{const{propertyName:s,value:i,angle:a,axle:r,leftMatch:l,rightMatch:c,isOpen:d,duration:p,autoClose:u,delay:g}=hn(e,o),m=t.getObjectByProperty(s,i);if(!m)return Promise.reject();const h=m.children.find((e=>e.name.indexOf(l)>-1)),f=m.children.find((e=>e.name.indexOf(c)>-1));if(!h||!f)return Promise.reject();u&&clearTimeout(m.__timer__);const v=h.rotation,y=f.rotation;return null==m.__open__&&(h.__rotation__=(new Rt).copy(v),f.__rotation__=(new Rt).copy(y)),m.__open__=void 0!==d?d:!m.__open__,new Promise((e=>{const s=f.__rotation__[r]+(m.__open__?-a:0);if(y[r]===s)return e(m);new Ue(h.rotation).to({[r]:h.__rotation__[r]+(m.__open__?a:0)},p).delay(0).start(),new Ue(f.rotation).to({[r]:s},p).delay(0).start(),u&&m.__open__&&(m.__timer__=setTimeout((()=>{n(t,o)}),g+p))}))};return{dubleHorizontal:t,dubleRotate:n}},useKeyboardState:()=>{const e=["shift","ctrl","alt","meta"],t={left:37,up:38,right:39,down:40,space:32,pageup:33,pagedown:34,tab:9},n={},o={};let s,i;const a=(e,t)=>{var s=e.keyCode;n[s]=t,o.shift=e.shiftKey,o.ctrl=e.ctrlKey,o.alt=e.altKey,o.meta=e.metaKey},r=e=>{a(e,!0),"function"==typeof s&&s(e)},l=e=>{a(e,!1),"function"==typeof i&&i(e)};document.addEventListener("keydown",r,!1),document.addEventListener("keyup",l,!1);const c=s=>{for(var i=s.split("+"),a=0;a<i.length;a++){var r=i[a];if(!(-1!==e.indexOf(r)?o[r]:-1!=Object.keys(t).indexOf(r)?n[t[r]]:n[r.toUpperCase().charCodeAt(0)]))return!1}return!0};return{keyboardPressed:e=>Array.isArray(e)?e.findIndex(c)>-1:c(e),insertEvent:(e,t)=>{s=e,i=t},destroyEvent:()=>{document.removeEventListener("keydown",r,!1),document.removeEventListener("keyup",l,!1)}}},useBackground:ue=>{const ge=Cn.findIndex((e=>e==ue)),me=He(ge<0?0:ge),he=e=>{const t=Cn[me.value];t&&(ve(e,t),me.value++,me.value>=Cn.length&&(me.value=0))},fe=ue=>["posX.jpeg","negX.jpeg","posY.jpeg","negY.jpeg","posZ.jpeg","negZ.jpeg"].map((ge=>((ue,ge)=>new URL(Object.assign({"../src/assets/imgs/sky/216/negX.jpeg":e,"../src/assets/imgs/sky/216/negY.jpeg":t,"../src/assets/imgs/sky/216/negZ.jpeg":n,"../src/assets/imgs/sky/216/posX.jpeg":o,"../src/assets/imgs/sky/216/posY.jpeg":s,"../src/assets/imgs/sky/216/posZ.jpeg":i,"../src/assets/imgs/sky/217/negX.jpeg":a,"../src/assets/imgs/sky/217/negY.jpeg":r,"../src/assets/imgs/sky/217/negZ.jpeg":l,"../src/assets/imgs/sky/217/posX.jpeg":c,"../src/assets/imgs/sky/217/posY.jpeg":d,"../src/assets/imgs/sky/217/posZ.jpeg":p,"../src/assets/imgs/sky/218/negX.jpeg":u,"../src/assets/imgs/sky/218/negY.jpeg":g,"../src/assets/imgs/sky/218/negZ.jpeg":m,"../src/assets/imgs/sky/218/posX.jpeg":h,"../src/assets/imgs/sky/218/posY.jpeg":f,"../src/assets/imgs/sky/218/posZ.jpeg":v,"../src/assets/imgs/sky/219/negX.jpeg":y,"../src/assets/imgs/sky/219/negY.jpeg":w,"../src/assets/imgs/sky/219/negZ.jpeg":x,"../src/assets/imgs/sky/219/posX.jpeg":b,"../src/assets/imgs/sky/219/posY.jpeg":_,"../src/assets/imgs/sky/219/posZ.jpeg":k,"../src/assets/imgs/sky/220/negX.jpeg":C,"../src/assets/imgs/sky/220/negY.jpeg":S,"../src/assets/imgs/sky/220/negZ.jpeg":j,"../src/assets/imgs/sky/220/posX.jpeg":L,"../src/assets/imgs/sky/220/posY.jpeg":M,"../src/assets/imgs/sky/220/posZ.jpeg":z,"../src/assets/imgs/sky/221/negX.jpeg":P,"../src/assets/imgs/sky/221/negY.jpeg":O,"../src/assets/imgs/sky/221/negZ.jpeg":A,"../src/assets/imgs/sky/221/posX.jpeg":T,"../src/assets/imgs/sky/221/posY.jpeg":B,"../src/assets/imgs/sky/221/posZ.jpeg":E,"../src/assets/imgs/sky/222/negX.jpeg":D,"../src/assets/imgs/sky/222/negY.jpeg":I,"../src/assets/imgs/sky/222/negZ.jpeg":U,"../src/assets/imgs/sky/222/posX.jpeg":R,"../src/assets/imgs/sky/222/posY.jpeg":F,"../src/assets/imgs/sky/222/posZ.jpeg":X,"../src/assets/imgs/sky/223/negX.jpeg":N,"../src/assets/imgs/sky/223/negY.jpeg":G,"../src/assets/imgs/sky/223/negZ.jpeg":Z,"../src/assets/imgs/sky/223/posX.jpeg":J,"../src/assets/imgs/sky/223/posY.jpeg":Y,"../src/assets/imgs/sky/223/posZ.jpeg":Q,"../src/assets/imgs/sky/224/negX.jpeg":H,"../src/assets/imgs/sky/224/negY.jpeg":W,"../src/assets/imgs/sky/224/negZ.jpeg":K,"../src/assets/imgs/sky/224/posX.jpeg":V,"../src/assets/imgs/sky/224/posY.jpeg":$,"../src/assets/imgs/sky/224/posZ.jpeg":q,"../src/assets/imgs/sky/225/negX.jpeg":ee,"../src/assets/imgs/sky/225/negY.jpeg":te,"../src/assets/imgs/sky/225/negZ.jpeg":ne,"../src/assets/imgs/sky/225/posX.jpeg":oe,"../src/assets/imgs/sky/225/posY.jpeg":se,"../src/assets/imgs/sky/225/posZ.jpeg":ie,"../src/assets/imgs/sky/226/negX.jpeg":ae,"../src/assets/imgs/sky/226/negY.jpeg":re,"../src/assets/imgs/sky/226/negZ.jpeg":le,"../src/assets/imgs/sky/226/posX.jpeg":ce,"../src/assets/imgs/sky/226/posY.jpeg":de,"../src/assets/imgs/sky/226/posZ.jpeg":pe})[`../src/assets/imgs/sky/${ue}/${ge}`],self.location).href)(ue,ge))),ve=(e,t)=>{const n=fe(t);if("function"==typeof e.setBgTexture)e.setBgTexture(n);else if(Array.isArray(n)){const t=(new Be).load(n);e.background=t}else e.background=(new Ee).load(n)};return{skys:Cn,index:me,change:he,changeBackground:he,load:ve,getBgGroup:fe,backgroundLoad:ve}},useModelLoader:(e={})=>{let t;const n=hn({baseUrl:"",dracoPath:"/three/draco/gltf/",basisPath:"/three/basis/",modelSizeKB:1048576,colors:{normal:{color:8954293},runing:{color:3045368},error:{color:12717056}},loadCache:!0,colorMeshName:[],indexDB:{cache:!0}},e),o=lt({percentage:0,show:!1,isEnd:!1,list:[],total:0,loaded:0}),s={base:"base",device:"device",font:"font",sprite:"sprite",pipe:"pipe",warning:"warning",remote:"remote",local:"local",disabled:"disabled",spotlight:"spotlight"},i=new Map,a=new dt;a.setDecoderPath(n.baseUrl+n.dracoPath);const r=new pt;r.setDRACOLoader(a);const l=new ut;l.setTranscoderPath(n.baseUrl+n.basisPath),r.setKTX2Loader(l),r.setMeshoptDecoder(gt);const c=e=>{const t=e.loaded,n=o.total;let s=Number((t+o.loaded)/n*100);s>100&&(s=100),o.percentage=Number(s.toFixed(2))},d=(e,t,o,s)=>{if(!o)return;const{baseUrl:a,colorMeshName:r}=n,{mapUrl:l,key:c,mapMeshName:d,repeat:p=[1,1]}=e;let u;l&&d&&(u=(new Ee).load(Kt(l,a)),u.wrapS=Qe,u.wrapT=Qe,u.repeat.set(p[0],p[1]));const g=sn(o);return g.traverse((e=>{e.isMesh&&u&&e.name.indexOf(d)>-1?e.material=new rt({side:Ct,transparent:!0,opacity:0,map:u.clone()}):an(e,t,r||[])})),l&&d&&(g._mapMeshName_=d),g.animations=s,c&&i.set(c,g),g},p=(e,o=0)=>new Promise((s=>Qt(void 0,void 0,void 0,(function*(){var i;n.indexDB.cache||s(null);const a=Ie.get(e);if(a)a instanceof ArrayBuffer?(c({loaded:a.byteLength}),r.parse(a,"",(t=>{Ie.add(e,t),s(t)}))):(c({loaded:o*n.modelSizeKB}),setTimeout((()=>{s(a)}),10));else{const o=yield en(t,(null===(i=n.indexDB)||void 0===i?void 0:i.tbName)||nn.indexdb.tbName,e);if(o&&o.data){const e=o.data;"string"==typeof e?(c({loaded:e.length}),Ie.add(o.path,e),setTimeout((()=>{s(e)}),10)):(c({loaded:e.byteLength}),r.parse(e,"",(e=>{Ie.add(o.path,e),s(e)})))}else s(null)}})))),u=e=>{var o;if(!n.indexDB.cache)return;const s=Ie.get(e);if(s&&t){const i=(null===(o=n.indexDB)||void 0===o?void 0:o.tbName)||nn.indexdb.tbName;t.transaction(i,"readwrite").objectStore(i).add({path:e,data:s})}},g=(e,t)=>{const{key:o,url:s="",size:i=0}=e,{baseUrl:a,colors:l}=n;return new Promise(((n,g)=>Qt(void 0,void 0,void 0,(function*(){let m=l.normal[o]||l.normal.color;m=rn(m)[0];const h=Kt(s,a),f=yield p(h,i);if(f){const t=f.scene.children[0],o=d(e,m,t,f.animations);return void n(o)}let v=(h.split(".").pop()||"").toLowerCase();if("glb"!==v)throw new Error("模型类型错误,必须为 GLB 格式，当前格式："+v);r.load(h,(t=>{const o=t.scene.children;let s=new Je;o.length>1?s.add(...o):s=o[o.length-1];const i=d(e,m,s,t.animations);u(h),n(i)}),(e=>{c(e),"function"==typeof t&&t(e)}),g)}))))},m=(e,t={})=>{t=hn({color:57599,wireframe:!0,opacity:.5,filter:[],filterMatch:[]},t),e.traverse((e=>{var n;(null===(n=t.filter)||void 0===n?void 0:n.includes(e.name))||h(e.name,t.filterMatch)||e.isMesh&&(e.__material__||(e.__material__=e.material),e.material=new nt({color:t.color,wireframe:t.wireframe,transparent:!0,opacity:t.opacity}))}))},h=(e="",t=[])=>t.filter((t=>e.indexOf(t)>-1)).length>0;return{progress:o,MODEL_MAP:s,loadModel:g,loadModels:(e,a,r)=>Qt(void 0,void 0,void 0,(function*(){var l,d,m;yield qt((null===(l=n.indexDB)||void 0===l?void 0:l.tbName)||nn.indexdb.tbName,(null===(d=n.indexDB)||void 0===d?void 0:d.dbName)||nn.indexdb.dbName,(null===(m=n.indexDB)||void 0===m?void 0:m.version)||nn.indexdb.version).then((e=>(e&&(Ie.enabled=!0,t=e),e)));const h=e.length;if(!(0==h?(o.isEnd=!0,o.show=!1,0):(o.isEnd=!1,o.percentage=0,o.show=!0,1)))return;(e=>{for(let t=0;t<e.length;t++)o.total+=(e[t].size||0)*n.modelSizeKB})(e);let f=0;const v=()=>Qt(void 0,void 0,void 0,(function*(){const t=e[f],{type:l=s.device,size:d=0}=t;switch(l){case s.device:case s.pipe:yield g(t,r);break;case s.sprite:(e=>{const{key:t,range:o={x:1,y:1},mapUrl:s=""}=e;let a=(new Ee).load(n.baseUrl+s),r=new Gt({map:a}),l=new Zt(r),c=o.x,d=o.y;l.scale.set(c,d,1),l.name="sprite",i.set(t,l)})(t);break;case s.font:yield((e,t)=>{const{url:o="",size:a=0}=e,{baseUrl:r}=n,l=Kt(o,r),d=new Jt;return new Promise(((e,n)=>Qt(void 0,void 0,void 0,(function*(){const o=yield p(l,a);if(o){const t=d.parse(JSON.parse(o));return i.set(s.font,t),void setTimeout((()=>{e(t)}),10)}d.load(l,(t=>{i.set(s.font,t),u(l),e(t)}),(e=>{c(e),"function"==typeof t&&t(e)}),n)}))))})(t,r);break;case s.warning:t.key=s.warning,yield g(t,r);break;case s.local:t.key=s.local,yield g(t,r);break;case s.disabled:t.key=s.disabled,yield g(t,r);break;case s.spotlight:(e=>{const{key:t,color:n=16777215,intensity:o=8,distance:s=10,angle:a=.2*Math.PI,penumbra:r=.2,decay:l=0}=e;let c=new Yt(n,o,s,a,r,l);c.castShadow=!0,c.visible=!1,i.set(t,c)})(t)}f++,o.loaded+=d*n.modelSizeKB,f>=h?(o.percentage=100,o.isEnd=!0,a()):v()}));v()})),getModel:e=>i.get(e),virtualization:(e=[],t,n={})=>{const o=n.filter||[],s=n.filterMatch||[];if(e.length)for(let i=0;i<e.length;i++){const a=e[i];t.uuid===a.uuid||o.includes(a.name)||h(a.name,s)||m(a,n)}else m(t,n)},closeVirtualization:e=>{if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t].traverse((e=>{e.isMesh&&e.__material__&&(e.material=e.__material__)}));else e.traverse((e=>{e.isMesh&&e.__material__&&(e.material=e.__material__)}))}}}});const{createCruise:Mn,cruiseAnimate:zn,updateCruise:Pn,bindEvent:On,removeEvent:An}=_n(),{createFork:Tn}=kn();class Bn{constructor(e={}){Sn.add(this);const t=yn;this.options=hn(t,e),Bn.total++,this.pointer={tsp:0,isClick:!1},gn(this.options.container)?this.container=this.options.container:this.container=document.querySelector(this.options.container),this.options.width=this.container.offsetWidth,this.options.height=this.container.offsetHeight,this.scene=new me,this.renderer=this.initRenderer(),this.baseCamera=this.initCamera(),this.controls=this.initControls(),this.init(),this.initCruise()}get camera(){const{visible:e,runing:t,auto:n}=this.options.cruise;return e&&this.cruiseCamera&&t?this.cruiseCamera:this.baseCamera}init(){this.initLight(),this.initGrid(),this.initAxes(),this.initModel()}run(){this.loop()}loop(){this.animationId=window.requestAnimationFrame((()=>{this.loop()})),this.animate(),this.modelAnimate()}animate(){var e;this.renderer&&this.renderer.render(this.scene,this.camera),this.options.controls.visible&&(null===(e=this.controls)||void 0===e||e.update()),zn(this.cruiseCamera),he()}initModel(){}modelAnimate(){}initRenderer(){const{width:e,height:t,bgColor:n,bgUrl:o,env:s}=this.options,i=new fe(this.options.render);if(s&&this.setEnvironment(s),o?this.setBgTexture(o):this.setBgColor(n),this.options.fog.visible){const{color:e,near:t,far:n}=this.options.fog;this.scene.fog=new ve(null!=e?e:this.scene.background,t,n)}return i.sortObjects=!0,i.shadowMap.enabled=!0,i.shadowMap.type=ye,i.setSize(e,t),i.setPixelRatio(window.devicePixelRatio),this.container.appendChild(i.domElement),i}initLight(){const{ambientLight:e,directionalLight:t}=this.options;if(e.visible){const t=new we(e.color,e.intensity);this.addObject(t)}if(t.visible){const e=this.createDirectionalLight(),[n=0,o=0,s=0]=t.position;if(e.position.set(n,o,s),this.addObject(e),t.helper){const t=new xe(e,1);this.addObject(t)}if(t.light2){const e=this.createDirectionalLight(!1),[n=0,o=0,s=0]=t.position2;if(e.position.set(n,o,s),this.addObject(e),t.helper){const t=new xe(e,1);this.addObject(t)}}}}createDirectionalLight(e=!0,t=2e3,n=4096,o=1,s=2e4){const{color:i,intensity:a}=this.options.directionalLight,r=new be(i,a);if(e){r.shadow.mapSize.setScalar(n),r.shadow.bias=-1e-5,r.shadow.normalBias=.01,r.castShadow=e;const i=r.shadow.camera;i.near=o,i.far=s,i.top=i.right=t,i.left=i.bottom=-t,i.updateProjectionMatrix()}return r}initCamera(){const{width:e,height:t,camera:n}=this.options;let o=new _e(36,e/t,n.near,n.far);if(n.orthogonal){let s=e/t,i=260;o=new ke(-i*s,i*s,i,-i,n.near,n.far)}if(o.position.set(...n.position),o.lookAt(0,0,0),n.helper){const e=new Ce(o);this.addObject(e)}return o}initControls(){const e=this.options.controls;if(!e.visible)return;const t=new Se(this.camera,this.renderer.domElement);return Object.keys(e).forEach((n=>{t[n]=e[n]})),t.target.set(0,0,0),t.saveState(),t}initCruise(){const{visible:e}=this.options.cruise;e&&(this.cruiseCamera=this.initCamera(),function(e,t,n,o){if("a"===n&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?o:"a"===n?o.call(e):o?o.value:t.get(e)}(this,Sn,"m",jn).call(this))}initGrid(){const e=this.options.grid;if(!e.visible)return;const{width:t,divisions:n,centerLineColor:o,gridColor:s,opacity:i,transparent:a,fork:r}=e,l=new je(t,n,o,s);if(l.material.opacity=i,l.material.transparent=a,this.grid=l,this.addObject(l),r){const t=Tn(e);t.name="辅助交叉点",t._isGridFork_=!0,this.addObject(t)}}initAxes(){if(!this.options.axes.visible)return;const e=new Le(this.options.axes.size);this.addObject(e)}createGround(e=5e3,t,n=11721691){const o=new Me(e,t=void 0===t?e:t),s=new ze({color:n,shininess:10}),i=new Pe(o,s);return i.name="ground",i.rotation.x=1.5*Math.PI,i.receiveShadow=!0,i}createClock(){this.clock=new Oe}setCruisePoint(e){this.options.cruise.points=e,this.createCruise()}createCruise(){const{visible:e,points:t,alway:n}=this.options.cruise;if(!e)return;if(this.cruiseGroup&&this.disposeObj(this.cruiseGroup),On(),!t||0==t.length)return;const o=Mn(this.options.cruise,this.renderer);this.cruiseGroup=o,o.visible=n,this.addObject(o)}toggleCruise(e){let{visible:t,runing:n,auto:o,alway:s}=this.options.cruise;t&&(n=null!=e?e:n,this.options.cruise.runing=!n,this.options.cruise.enabled=!n,this.controls&&(this.controls.enabled=o||n),this.cruiseGroup&&!s&&(this.cruiseGroup.visible=!n),Pn(this.options.cruise))}toggleCruiseDepthTest(e){this.cruiseGroup&&this.cruiseGroup.traverse((t=>{(t.isMesh||t.isLine)&&(t.material.depthTest=null!=e?e:!t.material.depthTest)}))}setScale(e){this.options.scale=e}setEnvironment(e){(new Ae).load(Kt(e,this.options.baseUrl),(e=>{e.mapping=Te,this.scene.environment=e}))}setBgTexture(e){if(Array.isArray(e)){const t=(new Be).load(Kt(e,this.options.baseUrl));this.scene.background=t}else this.scene.background=(new Ee).load(Kt(e))}setBgColor(e){this.scene.background=e?new De(e):null}bindEvent(){const e=this.renderer.domElement;e.addEventListener("dblclick",this.onDblclick.bind(this)),e.addEventListener("pointerdown",this.onPointerDown.bind(this)),e.addEventListener("pointermove",this.onPointerMove.bind(this)),e.addEventListener("pointerup",this.onPointerUp.bind(this))}onDblclick(e){}onPointerDown(e){this.pointer.isClick=!0,this.pointer.tsp=e.timeStamp}onPointerMove(e){}onPointerUp(e){this.pointer.isClick=!1}exportImage(){const e=document.createElement("a");e.download="render.png",e.href=this.renderer.domElement.toDataURL().replace("image/png","image/octet-stream"),e.click()}getPosition(){var e;return{position:this.camera.position,target:null===(e=this.controls)||void 0===e?void 0:e.target}}isCameraMove(e,t=1){const n=this.camera.position;return Math.abs(n.x-e.x)<t&&Math.abs(n.y-e.y)<t&&Math.abs(n.z-e.z)<t}addObject(...e){this.scene.add(...e)}controlSave(){var e;null===(e=this.controls)||void 0===e||e.saveState()}controlReset(){var e;null===(e=this.controls)||void 0===e||e.reset(),this.toggleCruise(!0)}getValidTargetPosition(e,t,n,o={x:-104,y:7,z:58}){const s=t||e.to||o,i=n||e.target||{x:0,y:0,z:0},a=this.controls;return a&&a.target&&a.target.set(i.x,i.y,i.z),s}resize(){this.options.width=this.container.offsetWidth||window.innerWidth,this.options.height=this.container.offsetHeight||window.innerHeight;const{width:e,height:t,camera:n}=this.options,o=e/t;n.orthogonal||(this.baseCamera.aspect=o),this.baseCamera.updateProjectionMatrix(),this.cruiseCamera&&(n.orthogonal||(this.cruiseCamera.aspect=o),this.cruiseCamera.updateProjectionMatrix()),this.renderer.setSize(e,t)}stopAnimate(){window.cancelAnimationFrame(this.animationId)}clear(e){e&&e.traverse&&(e.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),null==e||e.clear()})),null==e||e.clear())}disposeObj(e){e&&e.traverse&&(e.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),null==e||e.clear()})),null==e||e.clear(),this.scene.remove(e))}dispose(){var e;An(),this.stopAnimate();try{Ie.clear(),this.disposeObj(this.scene),this.scene.clear(),this.renderer.dispose(),this.renderer.forceContextLoss();let t=this.renderer.domElement.getContext("webgl");t&&(null===(e=t.getExtension("WEBGL_lose_context"))||void 0===e||e.loseContext()),this.disposeObj(this.cruiseGroup),this.disposeObj(this.grid),this.controls&&this.controls.dispose(),this.scene=void 0,this.renderer=void 0,this.baseCamera=void 0,this.cruiseCamera=void 0,this.controls=void 0,this.grid=void 0,this.cruiseGroup=void 0,this.container.innerHTML=""}catch(t){}}}Sn=new WeakSet,jn=function(){const e=this.options.cruise;e.enabled=!1,e.runing=!1,e.baseUrl&&(e.baseUrl=this.options.baseUrl),e.factor=1},Bn.total=0;const En=Object.freeze(Object.defineProperty({__proto__:null,Hooks:Ln,Scene:Bn,Utils:vn},Symbol.toStringTag,{value:"Module"}));export{Bn as S,En as T,vn as a,Ln as i};
