var e=Object.defineProperty,t=(t,s,i)=>(((t,s,i)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i})(t,"symbol"!=typeof s?s+"":s,i),i);import{bc as s,dH as i,er as a,dd as o,ee as r,dE as n,ep as d,dl as u,eE as l,bb as c,eF as h,b7 as m,cZ as p,bh as x,ex as b,b6 as g,eG as N,eH as f,eq as w,e as y,i as v,l as M,o as T,g as j,h as C}from"./vendor-4c59ff80.js";import{m as P,l as Y,u as k}from"./scene-resize-e14e822b.js";import"./index-7cc312c2.js";const D=w,{color:L,vec2:E,pass:W,linearDepth:_,normalWorld:z,objectPosition:A,screenUV:B,viewportLinearDepth:O,viewportDepthTexture:R,viewportSharedTexture:G,mx_worley_noise_float:F,positionWorld:S,time:H}=D,U=Y,{getBgGroup:V}=U.useBackground(),q=(new s).load("/oss/textures/gpu/water.jpg");q.wrapS=i,q.wrapT=i,q.colorSpace=a;const I={mix:0,procedural:0,intensity:1,hue:0,saturation:1},Z={offsetCube1:0,offsetCube2:0};class J extends P{constructor(e){super(e),t(this,"water"),t(this,"blurNode"),t(this,"mixNode"),t(this,"proceduralNode"),t(this,"intensityNode"),t(this,"hueNode"),t(this,"saturationNode"),t(this,"rotateY1Matrix"),t(this,"rotateY2Matrix"),t(this,"cube1Texture"),t(this,"cube2Texture"),t(this,"postProcessing"),t(this,"gui"),t(this,"floor"),t(this,"getEnvironmentNode",((e,t)=>{const{rotateY1Matrix:s,rotateY2Matrix:i,mixNode:a,proceduralNode:o,intensityNode:r,hueNode:n,saturationNode:d}=this,u=e.xyz.mul(D.uniform(s)),l=e.xyz.mul(D.uniform(i)),c=D.mix(D.pmremTexture(this.cube1Texture,u),D.pmremTexture(this.cube2Texture,l),t.y.add(a).clamp()),h=D.mix(c,D.normalWorld,o).mul(r),m=D.hue(h,n);return D.saturation(m,d)})),this.postProcessing=null,this.blurNode=D.uniform(0),this.mixNode=D.reference("mix","float",I),this.proceduralNode=D.reference("procedural","float",I),this.intensityNode=D.reference("intensity","float",I),this.hueNode=D.reference("hue","float",I),this.saturationNode=D.reference("saturation","float",I),this.rotateY1Matrix=new o,this.rotateY2Matrix=new o;const s=new r(3355494,7654644,5),i=new r(7654644,0,1);this.addObject(i),this.addObject(s),this.addModel(),this.addWater(),this.addProcessing(),this.gui=new n,this.addGui()}createRender(){return new d}createDirectionalLight(e,t){return new u(e,t)}async addModel(){let e=await(new l).setMaxRange(16).loadCubemap(V("228","png"));e=await(new c).loadAsync(V("225","jpeg")),e.generateMipmaps=!0,e.minFilter=h,this.cube1Texture=e;const t=await(new c).loadAsync(V("221","jpeg"));t.generateMipmaps=!0,t.minFilter=h,this.cube2Texture=t,this.scene.environmentNode=this.getEnvironmentNode(D.reflectVector,D.positionWorld),this.scene.backgroundNode=this.getEnvironmentNode(D.positionWorldDirection,D.positionLocal).context({getTextureLevel:()=>this.blurNode});const s=new m(new p(.5,64,32),new x({metalness:1,roughness:0}));this.addObject(s)}addWater(){this.scene.backgroundNode=z.y.mix(L(296930),L(26367));const e=H.mul(.8),t=S.xzy,s=F(t.mul(4).add(e)),i=F(t.mul(2).add(e)),a=s.mul(i),o=a.mul(1.4).mix(L(296930),L(7654644)),r=_(),n=O.sub(r).remapClamp(-.002,.04),d=B.add(E(0,a.mul(.1))),u=_(R(d)).sub(r),l=u.remapClamp(0,.1),c=u.lessThan(0).select(B,d),h=G(c),p=new b;p.colorNode=o,p.backdropNode=n.mix(G(),h.mul(l.mix(1,o))),p.backdropAlphaNode=l.oneMinus(),p.transparent=!0;const x=new m(new g(50,.001,50),p);x.position.set(0,0,0),this.water=x,this.addObject(this.water)}addProcessing(){var e;null==(e=this.controls)||e.target.set(0,.2,0);const{camera:t,scene:s,renderer:i}=this,a=W(s,t),o=a.getTextureNode(),r=a.getLinearDepthNode().remapClamp(.3,.5),n=A(t).y.greaterThan(B.y.sub(.5).mul(t.near)),d=N(o);d.directionNode=n.select(r,a.getLinearDepthNode().mul(5));const u=B.distance(.5).mul(1.35).clamp().oneMinus(),l=new f(i);l.needsUpdate=!0,l.outputNode=n.select(d,d.mul(L(7654644)).mul(u)),this.postProcessing=l}addGui(){var e;const t=this.gui;t.add({blurBackground:this.blurNode.value},"blurBackground",0,1,.01).name("背景模糊").onChange((e=>{this.blurNode.value=e})),t.add(I,"mix",-1,2,.01).name("混合"),t.add(I,"intensity",0,5,.01).name("曝光"),t.add(I,"saturation",0,2,.01).name("饱和度"),t.domElement.className+=" gui-wrap",null==(e=this.container.parentNode)||e.appendChild(t.domElement)}animate(){this.postProcessing&&(this.postProcessing.renderAsync(),this.cube2Texture&&(Z.offsetCube1+=.001,Z.offsetCube2+=5e-4,this.rotateY1Matrix.makeRotationY(Z.offsetCube1),this.rotateY2Matrix.makeRotationY(Z.offsetCube2)))}dispose(){var e,t;this.postProcessing=null,this.blurNode=null,this.mixNode=null,this.proceduralNode=null,this.intensityNode=null,this.hueNode=null,this.saturationNode=null,this.rotateY1Matrix=null,this.rotateY2Matrix=null,null==(e=this.cube1Texture)||e.dispose(),null==(t=this.cube2Texture)||t.dispose(),this.gui=null,super.dispose()}}const K={class:"three-page"},Q=y({__name:"index",setup(e){const t=v(),s={directionalLight:{color:16770201,intensity:5,position:[.5,3,.5],light2:!1},ambientLight:{visible:!1},render:{logarithmicDepthBuffer:!1},camera:{near:.25,far:25,position:[3,2,4]},controls:{minDistance:1,maxDistance:10,maxPolarAngle:.9*Math.PI}};let i;return M((()=>{s.container=t.value,i=new J(s),i.run(),k(i).resize()})),(e,s)=>(T(),j("div",K,[C("div",{class:"h-100",ref_key:"containerRef",ref:t},null,512)]))}});export{Q as default};
