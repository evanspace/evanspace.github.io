var e,t,i,s,a=Object.defineProperty,o=(e,t,i)=>(((e,t,i)=>{t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i),r=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},n=(e,t,i)=>(r(e,t,"read from private field"),i?i.call(e):t.get(e)),l=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},c=(e,t,i,s)=>(r(e,t,"write to private field"),s?s.call(e,i):t.set(e,i),i),p=(e,t,i)=>(r(e,t,"access private method"),i);import{b6 as d,bs as g,dt as h,dk as u,dv as m,dw as A,be as f,dD as S,dV as C,dW as k,bo as b,ec as v,eb as E,bc as J,ba as I,bk as y,dE as B,cV as U,e as w,i as G,w as R,l as Q,aP as j,o as L,g as M,h as D,n as P,u as O,a9 as K,a5 as x,B as z,Y,q as F,p as q,I as W,t as V,c as X,ak as H}from"./vendor-9759b632.js";import{m as _,l as N,A as T,u as Z}from"./scene-resize-6de18767.js";import{_ as $,e as ee,A as te,n as ie}from"./index-14dfb97f.js";const se={depth:1,scale:40,plateRadius:200,rightClickBackDiffTime:100,areaLabel:!1,markLight:!1,border:!0,mapBg:!0,mapBar:!0,bgOutFactor:1,bgInnerFactor:.9,map:{}},ae={main:3377879,mainHover:9633791,borderColor:9633791,borderHoverColor:1066618,light:1066618,lightHover:9633791,plateColor:3377879,plateLight:1066618,line:9559027,line2:6421501,gridColor:663606,gridFork:927811,outline:11856636,markColor1:13303807,markColor2:6945023,flyColor1:9559027,flyColor2:6421501,scatterColor1:9559027,scatterColor2:6421501},oe=N,re=T,{initCSS3DRender:ne,createCSS3DDom:le}=oe.useCSS3D(),{raycaster:ce,pointer:pe,style:de,update:ge}=oe.useRaycaster(),{createCorrugatedPlate:he,corrugatedPlateUpdate:ue}=oe.useCorrugatedPlate(),{getBoundingBox:me}=oe.useCoord(),{createMarkLight:Ae}=oe.useMarkLight(),{createCountryFlatLine:fe,getPoints:Se}=oe.useCountryLine(),{createOutline:Ce,outlineUpdate:ke}=oe.useOutline(),{createFlywireTexture:be,createFlywire:ve,flywireUpdate:Ee}=oe.useFlywire(),{createBar:Je}=oe.useMapBar(),Ie={x:105.06,y:0,z:32.93},ye=new d;let Be,Ue,we,Ge,Re;const Qe=(e,t="")=>new URL(Object.assign({"./imgs/border.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGUAAAE1CAYAAAD+hS6MAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALrSURBVHgB7dOxDQJBEMDABV1fdE5Mhr4IwkMiIUNPGw5mWrB8ue19DinXIUeUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAlax+M+tDglSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlaH2fx9DilCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJWud+Dy1OCRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECVq/12docUqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBP0B9I0QJBOMnj4AAAAASUVORK5CYII=","./imgs/circle.png":"/imgs/circle-f2c3f6ed.png","./imgs/gz-map-fx.jpg":"/imgs/gz-map-fx-c5e413a7.jpg","./imgs/gz-map.jpg":"/imgs/gz-map-15a6793f.jpg","./imgs/inner-circle.png":"/imgs/inner-circle-8c61cf85.png","./imgs/label.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAK+SURBVHgB7dzNbdswGIdxSugCRtGBuklWSO17nXs/J0hHywA11AEMu3wDsLFT5WCJ5PtI/D8nQ5cA/FmxJJLqtofhHBSmPihUAoElEFgCgfVu7ODX95suqOKNXVDpDIElEFgCgSUQWAKBJRBYAoE1G2Q3DJ/j9fRjUGE7DI+f4niEGc0CMYzzKezjx7vWUQwjnMJdF8djDsq8M+QYLu/om0VJGP8OXI/LTc0C+fJhs4/fiIeLQ82hvMaI/zEevsVxCROb/RvSMkpuDCvLVVaLKCUwrGyXvS2hlMKwst6HtIBSEsPKfmO4ZpTSGFaRO/U1otTAsIo9OlkTSi0Mq+izrDWg1MSwij9cXDJKbQyrytPeJaJ4YFjVHr8vCcULw6o6H7IEFE8Mq/oEFRnFG8NymTEkohAwLLcpXBIKBcNynVMnoJAwLPdFDp4oNAwLserEA4WIYXVjK7C9Vr+fY8Gh7e8/Lhha/f5GhDMjJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJZDwvIIQs2kIA/K81tYvzKYhBMh/75vyCYHiDgLBSLmjuIK8xrBV6J1HoO11biCk/Rmk7XUuIMTNMhSU6iDUnUsWAaUqCBkj5Y1SDWQJGClPlCogS8JIeaEUB1kiRsoDpSjIkjFStVGKgawBI1UTpQjImjBStVCyg6wRI1UDJSvImjFSpVGygbSAkSqJkgWkJYxUKZTZIC1ipEqgzAJpGSOVG2UyiDBeyokyCWR3OOyFcd0Yyu4wfA83Ngnk2Pe/ziE82WdhvHSJYuNz7MPPcGOTQH5sNk+nPnyMf/xeGNcZSvyS3tv42DiFG0O94q+19Iq/BSQQWAKBJRBYAoElEFgCgSUQWKM3hsovnSGwBAJLILAEAusvLK6Na4P/Au0AAAAASUVORK5CYII=","./imgs/light.png":"/imgs/light-aa132c89.png","./imgs/out-circle.png":"/imgs/out-circle-6854860a.png","./imgs/point.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAABCtJREFUWIXVmU1oXFUUx3/zSptF4qYliNAUJB8tUnRhXSiSWhcmEekiXVi1C20Ximm7li5EsFDUrYsuBVeNCCroIgXF2iKtCRioIp1shIC1I0g7TUIS7d/FPTfz+vLu+5i8GewfLjP33vPxf3fu3HfuOTVJbAG9wLPAQeAxYAR4GOiz+bvAn8AN4FfgEvADsNS2R0llW03SuKQLkpZVHsumO262SvmvlVzhSeBd4Anr3wNmgW+BOVvJxdgK9gK7gWHgAHAIeAqIbH4eeA/4ouoVHpQ0E1ulRUlnJO1p4xfaY7qLMXsz5iNXv4iDlyXdNsMNSScl9bRBNNl6zFbDbN+WdHQrhGuSzsZW4TNJuyogmmy7zLbHWWXs7SyyH5uBfySd6gDRZDspad18ng+RDimfM8VlSYe7QNa3lyQtme9zRQkfja1sEbI1SaOSPpB0WdJNSavWbtrYhyZT5Bg7bL4l6ZU8woNq/cFO5xiOJB2XVFdx1E0nyrF92uTvKHF6JAX90TWdY/BRSddKEE3imtnI8jFtsjMhwpMm8Jek/gxDz6l1FG0FDbltEvKzU9Itk51MEq5J+tkmpzKMvCC3N6vCqqSxDH9vmdy8cdwgPGYTv0vaHlDeK7enqkbTbKf53G6cJBd7bLzT37DP88B6yht8G/Ap8FDhd35x9JntbSlz68YJ4HUAJPVKWpH0r6SBwJMe78DKJnEi4HvAuK1I6o1vh6sBhZrKHV3toq7wOX3VZMYiXPANLkRMwygwVNkGCGPIfKXBczsYAfutMxcQfrFKVjkI+fLc9ke44Brgt4DwM5VSysbTgXHPbTgC+q3zR0B4ODDeCYwExj23/pqkVWAH0AOspQj7+W5gzXgkscN4rEUpk/9rREDTvodeCn93iUuWL8+tGQEN6zwSEK5XSikbNwLjnlsjokVob0D4x0opZSPky3OrR8B16zwZEP66UkrZ+CYwfsA+r0e49BHA8wHhS8BClawCWMClsdJwaIOLigU/J7oQSxQKfiJcWulL3IlxLPCEn+BSUp3CnPlIwzEct6+AJf8U4/aUWQH8Prlgu2o0zXZeAD+hxBVp3ibeDihjSlVfkSYy/L1pcpuuSGUuoROqZqWbOWTjl9AjfjwpVPSav0/S7BbIziq8DXy7YLIX4+NJoUG1Lpp5+TSfSFkoQXRBxRIpp0z+jqShLMKofKoqkssvfCTpijanqq7Y3GgBoqhkqsq3ByoZiB7AdKsnHU9oT6szCe2dauXRpDYT2vH2qu4vGUypupLBlO4vGbyWp1fU+JDc8eKxKOkdtVeUGTDdeFHmohKnQaiVLXsdwZW9Hrf+PeAn4DtcrOHLXndtvg9X9hohXPZ6H/i8MIM2VsgXFqflIqiyWDHdrhQWk+jDlW5HcQmZYTaXbm/hVv4X4HvgMq1foDT+A+dj9DaZa2PgAAAAAElFTkSuQmCC"})[`./imgs${t}/${e}`],self.location).href,je=(e,t,i)=>t?re.getUrl(t,i):e,Le=(e,t)=>{const i=new C(t),s={depth:e.config.depth,bevelEnabled:!0,bevelSegments:1,bevelThickness:0,steps:0,bevelSize:0},a=new k(i,s),o=new b({color:e.color.main,map:Be,normalMap:Ue,combine:v,transparent:!0,opacity:.8}),r=new E({color:ae.borderColor,map:we,transparent:!0,opacity:.9}),n=new J(a,[o,r]);return n.scale.setScalar(e.config.scale),n.name="地图拼块",n},Me=Qe("label.png",""),De=(e,t,i)=>{if(!t.centroid&&!t.center)return!1;const{depth:s,scale:a}=e.config,[o,r]=t.centroid||t.center,n=le({name:`\n      <img src="${Me}" />\n      <div class="name">${t.name}</div>\n    `,className:"map-3D-label",position:[o*a,r*a*.995,s*a]});n.rotateX(.5*Math.PI),n.name=t.name+"_CSS3D_label",n.isLabel=!0,i.add(n)},Pe=(e,t,i)=>{if(!t.centroid&&!t.center)return!1;const{depth:s,scale:a}=e.config,o=1+(r=5,n=10,(Math.floor(Math.random()*(n-r+1))+r)/4);var r,n;const[l,c]=t.centroid||t.center,p=Ae([l,c,1.01*s].map((e=>e*a)),o*a,{factor:a,color:e.color.markColor1});p.rotateX(-Math.PI/2),i.add(p)},Oe=(e,t,i)=>{const{scale:s,depth:a}=e.config,o=new g,r=.2*s,n=new B(r,32),l=new y({color:ae.scatterColor1,transparent:!0,opacity:1}),c=new J(n,l),p=new U(.8*r,32,32,0,Math.PI),d=new y({color:ae.scatterColor2,transparent:!0,opacity:1}),h=new J(p,d);return o.add(c,h),o.position.set(t*s,i*s,a*s*1.005),o};class Ke extends _{constructor(s,a={},r={},n,p){super(s),l(this,i),o(this,"config"),o(this,"color"),o(this,"corrugatedPlate"),o(this,"mapGroup"),o(this,"scatterGroup"),o(this,"flywireGroup"),o(this,"css3DRender"),o(this,"outline"),l(this,e,void 0),l(this,t,void 0),o(this,"outRingMesh"),o(this,"innerRingMesh"),this.config=re.deepMerge(se,a),this.color=re.deepMerge(ae,r),c(this,e,n),c(this,t,p),this.createClock(),this.css3DRender=ne(this.options,this.container),((e,t)=>{Be=ye.load(je(Qe("gz-map.jpg"),e.map.map,t)),Ue=ye.load(je(Qe("gz-map-fx.jpg"),e.map.normal,t)),we=ye.load(je(Qe("border.png"),e.map.side,t)),Be.wrapS=Ue.wrapS=we.wrapS=S,Be.wrapT=Ue.wrapT=we.wrapT=S,Be.flipY=!1;const i=.0128;Be.repeat.set(i,i),Ue.repeat.set(i,i),Ge=ye.load(je(Qe("out-circle.png"),e.map.bgOutCircle,t)),Re=ye.load(je(Qe("inner-circle.png"),e.map.bgInnerCircle,t))})(this.config,this.options.baseUrl),this.bindEvent()}addCorrugatedPlate(){this.corrugatedPlate&&(this.disposeObj(this.corrugatedPlate),this.corrugatedPlate=void 0);const e=he({range:this.config.plateRadius,factor:this.config.scale,color:this.color.plateColor,light:this.color.plateLight});e.renderOrder=0,this.corrugatedPlate=e,this.addObject(e)}initMap(e){this.mapGroup&&(this.disposeObj(this.mapGroup),this.mapGroup=void 0);const t=new g;t.name="地图";const i=e.features,s=i.length;for(let c=0;c<s;c++){const e=i[c],s=new h,a=e.geometry.coordinates,o=e.properties;for(let t=0;t<a.length;t++)a[t].forEach((e=>{const t=e.map((e=>new u(e[0],e[1]))),i=Le(this,t);i.isProvinceBlock=!0,s.add(i)}));this.config.areaLabel&&De(this,o,s),this.config.markLight&&Pe(this,o,s),s.rotateX(-Math.PI/2),s.isProvinceGroup=!0,s.name=o.name,s.data=o,t.add(s)}this.mapGroup=t,this.addObject(t),this.config.border&&((e,t)=>{let i=fe(t,{color:ae.line,transparent:!0},"Line2");const{depth:s,scale:a}=e.config;i.name="地图上边框",i.position.y+=s*a;let o=fe(t,{color:ae.line2},"Line2");o.name="地图下边框",i.scale.setScalar(a),o.scale.setScalar(a),e.scene.add(i),e.scene.add(o)})(this,e);const a=me(t);if(!this.corrugatedPlate)return;let{size:o,center:{x:r,y:n,z:l}}=a;if(Ie.x=r,Ie.y=n,Ie.z=l,this.corrugatedPlate.position.set(r,0-.1*this.config.scale,l),this.resetSceneEle(),this.config.mapBg){const e=o.x<o.y?o.y+1:o.x+1;this.outRingMesh=((e,t)=>{let i=new I(t,t),s=new y({map:Ge,transparent:!0,opacity:.6,depthTest:!0}),a=new J(i,s);const{x:o,z:r}=Ie;return a.position.set(o,-1,r),a.scale.setScalar(1.2),a.rotateX(.5*-Math.PI),e.add(a),a})(this.scene,e*this.config.bgOutFactor),this.innerRingMesh=((e,t)=>{let i=new I(t,t),s=new y({map:Re,transparent:!0,opacity:.3,depthTest:!0}),a=new J(i,s);const{x:o,z:r}=Ie;return a.position.set(o,-2,r),a.scale.setScalar(1.2),a.rotateX(.5*-Math.PI),e.add(a),a})(this.scene,e*this.config.bgInnerFactor)}}initMapOutLine(e){this.outline&&(this.disposeObj(this.outline),this.outline=void 0);const t=Se(e,this.config.depth,!1),i=Ce(t,{factor:this.config.scale,color:this.color.outline});i.renderOrder=10,this.outline=i,this.addObject(i)}initFlywire(e){this.flywireGroup&&(this.disposeObj(this.flywireGroup),this.flywireGroup=void 0);const{scale:t,depth:i}=this.config,s=this.color;be({depth:i,color:s.line,flyColor:s.flyColor2,pointColor:s.flyColor1,factor:t});const a=new g;for(let o=0;o<e.length;o++){const{coords:i,path:s}=e[o],r=ve(i.map((e=>e.map((e=>e*t)))));r.name=s,a.add(r)}a.name="飞线集合",a.renderOrder=20,this.flywireGroup=a,this.addObject(a)}initMapBar(e,t){if(!this.config.mapBar)return;if(!this.mapGroup)return;this.clearMapBar();const i=Math.max(...e.map((e=>e.value||0))),{scale:s,depth:a}=this.config,o=this.color,r={height:5,size:.2,factor:s,color1:o.markColor1,color2:o.markColor2};for(let n=0;n<e.length;n++){const{name:o="",value:l=0}=e[n],c=this.mapGroup.getObjectByName(o);if(c){const o=l/i||0,{centroid:p,center:d}=c.data,g=p||d,h=Je({position:[g[0]*s,g[1]*s,a*s],heightRatio:o,label:t(e[n])},r);h.isBar=!0,c.add(h)}else console.log(o,c)}}clearMapBar(){var e;null==(e=this.mapGroup)||e.traverse((e=>{e.isBar&&this.disposeObj(e)}))}initScatter(e){this.scatterGroup&&(this.disposeObj(this.scatterGroup),this.scatterGroup=void 0);const t=new g;t.name="散点集合";for(let i=0;i<e.length;i++){const s=e[i],[a=0,o=0]=s.coord||[],r=Oe(this,a,o);r.name=s.name,r.data=s,r.isScatter=!0,t.add(r)}t.rotateX(.5*-Math.PI),this.scatterGroup=t,this.addObject(t)}onDblclick(e){}onPointerDown(e){this.pointer.isClick=!0,this.pointer.tsp=e.timeStamp}onPointerMove(e){const t=this.container,a=this.options.scale;if(ge(e,t,a),this.mapGroup){ce.setFromCamera(pe,this.camera);const e=[this.mapGroup];this.scatterGroup&&e.push(this.scatterGroup);const t=ce.intersectObjects(e);if(this.container.style.cursor=t.length?"pointer":"auto",t.length>0){const e=t[0].object;let a;const o=this.findParentGroupGroupUuid(e);o&&(a=o.uuid,p(this,i,s).call(this,o)),this.setMapBlockColor(a)}else p(this,i,s).call(this),this.setMapBlockColor()}}onPointerUp(e){this.pointer.isClick=!1;const t=e.timeStamp-this.pointer.tsp<this.config.rightClickBackDiffTime;2==e.button||(0==e.button?t&&this.clickObject(e):e.button)}findParentGroupGroupUuid(e){const t=e=>{let i=e.parent;if(i)return i&&i.isProvinceGroup||i.isScatter?i:t(i)};return t(e)}setMapBlockColor(e){var t;null==(t=this.mapGroup)||t.traverse((t=>{if(t.isProvinceBlock)t.material[0].color.set(t.parent.uuid===e?this.color.mainHover:this.color.main),t.material[1].color.set(t.parent.uuid===e?this.color.borderHoverColor:this.color.borderColor);else if(t.isLabel){const i=t.parent.uuid===e;t.element.className="map-3D-label"+(i?" is-active":"")}}))}clickObject(e){const i=this.container,s=this.options.scale;if(ge(e,i,s),this.scatterGroup){ce.setFromCamera(pe,this.camera);const e=[this.scatterGroup],i=ce.intersectObjects(e);if(this.container.style.cursor=i.length?"pointer":"auto",i.length){const e=i[0].object,s=this.findParentGroupGroupUuid(e).data||{};"function"==typeof n(this,t)&&n(this,t).call(this,s)}}}resetSceneEle(){const{x:e,y:t,z:i}=Ie;this.camera.lookAt(e,t,i);const s=this.config.scale;if(new m(this.camera.position).to({x:e,y:90*s,z:i+40*s},1e3).easing(A.Quadratic.In).start().onUpdate((e=>{console.log(e)})),this.controls&&(this.controls.target=new f(e,t,i-5*this.config.scale)),this.grid){this.grid.position.set(e,0,i);const t=this.scene.getObjectByProperty("_isGridFork_",!0);t&&t.position.set(e,0,i)}}modelAnimate(){var e;let t=null==(e=this.clock)?void 0:e.getDelta();this.corrugatedPlate&&ue(this.corrugatedPlate,t),this.css3DRender&&this.css3DRender.render(this.scene,this.camera),we&&(we.offset.y+=.005),this.outRingMesh&&(this.outRingMesh.rotation.z+=5e-4),this.innerRingMesh&&(this.innerRingMesh.rotation.z-=5e-4),this.outline&&ke(this.outline),this.flywireGroup&&Ee()}resize(){if(super.resize(),this.css3DRender){const{width:e,height:t}=this.options;this.css3DRender.setSize(e,t)}}dispose(){this.disposeObj(this.corrugatedPlate),this.disposeObj(this.mapGroup),this.disposeObj(this.scatterGroup),this.disposeObj(this.flywireGroup),this.disposeObj(this.outline),this.disposeObj(this.outRingMesh),this.disposeObj(this.innerRingMesh),this.clock=void 0,this.css3DRender=void 0,this.corrugatedPlate=void 0,this.mapGroup=void 0,this.scatterGroup=void 0,this.flywireGroup=void 0,this.outline=void 0,this.outRingMesh=void 0,this.innerRingMesh=void 0,super.dispose()}}e=new WeakMap,t=new WeakMap,i=new WeakSet,s=function(t){"function"==typeof n(this,e)&&n(this,e).call(this,t,de)};const xe=$(w({__name:"index",props:{devEnv:{type:Boolean},baseUrl:{},bgColor:{},skyCode:{},bgUrl:{},env:{},scale:{},camera:{default:()=>({})},cruise:{default:()=>({})},fog:{default:()=>({})},render:{default:()=>({})},controls:{default:()=>({})},grid:{default:()=>({})},axes:{default:()=>({})},directionalLight:{},color:{default:()=>({})},config:{default:()=>({})},corrugatedPlate:{type:Boolean,default:!0},mapJson:{},outlineJson:{},flywire:{},barList:{},scatters:{},barLabelRender:{}},emits:["init","click"],setup(e,{expose:t,emit:i}){const{backgroundLoad:s,skys:a}=N.useBackground(),{transformGeoJSON:o}=N.useConvertData(),{show:r,dialog:n}=N.useDialog({style:{left:"0px",top:"0px"},extend:{}}),l=e,c=G(),p=i;R((()=>l.scale),(e=>{null==h||h.setScale(e||1)})),R((()=>l.mapJson),(e=>{e&&(null==h||h.initMap(o(e)))})),R((()=>l.outlineJson),(e=>{e&&(null==h||h.initMapOutLine(o(e)),l.barList&&(null==h||h.initMapBar(l.barList||[],d)))})),R((()=>l.flywire),(e=>{null==h||h.initFlywire(e||[])})),R((()=>l.barList),(e=>{null==h||h.initMapBar(e||[],d)})),R((()=>l.scatters),(e=>{null==h||h.initScatter(e||[])}));const d=e=>{if("function"==typeof l.barLabelRender)return l.barLabelRender(e);const{name:t="",value:i=0,unit:s=""}=e;return{name:`\n      <div class="label-wrap">\n        <div class="name">${t}</div>\n        <div class="text">\n          <span class="value">${T.numConverter(i)}</span>\n          <span class="unit">${s}</span>\n        </div>\n      </div>\n    `,className:"map-bar-label"}},g={baseUrl:l.baseUrl,bgUrl:l.bgUrl,env:l.env,bgColor:l.bgColor,camera:l.camera,cruise:l.cruise,fog:l.fog,render:l.render,grid:l.grid,controls:l.controls,axes:l.axes};let h;return Q((()=>{g.container=c.value,h=new Ke(g,l.config,l.color,((e,t)=>{let i=!!e;if(i){n.style&&(n.style.left=t.left+"px",n.style.top=t.top+"px");const s=e.isScatter,a=e.data;if(s)a.isScatter=!0,n.extend=a;else{const t=(l.barList||[]).find((t=>t.name==e.name));t?n.extend=t:i=!1}}r.value=i}),(e=>{p("click",j(e))})),h.run(),p("init",h),l.skyCode&&s(h,l.skyCode),l.corrugatedPlate&&(null==h||h.addCorrugatedPlate()),l.flywire&&l.flywire.length&&(null==h||h.initFlywire(l.flywire))})),t({exportImage:()=>null==h?void 0:h.exportImage()}),(e,t)=>(L(),M("div",{class:P(e.$style["map-scene"])},[D("div",{class:P(e.$style.container),ref_key:"containerRef",ref:c},null,2),O(r)?(L(),M("div",{key:0,class:P(e.$style["dialog-view"]),style:K(O(n).style)},[x(e.$slots,"dialog",{data:O(n).extend})],6)):z("",!0)],2))}}),[["__cssModules",{$style:{"map-scene":"_map-scene_5opvk_2",container:"_container_5opvk_8","dialog-view":"_dialog-view_5opvk_12"}}]]),ze={depth:2,scale:40,plateRadius:100},Ye={main:3377879,mainHover:9633791,borderColor:9633791,borderHoverColor:1066618,light:1066618,lightHover:9633791,plateColor:3377879,plateLight:1066618,line:9559027,line2:6421501,gridColor:663606,gridFork:927811,outline:11856636,markColor1:13303807,markColor2:6945023,flyColor1:9559027,flyColor2:6421501,scatterColor1:9559027,scatterColor2:6421501},Fe=["src"],qe=$(w({__name:"index",setup(e){const{load:t}=N.useFileLoader(),i=G(),s=Y({devEnv:!0,baseUrl:"",bgColor:464681,color:Ye,config:{...ze,areaLabel:!0,markLight:!0,map:{}},camera:{position:[0,100,200]},directionalLight:{helper:!0},fog:{visible:!1,near:2e3,far:3e3},render:{preserveDrawingBuffer:!0},grid:{visible:!0,gridColor:Ye.gridColor,centerLineColor:Ye.gridColor,fork:!0,divisions:40,width:2*ze.plateRadius*ze.scale,forkSize:1.4*ze.scale,forkColor:Ye.gridFork},controls:{maxPolarAngle:.46*Math.PI,maxDistance:5e3,enableDamping:!0,screenSpacePanning:!1},axes:{visible:!0},mapJson:null,outlineJson:null,flywire:[],barList:[],scatters:[]}),a=()=>{var e;return null==(e=i.value)?void 0:e.exportImage()},o=e=>{const i=s.baseUrl;t(`${i}/oss/map/china.json`).then((e=>{s.mapJson=e})),t(`${i}/oss/map/china-outline.json`).then((e=>{s.outlineJson=e})),Z(e).resize()},r=e=>{console.log(e),X.info({message:e.name,grouping:!0})},n=e=>{const{name:t="",value:i=0,unit:s=""}=e;return{name:`\n      <div class="label-wrap">\n        <div class="name">${t}</div>\n        <div class="text">\n          <span class="value">${ie(i)}</span>\n          <span class="unit">${s}</span>\n        </div>\n      </div>\n    `,className:"map-bar-label"}},l=()=>{ee.get(te.d3.map).then((e=>{const t=[],i=[];return e.list.forEach((e=>{const s=e.projects.length;let a=e.province;["重庆","北京","天津","上海"].includes(a)&&(a+="市"),["台湾"].includes(a)&&(a+="省"),e.projects.forEach((i=>{t.push({coord:[i.lng,i.lat],name:i.name,carbon:i.carbon,value:i.use,total:s,city:e.province,id:i.id})}));const o=e.total;-1===i.findIndex((e=>e.name===a))&&i.push({id:e.code,name:a,total:s,value:o,unit:"kWh"})})),{citys:i,projects:t,lines:e.lines}})).then((e=>{s.flywire=e.lines,s.barList=e.citys,s.scatters=e.projects}))};return Q((()=>{l()})),(e,t)=>{const l=H;return L(),M("div",{class:P([e.$style.page,"h-100 o-h"])},[D("div",{class:P(e.$style.operate)},[F(l,{type:"primary",size:"small",onClick:a},{default:q((()=>t[0]||(t[0]=[W("导出")]))),_:1})],2),F(xe,{ref_key:"threeSceneRef",ref:i,"dev-env":O(s).devEnv,"base-url":O(s).baseUrl,"bg-color":O(s).bgColor,"bg-url":O(s).bgUrl,env:O(s).env,"sky-code":O(s).skyCode,camera:O(s).camera,cruise:O(s).cruise,render:O(s).render,controls:O(s).controls,"directional-light":O(s).directionalLight,grid:O(s).grid,axes:O(s).axes,config:O(s).config,color:O(s).color,"map-json":O(s).mapJson,"outline-json":O(s).outlineJson,flywire:O(s).flywire,"bar-list":O(s).barList,scatters:O(s).scatters,"bar-label-render":n,onInit:o,onClick:r},{dialog:q((({data:i})=>[D("div",{class:P(e.$style["dialog-view"])},[D("div",{class:P([e.$style.city,"flex"])},[D("span",{class:P(e.$style.name)},V(i.isScatter?i.city:i.name),3),D("span",{class:P(e.$style.total)},V(i.total)+"个项目",3)],2),i.isScatter?(L(),M("div",{key:0,class:P([e.$style.project,"flex flex-ac"])},[D("img",{src:`${O(s).baseUrl}/oss/img/map/pos.png`,alt:""},null,8,Fe),D("span",{class:P(e.$style.name)},V(i.name),3)],2)):z("",!0),D("div",{class:P(e.$style.count)},[D("div",{class:P(e.$style.item)},[t[1]||(t[1]=D("span",null,"今日用电量",-1)),D("span",null,V(O(ie)(i.value)),1),t[2]||(t[2]=D("span",null,"kWh",-1))],2),i.isScatter?(L(),M("div",{key:0,class:P(e.$style.item)},[t[3]||(t[3]=D("span",null,"今日碳排放",-1)),D("span",null,V(O(ie)(i.carbon)),1),t[4]||(t[4]=D("span",null,"kgCO₂",-1))],2)):z("",!0)],2)],2)])),_:1},8,["dev-env","base-url","bg-color","bg-url","env","sky-code","camera","cruise","render","controls","directional-light","grid","axes","config","color","map-json","outline-json","flywire","bar-list","scatters"])],2)}}}),[["__cssModules",{$style:{page:"_page_dcgzt_2",operate:"_operate_dcgzt_8","dialog-view":"_dialog-view_dcgzt_15",city:"_city_dcgzt_20",name:"_name_dcgzt_20",total:"_total_dcgzt_28",project:"_project_dcgzt_33",count:"_count_dcgzt_48",item:"_item_dcgzt_52"}}]]);export{qe as default};
