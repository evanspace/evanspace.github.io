var e=Object.defineProperty,t=(t,a,n)=>(((t,a,n)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n})(t,"symbol"!=typeof a?a+"":a,n),n);import{b6 as a,dD as n,ev as r,d9 as s,dA as o,ek as i,b5 as u,ew as d,bc as l,cV as m,bb as c,ex as p,ey as h,em as f,en as b,bd as x,e as g,i as w,l as v,o as T,g as y,h as N}from"./vendor-d8d328e6.js";import{E as C,i as j,u as k}from"./scene-resize-6b620c5b.js";import"./index-bace1180.js";const D=f,{color:E,vec2:L,pass:M,linearDepth:_,objectPosition:z,screenUV:B,viewportLinearDepth:R,viewportDepthTexture:W,viewportSharedTexture:A,mx_worley_noise_float:G,positionWorld:O,time:S}=D,V=j,{getBgGroup:F}=V.useBackground(),P=(new a).load("/oss/textures/gpu/water.jpg");P.wrapS=n,P.wrapT=n,P.colorSpace=r;const Y=D.uniform(0),U={mix:0,procedural:0,intensity:1,hue:0,saturation:1},q=D.reference("mix","float",U),H=D.reference("procedural","float",U),I=D.reference("intensity","float",U),J=D.reference("hue","float",U),K=D.reference("saturation","float",U),Q=new s,X=new s,Z={offsetCube1:0,offsetCube2:0};let $;class ee extends C{constructor(e){super(e),t(this,"water"),t(this,"cube1Texture"),t(this,"cube2Texture"),t(this,"gui"),t(this,"getEnvironmentNode",((e,t)=>{const a=e.xyz.mul(D.uniform(Q)),n=e.xyz.mul(D.uniform(X)),r=D.mix(D.pmremTexture(this.cube1Texture,a),D.pmremTexture(this.cube2Texture,n),t.y.add(q).clamp()),s=D.mix(r,D.normalWorld,H).mul(I),o=D.hue(s,J);return D.saturation(o,K)})),this.addModel(),this.gui=new o,this.addGui()}createRender(){return new i(this.options.render)}addModel(){this.water=(()=>{const e=S.mul(.8),t=O.xzy,a=G(t.mul(4).add(e)),n=G(t.mul(2).add(e)),r=a.mul(n),s=r.mul(1.4).mix(E(296930),E(7654644)),o=_(),i=R.sub(o).remapClamp(-.002,.04),u=B.add(L(0,r.mul(.1))),d=_(W(u)).sub(o),m=d.remapClamp(0,.1),c=d.lessThan(0).select(B,u),p=A(c),h=new b;return h.colorNode=s,h.backdropNode=i.mix(A(),p.mul(m.mix(1,s))),h.backdropAlphaNode=m.oneMinus(),h.transparent=!0,new l(new x(50,.001,50),h)})(),this.addObject(this.water),(new u).load(F("225","jpeg"),(e=>{e.generateMipmaps=!0,e.minFilter=d,this.cube1Texture=e,(new u).load(F("221","jpeg"),(e=>{e.generateMipmaps=!0,e.minFilter=d,this.cube2Texture=e,this.scene.environmentNode=this.getEnvironmentNode(D.reflectVector,D.positionWorld),this.scene.backgroundNode=this.getEnvironmentNode(D.positionWorldDirection,D.positionLocal).context({getTextureLevel:()=>Y})}))}));const e=new l(new m(.5,64,32),new c({metalness:1,roughness:0}));this.addObject(e);const{camera:t,scene:a,renderer:n}=this,r=M(a,t),s=r.getTextureNode(),o=r.getLinearDepthNode().remapClamp(.3,.5),i=z(t).y.greaterThan(B.y.sub(.5).mul(t.near)),f=p(s);f.directionNode=i.select(o,r.getLinearDepthNode().mul(5));const g=B.distance(.5).mul(1.35).clamp().oneMinus();$=new h(n),$.outputNode=i.select(f,f.mul(E(7654644)).mul(g))}addGui(){var e;const t=this.gui;t.add({blurBackground:Y.value},"blurBackground",0,1,.01).name("背景模糊").onChange((e=>{Y.value=e})),t.add(U,"mix",-1,2,.01).name("混合"),t.add(U,"intensity",0,5,.01).name("曝光"),t.add(U,"saturation",0,2,.01).name("饱和度"),t.domElement.className+=" gui-wrap",null==(e=this.container.parentNode)||e.appendChild(t.domElement)}animate(){$.render()}modelAnimate(){this.cube2Texture&&(Z.offsetCube1+=.001,Z.offsetCube2+=5e-4,Q.makeRotationY(Z.offsetCube1),X.makeRotationY(Z.offsetCube2))}}const te={class:"three-page"},ae=g({__name:"index",setup(e){const t=w(),a={directionalLight:{light2:!1},render:{logarithmicDepthBuffer:!1},camera:{position:[0,2,2]},controls:{minDistance:2,maxDistance:100}};let n;return v((()=>{a.container=t.value,n=new ee(a),n.run(),k(n).resize()})),(e,a)=>(T(),y("div",te,[N("div",{class:"h-100",ref_key:"containerRef",ref:t},null,512)]))}});export{ae as default};
