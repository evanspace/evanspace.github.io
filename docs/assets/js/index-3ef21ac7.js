var e=Object.defineProperty,t=(t,s,i)=>(((t,s,i)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i})(t,"symbol"!=typeof s?s+"":s,i),i);import{bC as s,bB as i,bE as a,bX as r,bI as n,b_ as o,c1 as h,c2 as l,bk as c,cd as m,ce as d,b7 as u,bc as p,cf as v,e as f,i as g,l as w,o as y,g as x,h as b,n as _}from"./vendor-c8aa99b3.js";import"./index-56a6a919.js";import{_ as C}from"./index-e8191030.js";new s;const P=["01.jpeg","02.jpeg"].map((e=>`/oss/textures/effect/${e}`));class j{constructor({background:e="#eee",el:s=document.body}){t(this,"width"),t(this,"height"),t(this,"aspect"),t(this,"scene"),t(this,"renderer"),t(this,"camera"),t(this,"controls"),t(this,"textures"),t(this,"material"),t(this,"isPlaying",!1),t(this,"time",0),t(this,"move",0),t(this,"activeIndex",0),t(this,"progress",0),t(this,"isComplete",!0),t(this,"createLayoutGrid",(()=>{let e=new l(800,16,10592673,10592673);return e.material.opacity=.3,e.material.transparent=!0,e})),this.width=s.offsetWidth,this.height=s.offsetHeight,this.aspect=this.width/this.height,this.scene=new i,this.renderer=this.createRender(e),this.camera=this.createCamera(),this.controls=this.createControls();const r=this.createLayoutGrid();this.scene.add(r),s.appendChild(this.renderer.domElement);const n=new a(500);return this.scene.add(n),this.init(),this}createRender(e){const t=new r({antialias:!0,logarithmicDepthBuffer:!0,preserveDrawingBuffer:!1});return t.sortObjects=!0,t.shadowMap.enabled=!0,t.shadowMap.type=n,t.setSize(this.width,this.height),this.renderer.setClearColor(e,1),this.scene.background=null,t.setPixelRatio(Math.min(window.devicePixelRatio,2)),t}createCamera(){const e=new o(36,this.aspect,1,1e4);return e.position.set(0,0,2e3),e}createControls(){const e=new h(this.camera,this.renderer.domElement),t={visible:!0,enableDamping:!1,dampingFactor:.25,autoRotate:!1,enableZoom:!0,enablePan:!0,screenSpacePanning:!0,minDistance:1,maxDistance:1e4};return Object.keys(t).forEach((s=>{e[s]=t[s]})),e.target.set(0,0,0),e}loader(e){return new Promise((t=>{let i=new s,a=e.length,r=new Array(a);e.forEach(((e,s)=>{i.load(e,(e=>{r[s]=e,r.filter((e=>e)).length===a&&t(r)}))}))}))}async init(){this.textures=await this.loader(P),this.addMesh(),this.play(),this.change()}addMesh(){const e=new c(1980,1280),t=new m({fragmentShader:"\n        varying vec2 vUv;\n        varying vec2 vPosition;\n\n        uniform float time;\n        uniform float progress;\n        uniform vec4 resolution;\n        uniform sampler2D t1;\n        uniform sampler2D t2;\n\n        void main(){\n          vec2 newUV=vec2(vUv-vec2(0.5))*resolution.zw+vec2(.5);\n          vec4 tt1=texture2D(t1,newUV);\n          vec4 tt2=texture2D(t2,newUV);\n          float dist=distance(tt1,tt2)*.5;\n          // dist = newUV.x / 2. + .03 * sin(newUV.y*10. + time* 10.) + 0.2;\n          float pr=step(dist,progress);\n          vec4 final=mix(mix(tt1,tt2,pr),tt2,pr);\n          gl_FragColor=final;\n        }\n      ",vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n      ",uniforms:{progress:{type:"f",value:0},time:{type:"f",value:0},resolution:{value:new d},t1:{type:"t",value:this.textures[0]},t2:{type:"t",value:this.textures[1]}},side:u,transparent:!0,depthTest:!1,depthWrite:!1,wireframe:!1});this.material=t,this.setTextureSize();const s=new p(e,t);this.scene.add(s)}setTextureSize(){if(!this.material)return;const e=1280/1920,{width:t,height:s}=this;let i,a;s/t>e?(i=t/s*e,a=1):(i=1,a=s/t/e),this.material.uniforms.resolution.value.x=t,this.material.uniforms.resolution.value.y=s,this.material.uniforms.resolution.value.z=i,this.material.uniforms.resolution.value.w=a}change(){this.material&&this.isComplete&&(this.isComplete=!1,this.material.uniforms.t1.value=this.textures[this.activeIndex++],this.activeIndex%=this.textures.length,this.material.uniforms.t2.value=this.textures[this.activeIndex],v.fromTo(this,{progress:0},{duration:2.1,delay:1.2,progress:1,onComplete:()=>{this.isComplete=!0,this.change()}}))}play(){this.isPlaying||(this.isPlaying=!0,this.render())}stop(){this.isPlaying=!1}render(){this.isPlaying&&window.requestAnimationFrame((()=>{this.update(),this.render()}))}update(){const{scene:e,camera:t}=this;this.time+=.01,this.material&&(this.material.uniforms.time.value=this.time,this.material.uniforms.progress.value=this.progress),this.renderer.render(e,t),this.controls&&this.controls.update()}}const D=C(f({__name:"index",setup(e){const t=g();return w((()=>{t.value,new j({el:t.value})})),(e,s)=>(y(),x("div",{class:_(e.$style.page)},[b("div",{class:_(e.$style.container),ref_key:"containerRef",ref:t},null,2)],2))}}),[["__cssModules",{$style:{page:"_page_4vabc_2",container:"_container_4vabc_10"}}]]);export{D as default};
