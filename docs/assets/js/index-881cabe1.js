var e,t,i,s,a=Object.defineProperty,o=(e,t,i)=>(((e,t,i)=>{t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i),r=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},n=(e,t,i)=>(r(e,t,"read from private field"),i?i.call(e):t.get(e)),l=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},c=(e,t,i,s)=>(r(e,t,"write to private field"),s?s.call(e,i):t.set(e,i),i),p=(e,t,i)=>(r(e,t,"access private method"),i);import{bG as d,by as g,dW as h,bE as u,dU as m,dV as A,bD as f,eN as S,bH as C,ek as b,el as v,dt as k,eO as E,df as I,bw as J,bu as y,bC as B,d$ as U,bI as w,e as G,i as R,w as Q,l as j,aP as M,o as L,g as D,h as P,n as O,u as K,a9 as x,a5 as z,B as Y,Y as F,q,p as W,I as V,t as X,c as H,ak as N}from"./vendor-b9b94b6b.js";import{E as _,p as T,i as Z,u as $}from"./scene-resize-8611dce1.js";import{u as ee}from"./sky-53f13301.js";import{_ as te,d as ie,A as se,n as ae}from"./index-8d9d4caa.js";const oe={depth:1,scale:40,plateRadius:200,clickIntervalTime:100,areaLabel:!1,markLight:!1,border:!0,mapBg:!0,mapBar:!0,bgOutFactor:1,bgInnerFactor:.9,map:{}},re={main:3377879,mainHover:9633791,borderColor:9633791,borderHoverColor:1066618,light:1066618,lightHover:9633791,plateColor:3377879,plateLight:1066618,line:9559027,line2:6421501,gridColor:663606,gridFork:927811,outline:11856636,markColor1:13303807,markColor2:6945023,flyColor1:9559027,flyColor2:6421501,scatterColor1:9559027,scatterColor2:6421501},ne=T,le=Z,{initCSS3DRender:ce,createCSS3DDom:pe}=ne.useCSS3D(),{raycaster:de,pointer:ge,style:he,update:ue}=ne.useRaycaster(),{createCorrugatedPlate:me,corrugatedPlateUpdate:Ae}=ne.useCorrugatedPlate(),{getBoundingBox:fe}=ne.useCoord(),{createMarkLight:Se}=ne.useMarkLight(),{createCountryFlatLine:Ce,getPoints:be}=ne.useCountryLine(),{createOutline:ve,outlineUpdate:ke}=ne.useOutline(),{createFlywireTexture:Ee,createFlywire:Ie,flywireUpdate:Je}=ne.useFlywire(),{createBar:ye}=ne.useMapBar(),Be={x:105.06,y:0,z:32.93},Ue=new d;let we,Ge,Re,Qe,je;const Me=(e,t="")=>new URL(Object.assign({"./imgs/border.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGUAAAE1CAYAAAD+hS6MAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALrSURBVHgB7dOxDQJBEMDABV1fdE5Mhr4IwkMiIUNPGw5mWrB8ue19DinXIUeUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAlax+M+tDglSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlaH2fx9DilCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJWud+Dy1OCRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECVq/12docUqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBP0B9I0QJBOMnj4AAAAASUVORK5CYII=","./imgs/circle.png":"/imgs/circle-f2c3f6ed.png","./imgs/gz-map-fx.jpg":"/imgs/gz-map-fx-c5e413a7.jpg","./imgs/gz-map.jpg":"/imgs/gz-map-15a6793f.jpg","./imgs/inner-circle.png":"/imgs/inner-circle-8c61cf85.png","./imgs/label.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAK+SURBVHgB7dzNbdswGIdxSugCRtGBuklWSO17nXs/J0hHywA11AEMu3wDsLFT5WCJ5PtI/D8nQ5cA/FmxJJLqtofhHBSmPihUAoElEFgCgfVu7ODX95suqOKNXVDpDIElEFgCgSUQWAKBJRBYAoE1G2Q3DJ/j9fRjUGE7DI+f4niEGc0CMYzzKezjx7vWUQwjnMJdF8djDsq8M+QYLu/om0VJGP8OXI/LTc0C+fJhs4/fiIeLQ82hvMaI/zEevsVxCROb/RvSMkpuDCvLVVaLKCUwrGyXvS2hlMKwst6HtIBSEsPKfmO4ZpTSGFaRO/U1otTAsIo9OlkTSi0Mq+izrDWg1MSwij9cXDJKbQyrytPeJaJ4YFjVHr8vCcULw6o6H7IEFE8Mq/oEFRnFG8NymTEkohAwLLcpXBIKBcNynVMnoJAwLPdFDp4oNAwLserEA4WIYXVjK7C9Vr+fY8Gh7e8/Lhha/f5GhDMjJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJZDwvIIQs2kIA/K81tYvzKYhBMh/75vyCYHiDgLBSLmjuIK8xrBV6J1HoO11biCk/Rmk7XUuIMTNMhSU6iDUnUsWAaUqCBkj5Y1SDWQJGClPlCogS8JIeaEUB1kiRsoDpSjIkjFStVGKgawBI1UTpQjImjBStVCyg6wRI1UDJSvImjFSpVGygbSAkSqJkgWkJYxUKZTZIC1ipEqgzAJpGSOVG2UyiDBeyokyCWR3OOyFcd0Yyu4wfA83Ngnk2Pe/ziE82WdhvHSJYuNz7MPPcGOTQH5sNk+nPnyMf/xeGNcZSvyS3tv42DiFG0O94q+19Iq/BSQQWAKBJRBYAoElEFgCgSUQWKM3hsovnSGwBAJLILAEAusvLK6Na4P/Au0AAAAASUVORK5CYII=","./imgs/light.png":"/imgs/light-aa132c89.png","./imgs/out-circle.png":"/imgs/out-circle-6854860a.png","./imgs/point.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAABCtJREFUWIXVmU1oXFUUx3/zSptF4qYliNAUJB8tUnRhXSiSWhcmEekiXVi1C20Ximm7li5EsFDUrYsuBVeNCCroIgXF2iKtCRioIp1shIC1I0g7TUIS7d/FPTfz+vLu+5i8GewfLjP33vPxf3fu3HfuOTVJbAG9wLPAQeAxYAR4GOiz+bvAn8AN4FfgEvADsNS2R0llW03SuKQLkpZVHsumO262SvmvlVzhSeBd4Anr3wNmgW+BOVvJxdgK9gK7gWHgAHAIeAqIbH4eeA/4ouoVHpQ0E1ulRUlnJO1p4xfaY7qLMXsz5iNXv4iDlyXdNsMNSScl9bRBNNl6zFbDbN+WdHQrhGuSzsZW4TNJuyogmmy7zLbHWWXs7SyyH5uBfySd6gDRZDspad18ng+RDimfM8VlSYe7QNa3lyQtme9zRQkfja1sEbI1SaOSPpB0WdJNSavWbtrYhyZT5Bg7bL4l6ZU8woNq/cFO5xiOJB2XVFdx1E0nyrF92uTvKHF6JAX90TWdY/BRSddKEE3imtnI8jFtsjMhwpMm8Jek/gxDz6l1FG0FDbltEvKzU9Itk51MEq5J+tkmpzKMvCC3N6vCqqSxDH9vmdy8cdwgPGYTv0vaHlDeK7enqkbTbKf53G6cJBd7bLzT37DP88B6yht8G/Ap8FDhd35x9JntbSlz68YJ4HUAJPVKWpH0r6SBwJMe78DKJnEi4HvAuK1I6o1vh6sBhZrKHV3toq7wOX3VZMYiXPANLkRMwygwVNkGCGPIfKXBczsYAfutMxcQfrFKVjkI+fLc9ke44Brgt4DwM5VSysbTgXHPbTgC+q3zR0B4ODDeCYwExj23/pqkVWAH0AOspQj7+W5gzXgkscN4rEUpk/9rREDTvodeCn93iUuWL8+tGQEN6zwSEK5XSikbNwLjnlsjokVob0D4x0opZSPky3OrR8B16zwZEP66UkrZ+CYwfsA+r0e49BHA8wHhS8BClawCWMClsdJwaIOLigU/J7oQSxQKfiJcWulL3IlxLPCEn+BSUp3CnPlIwzEct6+AJf8U4/aUWQH8Prlgu2o0zXZeAD+hxBVp3ibeDihjSlVfkSYy/L1pcpuuSGUuoROqZqWbOWTjl9AjfjwpVPSav0/S7BbIziq8DXy7YLIX4+NJoUG1Lpp5+TSfSFkoQXRBxRIpp0z+jqShLMKofKoqkssvfCTpijanqq7Y3GgBoqhkqsq3ByoZiB7AdKsnHU9oT6szCe2dauXRpDYT2vH2qu4vGUypupLBlO4vGbyWp1fU+JDc8eKxKOkdtVeUGTDdeFHmohKnQaiVLXsdwZW9Hrf+PeAn4DtcrOHLXndtvg9X9hohXPZ6H/i8MIM2VsgXFqflIqiyWDHdrhQWk+jDlW5HcQmZYTaXbm/hVv4X4HvgMq1foDT+A+dj9DaZa2PgAAAAAElFTkSuQmCC"})[`./imgs${t}/${e}`],self.location).href,Le=(e,t,i)=>t?le.getUrl(t,i):e,De=(e,t)=>{const i=new b(t),s={depth:e.config.depth,bevelEnabled:!0,bevelSegments:1,bevelThickness:0,steps:0,bevelSize:0},a=new v(i,s),o=new k({color:e.color.main,map:we,normalMap:Ge,combine:E,transparent:!0,opacity:.8}),r=new I({color:re.borderColor,map:Re,transparent:!0,opacity:.9}),n=new J(a,[o,r]);return n.scale.setScalar(e.config.scale),n.name="地图拼块",n},Pe=Me("label.png",""),Oe=(e,t,i)=>{if(!t.centroid&&!t.center)return!1;const{depth:s,scale:a}=e.config,[o,r]=t.centroid||t.center,n=pe({name:`\n      <img src="${Pe}" />\n      <div class="name">${t.name}</div>\n    `,className:"map-3D-label",position:[o*a,r*a*.995,s*a]});n.rotateX(.5*Math.PI),n.name=t.name+"_CSS3D_label",n.isLabel=!0,i.add(n)},Ke=(e,t,i)=>{if(!t.centroid&&!t.center)return!1;const{depth:s,scale:a}=e.config,o=1+(r=5,n=10,(Math.floor(Math.random()*(n-r+1))+r)/4);var r,n;const[l,c]=t.centroid||t.center,p=Se([l,c,1.01*s].map((e=>e*a)),o*a,{factor:a,color:e.color.markColor1});p.rotateX(-Math.PI/2),i.add(p)},xe=(e,t,i)=>{const{scale:s,depth:a}=e.config,o=new g,r=.2*s,n=new U(r,32),l=new B({color:re.scatterColor1,transparent:!0,opacity:1}),c=new J(n,l),p=new w(.8*r,32,32,0,Math.PI),d=new B({color:re.scatterColor2,transparent:!0,opacity:1}),h=new J(p,d);return o.add(c,h),o.position.set(t*s,i*s,a*s*1.005),o};class ze extends _{constructor(s,a={},r={},n,p){super(s),l(this,i),o(this,"config"),o(this,"color"),o(this,"corrugatedPlate"),o(this,"mapGroup"),o(this,"scatterGroup"),o(this,"flywireGroup"),o(this,"css3DRender"),o(this,"outline"),l(this,e,void 0),l(this,t,void 0),o(this,"outRingMesh"),o(this,"innerRingMesh"),this.config=le.deepMerge(oe,a),this.color=le.deepMerge(re,r),c(this,e,n),c(this,t,p),this.createClock(),this.css3DRender=ce(this.options,this.container),((e,t)=>{we=Ue.load(Le(Me("gz-map.jpg"),e.map.map,t)),Ge=Ue.load(Le(Me("gz-map-fx.jpg"),e.map.normal,t)),Re=Ue.load(Le(Me("border.png"),e.map.side,t)),we.wrapS=Ge.wrapS=Re.wrapS=C,we.wrapT=Ge.wrapT=Re.wrapT=C,we.flipY=!1;const i=.0128;we.repeat.set(i,i),Ge.repeat.set(i,i),Qe=Ue.load(Le(Me("out-circle.png"),e.map.bgOutCircle,t)),je=Ue.load(Le(Me("inner-circle.png"),e.map.bgInnerCircle,t))})(this.config,this.options.baseUrl),this.bindEvent()}addCorrugatedPlate(){this.corrugatedPlate&&(this.disposeObj(this.corrugatedPlate),this.corrugatedPlate=void 0);const e=me({range:this.config.plateRadius,factor:this.config.scale,color:this.color.plateColor,light:this.color.plateLight});e.renderOrder=0,this.corrugatedPlate=e,this.addObject(e)}initMap(e){this.mapGroup&&(this.disposeObj(this.mapGroup),this.mapGroup=void 0);const t=new g;t.name="地图";const i=e.features,s=i.length;for(let c=0;c<s;c++){const e=i[c],s=new h,a=e.geometry.coordinates,o=e.properties;for(let t=0;t<a.length;t++)a[t].forEach((e=>{const t=e.map((e=>new u(e[0],e[1]))),i=De(this,t);i.isProvinceBlock=!0,s.add(i)}));this.config.areaLabel&&Oe(this,o,s),this.config.markLight&&Ke(this,o,s),s.rotateX(-Math.PI/2),s.isProvinceGroup=!0,s.name=o.name,s.data=o,t.add(s)}this.mapGroup=t,this.addObject(t),this.config.border&&((e,t)=>{let i=Ce(t,{color:re.line,transparent:!0},"Line2");const{depth:s,scale:a}=e.config;i.name="地图上边框",i.position.y+=s*a;let o=Ce(t,{color:re.line2},"Line2");o.name="地图下边框",i.scale.setScalar(a),o.scale.setScalar(a),e.scene.add(i),e.scene.add(o)})(this,e);const a=fe(t);if(!this.corrugatedPlate)return;let{size:o,center:{x:r,y:n,z:l}}=a;if(Be.x=r,Be.y=n,Be.z=l,this.corrugatedPlate.position.set(r,0-.1*this.config.scale,l),this.resetSceneEle(),this.config.mapBg){const e=o.x<o.y?o.y+1:o.x+1;this.outRingMesh=((e,t)=>{let i=new y(t,t),s=new B({map:Qe,transparent:!0,opacity:.6,depthTest:!0}),a=new J(i,s);const{x:o,z:r}=Be;return a.position.set(o,-1,r),a.scale.setScalar(1.2),a.rotateX(.5*-Math.PI),e.add(a),a})(this.scene,e*this.config.bgOutFactor),this.innerRingMesh=((e,t)=>{let i=new y(t,t),s=new B({map:je,transparent:!0,opacity:.3,depthTest:!0}),a=new J(i,s);const{x:o,z:r}=Be;return a.position.set(o,-2,r),a.scale.setScalar(1.2),a.rotateX(.5*-Math.PI),e.add(a),a})(this.scene,e*this.config.bgInnerFactor)}}initMapOutLine(e){this.outline&&(this.disposeObj(this.outline),this.outline=void 0);const t=be(e,this.config.depth,!1),i=ve(t,{factor:this.config.scale,color:this.color.outline});i.renderOrder=10,this.outline=i,this.addObject(i)}initFlywire(e){this.flywireGroup&&(this.disposeObj(this.flywireGroup),this.flywireGroup=void 0);const{scale:t,depth:i}=this.config,s=this.color;Ee({depth:i,color:s.line,flyColor:s.flyColor2,pointColor:s.flyColor1,factor:t});const a=new g;for(let o=0;o<e.length;o++){const{coords:i,path:s}=e[o],r=Ie(i.map((e=>e.map((e=>e*t)))));r.name=s,a.add(r)}a.name="飞线集合",a.renderOrder=20,this.flywireGroup=a,this.addObject(a)}initMapBar(e,t){if(!this.config.mapBar)return;if(!this.mapGroup)return;this.clearMapBar();const i=Math.max(...e.map((e=>e.value||0))),{scale:s,depth:a}=this.config,o=this.color,r={height:5,size:.2,factor:s,color1:o.markColor1,color2:o.markColor2};for(let n=0;n<e.length;n++){const{name:o="",value:l=0}=e[n],c=this.mapGroup.getObjectByName(o);if(c){const o=l/i||0,{centroid:p,center:d}=c.data,g=p||d,h=ye({position:[g[0]*s,g[1]*s,a*s],heightRatio:o,label:t(e[n])},r);h.isBar=!0,c.add(h)}else console.log(o,c)}}clearMapBar(){var e;null==(e=this.mapGroup)||e.traverse((e=>{e.isBar&&this.disposeObj(e)}))}initScatter(e){this.scatterGroup&&(this.disposeObj(this.scatterGroup),this.scatterGroup=void 0);const t=new g;t.name="散点集合";for(let i=0;i<e.length;i++){const s=e[i],[a=0,o=0]=s.coord||[],r=xe(this,a,o);r.name=s.name,r.data=s,r.isScatter=!0,t.add(r)}t.rotateX(.5*-Math.PI),this.scatterGroup=t,this.addObject(t)}onDblclick(e){}onPointerDown(e){this.pointer.isClick=!0,this.pointer.tsp=e.timeStamp}onPointerMove(e){const t=this.container,a=this.options.scale;if(ue(e,t,a),this.mapGroup){de.setFromCamera(ge,this.camera);const e=[this.mapGroup];this.scatterGroup&&e.push(this.scatterGroup);const t=de.intersectObjects(e);if(this.container.style.cursor=t.length?"pointer":"auto",t.length>0){const e=t[0].object;let a;const o=this.findParentGroupGroupUuid(e);o&&(a=o.uuid,p(this,i,s).call(this,o)),this.setMapBlockColor(a)}else p(this,i,s).call(this),this.setMapBlockColor()}}onPointerUp(e){this.pointer.isClick=!1;const t=e.timeStamp-this.pointer.tsp<this.config.clickIntervalTime;2==e.button||(0==e.button?t&&this.clickObject(e):e.button)}findParentGroupGroupUuid(e){const t=e=>{let i=e.parent;if(i)return i&&i.isProvinceGroup||i.isScatter?i:t(i)};return t(e)}setMapBlockColor(e){var t;null==(t=this.mapGroup)||t.traverse((t=>{if(t.isProvinceBlock)t.material[0].color.set(t.parent.uuid===e?this.color.mainHover:this.color.main),t.material[1].color.set(t.parent.uuid===e?this.color.borderHoverColor:this.color.borderColor);else if(t.isLabel){const i=t.parent.uuid===e;t.element.className="map-3D-label"+(i?" is-active":"")}}))}clickObject(e){const i=this.container,s=this.options.scale;if(ue(e,i,s),this.scatterGroup){de.setFromCamera(ge,this.camera);const e=[this.scatterGroup],i=de.intersectObjects(e);if(this.container.style.cursor=i.length?"pointer":"auto",i.length){const e=i[0].object,s=this.findParentGroupGroupUuid(e).data||{};"function"==typeof n(this,t)&&n(this,t).call(this,s)}}}resetSceneEle(){const{x:e,y:t,z:i}=Be;this.camera.lookAt(e,t,i);const s=this.config.scale;if(new m(this.camera.position).to({x:e,y:90*s,z:i+40*s},1e3).easing(A.Quadratic.In).start(),this.controls&&(this.controls.target=new f(e,t,i-5*this.config.scale)),this.grid){this.grid.position.set(e,0,i);const t=this.scene.getObjectByProperty("_isGridFork_",!0);t&&t.position.set(e,0,i)}}modelAnimate(){var e;let t=null==(e=this.clock)?void 0:e.getDelta();this.corrugatedPlate&&Ae(this.corrugatedPlate,t),this.css3DRender&&this.css3DRender.render(this.scene,this.camera),Re&&(Re.offset.y+=.005),this.outRingMesh&&(this.outRingMesh.rotation.z+=5e-4),this.innerRingMesh&&(this.innerRingMesh.rotation.z-=5e-4),this.outline&&ke(this.outline),this.flywireGroup&&Je(),S()}resize(){if(super.resize(),this.css3DRender){const{width:e,height:t}=this.options;this.css3DRender.setSize(e,t)}}dispose(){this.disposeObj(this.corrugatedPlate),this.disposeObj(this.mapGroup),this.disposeObj(this.scatterGroup),this.disposeObj(this.flywireGroup),this.disposeObj(this.outline),this.disposeObj(this.outRingMesh),this.disposeObj(this.innerRingMesh),this.clock=void 0,this.css3DRender=void 0,this.corrugatedPlate=void 0,this.mapGroup=void 0,this.scatterGroup=void 0,this.flywireGroup=void 0,this.outline=void 0,this.outRingMesh=void 0,this.innerRingMesh=void 0,super.dispose()}}e=new WeakMap,t=new WeakMap,i=new WeakSet,s=function(t){"function"==typeof n(this,e)&&n(this,e).call(this,t,he)};const Ye=te(G({__name:"index",props:{devEnv:{type:Boolean},baseUrl:{},bgColor:{},skyCode:{},bgUrl:{},env:{},scale:{},camera:{default:()=>({})},cruise:{default:()=>({})},fog:{default:()=>({})},render:{default:()=>({})},controls:{default:()=>({})},grid:{default:()=>({})},axes:{default:()=>({})},directionalLight:{},color:{default:()=>({})},config:{default:()=>({})},corrugatedPlate:{type:Boolean,default:!0},mapJson:{},outlineJson:{},flywire:{},barList:{},scatters:{},barLabelRender:{}},emits:["init","change-map","click"],setup(e,{expose:t,emit:i}){const{transformGeoJSON:s}=T.useConvertData(),{show:a,dialog:o}=T.useDialog({style:{left:"0px",top:"0px"},extend:{}}),r=e,n=R(),{backgroundLoad:l}=T.useBackground(r.baseUrl+"/oss/sky/",ee().skys),c=i;Q((()=>r.scale),(e=>{null==g||g.setScale(e||1)})),Q((()=>r.mapJson),(e=>{e&&(null==g||g.initMap(s(e)),c("change-map"))})),Q((()=>r.outlineJson),(e=>{e&&(null==g||g.initMapOutLine(s(e)),r.barList&&(null==g||g.initMapBar(r.barList||[],p)))})),Q((()=>r.flywire),(e=>{null==g||g.initFlywire(e||[])})),Q((()=>r.barList),(e=>{null==g||g.initMapBar(e||[],p)})),Q((()=>r.scatters),(e=>{null==g||g.initScatter(e||[])}));const p=e=>{if("function"==typeof r.barLabelRender)return r.barLabelRender(e);const{name:t="",value:i=0,unit:s=""}=e;return{name:`\n      <div class="label-wrap">\n        <div class="name">${t}</div>\n        <div class="text">\n          <span class="value">${Z.numConverter(i)}</span>\n          <span class="unit">${s}</span>\n        </div>\n      </div>\n    `,className:"map-bar-label"}},d={baseUrl:r.baseUrl,bgUrl:r.bgUrl,env:r.env,bgColor:r.bgColor,camera:r.camera,cruise:r.cruise,fog:r.fog,render:r.render,grid:r.grid,controls:r.controls,axes:r.axes};let g;return j((()=>{d.container=n.value,g=new ze(d,r.config,r.color,((e,t)=>{let i=!!e;if(i){o.style&&(o.style.left=t.left+"px",o.style.top=t.top+"px");const s=e.isScatter,a=e.data;if(s)a.isScatter=!0,o.extend=a;else{const t=(r.barList||[]).find((t=>t.name==e.name));t?o.extend=t:i=!1}}a.value=i}),(e=>{c("click",M(e))})),g.run(),c("init",g),r.skyCode&&l(g,r.skyCode),r.corrugatedPlate&&(null==g||g.addCorrugatedPlate()),r.flywire&&r.flywire.length&&(null==g||g.initFlywire(r.flywire))})),t({exportImage:()=>null==g?void 0:g.exportImage()}),(e,t)=>(L(),D("div",{class:O(e.$style["map-scene"])},[P("div",{class:O(e.$style.container),ref_key:"containerRef",ref:n},null,2),K(a)?(L(),D("div",{key:0,class:O(e.$style["dialog-view"]),style:x(K(o).style)},[z(e.$slots,"dialog",{data:K(o).extend})],6)):Y("",!0)],2))}}),[["__cssModules",{$style:{"map-scene":"_map-scene_5opvk_2",container:"_container_5opvk_8","dialog-view":"_dialog-view_5opvk_12"}}]]),Fe={depth:2,scale:40,plateRadius:100},qe={main:3377879,mainHover:9633791,borderColor:9633791,borderHoverColor:1066618,light:1066618,lightHover:9633791,plateColor:3377879,plateLight:1066618,line:9559027,line2:6421501,gridColor:663606,gridFork:927811,outline:11856636,markColor1:13303807,markColor2:6945023,flyColor1:9559027,flyColor2:6421501,scatterColor1:9559027,scatterColor2:6421501},We=["src"],Ve=te(G({__name:"index",setup(e){const{load:t}=T.useFileLoader(),i=R(),s=F({devEnv:!0,baseUrl:"",bgColor:464681,color:qe,config:{...Fe,areaLabel:!0,markLight:!0,map:{}},camera:{position:[0,100,200]},directionalLight:{helper:!0},fog:{visible:!1,near:2e3,far:3e3},render:{preserveDrawingBuffer:!0},grid:{visible:!0,gridColor:qe.gridColor,centerLineColor:qe.gridColor,fork:!0,divisions:40,width:2*Fe.plateRadius*Fe.scale,forkSize:1.4*Fe.scale,forkColor:qe.gridFork},controls:{maxPolarAngle:.46*Math.PI,maxDistance:5e3,enableDamping:!0,screenSpacePanning:!1},axes:{visible:!0},mapJson:null,outlineJson:null,flywire:[],barList:[],scatters:[]}),a=()=>{var e;return null==(e=i.value)?void 0:e.exportImage()},o=e=>{const i=s.baseUrl;t(`${i}/oss/map/china.json`).then((e=>{s.mapJson=e})),t(`${i}/oss/map/china-outline.json`).then((e=>{s.outlineJson=e})),$(e).resize()},r=e=>{console.log(e),H.info({message:e.name,grouping:!0})},n=e=>{const{name:t="",value:i=0,unit:s=""}=e;return{name:`\n      <div class="label-wrap">\n        <div class="name">${t}</div>\n        <div class="text">\n          <span class="value">${ae(i)}</span>\n          <span class="unit">${s}</span>\n        </div>\n      </div>\n    `,className:"map-bar-label"}},l=()=>{ie.get(se.d3.map).then((e=>{const t=[],i=[];return e.list.forEach((e=>{const s=e.projects.length;let a=e.province;["重庆","北京","天津","上海"].includes(a)&&(a+="市"),["台湾"].includes(a)&&(a+="省"),e.projects.forEach((i=>{t.push({coord:[i.lng,i.lat],name:i.name,carbon:i.carbon,value:i.use,total:s,city:e.province,id:i.id})}));const o=e.total;-1===i.findIndex((e=>e.name===a))&&i.push({id:e.code,name:a,total:s,value:o,unit:"kWh"})})),{citys:i,projects:t,lines:e.lines}})).then((e=>{s.flywire=e.lines,s.scatters=e.projects,s.barList=e.citys}))};return j((()=>{})),(e,t)=>{const c=N;return L(),D("div",{class:O([e.$style.page,"h-100 o-h"])},[P("div",{class:O(e.$style.operate)},[q(c,{type:"primary",size:"small",onClick:a},{default:W((()=>t[0]||(t[0]=[V("导出")]))),_:1})],2),q(Ye,{ref_key:"threeSceneRef",ref:i,"dev-env":K(s).devEnv,"base-url":K(s).baseUrl,"bg-color":K(s).bgColor,"bg-url":K(s).bgUrl,env:K(s).env,"sky-code":K(s).skyCode,camera:K(s).camera,cruise:K(s).cruise,render:K(s).render,controls:K(s).controls,"directional-light":K(s).directionalLight,grid:K(s).grid,axes:K(s).axes,config:K(s).config,color:K(s).color,"map-json":K(s).mapJson,"outline-json":K(s).outlineJson,flywire:K(s).flywire,"bar-list":K(s).barList,scatters:K(s).scatters,"bar-label-render":n,onInit:o,onClick:r,onChangeMap:l},{dialog:W((({data:i})=>[P("div",{class:O(e.$style["dialog-view"])},[P("div",{class:O([e.$style.city,"flex"])},[P("span",{class:O(e.$style.name)},X(i.isScatter?i.city:i.name),3),P("span",{class:O(e.$style.total)},X(i.total)+"个项目",3)],2),i.isScatter?(L(),D("div",{key:0,class:O([e.$style.project,"flex flex-ac"])},[P("img",{src:`${K(s).baseUrl}/oss/img/map/pos.png`,alt:""},null,8,We),P("span",{class:O(e.$style.name)},X(i.name),3)],2)):Y("",!0),P("div",{class:O(e.$style.count)},[P("div",{class:O(e.$style.item)},[t[1]||(t[1]=P("span",null,"今日用电量",-1)),P("span",null,X(K(ae)(i.value)),1),t[2]||(t[2]=P("span",null,"kWh",-1))],2),i.isScatter?(L(),D("div",{key:0,class:O(e.$style.item)},[t[3]||(t[3]=P("span",null,"今日碳排放",-1)),P("span",null,X(K(ae)(i.carbon)),1),t[4]||(t[4]=P("span",null,"kgCO₂",-1))],2)):Y("",!0)],2)],2)])),_:1},8,["dev-env","base-url","bg-color","bg-url","env","sky-code","camera","cruise","render","controls","directional-light","grid","axes","config","color","map-json","outline-json","flywire","bar-list","scatters"])],2)}}}),[["__cssModules",{$style:{page:"_page_dcgzt_2",operate:"_operate_dcgzt_8","dialog-view":"_dialog-view_dcgzt_15",city:"_city_dcgzt_20",name:"_name_dcgzt_20",total:"_total_dcgzt_28",project:"_project_dcgzt_33",count:"_count_dcgzt_48",item:"_item_dcgzt_52"}}]]);export{Ve as default};
