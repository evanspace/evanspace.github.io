import{bv as e,bw as t,bx as n,by as s,be as o,bz as i,bA as a,bB as r,bC as l,bo as c,bc as d,bs as p,bD as g,b6 as u,bE as m,i as h,bf as f,bF as v,Y as y,bG as w,bH as b,bI as x,bJ as _,bK as j,bL as k,bM as C,bN as S,bO as L,bP as M,bQ as z,bR as P,bS as O,bT as A,bU as T,bV as B,bW as E,bX as D,bY as X,ba as I,b7 as U,bZ as R,b_ as Z,b5 as Y,bh as F,b$ as N,c0 as G,c1 as J,c2 as Q,c3 as H,c4 as W,c5 as K,c6 as V,c7 as $,bd as q,c8 as ee,c9 as te,ca as ne,bk as se,bp as oe,cb as ie,cc as ae,cd as re,ce as le,cf as ce,cg as de,ch as pe,ci as ge,cj as ue,ck as me,cl as he,cm as fe,cn as ve,co as ye,cp as we,cq as be,cr as xe,cs as _e,bb as je,ct as ke,cu as Ce,cv as Se,cw as Le,cx as Me,cy as ze,cz as Pe,cA as Oe,cB as Ae,cC as Te,cD as Be}from"./vendor-706835b2.js";const Ee="/imgs/negX-ba52c8a0.jpeg",De="/imgs/negY-aebb71ea.jpeg",Xe="/imgs/negZ-8a623aca.jpeg",Ie="/imgs/posX-0b453472.jpeg",Ue="/imgs/posY-106f8c18.jpeg",Re="/imgs/posZ-46bd2041.jpeg",Ze="/imgs/negX-07572c4d.jpeg",Ye="/imgs/negY-df29a995.jpeg",Fe="/imgs/negZ-e9c2566d.jpeg",Ne="/imgs/posX-412387d5.jpeg",Ge="/imgs/posY-2f852e1e.jpeg",Je="/imgs/posZ-a0169caf.jpeg",Qe="/imgs/negX-c075849c.jpeg",He="/imgs/negY-efe68319.jpeg",We="/imgs/negZ-f8c06141.jpeg",Ke="/imgs/posX-859ff54e.jpeg",Ve="/imgs/posY-542d8770.jpeg",$e="/imgs/posZ-9bf87017.jpeg",qe="/imgs/negX-93298305.jpeg",et="/imgs/negY-ab7d0097.jpeg",tt="/imgs/negZ-8e003bb8.jpeg",nt="/imgs/posX-42faf44a.jpeg",st="/imgs/posY-1539f2e4.jpeg",ot="/imgs/posZ-207804dc.jpeg",it="/imgs/negX-438b9f2b.jpeg",at="/imgs/negY-e9e0d506.jpeg",rt="/imgs/negZ-4d22fd12.jpeg",lt="/imgs/posX-a78e0796.jpeg",ct="/imgs/posY-f63703dd.jpeg",dt="/imgs/posZ-08a079c0.jpeg",pt="/imgs/negX-4d93f94f.jpeg",gt="/imgs/negY-8e9f1ba0.jpeg",ut="/imgs/negZ-59dbfaea.jpeg",mt="/imgs/posX-1819325d.jpeg",ht="/imgs/posY-fc440547.jpeg",ft="/imgs/posZ-1d29759b.jpeg",vt="/imgs/negX-ee411de3.jpeg",yt="/imgs/negY-0544ac3d.jpeg",wt="/imgs/negZ-92b76742.jpeg",bt="/imgs/posX-098f1b9a.jpeg",xt="/imgs/posY-d7813922.jpeg",_t="/imgs/posZ-c09fed75.jpeg",jt="/imgs/negX-971935c3.jpeg",kt="/imgs/negY-d3d51ab8.jpeg",Ct="/imgs/negZ-c76bfdd8.jpeg",St="/imgs/posX-a1fef9f5.jpeg",Lt="/imgs/posY-93b527f3.jpeg",Mt="/imgs/posZ-322f39df.jpeg",zt="/imgs/negX-de81e2d2.jpeg",Pt="/imgs/negY-60e5367a.jpeg",Ot="/imgs/negZ-b8b9ffd1.jpeg",At="/imgs/posX-4fc91917.jpeg",Tt="/imgs/posY-1e22430a.jpeg",Bt="/imgs/posZ-f948bb21.jpeg",Et="/imgs/negX-a708b91f.jpeg",Dt="/imgs/negY-0dfbb158.jpeg",Xt="/imgs/negZ-2fc11854.jpeg",It="/imgs/posX-09f2a3c1.jpeg",Ut="/imgs/posY-a4956363.jpeg",Rt="/imgs/posZ-858845b8.jpeg",Zt="/imgs/negX-375e5484.jpeg",Yt="/imgs/negY-4b8767fa.jpeg",Ft="/imgs/negZ-bc039d21.jpeg",Nt="/imgs/posX-8a1b126b.jpeg",Gt="/imgs/posY-a7e935b8.jpeg",Jt="/imgs/posZ-0af4e872.jpeg";function Qt(e,t,n,s){return new(n||(n=Promise))((function(o,i){function a(e){try{l(s.next(e))}catch(t){i(t)}}function r(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}l((s=s.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const Ht=e=>new URL(Object.assign({})[`../assets/imgs/texttures/${e}`],self.location).href,Wt=e=>{!e&&(e="");if(!/^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/)[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,}(\/\S*)?$/.test(e)){return/^(https?:\/\/)(?:\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::\d{1,5})?(?:[/?#]\S*)?$/.test(e)}return!0},Kt=(e,t="")=>Array.isArray(e)?e.map((e=>Kt(e,t))):!Wt(e)&&e.indexOf(t)<0?t+e:e,Vt=e=>new Promise((t=>{const n=window.indexedDB.deleteDatabase(e);n.onsuccess=e=>{t(!0)},n.onerror=e=>{t(!1)}})),$t=(e,t,n)=>new Promise((s=>{window.indexedDB.open(e).onsuccess=o=>{const i=o.target.result,a=i.version;i.close(),a!==t?Vt(e).then((e=>{s(e?t:a)})):i.objectStoreNames.contains(n)?s(a):Vt(e).then((e=>{s(e?t:a)}))}})),qt=(e,...t)=>Qt(void 0,[e,...t],void 0,(function*(e,t="THREE__MODEL_DB",n=1){if(!window.indexedDB)return Promise.resolve(void 0);yield $t(t,n,e);let s=window.indexedDB.open(t,n);return new Promise((t=>{s.onupgradeneeded=t=>{const n=t.target.result;n.objectStoreNames.contains(e)||n.createObjectStore(e,{keyPath:"path"})},s.onsuccess=e=>{const n=e.target.result;t(n)},s.onerror=e=>{t(void 0)}}))})),en=(e,t,n)=>{if(!e||!t||!n)return Promise.resolve(null);const s=e.transaction([t],"readonly").objectStore(t).get(n);return new Promise(((e,t)=>{s.onsuccess=t=>{const n=t.target.result;e(n)},s.onerror=e=>{t(e)}}))},tn={TEXT:"TEXT",JSQ:"JSQ",LDB:"LDB",LQB:"LQB",XBC:"XBC",LXJ:"LXJ",LGJ:"LGJ",LGJ_2:"LGJ_2",LGJ_3:"LGJ_3",LGJ_4:"LGJ_4",LQT:"LQT",GL:"GL",BSHRQ:"BSHRQ",BSHLQ:"BSHLQ",FLRB:"FLRB",FJY_X:"FJY_X",FJZ_X:"FJZ_X",FJY:"FJY",FJZ:"FJZ",FM:"FM",XFM:"XFM"};var nn={indexdb:{dbName:"THREE__MODEL__DB",tbName:"TB",version:1},mesh:{receiveShadowName:["楼板","地面","底座","底板","基础","基础底座","冷却塔基础","草地","ground","Ground"],animatehName:["动画","螺杆A","螺杆B","螺杆A001","螺杆B001","螺杆A002","螺杆B002","叶轮A","叶轮B","叶轮C","阀门"],transparentName:["透明","透明外壳"]},keys:tn,rightClickBackDiffTime:300,meshKey:{body:"__BODY_",color:"__COLOR_",warning:"__WARNING_",local:"__LOCAL_",disabled:"__DISABLED_",pipe:"__PIPE__"},statusOffset:{TEXT:{[tn.JSQ]:{position:{x:-20,y:10,z:0},rotation:{x:0,y:270,z:0}},[tn.LDB]:{position:{x:-60,y:0,z:0}},[tn.LQB]:{position:{x:0,y:0,z:60},rotation:{x:0,y:270,z:0}},[tn.LXJ]:{position:{x:0,y:16,z:50},rotation:{x:-20,y:0,z:0}},[tn.LGJ]:{position:{x:0,y:16,z:50},rotation:{x:-20,y:0,z:0}},[tn.LQT]:{position:{x:-60,y:0,z:0}},[tn.BSHLQ]:{position:{x:0,y:16,z:40}}},WARNING:{[tn.JSQ]:{position:{x:0,y:62,z:0}},[tn.LDB]:{position:{x:-4,y:45,z:0}},[tn.LQB]:{position:{x:0,y:45,z:4},rotation:{x:0,y:270,z:0}},[tn.LXJ]:{position:{x:0,y:78,z:0}},[tn.LGJ]:{position:{x:0,y:78,z:0}},[tn.LQT]:{position:{x:0,y:85,z:0}},[tn.BSHLQ]:{position:{x:0,y:88,z:0}}},STATUS:{[tn.LDB]:{position:{x:9,y:47,z:0}},[tn.LQB]:{position:{x:0,y:47,z:-9},rotation:{x:0,y:270,z:0}},[tn.LXJ]:{position:{x:27,y:67,z:42}},[tn.LGJ]:{position:{x:-47,y:67,z:42}},[tn.LQT]:{position:{x:-35,y:69,z:26}}},DISABLED:{[tn.LDB]:{position:{x:22,y:47,z:0}},[tn.LQB]:{position:{x:0,y:47,z:-22},rotation:{x:0,y:270,z:0}},[tn.LXJ]:{position:{x:40,y:67,z:42}},[tn.LGJ]:{position:{x:-34,y:67,z:42}},[tn.LQT]:{position:{x:-22,y:69,z:26}}}}};const sn=e=>{e.material instanceof Array?e.material=e.material.map((e=>e.clone())):e.material=e.material.clone()},on=e=>{let t=e.clone();return(e.isMesh||e.isSprite)&&sn(e),t.traverse((e=>{e.isMesh&&sn(e)})),t},an=(e,t=6776165,n,s)=>{const{type:o,name:i}=e;o.indexOf("Light"),nn.mesh.receiveShadowName.some((e=>i.indexOf(e)>-1))?e.traverse((e=>{e.isMesh&&(e.receiveShadow=!0)})):n.some((e=>i.indexOf(e)>-1))?ln(e,t):e.isMesh&&(s&&(e.material.envMap=s),e.castShadow=!0,e.receiveShadow=!0)},rn=e=>{let t=[];return Array.isArray(e)?t=e:null!=e&&(t=[e]),t},ln=(e,t)=>{e.traverse((e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0,Array.isArray(e.material)?e.material.forEach((e=>{e.color.set(t)})):e.material.color.set(t))}))},cn=nn.statusOffset,dn=(e,t,n={})=>{const s=t.type,o=cn[e]||{},i=n[s]||o[s]||{};let a=hn({x:0,y:0,z:0},i.position||{}),r=hn({x:0,y:0,z:0},i.rotation||{});return r.x=Math.PI/180*r.x,r.y=Math.PI/180*r.y,r.z=Math.PI/180*r.z,{position:a,rotation:r}},pn=(e,t)=>Object.prototype.toString.call(t)===`[object ${e}]`,gn=e=>pn("Object",e),un=e=>e&&("object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName),mn=(e,t=new Map)=>{if(null!=e&&gn(e)){let n=t.get(e);if(n)return n;const s=Array.isArray(e);let o=s?[]:{};return n=t.set(e,o),s?e.forEach(((e,t)=>{o[t]=mn(e,n)})):Object.keys(e).forEach((t=>{gn(o[t])?o[t]=mn(e[t],n):o[t]=e[t]})),o}return e},hn=(e,t)=>{e=mn(e);for(let n in t)n in e&&gn(t[n])&&gn(e[n])?e[n]=hn(e[n],t[n]):e[n]=t[n];return e},fn=(e,t)=>Math.floor(Math.random()*(t-e+1))+e;var vn=Object.freeze({__proto__:null,getTextturesUrl:Ht,numConverter:(e=0,t=2)=>{if(Math.abs(e)>=1e8){return 1*(e/1e8).toFixed(t)+"亿"}if(Math.abs(e)>=1e4){return 1*(e/1e4).toFixed(t)+"万"}return 1*e.toFixed(t)},getUrl:Kt,deleteDB:Vt,getDBVersion:$t,createDB:qt,getDataByKey:en,getAllData:(e,t)=>{const n=e.transaction(t,"readonly").objectStore(t).getAll();return new Promise(((e,t)=>{n.onsuccess=t=>{const n=t.target.result;e(n)},n.onerror=e=>{t(e)}}))},get_P_S_R_param:(e,t,n=1)=>{const s=e.position,o=e.rotation,i=e.scale,a=t.position||{x:0,y:0,z:0},r=t.rotation||{x:0,y:0,z:0},l=t.scale||{x:1,y:1,z:1},c=Math.abs(r.x)<2?1:180,d=Math.abs(r.y)<2?1:180,p=Math.abs(r.z)<2?1:180;return{position:[s.x+a.x,s.y+a.y,s.z+a.z],rotation:[o.x+Math.PI/c*r.x,o.y+Math.PI/d*r.y,o.z+Math.PI/p*r.z],scale:[i.x*n*l.x,i.y*n*l.y,i.z*n*l.z]}},modelDeepClone:on,replaceMaterial:an,getColorArr:rn,setMaterialColor:ln,cameraInSceneAnimate:(e,t,i=new o)=>(e.lookAt(i),e._lookAt_=i,new Promise((o=>{new n(e.position).to(t,1e3).easing(s.Quadratic.In).start().onUpdate((()=>{e.lookAt(i),e._lookAt_=i})).onComplete((()=>{o(e)}))}))),cameraLookatAnimate:(e,t,o)=>new Promise((i=>{new n(o).to(t,1e3).easing(s.Quadratic.In).start().onUpdate((t=>{e.lookAt(t),e._lookAt_=t})).onComplete((()=>{i(e)}))})),cameraLinkageControlsAnimate:(e,t,o,i)=>new Promise((a=>{new n(t.position).to(o,1e3).easing(s.Quadratic.In).start().onUpdate((()=>{const n=e.target;t.lookAt(n),t._lookAt_=n})),new n(e.target).to(i,1e3).easing(s.Quadratic.In).start().onComplete((()=>{a(t)}))})),createSpriteAnimate:(e,t,n=1,s=10)=>{let o=[0,s/2,s],l=[...t,t[0],t[1]+n,t[2],...t],c=new i("sprite.position",o,l),d=new a("sprite_up_down",s,[c]);const p=new r(e),g=p.clipAction(d);return g.timeScale=5,g.play(),e.__action__=g,e.__mixer__=p,e},getPlanePosition:(e,t,n)=>{let s=e.clientWidth/2,o=e.clientHeight/2,i=t.position.clone();const a=t.scale;i.y+=a.x/2;let r=i.project(n);return{left:r.x*s+s,top:-r.y*o+o}},findObjectsByHasProperty:(e,t,n="name")=>{let s=[];if(!e||!e.length)return[];return function e(o){o.forEach((o=>{const i=o[n];"string"==typeof i&&t.some((e=>i.indexOf(e)>-1))&&s.push(o),o.children&&e(o.children)}))}(e),s},getStatusOffset:dn,createText:(e,t,n=16777215,s)=>{const o=dn("TEXT",e,s);let i=e.font||{},a=new l(e.name||"",{font:t,size:i.size||10,depth:0,curveSegments:12,bevelThickness:1,bevelSize:.1,bevelEnabled:!0});const r=o.rotation;a.rotateX(r.x),a.rotateY(r.y),a.rotateZ(r.z);const p=o.position;a.computeBoundingBox(),a.computeVertexNormals();let g=.5*(a.boundingBox.max.x-a.boundingBox.min.x),u=.5*(a.boundingBox.max.z-a.boundingBox.min.z),m=new c({color:null!=i.color?i.color:n,flatShading:!1}),h=new d(a,m);return h.castShadow=!0,h.position.set((p.x||0)-g,p.y||0,(p.z||0)-u),h.name="text",h._isText_=!0,h},createWarning:(e,t,n,s,o=100,l=1)=>{if(!n)return;const c=dn("WARNING",t,s);let d=new p,u=on(n);u.scale.set(l,l,l);const m=c.position;u.position.set(m.x,m.y,m.z);const h=c.rotation;u.rotation.set(h.x,h.y,h.z),d.add(u);let f=new g(12717056,8,o,0);f.name="灯光",f.position.y=m.y+30,d.add(f),d.name=e;let v=new r(d),y=new i("红色.material.color",[0,.25,.75],[1,0,0,1,1,0,1,0,0]),w=new i("灯光.color",[0,.25,.75],[1,0,0,1,1,0,1,0,0]),b=new i("警告标识.scale",[0,.5,1],[1,1,1,1.2,1.2,2,1,1,1]),x=new a("warning_",1,[y,w,b]),_=v.clipAction(x);return _.paused=!0,_.play(),d.visible=!1,d._isWarning_=!0,{group:d,action:_,mixer:v}},createStatusMark:(e,t,n,s)=>{if(!t)return;const o=dn(s?"DISABLED":"STATUS",e,n);let i=on(t);const a=o.position;i.position.set(a.x,a.y,a.z);const r=o.rotation;return i.rotation.set(r.x,r.y,r.z),i.visible=!1,i._isStatus_=!0,i},isType:pn,isObject:gn,isDOM:un,deepClone:mn,deepMerge:hn,checkUrl:Wt,random:fn}),yn={container:document.body,width:window.innerWidth,height:window.innerHeight,baseUrl:"",bgColor:null,bgUrl:null,env:null,scale:1,fog:{visible:!1,near:100,far:1e3},render:{antialias:!0,logarithmicDepthBuffer:!0,preserveDrawingBuffer:!1},controls:{visible:!0,autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.25,enablePan:!0,enableRotate:!0,enableZoom:!0,maxAzimuthAngle:1/0,minAzimuthAngle:1/0,minDistance:1,maxDistance:2e3,minPolarAngle:0,maxPolarAngle:Math.PI,maxTargetRadius:1/0,rotateSpeed:1,screenSpacePanning:!0},ambientLight:{visible:!0,color:16777215,intensity:1.5},directionalLight:{visible:!0,helper:!1,position:[500,1e3,800],position2:[-500,800,-800],light2:!0,color:16777215,intensity:1.5},camera:{helper:!1,near:1,far:1e4,position:[-350,510,700]},cruise:{visible:!1,enabled:!1,runing:!1,helper:!1,points:[],segment:2,tension:0,baseUrl:"",repeat:[.1,1],width:15,speed:1,mapSpeed:.006,offset:10,factor:1,auto:!1,animateBack:void 0,alway:!1},grid:{visible:!1,opacity:.3,transparent:!0,width:800,divisions:80,centerLineColor:10592673,gridColor:10592673,fork:!1,forkSize:1.4,forkColor:10592673},axes:{visible:!1,size:50}};const wn=()=>({initCSS3DRender:(e,n)=>{const{width:s,height:o}=e,i=new t;return i.setSize(s,o),i.domElement.style.position="absolute",i.domElement.style.left="0px",i.domElement.style.top="0px",i.domElement.style.pointerEvents="none",n.appendChild(i.domElement),i},createCSS3DDom:e=>{const{name:t,className:n="",onClick:s,position:o,sprite:i}=e,a=document.createElement("div");a.innerHTML=t,a.className=n;const r=i?new V(a):new $(a);return a.style.pointerEvents=s?"auto":"none",a.style.position="absolute","function"==typeof s&&a.addEventListener("click",s),o&&r.position.set(...o),r}}),{createCSS3DDom:bn}=wn(),xn=()=>({visible:!0,enabled:!1,runing:!1,helper:!1,points:[],segment:2,close:!0,tension:0,baseUrl:"",mapUrl:Ht("arrow.png"),repeat:[.1,1],width:15,speed:1,mapSpeed:.006,offset:10,factor:1,index:0,auto:!1,tube:!1,color:16777215,radius:1,radialSegments:1,animateBack:void 0,alway:!1}),_n=()=>{let e,t,n,s=xn();const i=(t,o)=>{n=new d(new ye(2),new se({color:0,opacity:.8,depthTest:!1,transparent:!0})),t.add(n);const i=(new W).setFromPoints(o.concat(o[0])),a=new G({color:255,opacity:1,depthTest:!1,transparent:!0}),r=new we(i,a);t.add(r);const l=new ce(e,100,s.width/2,3,!0),c=new be({color:16711935,opacity:.1,depthTest:!1,transparent:!0}),p=new d(l,c),g=new se({color:16715760,opacity:.3,wireframe:!0,depthTest:!1,transparent:!0}),u=new d(l,g);p.add(u),t.add(p)},a=()=>{var e;return 900*(null!==(e=s.segment)&&void 0!==e?e:2)},r=()=>null==e?void 0:e.getPoints(a()),l=(e,t)=>new o(t.x,t.y+e,t.z),g=e=>{if(!s.enabled)return;switch(e.keyCode){case 38:case 87:s.runing?(s.factor*=1.5,s.factor>10&&(s.factor=10)):s.index+=5;break;case 83:case 40:s.runing||(s.index-=5,s.index<0&&(s.index=a()))}},h=e=>{if(!s.enabled)return;s.factor=1;switch(e.keyCode){case 32:s.runing=!s.runing;break;case 38:case 87:s.runing||(s.index+=10);break;case 83:case 40:s.runing||(s.index-=10,s.index<0&&(s.index=a()))}};return{createCruise:(n,a)=>{s=hn(xn(),n);const{points:l,tension:g,mapUrl:h,baseUrl:f,repeat:v,width:y,helper:w,close:b,tube:x,color:_,radius:j,radialSegments:k}=s,C=[];for(let e=0;e<l.length;e++){const t=l[e];C.push(new o(t[0],t[1],t[2]))}e=new le(C,b,"catmullrom",null!=g?g:0),e=new le(r(),b,"catmullrom",null!=g?g:0);const S=new p;t=(new u).load(Kt(h,f),(e=>{e.wrapS=m,e.repeat.x=v[0],e.repeat.y=v[1],e.anisotropy=a.capabilities.getMaxAnisotropy()}));const L=new c({color:_,map:t,opacity:.9,transparent:!0,depthTest:!0,side:he}),M=new o(0,1,0),z=new ze;z.set(r(),j,k,M,!1);const P=x?new fe:new ve;P.update(z,x?{radius:j,radialSegments:k,progress:1,startRad:0}:{width:y,arrow:!1,progress:1,side:"both"},!1);const O=new d(P,L);return S.add(O),S.name="cruise",w&&i(S,C),S.renderOrder=99,S},updateCruise:e=>{s=hn(s,e)},cruiseAnimate:o=>{if(!o)return;if(!e)return;const{mapSpeed:i,speed:r,factor:c,enabled:d,runing:p,offset:g,helper:u,auto:m,animateBack:h}=s;if(t&&(t.offset.x-=i),!(m||p&&d))return;(m||p&&d)&&(s.index+=c*r);const f=a(),v=s.index%f/f;let y=v+.001;y>1&&(y-=1);const w=e.getPointAt(y);if(u&&n){const e=l(g,w);n.position.copy(e)}const b=l(g,e.getPointAt(v));if(!m||p&&d){o.position.copy(b);const e=l(g,w);o._lookAt_=e,o.lookAt(e)}"function"==typeof h&&h(b,w,e,v)},bindEvent:()=>{window.addEventListener("keydown",g,!1),window.addEventListener("keyup",h,!1)},removeEvent:()=>{window.removeEventListener("keyup",h),window.removeEventListener("keydown",g)}}},jn=()=>({createFork:(e={})=>{const{width:t=800,divisions:n=80,forkSize:s=1.4,forkColor:o=10592673}=e;let i=t/n,a=-t/2;const r=new p;for(let l=0;l<=n;l++)for(let e=0;e<=n;e++){const t=a+l*i,n=a+e*i,c=new I(s,s/5),p=new be({color:o,transparent:!0,opacity:.9}),g=new d(c,p);g.rotateX(.5*-Math.PI),g.position.set(t,0,n);const u=g.clone();u.rotateZ(.5*Math.PI),r.add(g,u)}return r}}),kn=["216","217","218","219","220","221","222","223","224","225","226"];var Cn,Sn,Ln=Object.freeze({__proto__:null,useConvertData:()=>({transformGeoJSON:e=>{let t=e.features;for(let n=0;n<t.length;n++){const e=t[n];"Polygon"===e.geometry.type&&(e.geometry.coordinates=[e.geometry.coordinates])}return e}}),useCountryLine:()=>{const e=(e,t,n="LineLoop")=>{let s;if("Line2"===n){const n=new Q;n.setPositions(e),s=new H(n,t),s.name="countryLine2",s.computeLineDistances()}else{const o=new W;o.setFromPoints(e),s=new K[n](o,t),s.name="countryLine"}return s};return{createCountryFlatLine:(t,n,s="LineLoop")=>{let i={color:65535,linewidth:1,depthTest:!1};i=hn(i,n);let a=new G(i);"Line2"===s&&(a=new J(i));let r=t.features,l=new p;for(let c=0;c<r.length;c++){const t=r[c].geometry.coordinates;for(let n=0;n<t.length;n++){const i=t[n],r=[];"Line2"===s?i.forEach((e=>{e.forEach((e=>{r.push(e[0],0,-e[1])}))})):i.forEach((e=>{e.forEach((e=>{r.push(new o(e[0],e[1],0))}))}));let c=e(r,a,s);l.add(c)}}return l},getPoints:(e,t=0,n)=>{let s=e.features;const i=[];for(let a=0;a<s.length;a++){const e=s[a].geometry.coordinates;for(let s=0;s<e.length;s++)e[s].forEach((e=>{e.forEach((e=>{n?i.push(new o(e[0],t,-e[1])):i.push(e[0],t,-e[1])}))}))}return i}}},useMapBar:(e={})=>{let t=hn({height:10,size:2,factor:1,color1:1048575,color2:16777215},e);return{createBar:(e={},n={})=>{var s;t=hn(t,n);let{size:o,height:i,factor:a,color1:r,color2:l}=t;o*=a,i*=a,i*=null!==(s=e.heightRatio)&&void 0!==s?s:a;const[c,g,u]=e.position||[0,0,0],m=new p,h=new q(o,o,i),f=new ee({depthTest:!1,transparent:!0,vertexColors:!1,uniforms:{uColor1:{value:new F(r)},uColor2:{value:new F(l)},uOpacity:{value:.6}},vertexShader:"\n\t\t\t\tvarying vec3 vColor;\n\t\t\t\tuniform vec3 uColor1;\n\t\t\t\tuniform vec3 uColor2;\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat percent = (position.z + 0.0) / 100.0; // 计算当前像素点在立方体高度上的百分比\n\t\t\t\t\tvColor = mix(uColor1.rgb, uColor2.rgb, percent);\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\t\tvarying vec3 vColor;\n\t\t\t\tuniform float uOpacity;\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = vec4(vColor, uOpacity);\n\t\t\t\t}\n\t\t\t"}),v=new d(h,f);if(m.add(v),m.name="柱状图",m.position.set(c,g,u+i/2),m.renderOrder=99,e.label){const{name:t="",className:n="",onClick:s}=e.label,o=bn({name:t,className:n,position:[0,0,i/2],onClick:s});o.rotateX(.5*Math.PI),m.add(o)}return m}}},useOutline:(e={})=>{let t=hn({size:.1,color:16085360,range:500,factor:1,speed:6},e);const n=e=>{const n=e.material,s=n.uniforms.uLength.value;n.uniforms.uIndex.value+=t.speed,n.uniforms.uIndex.value>=s&&(n.uniforms.uIndex.value=0)};return{createOutline:(e,n={})=>{t=hn(t,n);const{size:s,factor:o,range:i,color:a}=t,r=new Float32Array(e),l=new W;l.setAttribute("position",new te(r,3));const c=new Float32Array(Math.floor(r.length/3)).map(((e,t)=>t));l.setAttribute("aIndex",new te(c,1));const d=new ee({vertexShader:"\n\t\t\t\tattribute float aOpacity;\n\t\t\t\tuniform float uSize;\n\n\t\t\t\tattribute float aIndex;\n\t\t\t\tvarying vec3 vp;\n\t\t\t\tvarying float vertexIndex;\n\n\t\t\t\tvoid main(){\n\t\t\t\t\tgl_Position = projectionMatrix*modelViewMatrix*vec4(position,1.0);\n\t\t\t\t\tgl_PointSize = uSize;\n\n\t\t\t\t\tvp = position;\n\t\t\t\t\tvertexIndex = aIndex;\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\t\tvarying float vertexIndex;\n\t\t\t\tuniform vec3 uColor;\n\t\t\t\tuniform float uIndex;\n\t\t\t\tuniform float uRange;\n\n\t\t\t\tfloat invert(float n){\n\t\t\t\t\treturn 1.-n;\n\t\t\t\t}\n\n\t\t\t\tvoid main(){\n\t\t\t\t\tfloat uOpacity = 1.0;\n\t\t\t\t\tif(vertexIndex <= uIndex || vertexIndex >= (uRange + uIndex)){\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t\tuOpacity = (vertexIndex - uIndex)/uRange;\n\t\t\t\t\tif ( uOpacity < 0.2) {\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t\tvec2 uv=vec2(gl_PointCoord.x,invert(gl_PointCoord.y));\n\t\t\t\t\tvec2 cUv=2.*uv-1.;\n\t\t\t\t\tvec4 color=vec4(1./length(cUv));\n\t\t\t\t\tcolor*=uOpacity;\n\t\t\t\t\tcolor.rgb*=uColor;\n\t\t\t\t\tgl_FragColor=color;\n\t\t\t\t}\n\t\t\t",transparent:!0,depthTest:!1,uniforms:{uSize:{value:s*o},uIndex:{value:0},uLength:{value:c.length},uRange:{value:i},uColor:{value:new F(a)}}}),p=new ne(l,d);return p.name="轮廓",p.scale.setScalar(o),p},update:n,outlineUpdate:n}},useMarkLight:(e={})=>{let t=hn({pointTextureUrl:Ht("point.png"),circleTextureUrl:Ht("circle.png"),lightTextureUrl:Ht("light.png"),factor:1,color:65535},e);const s=new u;return{createMarkLight:(e=[0,0,0],o=10,i={})=>{t=hn(t,i);const a=new p,r=new I(o/6.219,o);r.rotateX(-Math.PI/2),r.translate(0,0,o/2);const l=new se({map:s.load(t.lightTextureUrl),color:t.color,transparent:!0,depthWrite:!1,side:oe});let c=new d(r,l);c.rotateX(Math.PI),c.position.z=o,c.renderOrder=3,c.name="光柱 01";let g=c.clone();g.name="光柱 02",g.rotateZ(Math.PI/2);const u=(()=>{const e=new I(3,3),n=new se({map:s.load(t.pointTextureUrl),color:t.color,side:oe,transparent:!0,depthWrite:!1});let o=new d(e,n);o.renderOrder=1,o.name="底部光点";const i=.3*t.factor;return o.scale.setScalar(i),o})(),m=(()=>{const e=new I(3,3),o=new se({map:s.load(t.circleTextureUrl),color:t.color,side:oe,opacity:0,transparent:!0,depthWrite:!1});let i=new d(e,o);i.renderOrder=2,i.name="createLightHalo";const a=.5*t.factor;i.scale.setScalar(a);const r=fn(0,2e3);return i.tween1=new n({scale:a,opacity:0}).to({scale:1.5*a,opacity:1},1e3).delay(r).onUpdate((e=>{let{scale:t,opacity:n}=e;i.scale.setScalar(t),i.material.opacity=n})),i.tween2=new n({scale:1.5*a,opacity:1}).to({scale:2*a,opacity:0},1e3).onUpdate((e=>{let{scale:t,opacity:n}=e;i.scale.setScalar(t),i.material.opacity=n})),i.tween1.chain(i.tween2),i.tween2.chain(i.tween1),i.tween1.start(),i})();a.add(c,g,u,m);const[h,f,v]=e;return a.position.set(h,f,v),a.rotateX(.5*Math.PI),a.name="光柱标记",a}}},useFence:()=>{const e=[1,.8],t=.2,n=(new u).load(Ht("fenceMap0.png"),(n=>{n.wrapT=m,n.repeat.x=e[0],n.repeat.y=e[1],n.offset.y=t})),s=(new u).load(Ht("fenceMap1.png"),(n=>{n.wrapT=m,n.repeat.x=e[0],n.repeat.y=e[1],n.offset.x=t})),o=(new u).load(Ht("fenceMap2.png"),(e=>{e.wrapS=m,e.wrapT=m})),i=(e,t,i)=>{const a=[];for(let n=0;n<t.length;n++){const s=t[n];a.push(...e[s])}const r=new W,l=new Float32Array(a);r.setAttribute("position",new te(l,3));const g=t.length,u=new te(new Float32Array(3*g),3);r.setAttribute("normal",u);for(let n=0;n<g;n++)u.setXYZ(n,0,0,0);const m=new te(new Float32Array([1,1,0,1,0,0,0,0,1,0,1,1]),2);r.setAttribute("uv",m);const h=new c({color:i,map:n,transparent:!0,blending:re,side:oe}),f=new c({color:i,map:s,transparent:!0,blending:re,side:oe});var v=new c({color:i,map:o,opacity:.5,transparent:!0,side:oe});const y=new d(r,h),w=new p,b=new d(r,f),x=new d(r,v);return w.add(y,b,x),w};return{createFence:(e,t=11009923)=>{const n=new p;var s=new ie(e,t);s.update();const o=s.geometry.getAttribute("position").array,a=[];for(let i=0;i<o.length;i+=3){const e=o[i],t=o[i+1],n=o[i+2];a.push([e,t,n])}const r=i(a,[0,1,2,2,3,0],t),l=i(a,[4,5,6,6,7,4],t),c=i(a,[4,0,3,3,7,4],t),d=i(a,[1,5,6,6,2,1],t);return n.add(r,l,c,d),n},fenceAnimate:(e=1)=>{const o=.008*e;if(n){let e=n.offset.y-o;e<0&&(e=t),n.offset.y=e}if(s){let e=s.offset.y-o;e<0&&(e=t),s.offset.y=e}}}},useCorrugatedPlate:(e={})=>{let t=hn({range:100,interval:.8,size:.2,color:47273,light:881527,factor:1},e);const n=(e,t)=>{const n=e.material,s=n.uniforms.uRange.value,o=n.uniforms.uLength.value;n.uniforms.uRadius.value+=t*(s/4),n.uniforms.uRadius.value>=s+o&&(n.uniforms.uRadius.value=0)};return{createCorrugatedPlate:(e={})=>{t=hn(t,e);let{range:n,color:s,light:i,factor:a}=t;n*=a;const r=(()=>{let{range:e,interval:n,size:s,factor:i}=t;e*=i,n*=i,s*=i;const a=[],r=Math.floor(e/n);for(let t=-r;t<=r;t++)for(let e=-r;e<=r;e++){const i=new I(s,s),r=t*n,l=e*n,c=new Le,d=new o(r,-s,l),p=new Pe,g=new Se,u=new o(1,1,1);p.setFromEuler(g),c.compose(d,p,u),i.applyMatrix4(c),a.push(i)}return a})(),l=ae(r),c=new ee({uniforms:{uColor:{value:new F(i)},uTcolor:{value:new F(s)},uRadius:{value:1.25},uLength:{value:n/10},uRange:{value:n}},vertexShader:"\n\t\t\t\tvarying vec3 vp;\n\t\t\t\tvoid main(){\n\t\t\t\t\tvp = position;\n\t\t\t\t\tgl_Position\t= projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\t\tvarying vec3 vp;\n\t\t\t\tuniform vec3 uColor;\n\t\t\t\tuniform vec3 uTcolor;\n\t\t\t\tuniform float uRadius;\n\t\t\t\tuniform float uLength;\n\t\t\t\tfloat getLeng(float x, float y){\n\t\t\t\t\treturn\tsqrt((x-0.0)*(x-0.0)+(y-0.0)*(y-0.0));\n\t\t\t\t}\n\t\t\t\tvoid main(){\n\t\t\t\t\tfloat uOpacity = 0.8;\n\t\t\t\t\tvec3 vColor = uColor;\n\t\t\t\t\tfloat length = getLeng(vp.x,vp.z);\n\t\t\t\t\tif ( length <= uRadius && length > uRadius - uLength ) {\n\t\t\t\t\t\tfloat op = sin( (uRadius - length) / uLength ) ;\n\t\t\t\t\t\tuOpacity = op;\n\t\t\t\t\t\tif ( vp.y < 0.0 ) {\n\t\t\t\t\t\t\tvColor = uColor * op;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvColor = uTcolor;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tvColor = uTcolor;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(vColor,uOpacity);\n\t\t\t\t}\n\t\t\t",transparent:!0,depthWrite:!1,side:oe}),p=new d(l,c);return p.name="波纹板",p},update:n,corrugatedPlateUpdate:n}},useDiffusion:()=>{let e;return{createDiffusion:(t=10,n=16715760,s=5)=>{const o=new I(t,t,1,1),i=["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(""),a=["varying vec2 vUv;","uniform vec3 uColor;","uniform float uOpacity;","uniform float uSpeed;","uniform float uSge;","uniform float time;","float PI = 3.14159265;","float drawCircle(float index, float range) {","\tfloat opacity = 1.0;","\tif (index >= 1.0 - range) {","\t\topacity = 1.0 - (index - (1.0 - range)) / range;","\t} else if(index <= range) {","\t\topacity = index / range;","\t}","\treturn opacity;","}","float distanceTo(vec2 src, vec2 dst) {","\tfloat dx = src.x - dst.x;","\tfloat dy = src.y - dst.y;","\tfloat dv = dx * dx + dy * dy;","\treturn sqrt(dv);","}","void main() {","\tfloat iTime = -time * uSpeed;","\tfloat opacity = 0.0;","\tfloat len = distanceTo(vec2(0.5, 0.5), vec2(vUv.x, vUv.y));","\tfloat size = 1.0 / uSge;","\tvec2 range = vec2(0.65, 0.75);","\tfloat index = mod(iTime + len, size);","\tvec2 cRadius = vec2(0.06, 0.12);","\tif (index < size && len <= 0.5) {","\t\tfloat i = sin(index / size * PI);","\t\tif (i >= range.x && i <= range.y){","\t\t\tfloat t = (i - range.x) / (range.y - range.x);","\t\t\tfloat r = 0.3;","\t\t\topacity = drawCircle(t, r);","\t\t}","\t\topacity *=\t1.0 - len / 0.5;","\t};","\tgl_FragColor = vec4(uColor, uOpacity * opacity);","}"].join("");e=new ee({uniforms:{uColor:{value:new F(n)},uOpacity:{value:1},uSpeed:{value:.1},uSge:{value:s},uRadius:{value:t/2},time:{value:0}},transparent:!0,vertexShader:i,fragmentShader:a,depthTest:!1,blending:re,side:oe});return new d(o,e)},updateDiffusion:(t=1)=>{if(!e)return;const n=.001*performance.now()*t;e.uniforms.time.value=n}}},useFlywire:(e={})=>{let t,n,s=hn({depth:0,height:4,divisions:1e3,color:16777215,flyColor:16761095,pointColor:16715760,pointWidth:2.5,flyPointWidth:2.4,tubularSegments:256,radius:.5,radialSegments:8,closed:!1,length:100,factor:1,speed:4},e);const i=e=>{const[t,o]=e;let{pointWidth:i,depth:a,factor:r}=s;const l=i*r;a*=r;const c=new I(l,l,1,1),p=new d(c,n);return p.position.set(t,a,-o),p.rotateX(.5*-Math.PI),p},a=(e={})=>{s=hn(s,e),t=new ee({depthTest:!1,uniforms:{uColor:{value:new F(s.flyColor)},uIndex:{value:0},uTotal:{value:s.divisions},uWidth:{value:s.flyPointWidth},uLength:{value:s.length}},vertexShader:["attribute float aIndex;","uniform float uIndex;","uniform float uWidth;","uniform vec3 uColor;","varying float vSize;","uniform float uLength;","void main(){","\t\tvec4 viewPosition = viewMatrix * modelMatrix * vec4(position,1);","\t\tgl_Position = projectionMatrix * viewPosition;","\t\tif(aIndex >= uIndex - uLength && aIndex < uIndex){","\t\t\tvSize = uWidth * ((aIndex - uIndex + uLength) / uLength);","\t\t}","\t\tgl_PointSize = vSize;","}"].join(""),side:oe,fragmentShader:["varying float vSize;","uniform vec3 uColor;","void main(){","\t\tif(vSize<=0.0){","\t\t\tgl_FragColor = vec4(1,0,0,0);","\t\t}else{","\t\t\tgl_FragColor = vec4(uColor,1);","\t\t}","}"].join(""),transparent:!0,vertexColors:!1}),n=new ee({uniforms:{uColor:{value:new F(s.pointColor)},uOpacity:{value:1},uSpeed:{value:.1},uSge:{value:4},uRadius:{value:s.pointWidth*s.factor/2},time:{value:0}},transparent:!0,depthTest:!1,vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(""),fragmentShader:["varying vec2 vUv;","uniform vec3 uColor;","uniform float uOpacity;","uniform float uSpeed;","uniform float uSge;","uniform float time;","float PI = 3.14159265;","float drawCircle(float index, float range) {","\tfloat opacity = 1.0;","\tif (index >= 1.0 - range) {","\t\topacity = 1.0 - (index - (1.0 - range)) / range;","\t} else if(index <= range) {","\t\topacity = index / range;","\t}","\treturn opacity;","}","float distanceTo(vec2 src, vec2 dst) {","\tfloat dx = src.x - dst.x;","\tfloat dy = src.y - dst.y;","\tfloat dv = dx * dx + dy * dy;","\treturn sqrt(dv);","}","void main() {","\tfloat iTime = -time * uSpeed;","\tfloat opacity = 0.0;","\tfloat len = distanceTo(vec2(0.5, 0.5), vec2(vUv.x, vUv.y));","\tfloat size = 1.0 / uSge;","\tvec2 range = vec2(0.65, 0.75);","\tfloat index = mod(iTime + len, size);","\tvec2 cRadius = vec2(0.06, 0.12);","\tif (index < size && len <= 0.5) {","\t\tfloat i = sin(index / size * PI);","\t\tif (i >= range.x && i <= range.y){","\t\t\t// 归一","\t\t\tfloat t = (i - range.x) / (range.y - range.x);","\t\t\t// 边缘锯齿范围","\t\t\tfloat r = 0.3;","\t\t\topacity = drawCircle(t, r);","\t\t}","\t\t// 渐变","\t\topacity *=\t1.0 - len / 0.5;","\t};","\tgl_FragColor = vec4(uColor, uOpacity * opacity);","}"].join("\n"),side:oe})},r=()=>{const e=t,o=e.uniforms.uTotal.value;e.uniforms.uIndex.value+=s.speed,e.uniforms.uIndex.value>=o&&(e.uniforms.uIndex.value=0);const i=.001*performance.now();n.uniforms.time.value=i};return a(),{createFlywireTexture:a,createFlywire:e=>{const n=new p,a=i(e[0]),r=i(e[1]);n.add(a,r);const l=(e=>{const[t,n]=e[0],[i,a]=e[1];let{depth:r,height:l,factor:c,divisions:d}=s;l=(r+l)*c,r*=c;const p=new o(t,r,-n),g=new o(t+(i-t)/4,l,-(n+(a-n)/4)),u=new o(t+3*(i-t)/4,l,-(n+3*(a-n)/4)),m=new o(i,r,-a);return new Me(p,g,u,m).getPoints(d)})(e),c=new le(l,!1,"centripetal",.5),g=new ce(c,s.tubularSegments,s.radius,s.radialSegments,s.closed),u=new ee({transparent:!0,opacity:1,depthTest:!1,vertexColors:!1,uniforms:{uColor:{value:new F(s.color)},uOpacity:{value:.6}},vertexShader:["varying vec3 vColor;","uniform vec3 uColor;","void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join(""),fragmentShader:["uniform vec3 uColor;","uniform float uOpacity;","void main() {","\tgl_FragColor = vec4(uColor, uOpacity);","}"].join("")}),m=new d(g,u);m.renderOrder=10;const h=(e=>{const n=new Float32Array(e.map(((e,t)=>t))),s=(new W).setFromPoints(e);return s.setAttribute("aIndex",new te(n,1)),new ne(s,t)})(l);return n.add(m,h),n},update:r,flywireUpdate:r}},useLensflare:(e={})=>{let t=hn({mainTextureUrl:Ht("lensflare0.png"),minorTextureUrl:Ht("lensflare3.png")},e);const n=new u,s=n.load(t.mainTextureUrl),o=n.load(t.minorTextureUrl);return{addLensflare:(e,t,n,i)=>{const a=new g(16777215,1,2e3,0);a.color.set(e),a.position.set(t,n,i);const r=new de;return r.addElement(new pe(s,700,0,a.color)),r.addElement(new pe(o,60,.6)),r.addElement(new pe(o,70,.7)),r.addElement(new pe(o,120,.9)),r.addElement(new pe(o,70,1)),a.add(r),a}}},useFileLoader:()=>{const e=h(0);return{load:t=>{const n=new ge;return new Promise(((s,o)=>{n.load(t,(e=>{let t={};try{t=JSON.parse(e)}catch(n){}s(t)}),(t=>{let{loaded:n,total:s}=t;e.value=Number((n/s*100).toFixed(0))}),o)}))},progress:e}},useUpload:e=>{const t=hn({baseUrl:"",dracoPath:"/three/draco/gltf/",basisPath:"/three/basis/"},e);return{uploadModel:(e,n,s)=>{const{baseUrl:o,dracoPath:i,basisPath:a}=t,r=e[0],l=r.name,c=l.split(".").pop().toLowerCase(),d=new FileReader;d.addEventListener("progress",(e=>{const t="("+Math.floor(e.total/1e3)+" KB)",n=Math.floor(e.loaded/e.total*100)+"%";s&&s({progress:n,filename:l,size:t})})),d.addEventListener("load",(e=>Qt(void 0,void 0,void 0,(function*(){const t=e.target.result;if(["glb","gltf"].includes(c)){const e=new x,s=new b;s.setDecoderPath(`${o}${i}`),e.setDRACOLoader(s);const r=new _;r.setTranscoderPath(`${o}${a}`),e.setKTX2Loader(r),e.setMeshoptDecoder(j),e.parse(t,"",(t=>{var s,o,i;const a=t.scene.children;let r=new p;a.length>1?r.add(...a):r=a[a.length-1],r.name=(null===(s=r.userData)||void 0===s?void 0:s.name)||l,r.animations.push(...t.animations),n(r),null===(o=e.dracoLoader)||void 0===o||o.dispose(),null===(i=e.ktx2Loader)||void 0===i||i.dispose()}))}else if("fbx"==c){const e=(new ue).parse(t,"");n(e)}})))),d.readAsArrayBuffer(r)}}},useCollide:()=>{const e=new f,t=new o(0,2,0);return{checkCollide:(n,s,i,a=!0,r=t)=>{const l=s.clone().add(r),c=new o;n.getWorldDirection(c),c.normalize(),e.ray.origin.copy(l),e.ray.direction.copy(c);return e.intersectObjects(i,a)}}},useCoord:()=>({getBoundingBox:e=>{var t=new me;t.expandByObject(e);var n=new o;t.getSize(n);var s=new o;return t.getCenter(s),{box3:t,center:s,size:n}}}),useRaycaster:()=>{const e=new f,t=new v,n={left:0,top:0};return{raycaster:e,pointer:t,style:n,update:(e,s,o=1)=>{const i=s.getBoundingClientRect()||{left:0,top:0};t.x=(e.clientX-i.left)/(s.clientWidth*o)*2-1,t.y=-(e.clientY-i.top)/(s.clientHeight*o)*2+1;const a=s.clientWidth/2,r=s.clientHeight/2;n.left=t.x*a+a,n.top=-t.y*r+r}}},useCruise:_n,useCSS2D:()=>({initCSS2DRender:(t,n)=>{const{width:s,height:o}=t,i=new e;return i.setSize(s,o),i.domElement.style.position="absolute",i.domElement.style.left="0px",i.domElement.style.top="0px",i.domElement.style.pointerEvents="none",n.appendChild(i.domElement),i},createCSS2DDom:e=>{const{name:t,className:n="",onClick:s,position:o}=e,i=document.createElement("div");i.innerHTML=t,i.className=n;const a=new xe(i);return i.style.pointerEvents=s?"auto":"none",i.style.position="absolute","function"==typeof s&&i.addEventListener("click",(e=>s(e,a))),o&&a.position.set(...o),a}}),CSS2DRenderer:e,useCSS3D:wn,CSS3DRenderer:t,useFloor:(e={})=>{const t=hn({mode:"BA",margin:50},e),o=(e,t,o,i)=>{0!==t.length&&t.forEach((t=>{var a,r,l,c;const d=t._position_,p="UD"==e?(null!==(a=d.y)&&void 0!==a?a:0)+o:null!==(r=d.y)&&void 0!==r?r:0,g="BA"==e?(null!==(l=d.z)&&void 0!==l?l:0)+i:null!==(c=d.z)&&void 0!==c?c:0;new n(t.position).to({y:p,z:g},500).easing(s.Quadratic.Out).start()}))};return{floorAnimate:(e,i,a)=>{var r,l,c,d,p,g;const u=void 0!==i&&i>-1,{margin:m,mode:h}=t;for(let t=0;t<e.length;t++){const f=e[t],v=f._position_;const y=(t-(u?i:t))*m;let w=(null!==(r=v.y)&&void 0!==r?r:0)+y,b=i==t?(null!==(l=v.z)&&void 0!==l?l:0)+m:null!==(c=v.z)&&void 0!==c?c:0;const x=i===t&&("UD"===h&&w===f.position.y||"BA"===h&&b===f.position.z);if(x&&(w=null!==(d=v.y)&&void 0!==d?d:0,b=null!==(p=v.z)&&void 0!==p?p:0),"UD"===h){if(f.position.y===w)continue}else if("BA"===h&&f.position.z===b)continue;if(null===(g=f.data)||void 0===g?void 0:g.mark){const e=a(f.data.mark);let n=i==t?m:0;x&&(n=0),o(h,e,y,n)}new n(f.position).to({y:"UD"===h?w:f.position.y,z:"BA"===h?b:f.position.z},500).easing(s.Quadratic.Out).start()}}}},useDialog:(e={})=>{const t=y(hn({show:!1,style:{left:"",top:""},select:[],data:{},title:"",position:{top:0,left:0}},e));return{dialog:t,options:t,show:w(t.show)}},useGrid:jn,useMaterial:()=>{const e=(e,t=.5)=>{const n=e=>{e.material.transparent=!0,e.material.opacity=t};e.isMesh?n(e):e.traverse((e=>{e.isMesh&&n(e)}))},t=e=>({color:e.color,map:e.map,emissive:e.emissive,emissiveIntensity:e.emissiveIntensity,emissiveMap:e.emissiveMap,bumpMap:e.bumpMap,normalMap:e.normalMap,displacementMap:e.displacementMap,opacity:e.opacity,transparent:e.transparent,side:e.side}),n=(e,s,o)=>{if(e instanceof Array){let t=e.map((e=>n(e,s,o)));e=t}else s?(e.metalness=.5,e.roughness=0):(e.metalness=.5,e.roughness=1),e=new je(Object.assign(Object.assign({},t(e)),{metalness:e.metalness,roughness:e.roughness,side:o?oe:he}));return e},s=(e,t)=>{const n=document.createElement("a");n.style.display="none",document.body.appendChild(n),n.href=URL.createObjectURL(e),n.download=t,n.click(),n.remove()};return{materialReplace:(t,s,o,i=1211922)=>{const a=nn.mesh,r=a.animatehName,l=a.transparentName,{type:c,name:d}=o;if(c.indexOf("Light")>-1){if(!o.shadow)return;let e=800;if(o.castShadow=!0,o.shadow.camera.right=e,o.shadow.camera.left=-e,o.shadow.camera.top=e,o.shadow.camera.bottom=-e,"SpotLight"===c){let e=new _e(o,o.color);t.add(e)}}else if(s.transformMaterial&&o.isMesh)if(s.opacitySkin&&l.find((e=>d.indexOf(e)>-1))&&e(o,s.opacity),a.receiveShadowName.find((e=>d.indexOf(e)>-1))){o.receiveShadow=!0;const e=s.groundReflection;o.material=n(o.material,e,s.side)}else if(r.find((e=>d.indexOf(e)>-1))){let e=new je({color:i,metalness:.6,roughness:.6});o.material=e}else o.isMesh&&(o.castShadow=!0,o.receiveShadow=!0,o.material=n(o.material,s.glisten,s.side))},changeTransparent:e,exportGlb:(e,t,n,o=!0)=>{if(!e)return;const i={binary:o,animations:t};(new ke).parse(e,(e=>{if(e instanceof ArrayBuffer)t=n+".glb",s(new Blob([e],{type:"application/octet-stream"}),t);else{((e,t)=>{s(new Blob([e],{type:"text/plain"}),t)})(JSON.stringify(e,null,2),n+".gltf")}var t}),(e=>{}),i)},getAnimations:e=>{const t=[];e.traverse((e=>{t.push(...e.animations)}));const n=[];for(const s of t)n.push(s.clone().optimize());return n},setMetalnessMaterial:(e={color:16777215},n,s)=>new je(Object.assign(Object.assign({},t(e)),{metalness:n,roughness:s})),setGlassMaterial:(e={color:16777215},{metalness:n=0,roughness:s=0,envMapIntensity:o=0,transmission:i=0,ior:a=0})=>new Ce(Object.assign(Object.assign({},t(e)),{metalness:n,roughness:s,envMapIntensity:o,transmission:i,ior:a})),centerBoxHelper:(e,t=16711680)=>{var n=new ie(e,t);n.update();return{helper:n,center:(new me).setFromObject(e).getCenter(new o)}}}},useMoveAnimate:()=>{let e;const t={index:0,length:0,runing:!1,model:void 0,speed:1,endCallback:void 0,rungingCall:void 0},n=t=>null==e?void 0:e.getPoints(t),s=(n=!0)=>{if(t.runing=!1,n){const n=t.index-1;t.model.position.copy((n=>{let s=n/t.length;return s>1?s=1:s<0&&(s=0),e.getPointAt(s)})(n))}};return{createMove:(s,o,i,a)=>{const r=s.position,l=Math.atan2(-o.z+r.z,o.x-r.x);s.rotation.y=.5*Math.PI+l;const c=r.distanceTo(o);let d=Math.floor(c/t.speed);d<2&&(d=2);e=new le([r,o],!1,"catmullrom",0),e=new le(n(d),!1,"catmullrom",0),t.model=s,t.index=0,t.length=d,t.rungingCall=i,t.endCallback=a,t.runing=!0},moveAnimate:(n=1)=>{if(!t.runing)return;t.index+=n;let o=t.index/t.length;o>1&&(o=1);const i=e.getPointAt(o);t.model.position.copy(i),o>=1?(t.runing=!1,"function"==typeof t.endCallback&&t.endCallback(i)):"function"==typeof t.rungingCall&&t.rungingCall(i,s)}}},useRoam:()=>{let e,t={runing:!1,segment:2,close:!0,tension:0,offset:0,points:[],factor:1,speed:1,index:0,animateBack:void 0};const n=(n={})=>{if(e)return;t=hn({runing:!1,segment:2,close:!0,tension:0,offset:0,points:[],factor:1,speed:1,index:0,animateBack:void 0},n);const{points:i,tension:a,close:r}=t,l=[];for(let e=0;e<i.length;e++){const t=i[e];l.push(new o(t[0],t[1],t[2]))}e=new le(l,r,"catmullrom",null!=a?a:0),e=new le(s(),r,"catmullrom",null!=a?a:0)},s=()=>null==e?void 0:e.getPoints(i()),i=()=>{var e;return 1e3*(null!==(e=t.segment)&&void 0!==e?e:2)},a=(e,t)=>new o(t.x,t.y+e,t.z);return{createRoam:n,updateRoam:e=>{t=hn(t,e)},executeRoam:(n,s)=>{if(!n||!s)return;if(!e)return;const{runing:o,offset:r,factor:l,speed:c,animateBack:d}=t;if(!o)return;t.index+=l*c;const p=i(),g=t.index%p/p;let u=g+.01;u>1&&(u-=1);const m=e.getPointAt(u),h=a(r,e.getPointAt(g)),f=a(r,m);s.target=f,n._lookAt_=f,n.lookAt(s.target),"function"==typeof d&&d(h,m,e,g)},pause:()=>{t.runing=!1},play:()=>{t.runing=!0},reset:t=>{e=void 0,n(t)},getStatus:()=>t.runing}},useOpenTheDoor:()=>{let e={propertyName:"name",value:"",scale:10,axle:"z",isOpen:void 0,leftMatch:"左",rightMatch:"右",duration:1e3,angle:.5*Math.PI,autoClose:!0,delay:1e4};const t=(s,i)=>{const{propertyName:a,value:r,scale:l,axle:c,isOpen:d,leftMatch:p,rightMatch:g,duration:u,autoClose:m,delay:h}=hn(e,i),f=s.getObjectByProperty(a,r);if(!f)return Promise.reject();const v=f.children.find((e=>e.name.indexOf(p)>-1)),y=f.children.find((e=>e.name.indexOf(g)>-1));if(!v||!y)return Promise.reject();m&&clearTimeout(f.__timer__);const w=v.position,b=y.position;return null==f.__open__&&(v.__position__=(new o).copy(w),y.__position__=(new o).copy(b)),f.__open__=void 0!==d?d:!f.__open__,new Promise((e=>{const o=y.__position__[c]+(f.__open__?-l:0);if(b[c]===o)return e(f);new n(w).to({[c]:v.__position__[c]+(f.__open__?l:0)},u).delay(0).start(),new n(b).to({[c]:o},u).delay(0).start().onComplete((()=>{e(f)})),m&&f.__open__&&(f.__timer__=setTimeout((()=>{t(s,i)}),h+u))}))},s=(t,o)=>{const{propertyName:i,value:a,angle:r,axle:l,isOpen:c,duration:d,autoClose:p,delay:g}=hn(e,o),u=t.getObjectByProperty(i,a);if(!u)return Promise.reject();p&&clearTimeout(u.__timer__);const m=u.rotation;return null==u.__open__&&(u.__rotation__=(new Se).copy(m)),u.__open__=void 0!==c?c:!u.__open__,new Promise((e=>{const i=u.__rotation__[l]+(u.__open__?-r:0);if(m[l]===i)return e(u);new n(u.rotation).to({[l]:i},d).delay(0).start(),p&&u.__open__&&(u.__timer__=setTimeout((()=>{s(t,o)}),g+d))}))},i=(t,s)=>{const{propertyName:o,value:a,angle:r,axle:l,leftMatch:c,rightMatch:d,isOpen:p,duration:g,autoClose:u,delay:m}=hn(e,s),h=t.getObjectByProperty(o,a);if(!h)return Promise.reject();const f=h.children.find((e=>e.name.indexOf(c)>-1)),v=h.children.find((e=>e.name.indexOf(d)>-1));if(!f||!v)return Promise.reject();u&&clearTimeout(h.__timer__);const y=f.rotation,w=v.rotation;return null==h.__open__&&(f.__rotation__=(new Se).copy(y),v.__rotation__=(new Se).copy(w)),h.__open__=void 0!==p?p:!h.__open__,new Promise((e=>{const o=v.__rotation__[l]+(h.__open__?-r:0);if(w[l]===o)return e(h);new n(f.rotation).to({[l]:f.__rotation__[l]+(h.__open__?r:0)},g).delay(0).start(),new n(v.rotation).to({[l]:o},g).delay(0).start(),u&&h.__open__&&(h.__timer__=setTimeout((()=>{i(t,s)}),m+g))}))};return{dubleHorizontal:t,oddRotate:s,dubleRotate:i}},useKeyboardState:()=>{const e=["shift","ctrl","alt","meta"],t={left:37,up:38,right:39,down:40,space:32,pageup:33,pagedown:34,tab:9},n={},s={};let o,i;const a=(e,t)=>{var o=e.keyCode;n[o]=t,s.shift=e.shiftKey,s.ctrl=e.ctrlKey,s.alt=e.altKey,s.meta=e.metaKey},r=e=>{a(e,!0),"function"==typeof o&&o(e)},l=e=>{a(e,!1),"function"==typeof i&&i(e)};document.addEventListener("keydown",r,!1),document.addEventListener("keyup",l,!1);const c=o=>{for(var i=o.split("+"),a=0;a<i.length;a++){var r=i[a];if(!(-1!==e.indexOf(r)?s[r]:-1!=Object.keys(t).indexOf(r)?n[t[r]]:n[r.toUpperCase().charCodeAt(0)]))return!1}return!0};return{keyboardPressed:e=>Array.isArray(e)?e.findIndex(c)>-1:c(e),insertEvent:(e,t)=>{o=e,i=t},destroyEvent:()=>{document.removeEventListener("keydown",r,!1),document.removeEventListener("keyup",l,!1)}}},useBackground:e=>{const t=kn.findIndex((t=>t==e)),n=h(t<0?0:t),s=e=>{const t=kn[n.value];t&&(i(e,t),n.value++,n.value>=kn.length&&(n.value=0))},o=e=>["posX.jpeg","negX.jpeg","posY.jpeg","negY.jpeg","posZ.jpeg","negZ.jpeg"].map((t=>((e,t)=>new URL(Object.assign({"../src/assets/imgs/sky/216/negX.jpeg":Ee,"../src/assets/imgs/sky/216/negY.jpeg":De,"../src/assets/imgs/sky/216/negZ.jpeg":Xe,"../src/assets/imgs/sky/216/posX.jpeg":Ie,"../src/assets/imgs/sky/216/posY.jpeg":Ue,"../src/assets/imgs/sky/216/posZ.jpeg":Re,"../src/assets/imgs/sky/217/negX.jpeg":Ze,"../src/assets/imgs/sky/217/negY.jpeg":Ye,"../src/assets/imgs/sky/217/negZ.jpeg":Fe,"../src/assets/imgs/sky/217/posX.jpeg":Ne,"../src/assets/imgs/sky/217/posY.jpeg":Ge,"../src/assets/imgs/sky/217/posZ.jpeg":Je,"../src/assets/imgs/sky/218/negX.jpeg":Qe,"../src/assets/imgs/sky/218/negY.jpeg":He,"../src/assets/imgs/sky/218/negZ.jpeg":We,"../src/assets/imgs/sky/218/posX.jpeg":Ke,"../src/assets/imgs/sky/218/posY.jpeg":Ve,"../src/assets/imgs/sky/218/posZ.jpeg":$e,"../src/assets/imgs/sky/219/negX.jpeg":qe,"../src/assets/imgs/sky/219/negY.jpeg":et,"../src/assets/imgs/sky/219/negZ.jpeg":tt,"../src/assets/imgs/sky/219/posX.jpeg":nt,"../src/assets/imgs/sky/219/posY.jpeg":st,"../src/assets/imgs/sky/219/posZ.jpeg":ot,"../src/assets/imgs/sky/220/negX.jpeg":it,"../src/assets/imgs/sky/220/negY.jpeg":at,"../src/assets/imgs/sky/220/negZ.jpeg":rt,"../src/assets/imgs/sky/220/posX.jpeg":lt,"../src/assets/imgs/sky/220/posY.jpeg":ct,"../src/assets/imgs/sky/220/posZ.jpeg":dt,"../src/assets/imgs/sky/221/negX.jpeg":pt,"../src/assets/imgs/sky/221/negY.jpeg":gt,"../src/assets/imgs/sky/221/negZ.jpeg":ut,"../src/assets/imgs/sky/221/posX.jpeg":mt,"../src/assets/imgs/sky/221/posY.jpeg":ht,"../src/assets/imgs/sky/221/posZ.jpeg":ft,"../src/assets/imgs/sky/222/negX.jpeg":vt,"../src/assets/imgs/sky/222/negY.jpeg":yt,"../src/assets/imgs/sky/222/negZ.jpeg":wt,"../src/assets/imgs/sky/222/posX.jpeg":bt,"../src/assets/imgs/sky/222/posY.jpeg":xt,"../src/assets/imgs/sky/222/posZ.jpeg":_t,"../src/assets/imgs/sky/223/negX.jpeg":jt,"../src/assets/imgs/sky/223/negY.jpeg":kt,"../src/assets/imgs/sky/223/negZ.jpeg":Ct,"../src/assets/imgs/sky/223/posX.jpeg":St,"../src/assets/imgs/sky/223/posY.jpeg":Lt,"../src/assets/imgs/sky/223/posZ.jpeg":Mt,"../src/assets/imgs/sky/224/negX.jpeg":zt,"../src/assets/imgs/sky/224/negY.jpeg":Pt,"../src/assets/imgs/sky/224/negZ.jpeg":Ot,"../src/assets/imgs/sky/224/posX.jpeg":At,"../src/assets/imgs/sky/224/posY.jpeg":Tt,"../src/assets/imgs/sky/224/posZ.jpeg":Bt,"../src/assets/imgs/sky/225/negX.jpeg":Et,"../src/assets/imgs/sky/225/negY.jpeg":Dt,"../src/assets/imgs/sky/225/negZ.jpeg":Xt,"../src/assets/imgs/sky/225/posX.jpeg":It,"../src/assets/imgs/sky/225/posY.jpeg":Ut,"../src/assets/imgs/sky/225/posZ.jpeg":Rt,"../src/assets/imgs/sky/226/negX.jpeg":Zt,"../src/assets/imgs/sky/226/negY.jpeg":Yt,"../src/assets/imgs/sky/226/negZ.jpeg":Ft,"../src/assets/imgs/sky/226/posX.jpeg":Nt,"../src/assets/imgs/sky/226/posY.jpeg":Gt,"../src/assets/imgs/sky/226/posZ.jpeg":Jt})[`../src/assets/imgs/sky/${e}/${t}`],self.location).href)(e,t))),i=(e,t)=>{const n=o(t);if("function"==typeof e.setBgTexture)e.setBgTexture(n);else if(Array.isArray(n)){const t=(new Y).load(n);e.background=t}else e.background=(new u).load(n)};return{skys:kn,index:n,change:s,changeBackground:s,load:i,getBgGroup:o,backgroundLoad:i}},useModelLoader:(e={})=>{let t;const n=hn({baseUrl:"",dracoPath:"/three/draco/gltf/",basisPath:"/three/basis/",modelSizeKB:1048576,colors:{normal:{color:8954293},runing:{color:3045368},error:{color:12717056}},loadCache:!0,colorMeshName:[],indexDB:{cache:!0}},e),s=y({percentage:0,show:!1,isEnd:!1,list:[],total:0,loaded:0}),o={base:"base",device:"device",font:"font",sprite:"sprite",pipe:"pipe",warning:"warning",remote:"remote",local:"local",disabled:"disabled",spotlight:"spotlight"},i=new Map,a=new b;a.setDecoderPath(n.baseUrl+n.dracoPath);const r=new x;r.setDRACOLoader(a);const l=new _;l.setTranscoderPath(n.baseUrl+n.basisPath),r.setKTX2Loader(l),r.setMeshoptDecoder(j);const c=e=>{const t=e.loaded,n=s.total;let o=Number((t+s.loaded)/n*100);o>100&&(o=100),s.percentage=Number(o.toFixed(2))},d=(e,t,s,o)=>{if(!s)return;const{baseUrl:a,colorMeshName:r}=n,{mapUrl:l,key:c,mapMeshName:d,repeat:p=[1,1]}=e;let g;l&&d&&(g=(new u).load(Kt(l,a)),g.wrapS=m,g.wrapT=m,g.repeat.set(p[0],p[1]));const h=on(s);return h.traverse((e=>{e.isMesh&&g&&e.name.indexOf(d)>-1?e.material=new be({side:oe,transparent:!0,opacity:0,map:g.clone()}):an(e,t,r||[])})),l&&d&&(h._mapMeshName_=d),h.animations=o,c&&i.set(c,h),h},g=(e,s=0)=>new Promise((o=>Qt(void 0,void 0,void 0,(function*(){var i;n.indexDB.cache||o(null);const a=N.get(e);if(a)a instanceof ArrayBuffer?(c({loaded:a.byteLength}),r.parse(a,"",(t=>{N.add(e,t),o(t)}))):(c({loaded:s*n.modelSizeKB}),setTimeout((()=>{o(a)}),10));else{const s=yield en(t,(null===(i=n.indexDB)||void 0===i?void 0:i.tbName)||nn.indexdb.tbName,e);if(s&&s.data){const e=s.data;"string"==typeof e?(c({loaded:e.length}),N.add(s.path,e),setTimeout((()=>{o(e)}),10)):(c({loaded:e.byteLength}),r.parse(e,"",(e=>{N.add(s.path,e),o(e)})))}else o(null)}})))),h=e=>{var s;if(!n.indexDB.cache)return;const o=N.get(e);if(o&&t){const i=(null===(s=n.indexDB)||void 0===s?void 0:s.tbName)||nn.indexdb.tbName;t.transaction(i,"readwrite").objectStore(i).add({path:e,data:o})}},f=(e,t)=>{const{key:s,url:o="",size:i=0}=e,{baseUrl:a,colors:l}=n;return new Promise(((n,u)=>Qt(void 0,void 0,void 0,(function*(){let m=l.normal[s]||l.normal.color;m=rn(m)[0];const f=Kt(o,a),v=yield g(f,i);if(v){const t=v.scene.children[0],s=d(e,m,t,v.animations);return void n(s)}let y=(f.split(".").pop()||"").toLowerCase();if("glb"!==y)throw new Error("模型类型错误,必须为 GLB 格式，当前格式："+y);r.load(f,(t=>{const s=t.scene.children;let o=new p;s.length>1?o.add(...s):o=s[s.length-1];const i=d(e,m,o,t.animations);h(f),n(i)}),(e=>{c(e),"function"==typeof t&&t(e)}),u)}))))},v=(e,t={})=>{t=hn({color:57599,wireframe:!0,opacity:.5,filter:[],filterMatch:[]},t),e.traverse((e=>{var n;(null===(n=t.filter)||void 0===n?void 0:n.includes(e.name))||w(e.name,t.filterMatch)||e.isMesh&&(e.__material__||(e.__material__=e.material),e.material=new se({color:t.color,wireframe:t.wireframe,transparent:!0,opacity:t.opacity}))}))},w=(e="",t=[])=>t.filter((t=>e.indexOf(t)>-1)).length>0;return{progress:s,MODEL_MAP:o,loadModel:f,loadModels:(e,a,r)=>Qt(void 0,void 0,void 0,(function*(){var l,d,p;yield qt((null===(l=n.indexDB)||void 0===l?void 0:l.tbName)||nn.indexdb.tbName,(null===(d=n.indexDB)||void 0===d?void 0:d.dbName)||nn.indexdb.dbName,(null===(p=n.indexDB)||void 0===p?void 0:p.version)||nn.indexdb.version).then((e=>(e&&(N.enabled=!0,t=e),e)));const m=e.length;if(!(0==m?(s.isEnd=!0,s.show=!1,0):(s.isEnd=!1,s.percentage=0,s.show=!0,1)))return;(e=>{for(let t=0;t<e.length;t++)s.total+=(e[t].size||0)*n.modelSizeKB})(e);let v=0;const y=()=>Qt(void 0,void 0,void 0,(function*(){const t=e[v],{type:l=o.device,size:d=0}=t;switch(l){case o.device:case o.pipe:yield f(t,r);break;case o.sprite:(e=>{const{key:t,range:s={x:1,y:1},mapUrl:o=""}=e;let a=(new u).load(n.baseUrl+o),r=new Oe({map:a}),l=new Ae(r),c=s.x,d=s.y;l.scale.set(c,d,1),l.name="sprite",i.set(t,l)})(t);break;case o.font:yield((e,t)=>{const{url:s="",size:a=0}=e,{baseUrl:r}=n,l=Kt(s,r),d=new Te;return new Promise(((e,n)=>Qt(void 0,void 0,void 0,(function*(){const s=yield g(l,a);if(s){const t=d.parse(JSON.parse(s));return i.set(o.font,t),void setTimeout((()=>{e(t)}),10)}d.load(l,(t=>{i.set(o.font,t),h(l),e(t)}),(e=>{c(e),"function"==typeof t&&t(e)}),n)}))))})(t,r);break;case o.warning:t.key=o.warning,yield f(t,r);break;case o.local:t.key=o.local,yield f(t,r);break;case o.disabled:t.key=o.disabled,yield f(t,r);break;case o.spotlight:(e=>{const{key:t,color:n=16777215,intensity:s=8,distance:o=10,angle:a=.2*Math.PI,penumbra:r=.2,decay:l=0}=e;let c=new Be(n,s,o,a,r,l);c.castShadow=!0,c.visible=!1,i.set(t,c)})(t)}v++,s.loaded+=d*n.modelSizeKB,v>=m?(s.percentage=100,s.isEnd=!0,a()):y()}));y()})),getModel:e=>i.get(e),virtualization:(e=[],t,n={})=>{const s=n.filter||[],o=n.filterMatch||[];if(e.length)for(let i=0;i<e.length;i++){const a=e[i];t.uuid===a.uuid||s.includes(a.name)||w(a.name,o)||v(a,n)}else v(t,n)},closeVirtualization:e=>{if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t].traverse((e=>{e.isMesh&&e.__material__&&(e.material=e.__material__)}));else e.traverse((e=>{e.isMesh&&e.__material__&&(e.material=e.__material__)}))}}}});const{createCruise:Mn,cruiseAnimate:zn,updateCruise:Pn,bindEvent:On,removeEvent:An}=_n(),{createFork:Tn}=jn();class Bn{constructor(e={}){Cn.add(this);const t=yn;this.options=hn(t,e),Bn.total++,this.pointer={tsp:0,isClick:!1},un(this.options.container)?this.container=this.options.container:this.container=document.querySelector(this.options.container),this.options.width=this.container.offsetWidth,this.options.height=this.container.offsetHeight,this.scene=new k,this.renderer=this.initRenderer(),this.baseCamera=this.initCamera(),this.controls=this.initControls(),this.init(),this.initCruise()}get camera(){const{visible:e,runing:t,auto:n}=this.options.cruise;return e&&this.cruiseCamera&&t?this.cruiseCamera:this.baseCamera}init(){this.initLight(),this.initGrid(),this.initAxes(),this.initModel()}run(){this.loop()}loop(){this.animationId=window.requestAnimationFrame((()=>{this.loop()})),this.animate(),this.modelAnimate()}animate(){var e;this.renderer&&this.renderer.render(this.scene,this.camera),this.options.controls.visible&&(null===(e=this.controls)||void 0===e||e.update()),zn(this.cruiseCamera),C()}initModel(){}modelAnimate(){}initRenderer(){const{width:e,height:t,bgColor:n,bgUrl:s,env:o}=this.options,i=new S(this.options.render);if(o&&this.setEnvironment(o),s?this.setBgTexture(s):this.setBgColor(n),this.options.fog.visible){const{color:e,near:t,far:n}=this.options.fog;this.scene.fog=new L(null!=e?e:this.scene.background,t,n)}return i.sortObjects=!0,i.shadowMap.enabled=!0,i.shadowMap.type=M,i.setSize(e,t),i.setPixelRatio(window.devicePixelRatio),this.container.appendChild(i.domElement),i}initLight(){const{ambientLight:e,directionalLight:t}=this.options;if(e.visible){const t=new z(e.color,e.intensity);this.addObject(t)}if(t.visible){const e=this.createDirectionalLight(),[n=0,s=0,o=0]=t.position;if(e.position.set(n,s,o),this.addObject(e),t.helper){const t=new P(e,1);this.addObject(t)}if(t.light2){const e=this.createDirectionalLight(!1),[n=0,s=0,o=0]=t.position2;if(e.position.set(n,s,o),this.addObject(e),t.helper){const t=new P(e,1);this.addObject(t)}}}}createDirectionalLight(e=!0,t=2e3,n=4096,s=1,o=2e4){const{color:i,intensity:a}=this.options.directionalLight,r=new O(i,a);if(e){r.shadow.mapSize.setScalar(n),r.shadow.bias=-1e-5,r.shadow.normalBias=.01,r.castShadow=e;const i=r.shadow.camera;i.near=s,i.far=o,i.top=i.right=t,i.left=i.bottom=-t,i.updateProjectionMatrix()}return r}initCamera(){const{width:e,height:t,camera:n}=this.options;let s=new A(36,e/t,n.near,n.far);if(n.orthogonal){let o=e/t,i=260;s=new T(-i*o,i*o,i,-i,n.near,n.far)}if(s.position.set(...n.position),s.lookAt(0,0,0),n.helper){const e=new B(s);this.addObject(e)}return s}initControls(){const e=this.options.controls;if(!e.visible)return;const t=new E(this.camera,this.renderer.domElement);return Object.keys(e).forEach((n=>{t[n]=e[n]})),t.target.set(0,0,0),t.saveState(),t}initCruise(){const{visible:e}=this.options.cruise;e&&(this.cruiseCamera=this.initCamera(),function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)}(this,Cn,"m",Sn).call(this))}initGrid(){const e=this.options.grid;if(!e.visible)return;const{width:t,divisions:n,centerLineColor:s,gridColor:o,opacity:i,transparent:a,fork:r}=e,l=new D(t,n,s,o);if(l.material.opacity=i,l.material.transparent=a,this.grid=l,this.addObject(l),r){const t=Tn(e);t.name="辅助交叉点",t._isGridFork_=!0,this.addObject(t)}}initAxes(){if(!this.options.axes.visible)return;const e=new X(this.options.axes.size);this.addObject(e)}createGround(e=5e3,t,n=11721691){const s=new I(e,t=void 0===t?e:t),o=new c({color:n,shininess:10}),i=new d(s,o);return i.name="ground",i.rotation.x=1.5*Math.PI,i.receiveShadow=!0,i}createClock(){this.clock=new U}setCruisePoint(e){this.options.cruise.points=e,this.createCruise()}createCruise(){const{visible:e,points:t,alway:n}=this.options.cruise;if(!e)return;if(this.cruiseGroup&&this.disposeObj(this.cruiseGroup),On(),!t||0==t.length)return;const s=Mn(this.options.cruise,this.renderer);this.cruiseGroup=s,s.visible=n,this.addObject(s)}toggleCruise(e){let{visible:t,runing:n,auto:s,alway:o}=this.options.cruise;t&&(n=null!=e?e:n,this.options.cruise.runing=!n,this.options.cruise.enabled=!n,this.controls&&(this.controls.enabled=s||n),this.cruiseGroup&&!o&&(this.cruiseGroup.visible=!n),Pn(this.options.cruise))}toggleCruiseDepthTest(e){this.cruiseGroup&&this.cruiseGroup.traverse((t=>{(t.isMesh||t.isLine)&&(t.material.depthTest=null!=e?e:!t.material.depthTest)}))}setScale(e){this.options.scale=e}setEnvironment(e){(new R).load(Kt(e,this.options.baseUrl),(e=>{e.mapping=Z,this.scene.environment=e}))}setBgTexture(e){if(Array.isArray(e)){const t=(new Y).load(Kt(e,this.options.baseUrl));this.scene.background=t}else this.scene.background=(new u).load(Kt(e))}setBgColor(e){this.scene.background=e?new F(e):null}bindEvent(){const e=this.renderer.domElement;e.addEventListener("dblclick",this.onDblclick.bind(this)),e.addEventListener("pointerdown",this.onPointerDown.bind(this)),e.addEventListener("pointermove",this.onPointerMove.bind(this)),e.addEventListener("pointerup",this.onPointerUp.bind(this))}onDblclick(e){}onPointerDown(e){this.pointer.isClick=!0,this.pointer.tsp=e.timeStamp}onPointerMove(e){}onPointerUp(e){this.pointer.isClick=!1}exportImage(){const e=document.createElement("a");e.download="render.png",e.href=this.renderer.domElement.toDataURL().replace("image/png","image/octet-stream"),e.click()}getPosition(){var e;return{position:this.camera.position,target:null===(e=this.controls)||void 0===e?void 0:e.target}}isCameraMove(e,t=1){const n=this.camera.position;return Math.abs(n.x-e.x)<t&&Math.abs(n.y-e.y)<t&&Math.abs(n.z-e.z)<t}addObject(...e){this.scene.add(...e)}controlSave(){var e;null===(e=this.controls)||void 0===e||e.saveState()}controlReset(){var e;null===(e=this.controls)||void 0===e||e.reset(),this.toggleCruise(!0)}getValidTargetPosition(e,t,n,s={x:-104,y:7,z:58}){const o=t||e.to||s,i=n||e.target||{x:0,y:0,z:0},a=this.controls;return a&&a.target&&a.target.set(i.x,i.y,i.z),o}resize(){this.options.width=this.container.offsetWidth||window.innerWidth,this.options.height=this.container.offsetHeight||window.innerHeight;const{width:e,height:t,camera:n}=this.options,s=e/t;n.orthogonal||(this.baseCamera.aspect=s),this.baseCamera.updateProjectionMatrix(),this.cruiseCamera&&(n.orthogonal||(this.cruiseCamera.aspect=s),this.cruiseCamera.updateProjectionMatrix()),this.renderer.setSize(e,t)}stopAnimate(){window.cancelAnimationFrame(this.animationId)}clear(e){e&&e.traverse&&(e.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),null==e||e.clear()})),null==e||e.clear())}disposeObj(e){e&&e.traverse&&(e.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),null==e||e.clear()})),null==e||e.clear(),this.scene.remove(e))}dispose(){var e;An(),this.stopAnimate();try{N.clear(),this.disposeObj(this.scene),this.scene.clear(),this.renderer.dispose(),this.renderer.forceContextLoss();let t=this.renderer.domElement.getContext("webgl");t&&(null===(e=t.getExtension("WEBGL_lose_context"))||void 0===e||e.loseContext()),this.disposeObj(this.cruiseGroup),this.disposeObj(this.grid),this.controls&&this.controls.dispose(),this.scene=void 0,this.renderer=void 0,this.baseCamera=void 0,this.cruiseCamera=void 0,this.controls=void 0,this.grid=void 0,this.cruiseGroup=void 0,this.container.innerHTML=""}catch(t){}}}Cn=new WeakSet,Sn=function(){const e=this.options.cruise;e.enabled=!1,e.runing=!1,e.baseUrl&&(e.baseUrl=this.options.baseUrl),e.factor=1},Bn.total=0;const En=Object.freeze(Object.defineProperty({__proto__:null,Hooks:Ln,Scene:Bn,Utils:vn},Symbol.toStringTag,{value:"Module"}));export{Ot as $,rt as A,lt as B,ct as C,dt as D,pt as E,gt as F,ut as G,mt as H,ht as I,ft as J,vt as K,yt as L,wt as M,bt as N,xt as O,_t as P,jt as Q,kt as R,Bn as S,En as T,Ct as U,St as V,Lt as W,Mt as X,zt as Y,Pt as Z,Ee as _,De as a,At as a0,Tt as a1,Bt as a2,Et as a3,Dt as a4,Xt as a5,It as a6,Ut as a7,Rt as a8,Zt as a9,Yt as aa,Ft as ab,Nt as ac,Gt as ad,Jt as ae,vn as af,Xe as b,Ie as c,Ue as d,Re as e,Ze as f,Ye as g,Fe as h,Ln as i,Ne as j,Ge as k,Je as l,Qe as m,He as n,We as o,Ke as p,Ve as q,$e as r,qe as s,et as t,tt as u,nt as v,st as w,ot as x,it as y,at as z};
