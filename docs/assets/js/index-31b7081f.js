var e=Object.defineProperty,t=(t,o,n)=>(((t,o,n)=>{o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n})(t,"symbol"!=typeof o?o+"":o,n),n);import{bz as o,bH as n,b4 as a,a_ as s,a$ as r,i as l,Y as i,bE as c,bF as d,bw as p,bx as u,bv as m,bG as h,bj as f,bB as y,bC as g,bD as b,e as v,w as _,l as x,aM as w,o as O,g as C,u as E,q as M,p as D,I as k,B,h as j,n as L,a9 as S,s as N,t as z,a5 as T,aH as F,aa as U,R as G}from"./vendor-e4926781.js";import{T as R,d as P,g as A,u as $}from"./scene-resize-b7a4a030.js";import{u as J}from"./raycaster-baa71962.js";import{_ as I,j as X,A as H,k as Q}from"./common-426f1774.js";const K={indexdb:{dbName:"THREE__MODEL__DB",tbName:"TB",version:1},mesh:{receiveShadowName:["地面","底座","底板","基础","基础底座","冷却塔基础"]},keys:{TEXT:"TEXT",JSQ:"JSQ",LDB:"LDB",LQB:"LQB",XBC:"XBC",LXJ:"LXJ",LGJ:"LGJ",LGJ_2:"LGJ_2",LGJ_3:"LGJ_3",LGJ_4:"LGJ_4",LQT:"LQT",GL:"GL",BSHRQ:"BSHRQ",BSHLQ:"BSHLQ",FLRB:"FLRB",FJY_X:"FJY_X",FJZ_X:"FJZ_X",FJY:"FJY",FJZ:"FJZ",FM:"FM",XFM:"XFM"},rightClickBackDiffTime:100,meshKey:{body:Symbol("__BODY_")}},{raycaster:V,pointer:Y,update:Z}=J(),{initCSS2DRender:W,createCSS2DDom:q}={initCSS2DRender:(e,t)=>{const{width:n,height:a}=e,s=new o;return s.setSize(n,a),s.domElement.style.position="absolute",s.domElement.style.left="0px",s.domElement.style.top="0px",s.domElement.style.pointerEvents="none",t.appendChild(s.domElement),s},createCSS2DDom:e=>{const{name:t,className:o="",onClick:a,position:s}=e,r=document.createElement("div");r.innerHTML=t,r.className=o;const l=new n(r);return r.style.pointerEvents=a?"auto":"none",r.style.position="absolute","function"==typeof a&&r.addEventListener("click",a),s&&l.position.set(...s),l}};class ee extends R{constructor(e,o){super(e),t(this,"deviceGroup"),t(this,"dotGroup"),t(this,"extend"),t(this,"css2DRender"),this.extend=o,this.css2DRender=W(this.options,this.container),this.css2DRender.domElement.className="three-scene__dot-wrap",this.deviceGroup=new a,this.bindEvent(),this.addDotGroup()}addDotGroup(){const e=new a;this.scene.add(e),this.dotGroup=e}createDot(e,t){const o=e.position,{size:n,color:a}=e.font||{},{x:s=0,y:r=0,z:l=0}=o||{},i=q({name:`\n        <div class="bg"></div>\n        <span class="inner" style="${null!=n?`font-size: ${"string"==typeof n?n:n+"px"};`:""} ${null!=a?`color: ${a}`:""}"></span>\n      `,className:"dot-2D-label",position:[s,r,l],onClick:t});return i.name=e.name,i.data=e,i._position_={x:s,y:r,z:l},this.dotGroup.add(i),i}modelAnimate(){this.css2DRender.render(this.scene,this.camera),"function"==typeof this.extend.animateCall&&this.extend.animateCall()}onDblclick(e){var t;const o=this.container,n=this.options.scale;if(Z(e,o,n),this.deviceGroup){V.setFromCamera(Y,this.camera);const e=[this.deviceGroup],o=V.intersectObjects(e);if(o.length){const e=o[0].object,n=this.findParentGroupGroup(e);if(!n)return;"function"==typeof(null==(t=this.extend)?void 0:t.onDblclick)&&this.extend.onDblclick(n)}}}onPointerMove(e){this.checkIntersectObjects(e)}onPointerUp(e){var t;super.onPointerUp(e);const o=e.timeStamp-this.pointer.tsp<K.rightClickBackDiffTime;2==e.button?o&&"function"==typeof(null==(t=this.extend)?void 0:t.onClickRight)&&this.extend.onClickRight(e):0==e.button?o&&this.checkIntersectObjects(e):e.button}checkIntersectObjects(e){var t,o;const n=this.container,a=this.options.scale;Z(e,n,a);let s="pointerdown"==e.type||"pointerup"==e.type;const r=this.deviceGroup.children.filter((e=>e.visible&&e._isAnchor_));V.setFromCamera(Y,this.camera);let l=V.intersectObjects(r,s);if(n.style.cursor=l.length>0?"pointer":"auto",s)if(l.length){const e=l[0].object;if(!e)return;"function"==typeof(null==(t=this.extend)?void 0:t.onClickLeft)&&this.extend.onClickLeft(e)}else"function"==typeof(null==(o=this.extend)?void 0:o.onClickLeft)&&this.extend.onClickLeft()}findParentGroupGroup(e){const t=e=>{let o=e.parent;if(o)return o&&o._isDevice_?o:t(o)};return t(e)}clearDevice(){this.deviceGroup&&(this.disposeObj(this.deviceGroup),this.deviceGroup=new a,this.addObject(this.deviceGroup))}addDevice(...e){this.deviceGroup&&this.deviceGroup.add(...e)}getFloor(){return this.deviceGroup.children.filter((e=>e._isFloor_))}hideOmitFloor(e){this.deviceGroup.children.forEach((t=>{t.visible=t._isFloor_||e}))}getAll(){return this.deviceGroup.children.concat(this.dotGroup.children)}getFlowMark(e){return this.getAll().filter((t=>{var o;return(null==(o=t.data)?void 0:o.followMark)===e}))}getAnimTargetPos(e,t,o){const n=t||e.to||{x:-104,y:7,z:58},a=o||e.target||{x:0,y:0,z:0};return this.controls.target.set(a.x,a.y,a.z),n}getPosition(){}resize(){super.resize();const{width:e,height:t}=this.options;this.css2DRender.setSize(e,t)}}const te={normal:{color:8954293,main:[8954293,2698801],text:12180479,FM:6319220},runing:{color:3045368,main:3045368,FM:422935},error:{color:12717056,main:11879461,FM:15215899}},oe=(e,t,o=1)=>{const n=e.position,a=e.rotation,s=e.scale,r=t.position||{x:0,y:0,z:0},l=t.rotation||{x:0,y:0,z:0},i=t.scale||{x:1,y:1,z:1},c=Math.abs(l.x)<2?1:180,d=Math.abs(l.y)<2?1:180,p=Math.abs(l.z)<2?1:180;return{position:[n.x+r.x,n.y+r.y,n.z+r.z],rotation:[a.x+Math.PI/c*l.x,a.y+Math.PI/d*l.y,a.z+Math.PI/p*l.z],scale:[s.x*o*i.x,s.y*o*i.y,s.z*o*i.z]}},ne=e=>e.map((e=>(e.children&&e.children.length>0?e.children=ne(e.children):e.material&&(e.material instanceof Array?e.material=e.material.map((e=>e.clone())):e.material=e.material.clone()),e))),ae=e=>{let t=e.clone();return t.children=ne(t.children),t},se=e=>{let t=[];return Array.isArray(e)?t=e:null!=e&&(t=[e]),t},re=(e,t)=>{e.traverse((e=>{e.isMesh&&(Array.isArray(e.material)?e.material.forEach((e=>{e.color.set(t)})):e.material.color.set(t))}))},le=(e,t,o)=>(e.lookAt(o),new Promise((n=>{new s(e.position).to(t,1e3).easing(r.Quadratic.In).start().onUpdate((()=>{e.lookAt(o)})).onComplete((()=>{n(e)}))}))),ie=e=>new Promise((t=>{const o=window.indexedDB.deleteDatabase(e);o.onsuccess=e=>{t(!0)},o.onerror=e=>{t(!1)}})),ce=async(e,t="THREE__MODEL_DB",o=1)=>{if(!window.indexedDB)return Promise.resolve(void 0);await((e,t,o)=>new Promise((n=>{window.indexedDB.open(e).onsuccess=a=>{const s=a.target.result,r=s.version;s.close(),r!==t?ie(e).then((e=>{n(e?t:r)})):s.objectStoreNames.contains(o)?n(r):ie(e).then((e=>{n(e?t:r)}))}})))(t,o,e);let n=window.indexedDB.open(t,o);return new Promise((t=>{n.onupgradeneeded=t=>{const o=t.target.result;o.objectStoreNames.contains(e)||o.createObjectStore(e,{keyPath:"path"})},n.onsuccess=e=>{const o=e.target.result;t(o)},n.onerror=e=>{t(void 0)}}))},de=(e={})=>{let t;const o=P({baseUrl:"",dracoPath:"/draco/gltf/",modelSizeKB:1048576,colors:{normal:{color:8954293},runing:{color:3045368},error:{color:12717056}},loadCache:!0,colorMeshName:[],indexDB:{cache:!0}},e),n=i({percentage:0,show:!1,isEnd:!1,list:[],total:0,loaded:0}),a={base:"base",device:"device",font:"font",sprite:"sprite",pipe:"pipe",warning:"warning",remote:"remote",local:"local",disabled:"disabled"},s=new Map,r=new c;r.setDecoderPath(o.baseUrl+o.dracoPath);const l=new d;l.setDRACOLoader(r);const v=e=>{const t=e.loaded,o=n.total;let a=Number((t+n.loaded)/o*100);a>100&&(a=100),n.percentage=Number(a.toFixed(2))},_=(e,t,n,a)=>{if(!n)return;const{baseUrl:r,colorMeshName:l}=o,{mapUrl:i,key:c,mapMeshName:d,repeat:f=[1,1]}=e;let y;i&&d&&(y=(new p).load(A(i,r)),y.wrapS=u,y.wrapT=u,y.repeat.set(f[0],f[1]));const g=ae(n);return g.traverse((e=>{e.isMesh&&y&&e.name.indexOf(d)?e.material=new m({side:h,transparent:!0,opacity:0,map:y.clone()}):((e,t=6776165,o,n)=>{const{type:a,name:s}=e;a.indexOf("Light"),K.mesh.receiveShadowName.some((e=>s.indexOf(e)>-1))?e.traverse((e=>{e.isMesh&&(e.receiveShadow=!0)})):o.some((e=>s.indexOf(e)>-1))?re(e,t):e.isMesh&&(n&&(e.material.envMap=n),e.castShadow=!0)})(e,t,l||[])})),g.animations=a,s.set(c,g),g},x=(e,n=0)=>{const a=new d;return new Promise((async s=>{var r;o.indexDB.cache||s(null);const l=f.get(e);if(l)l instanceof ArrayBuffer?(v({loaded:l.byteLength}),a.parse(l,"",(t=>{f.add(e,t),s(t)}))):(v({loaded:n*o.modelSizeKB}),setTimeout((()=>{s(l)}),10));else{const n=await((e,t,o)=>{if(!e||!t||!o)return Promise.resolve(null);const n=e.transaction([t],"readonly").objectStore(t).get(o);return new Promise(((e,t)=>{n.onsuccess=t=>{const o=t.target.result;e(o)},n.onerror=e=>{t(e)}}))})(t,(null==(r=o.indexDB)?void 0:r.tbName)||K.indexdb.tbName,e);if(n&&n.data){const e=n.data;"string"==typeof e?(v({loaded:e.length}),f.add(n.path,e),setTimeout((()=>{s(e)}),10)):(v({loaded:e.byteLength}),a.parse(e,"",(e=>{f.add(n.path,e),s(e)})))}else s(null)}}))},w=e=>{var n;if(!o.indexDB.cache)return;const a=f.get(e);if(a&&t){const s=(null==(n=o.indexDB)?void 0:n.tbName)||K.indexdb.tbName;t.transaction(s,"readwrite").objectStore(s).add({path:e,data:a})}},O=(e,t)=>{const{key:n,url:a="",size:s=0}=e,{baseUrl:r,colors:i}=o;return new Promise((async(o,c)=>{let d=i.normal[n]||i.normal.color;d=se(d)[0];const p=A(a,r),u=await x(a,s);if(u){const t=u.scene.children[0],n=_(e,d,t,u.animations);return void o(n)}let m=p.split(".").pop().toLowerCase();if("glb"!==m)throw new Error("模型类型错误,必须为 GLB 格式，当前格式："+m);l.load(p,(t=>{let n=t.scene.children[0];const a=_(e,d,n,t.animations);w(p),o(a)}),(e=>{v(e),"function"==typeof t&&t(e)}),c)}))};let C;return{progress:n,MODEL_MAP:a,loadModel:O,loadModels:async(e,r,l)=>{var i,c,d;await ce((null==(i=o.indexDB)?void 0:i.tbName)||K.indexdb.tbName,(null==(c=o.indexDB)?void 0:c.dbName)||K.indexdb.dbName,(null==(d=o.indexDB)?void 0:d.version)||K.indexdb.version).then((e=>(e&&(f.enabled=!0,t=e),e)));const u=e.length;if(!(0==u?(n.isEnd=!0,n.show=!1,0):(n.isEnd=!1,n.percentage=0,n.show=!0,1)))return;(e=>{for(let t=0;t<e.length;t++)n.total+=e[t].size*o.modelSizeKB})(e);let m=0;const h=async()=>{const t=e[m],{type:i=a.device,size:c=0}=t;switch(i){case a.device:await O(t,l);break;case a.sprite:(e=>{const{key:t,range:n={x:1,y:1},mapUrl:a=""}=e;let r=(new p).load(o.baseUrl+a),l=new y({map:r}),i=new g(l),c=n.x,d=n.y;i.scale.set(c,d,1),i.name="sprite",s.set(t,i)})(t);break;case a.font:(e=>{const{url:t="",size:n=0}=e,{baseUrl:a}=o,s=A(t,a),r=new b;new Promise((async e=>{const o=await x(s,n);if(o)return C=r.parse(JSON.parse(o)),void setTimeout((()=>{e(C)}),10);r.load(s,(o=>{C=o,w(t),e(o)}))}))})(t)}m++,n.loaded+=c*o.modelSizeKB,m>=u?r():h()};h()},getModel:e=>s.get(e)}},pe={key:0,class:"scene-operation"},ue=I(v({__name:"index",props:{devEnv:{type:Boolean},baseUrl:{},dracoUrl:{default:""},bgColor:{},skyCode:{},bgUrl:{},env:{},scale:{},indexDB:{default:()=>({cache:!0})},camera:{default:()=>({})},fog:{default:()=>({})},render:{default:()=>({})},controls:{default:()=>({})},grid:{default:()=>({})},axes:{default:()=>({})},models:{},config:{},objects:{},dotKey:{default:"DOT"},dotShowStrict:{type:Boolean,default:!0},colorMeshName:{default:()=>[]},getColorCall:{},formatObject:{},dotUpdateObjectCall:{},updateObjectCall:{},randomUpdateObjectCall:{},animationModelType:{},floorModelType:{},textModelType:{},anchorType:{default:()=>[]},mainBodyChangeColor:{type:Boolean},mainBodyMeshName:{default:()=>["主体"]}},emits:["init","loaded","update","select","dblclick","click-dot","click-dialog-dot"],setup(e,{expose:t,emit:o}){const n=e,{change:c,load:d}=((e="")=>{const t=["216","217","218","219","220","221","222","223","224","225"],o=l("/oss/img/sky"),n=t.findIndex((t=>t==e)),a=l(n<0?0:n),s=(e,t)=>{null==e||e.setBgTexture(["/posX.jpeg","/negX.jpeg","/posY.jpeg","/negY.jpeg","/posZ.jpeg","/negZ.jpeg"].map((e=>`${o.value}/${t}${e}`)))};return{skys:t,index:a,skyPath:o,change:e=>{const o=t[a.value];o&&(s(e,o),a.value++,a.value>=t.length&&(a.value=0))},load:s}})(),{progress:p,loadModel:u,loadModels:m,getModel:h}=de({baseUrl:n.dracoUrl,colors:te,colorMeshName:n.colorMeshName,indexDB:n.indexDB}),{dialog:f}={dialog:i({show:!1,style:{left:"",top:""},select:[],data:{},title:"",position:{top:0,left:0}})},y=o,g=l(),b=n.devEnv,v={baseUrl:n.baseUrl,bgUrl:n.bgUrl,env:n.env,bgColor:n.bgColor,camera:n.camera,fog:n.fog,render:n.render,grid:n.grid,controls:n.controls,axes:n.axes};let G;_((()=>n.dotShowStrict),(()=>R())),_((()=>n.scale),(e=>{null==G||G.setScale(e||1)}));const R=()=>{const e=G.dotGroup.children;for(let t=0;t<e.length;t++){const o=e[t];if(!o.data)continue;o.data.type===n.dotKey&&J(o)}},P=e=>{var t,o,a,l;const i=G.getFloor();if(0===i.length)return;const c=void 0!==e&&e>-1;if((null==(t=n.config)?void 0:t.floorExpandHiddenOther)&&G.hideOmitFloor(!c),i.forEach(((t,o)=>{var a,l,i;const d=t._position_;let p=o-(c?e:o);const u=(null==(a=n.config)?void 0:a.floorExpandMargin)||200,m=(null==(l=n.config)?void 0:l.floorExpandMode)||"UD",h=p*u,f=((null==d?void 0:d.y)??0)+h,y=e==o?((null==d?void 0:d.z)??0)+u:(null==d?void 0:d.z)??0;if("UD"===m){if(t.position.y===f)return}else if("BA"===m&&t.position.z===y)return;if(null==(i=t.data)?void 0:i.mark){const n=t.data.mark,a=G.getFlowMark(n);$(m,a,h,e==o?u:0)}new s(t.position).to({y:"UD"===m?f:t.position.y,z:"BA"===m?y:t.position.z},500).easing(r.Quadratic.Out).start()})),!(null==(o=n.config)?void 0:o.floorExpandChangeViewAngle))return;let d,p;if(c){const t=i[e]||{};d=null==(a=t.data)?void 0:a.to,d&&(p=(null==(l=t.data)?void 0:l.target)||t._position_)}d=G.getAnimTargetPos(n.config||{},d,p),A(d)||le(G.camera,d,G.controls.target)},A=e=>{const t=G.camera.position;return Math.abs(t.x-e.x)<1&&Math.abs(t.y-e.y)<1&&Math.abs(t.z-e.z)<1},$=(e,t,o,n)=>{0!==t.length&&t.forEach((t=>{const a=t._position_,l="UD"==e?((null==a?void 0:a.y)??0)+o:(null==a?void 0:a.y)??0,i="BA"==e?((null==a?void 0:a.z)??0)+n:(null==a?void 0:a.z)??0;new s(t.position).to({y:l,z:i},500).easing(r.Quadratic.Out).start()}))},J=e=>{var t;if("function"!=typeof n.dotUpdateObjectCall)throw Error("未传人点位更新对象回调方法 dotUpdateObjectCall");const o=e.data,a=n.dotUpdateObjectCall(o,G.deviceGroup);if("object"!=typeof a)throw Error("点位更新回调方法返回类型不是 Object，当前返回类型为："+typeof a);Object.keys(a).forEach((e=>{o[e]=a[e]})),e.visible=o.show||!n.dotShowStrict;const s=null==(t=e.element)?void 0:t.getElementsByClassName("inner")[0];if(s){const{size:e,color:t}=o.font||{};null!=e&&(s.style.fontSize="string"==typeof e?e:e+"px"),null!=t&&(s.style.color=t),s.textContent=`${o.value||0}${o.unit}`}},I=e=>{const t=((e,t,o)=>{let n=e.clientWidth/2,a=e.clientHeight/2,s=t.position.clone();const r=t.scale;s.y+=r.x/2;let l=s.project(o);return{left:l.x*n+n,top:-l.y*a+a}})(g.value,e,G.camera);return f.position=t,f.style.left=t.left+"px",f.style.top=t.top+"px",t},X=async e=>{var t;if(!e)return;const{type:o,url:s}=e,r=h(o);if(!r)return void(s?await(async e=>{const{type:t,url:o="",name:n}=e,a=await u({key:t,url:o,name:n,size:0}),{position:s,scale:r,rotation:l}=oe(a,e);return a.scale.set(...r),a.position.set(...s),a.rotation.set(...l),a._isBase_=!0,G.addDevice(a),Promise.resolve(a)})(e):o===n.dotKey&&(e=>{J(G.createDot(e,(e=>{})))})(e));const l=n.floorModelType||[],i=n.anchorType||[];let c=ae(r);const{position:d,scale:p,rotation:m}=oe(c,e),[f,y,g]=d;c.scale.set(...p),c.position.set(f,y,g),c.rotation.set(...m);if((n.animationModelType||[]).includes(o)){if("Group"!==c.type){const e=new a;e.add(c),c=e}if(n.mainBodyChangeColor){const e=((null==(t=c.children[0])?void 0:t.children)||[]).filter((e=>(n.mainBodyMeshName||[]).some((t=>e.name.indexOf(t)>-1)))),o=te.normal;let a=o.main||o.color,s=se(a);s.length&&e.forEach(((e,t)=>{re(e,s[t%s.length])})),c[K.meshKey.body]=e}}return c._isDevice_=!0,c.data=e,l.includes(o)&&(c._position_={x:f,y:y,z:g},c._isFloor_=!0),i.includes(o)&&(c._isAnchor_=!0),G.addDevice(c),Promise.resolve()},H=l([]),Q=async()=>{var e,t,o,a;p.percentage=100,p.show=!1,G.clearDevice(),await U(),(()=>{H.value.length=0;const e=w(n.objects)||[];if("function"!=typeof n.formatObject)throw H.value=e,Error("未传入格式化函数 formatObject");{const t=n.formatObject(e);H.value=t}})(),await(()=>{let e=0,t=H.value.length;return new Promise((o=>{if(0==t)return o(null);const n=async()=>{const a=H.value[e];await X(a),e++,e<t?n():o(e)};n()}))})(),"function"==typeof(null==(e=n.config)?void 0:e.load)&&(null==(t=n.config)||t.load(G));const s=(null==(o=n.config)?void 0:o.floorExpandIndex)||-1,r=G.getAnimTargetPos(n.config||{}),l=G.getFloor();s>-1&&l.length?(P(s),(null==(a=n.config)?void 0:a.floorExpandChangeViewAngle)||le(G.camera,r,G.controls.target).then((()=>{y("loaded")}))):le(G.camera,r,G.controls.target).then((()=>{y("loaded")}))},V=()=>{m(n.models,(()=>{Q()})),n.skyCode&&d(G,n.skyCode)},Y=()=>{const e=[];if("function"!=typeof n.randomUpdateObjectCall)throw Error("未传入随机更新回调函数 randomUpdateObjectCall");G.getAll().forEach(((t,o)=>{if(!t.data)return;const a=t.data;let s=a.type;if(s===n.dotKey)return void J(t);const r=n.randomUpdateObjectCall(a);if(!r)return;if("object"!=typeof r)throw Error("更新回调函数返回对象不为 Object，当前类型："+typeof r);Object.keys(r).forEach((e=>{a[e]=r[e]})),e.push(w(a));let{status:l=0,error:i=0,remote:c=0,local:d=0,disabled:p=0}=a;const u=te[i>0?"error":l>0?"runing":"normal"];let m=u[s]||u.color;if("function"==typeof n.getColorCall){const e=n.getColorCall(a);e&&(m=e)}Z({type:s,el:t,colorObj:u,color:m,paused:0==l,error:i>0,remote:c>0,local:d>0,disabled:p>0})})),y("update",e,!0)},Z=e=>{let{el:t,colorObj:o,color:a,type:s,paused:r,error:l}=e,i=se(a);a=i[0];const c=t.extra;if(c&&(c.action&&(c.action.paused=r),null!=a)){(c.meshs||[]).forEach((e=>{re(e,a)}))}if(n.mainBodyChangeColor&&t[K.meshKey.body]){const e=o.main;let n=se(e);n.length&&t[K.meshKey.body].forEach(((e,t)=>{re(e,n[t%n.length])}))}};return x((()=>{v.container=g.value,G=new ee(v,{onDblclick:e=>{const t=e.data,o=G.getFloor().findIndex((t=>e.uuid===t.uuid));"function"==typeof t.onDblclick&&t.onDblclick(w(t),e,o),o>-1&&P(o)},onClickLeft(e){e?(f.select=[e],y("select",e),(()=>{const e=f.select[0],t=e.data;f.data=t,f.title=(null==t?void 0:t.name)||"";const o=I(e);y("click-dialog-dot",t,o)})()):f.select=[],f.show=!!e},onClickRight:e=>{var t;"function"==typeof(null==(t=n.config)?void 0:t.back)?n.config.back(G):P(-1)},animateCall:()=>{if(f.show&&f.select.length){const e=f.select[0];I(e)}}}),G.run(),y("init",G),V()})),t({floorAnimate:P}),(e,t)=>{const o=F;return O(),C("div",{class:L(e.$style["floor-scene"])},[E(b)?(O(),C("div",pe,[M(o,{type:"success",onClick:Y},{default:D((()=>t[3]||(t[3]=[k("随机更新")]))),_:1}),M(o,{onClick:t[0]||(t[0]=()=>{var e;return null==(e=E(G))?void 0:e.getPosition()}),type:"success"},{default:D((()=>t[4]||(t[4]=[k("场景坐标")]))),_:1}),M(o,{type:"warning",onClick:t[1]||(t[1]=()=>E(c)(E(G)))},{default:D((()=>t[5]||(t[5]=[k("切换背景")]))),_:1})])):B("",!0),j("div",{class:L(e.$style.container),ref_key:"containerRef",ref:g},null,2),E(p).show?(O(),C("div",{key:1,class:L(["loading",e.$style.loading]),style:S({"--bg-color":e.bgColor?String(e.bgColor):""}),onDblclick:t[2]||(t[2]=N((()=>{}),["stop"]))},[j("div",{class:L(e.$style.progress),style:S({"--percentage":E(p).percentage+"%"})},[j("div",{class:L(e.$style["bar-out"])},[j("div",{class:L(e.$style.bar)},null,2)],2),j("div",{class:L(e.$style.text)},z(E(p).percentage)+"%",3)],6)],38)):B("",!0),E(f).show?(O(),C("div",{key:2,class:L(e.$style.dialog),style:S(E(f).style)},[T(e.$slots,"dialog",{data:E(f).data,title:E(f).title,position:E(f).position})],6)):B("",!0)],2)}}}),[["__cssModules",{$style:{"floor-scene":"_floor-scene_bfl64_2",container:"_container_bfl64_8",loading:"_loading_bfl64_12",progress:"_progress_bfl64_27","bar-out":"_bar-out_bfl64_31",bar:"_bar_bfl64_31","striped-flow":"_striped-flow_bfl64_1",text:"_text_bfl64_47",dialog:"_dialog_bfl64_63"}}]]),me={class:"flex flex-ac"},he=I(v({__name:"index",setup(e){const t=Q(),o=i({devEnv:!0,baseUrl:"",bgColor:"",skyCode:"221",render:{alpha:!0},env:"/oss/textures/hdr/skidpan_2k.hdr",camera:{far:1e6},controls:{screenSpacePanning:!1,maxDistance:5e4,maxPolarAngle:.46*Math.PI},grid:{visible:!0},models:[{key:"FLOOR_ONE",name:"大堂",size:8.5,url:"/1楼.glb"},{key:"FLOOR_COMMON",name:"楼层",size:13.7,url:"/楼层.glb"},{key:"FLOOR_ATTIC",name:"楼顶",size:.1,url:"/楼顶.glb"},{key:"COLD_CAMERA",name:"摄像头",type:"sprite",size:1,range:{x:37,y:77},mapUrl:"/sxt.png"},{key:"COLD_ROOM_INLET",name:"房间入口",type:"sprite",size:1,range:{x:37,y:77},mapUrl:"/fjdw.png"},{key:"COLD_GPS",name:"定位",type:"sprite",size:1,range:{x:51,y:56},mapUrl:"/dw.png"}].map((e=>(e.url&&(e.url="/oss/model/floor"+e.url),e.mapUrl&&(e.mapUrl="/oss/textures/floor"+e.mapUrl),e))),objects:[],config:{},indexDB:{cache:!0,dbName:"THREE__FLOOR__DB",tbName:"TB",version:1},dotShowStrict:!1,colorMeshName:[],floorModelType:["FLOOR_COMMON","FLOOR_ONE","FLOOR_TWO_FIVE","FLOOR_SIX","FLOOR_SEVEN_ELEVEN","FLOOR_TWELVE_THIRTEEN","FLOOR_FOURTEEN_SIXTEEN","FLOOR_SEVENTEEN_EIGHTEEN"],anchorType:["COLD_CAMERA","COLD_ROOM_INLET","COLD_GPS"],mainBodyChangeColor:!0,mainBodyMeshName:["立方体062"],animationModelType:["FLOOR_COMMON"]}),n=l(),a=e=>t.formatData(e),s=(e,t)=>{const o=40*Math.random();return void 0!==o&&(e.value=o),e.show=Math.random()>.5,e.value=Number(Number(e.value||0).toFixed(2)),{value:e.value,show:e.show,font:{...e.font||{},color:e.value>35?"#f00":null}}},r=e=>{const t=Math.random()>.5?1:0,o=Math.random()>.5?1:0,n=Math.random()>.8?1:0,a=Math.floor(3*Math.random());return{status:n>0?0:t,error:n>0?0:o,remote:1==a?1:0,local:2==a?1:0,disabled:n}},c=e=>{$(e).resize()};return x((()=>{X.get(H.d3.floor).then((e=>{let t=e.JsonList;const n=e.ModelUrl;t.unshift({name:e.Name,type:"",url:n?`${o.baseUrl}${n}`:""});let a={};if(e.ConfigJson instanceof Object)a=e.ConfigJson;else if("string"==typeof e.ConfigJson)try{a=JSON.parse(e.ConfigJson)}catch(s){}Object.keys(a).forEach((e=>{o.config&&(o.config[e]=a[e])})),o.objects=t}))})),(e,t)=>{const l=G;return O(),C("div",{class:L([e.$style.page,"h-100 o-h"])},[j("div",{class:L(e.$style.operate)},[j("div",me,[t[1]||(t[1]=j("span",null,"点位：",-1)),M(l,{modelValue:E(o).dotShowStrict,"onUpdate:modelValue":t[0]||(t[0]=e=>E(o).dotShowStrict=e),"active-text":"严格","inactive-text":"全显","inline-prompt":""},null,8,["modelValue"])])],2),M(ue,{ref_key:"threeSceneRef",ref:n,"dev-env":E(o).devEnv,"base-url":E(o).baseUrl,"bg-color":E(o).bgColor,"bg-url":E(o).bgUrl,env:E(o).env,indexDB:E(o).indexDB,"sky-code":E(o).skyCode,camera:E(o).camera,render:E(o).render,controls:E(o).controls,grid:E(o).grid,config:E(o).config,models:E(o).models,"anchor-type":E(o).anchorType,"dot-show-strict":E(o).dotShowStrict,"floor-model-type":E(o).floorModelType,"main-body-change-color":E(o).mainBodyChangeColor,"main-body-mesh-name":E(o).mainBodyMeshName,"animation-model-type":E(o).animationModelType,objects:E(o).objects,"format-object":a,"dot-update-object-call":s,"random-update-object-call":r,onInit:c},{dialog:D((({data:t,title:o})=>[j("div",{class:L(e.$style["dialog-wrap"])},[j("div",{class:L(e.$style.circle)},null,2),j("div",{class:L(e.$style.line)},null,2),j("div",{class:L(e.$style.content)},[j("div",{class:L(e.$style.title)},z(o),3),j("div",{class:L(e.$style.data)},z(t),3)],2)],2)])),_:1},8,["dev-env","base-url","bg-color","bg-url","env","indexDB","sky-code","camera","render","controls","grid","config","models","anchor-type","dot-show-strict","floor-model-type","main-body-change-color","main-body-mesh-name","animation-model-type","objects"])],2)}}}),[["__cssModules",{$style:{page:"_page_m4oc3_2",operate:"_operate_m4oc3_8","dialog-wrap":"_dialog-wrap_m4oc3_16",circle:"_circle_m4oc3_22",line:"_line_m4oc3_52",content:"_content_m4oc3_78",title:"_title_m4oc3_85",data:"_data_m4oc3_89"}}]]);export{he as default};
