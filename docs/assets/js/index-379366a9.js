var e=Object.defineProperty,t=(t,s,o)=>(((t,s,o)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o})(t,"symbol"!=typeof s?s+"":s,o),o);import{t as s}from"./index-bf7b565b.js";import{i as o,S as n,u as a,a as r}from"./scene-resize-c2a7eabc.js";import{f4 as i,bx as d,bE as l,ee as c,f0 as m,ed as u,ef as p,eb as h,bz as w,fo as g,bC as f,bv as b,f3 as x,by as y,f6 as S,dv as v,bB as N,dn as k,f1 as j,c as M,X as z,h as I,k as L,o as O,f as P,g as _,p as A,u as R}from"./vendor-d7caeb87.js";import"./index-12944fbd.js";const{createStripSmoke:C}=o.useSmoke(i),V=j,{mix:D,mul:U,oneMinus:W,positionLocal:E,smoothstep:G,texture:T,time:$,rotateUV:B,Fn:F,uv:X,vec2:Y,vec3:q,vec4:H,uniform:J}=V,K="https://ye6.atomgit.net/3d-demo-data",Q=new d,Z=J(.2);class ee extends n{constructor(e){super(e),t(this,"gui"),t(this,"smokeInstancedSprite"),t(this,"fireInstancedSprite"),this.addModel(),this.gui=new l,this.addGui()}render(){this.renderer.renderAsync(this.scene,this.camera)}run(){return this.renderer.setAnimationLoop((()=>{this.animate(),this.modelAnimate()})),this}createScene(){return new c}createRender(){return new m}createDirectionalLight(e,t){return new u(e,t)}createAmbientLight(e,t){return new p(e,t)}createPerspectiveCamera(e,t,s,o){return new h(e,t,s,o)}addModel(){this.addSmoke(),this.addSmallSmoke()}addSmoke(){const e=V.range(.1,1),t=V.range(new w(-2,3,-2),new w(2,5,2)),s=V.time.add(5).mul(Z),o=s.mul(e).mod(1),n=V.range(.3,2),a=V.range(.1,4),r=o.div(e),i=V.positionLocal.y.oneMinus().max(.2),d=V.texture(Q.load(`${K}/textures/effect/smoke1.png`),V.rotateUV(V.uv(),s.mul(a))).a.mul(r.oneMinus()),l=V.mix(V.color(16777215),V.color(2236962),V.positionLocal.y.mul(.5).clamp()),c=new g;c.colorNode=V.mix(V.color(15891724),l,r.mul(2.5).min(1)).mul(i),c.opacityNode=d,c.positionNode=t.mul(o),c.scaleNode=n.mul(o.max(.3)),c.depthWrite=!1,c.transparent=!0;const m=new f(new b(1,1),c);m.scale.setScalar(40),m.count=2e3,m.position.y=10,m.castShadow=!0,this.smokeInstancedSprite=m,this.addObject(m);const u=new b(1,1),p=new g;p.colorNode=V.mix(V.color(12005143),V.color(12005143),r),p.positionNode=V.range(new w(-1,1,-1),new w(1,2,1)).mul(o),p.scaleNode=c.scaleNode,p.opacityNode=d.mul(.5),p.blending=x,p.transparent=!0,p.depthWrite=!1;const h=new f(u,p);h.scale.setScalar(40),h.count=1e3,h.position.y=10,h.castShadow=!0,this.fireInstancedSprite=h,this.addObject(h)}addSmallSmoke(){const e=new b(1,1,16,64);e.translate(0,.5,0),e.scale(15,60,15);const t=Q.load(`${K}/textures/gpu/128x128.png`);t.wrapS=y,t.wrapT=y;const s=new S({transparent:!0,side:v,depthWrite:!1});s.positionNode=F((()=>{const e=Y(.6,X().y.mul(.3).sub($.mul(Z)).mod(1)),s=T(t,e).r.mul(5);E.xz.assign(B(E.xz,s,Y(1)));const o=Y(T(t,Y(.25,$.mul(.01)).mod(1)).r.sub(.5),T(t,Y(.75,$.mul(.01)).mod(1)).r.sub(0)).mul(X().y.pow(2).mul(80));return E.addAssign(o),E}))(),s.colorNode=F((()=>{const e=X().mul(Y(.8,.3)).add(Y(0,$.mul(.03).negate())),s=U(T(t,e).r.smoothstep(.4,1),G(0,.1,X().x),G(0,.1,W(X().x)),G(0,.1,X().y),G(0,.1,W(X().y))),o=D(q(.6,.3,.2),q(1,1,1),s.pow(3));return H(o,s)}))();const o=new f(e,s);o.position.x=-80,o.position.y=30,this.addObject(o);const n=C({width:100,height:50,twistNums:1,twistRange:.1,offset:.1,segment:10});n.position.set(-100,0,200),this.addObject(n),console.log(n);const a=new f(new b(100,50),new N({color:15732480,wireframe:!0}));a.position.copy(n.position.clone().add(new w(0,25,0))),this.addObject(a)}createSmoke(e={}){const{width:t=10,height:s=10,speed:o=.2,color:n=16777215,alphaPow:a=3,twistNums:r=5,twistRange:i=0,RLSpeed:d=.1,TDSpeed:l=.1,offset:c=50,segment:m=10,power:u=.03}=e,p=new b(1,1,t*m,s*m);p.scale(t,s,1),p.rotateY(.5*Math.PI/3*r),p.translate(0,s/2,0);const h=new S({transparent:!0,side:v,depthWrite:!1}),w=Q.load(`${K}/textures/gpu/128x128.png`);w.wrapS=y,w.wrapT=y,h.positionNode=F((()=>{const e=Y(.8,X().y.mul(.3).sub($.mul(o))),t=T(w,e).r.mul(r);E.xz.assign(B(E.xz,t,Y(i)));const s=Y(T(w,Y(.25,$.mul(d)).mod(1)).r.sub(.5),T(w,Y(.75,$.mul(l)).mod(1)).r.sub(0)).mul(X().y.pow(1).mul(c));return E.addAssign(s),E}))(),h.colorNode=F((()=>{const e=X().mul(Y(.8,.3)).add(Y(0,$.mul(u).negate())),t=U(T(w,e).r.smoothstep(.4,1),G(0,.1,X().x),G(0,.1,W(X().x)),G(0,.1,X().y),G(0,.1,W(X().y))),s=new k(n),o=D(q(s.r,s.g,s.b),q(1,1,1),t.pow(a));return H(o,t)}))();return new f(p,h)}addGui(){var e;const t=this.gui;t.add(Z,"value",.01,1,.01).name("烟雾速度"),this.fireInstancedSprite&&t.add(this.fireInstancedSprite,"count",200,2e3).name("烟雾浓度").onChange((e=>{this.smokeInstancedSprite.count=2*e})),t.domElement.className+=" gui-wrap",null==(e=this.container.parentNode)||e.appendChild(t.domElement)}}const te={class:"three-page"},se=M({__name:"index",setup(e){const t=z({base:"https://ye6.atomgit.net/3d-demo-data",models:[{key:"coffeeMug",name:"咖啡杯",size:.5,url:"/models/gpu/coffeeMug.glb"}],objects:[{type:"coffeeMug",name:"咖啡杯",position:{x:-80,y:25,z:0},scale:{x:10,y:10,z:10}}]}),{progress:n,loadModels:i,getModel:d,initModels:l}=o.useModelLoader({baseUrl:t.base}),c=I(),m={grid:{visible:!0},axes:{visible:!0},render:{logarithmicDepthBuffer:!1}};let u;return L((()=>{m.container=c.value,u=new ee(m),u.run(),a(u).resize(),i(t.models,(()=>{n.percentage=100,n.show=!1,l(t.objects,(e=>{const{type:t}=e,s=d(t);if(!s)return Promise.resolve();let o=r.modelDeepClone(s);const{position:n,scale:a,rotation:i}=r.get_P_S_R_param(o,e),[l,c,m]=n;return o.scale.set(...a),o.position.set(l,c,m),o.rotation.set(...i),u.addObject(o),Promise.resolve()}))}))})),(e,t)=>(O(),P("div",te,[_("div",{class:"h-100",ref_key:"containerRef",ref:c},null,512),A(s,{modelValue:R(n).show,"onUpdate:modelValue":t[0]||(t[0]=e=>R(n).show=e),progress:R(n).percentage},null,8,["modelValue","progress"])]))}});export{se as default};
