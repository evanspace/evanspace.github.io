var e=Object.defineProperty,s=(s,t,o)=>(((s,t,o)=>{t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o})(s,"symbol"!=typeof t?t+"":t,o),o);import{t}from"./index-2f06c3e0.js";import{m as o,l as a,u as n,A as r}from"./scene-resize-bbcf7df5.js";import{bp as i,bb as d,dv as l,ex as c,dz as m,dy as u,dE as p,bm as h,eF as g,bf as w,bd as b,eE as f,bq as x,ez as y,bj as v,ey as S,e as N,Y as j,i as M,l as k,o as z,g as I,h as _,q as L,u as O}from"./vendor-0ca24a43.js";import"./index-ef9e62de.js";const P=S,{mix:V,mul:A,oneMinus:C,positionLocal:E,smoothstep:U,texture:D,time:R,rotateUV:W,Fn:q,uv:F,vec2:G,vec3:B,vec4:T}=P,Y=new i,H=P.uniform(.2);class J extends o{constructor(e){super(e),s(this,"gui"),s(this,"smokeInstancedSprite"),s(this,"fireInstancedSprite"),this.addModel(),this.gui=new d,this.addGui()}render(){this.renderer.renderAsync(this.scene,this.camera)}createScene(){return new l}createRender(){return new c}createDirectionalLight(e,s){return new m(e,s)}createAmbientLight(e,s){return new u(e,s)}createPerspectiveCamera(e,s,t,o){return new p(e,s,t,o)}addModel(){this.addSmoke(),this.addSmallSmoke()}addSmoke(){const e=P.range(.1,1),s=P.range(new h(-2,3,-2),new h(2,5,2)),t=P.time.add(5).mul(H),o=t.mul(e).mod(1),a=P.range(.3,2),n=P.range(.1,4),r=o.div(e),i=P.positionLocal.y.oneMinus().max(.2),d=P.texture(Y.load("/oss/textures/effect/smoke1.png"),P.rotateUV(P.uv(),t.mul(n))).a.mul(r.oneMinus()),l=P.mix(P.color(16777215),P.color(2236962),P.positionLocal.y.mul(.5).clamp()),c=new g;c.colorNode=P.mix(P.color(15891724),l,r.mul(2.5).min(1)).mul(i),c.opacityNode=d,c.positionNode=s.mul(o),c.scaleNode=a.mul(o.max(.3)),c.depthWrite=!1,c.transparent=!0;const m=new w(new b(1,1),c);m.scale.setScalar(40),m.count=2e3,m.position.y=10,m.castShadow=!0,this.smokeInstancedSprite=m,this.addObject(m);const u=new b(1,1),p=new g;p.colorNode=P.mix(P.color(12005143),P.color(12005143),r),p.positionNode=P.range(new h(-1,1,-1),new h(1,2,1)).mul(o),p.scaleNode=c.scaleNode,p.opacityNode=d.mul(.5),p.blending=f,p.transparent=!0,p.depthWrite=!1;const x=new w(u,p);x.scale.setScalar(40),x.count=1e3,x.position.y=10,x.castShadow=!0,this.fireInstancedSprite=x,this.addObject(x)}addSmallSmoke(){const e=new b(1,1,16,64);e.translate(0,.5,0),e.scale(15,60,15);const s=Y.load("/oss/textures/gpu/128x128.png");s.wrapS=x,s.wrapT=x;const t=new y({transparent:!0,side:v,depthWrite:!1});t.positionNode=q((()=>{const e=G(.6,F().y.mul(.3).sub(R.mul(H)).mod(1)),t=D(s,e).r.mul(5);E.xz.assign(W(E.xz,t,G(1)));const o=G(D(s,G(.25,R.mul(.01)).mod(1)).r.sub(.5),D(s,G(.75,R.mul(.01)).mod(1)).r.sub(0)).mul(F().y.pow(2).mul(80));return E.addAssign(o),E}))(),t.colorNode=q((()=>{const e=F().mul(G(.8,.3)).add(G(0,R.mul(.03).negate())),t=A(D(s,e).r.smoothstep(.4,1),U(0,.1,F().x),U(0,.1,C(F().x)),U(0,.1,F().y),U(0,.1,C(F().y))),o=V(B(.6,.3,.2),B(1,1,1),t.pow(3));return T(o,t)}))();const o=new w(e,t);o.position.x=-80,o.position.y=30,this.addObject(o)}addGui(){var e;const s=this.gui;s.add(H,"value",.01,1,.01).name("烟雾速度"),this.fireInstancedSprite&&s.add(this.fireInstancedSprite,"count",200,2e3).name("烟雾浓度").onChange((e=>{this.smokeInstancedSprite.count=2*e})),s.domElement.className+=" gui-wrap",null==(e=this.container.parentNode)||e.appendChild(s.domElement)}}const K={class:"three-page"},Q=N({__name:"index",setup(e){const s=j({base:"",models:[{key:"coffeeMug",name:"咖啡杯",size:.5,url:"/oss/model/gpu/coffeeMug.glb"}],objects:[{type:"coffeeMug",name:"咖啡杯",position:{x:-80,y:25,z:0},scale:{x:10,y:10,z:10}}]}),{progress:o,loadModels:i,getModel:d,initModels:l}=a.useModelLoader({baseUrl:s.base}),c=M(),m={grid:{visible:!0},axes:{visible:!0},render:{logarithmicDepthBuffer:!1}};let u;return k((()=>{m.container=c.value,u=new J(m),u.run(),n(u).resize(),i(s.models,(()=>{o.percentage=100,o.show=!1,l(s.objects,(e=>{const{type:s}=e,t=d(s);if(!t)return Promise.resolve();let o=r.modelDeepClone(t);const{position:a,scale:n,rotation:i}=r.get_P_S_R_param(o,e),[l,c,m]=a;return o.scale.set(...n),o.position.set(l,c,m),o.rotation.set(...i),u.addObject(o),Promise.resolve()}))}))})),(e,s)=>(z(),I("div",K,[_("div",{class:"h-100",ref_key:"containerRef",ref:c},null,512),L(t,{modelValue:O(o).show,"onUpdate:modelValue":s[0]||(s[0]=e=>O(o).show=e),progress:O(o).percentage},null,8,["modelValue","progress"])]))}});export{Q as default};
