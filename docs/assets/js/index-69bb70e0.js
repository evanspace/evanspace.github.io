var e=Object.defineProperty,t=(t,s,a)=>(((t,s,a)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a})(t,"symbol"!=typeof s?s+"":s,a),a);import{ex as s,ey as a,ez as n,bb as o,eA as r,du as i,c$ as d,eC as l,bf as c,eB as m,e as u,i as p,l as h,o as g,g as b,h as f}from"./vendor-b9b2d4fb.js";import{l as v,m as y,u as M}from"./scene-resize-8b48b5c1.js";import"./index-7c2c000d.js";const{pass:w,mrt:x,output:j,float:N,uniform:P}=m,{pointer:z,update:C,raycaster:E}=v.useRaycaster();class I extends y{constructor(e){super(e),t(this,"gui"),t(this,"postProcessing"),this.addModel();const r=w(this.scene,this.camera);r.setMRT(x({output:j,bloomIntensity:N(0)}));const i=r.getTextureNode(),d=r.getTextureNode("bloomIntensity"),l=s(i.mul(d));this.renderer.toneMapping=a;const c=new n(this.renderer);c.outputColorTransform=!1,c.outputNode=i.add(l).renderOutput(),this.postProcessing=c,this.gui=new o,this.addGui(l),this.bindEvent()}createRender(){return new r}addModel(){const e=new i(1,15);for(let t=0;t<50;t++){const t=new d;t.setHSL(Math.random(),.7,.2*Math.random()+.05);const s=Math.random()>.5?1:0,a=new l({color:t,mrtNode:x({bloomIntensity:P(s)})}),n=new c(e,a);n.position.set(10*Math.random()-5,10*Math.random()-5,10*Math.random()-5),n.position.normalize().multiplyScalar(20*Math.random()+10),n.scale.setScalar(4*Math.random()+3),this.addObject(n)}}onPointerDown(e){C(e,this.container),E.setFromCamera(z,this.camera);const t=E.intersectObjects(this.scene.children,!1);if(t.length>0){const e=t[0].object.material.mrtNode.get("bloomIntensity");e.value=0===e.value?1:0}}addGui(e){var t;const s=this.gui,a=s.addFolder("发光");a.add(e.threshold,"value",0,1).step(.01).name("阈值/起点"),a.add(e.strength,"value",0,3).step(.01).name("强度"),a.add(e.radius,"value",0,1).step(.01).name("半径"),a.open();const n=s.addFolder("色调映射");n.add(this.renderer,"toneMappingExposure",.1,3).name("曝光"),n.open(),s.domElement.className+=" gui-wrap",null==(t=this.container.parentNode)||t.appendChild(s.domElement)}animate(){this.postProcessing.renderAsync()}}const O={class:"three-page"},R=u({__name:"index",setup(e){const t=p(),s={camera:{position:[0,0,100]}};let a;return h((()=>{s.container=t.value,a=new I(s).run(),M(a).resize()})),(e,s)=>(g(),b("div",O,[f("div",{class:"h-100",ref_key:"containerRef",ref:t},null,512)]))}});export{R as default};
