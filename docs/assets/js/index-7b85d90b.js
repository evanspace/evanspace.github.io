var e=Object.defineProperty,s=(s,t,a)=>(((s,t,a)=>{t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a})(s,"symbol"!=typeof t?t+"":t,a),a);import{c_ as t,bh as a,eP as o,er as n,bb as r,es as i,d4 as d,br as l,cT as c,bf as h,bd as u,bj as m,et as p,e as g,Y as b,i as v,l as w,o as f,g as y,h as M}from"./vendor-16511a1c.js";import{s as P,m as j,u as S,$ as _}from"./scene-resize-81a632cd.js";import"./index-1f51d240.js";const{pass:x,uniform:C,time:E,oscSine:k}=p,{pointer:O,update:R,raycaster:z}=P.useRaycaster(),G=C(3),H=C(0),N=C(1),T=C(0),L=C(new t(16777215)),U=C(new t(5125686));class A extends j{constructor(e){super(e),s(this,"gui"),s(this,"group",new a),s(this,"select",[]),s(this,"outlinePass"),s(this,"postProcessing"),this.addObject(this.group);const t=o(this.scene,this.camera,{selectedObjects:this.select,edgeGlow:H,edgeThickness:N});this.outlinePass=t;const{visibleEdge:i,hiddenEdge:d}=t,l=E.div(T).mul(2),c=k(l).mul(.5).add(.5),h=i.mul(L).add(d.mul(U)).mul(G),u=T.greaterThan(0).select(h.mul(c),h),m=x(this.scene,this.camera),p=new n(this.renderer);p.outputNode=u.add(m),this.postProcessing=p,this.gui=new r,this.addGui(),this.bindEvent()}createRender(){return new i}addModel(e){this.group.children.length=0;let s=1;e.traverse((e=>{if(e.isMesh){e.geometry.center(),e.geometry.computeBoundingSphere(),s=.2*e.geometry.boundingSphere.radius;const t=new d({color:16777215,specular:1118481,shininess:5});e.material=t,e.receiveShadow=!0,e.castShadow=!0}})),e.position.y=1,e.scale.divideScalar(s),this.group.add(e);const t=new l(3,48,24);for(let o=0;o<20;o++){const e=new c;e.color.setHSL(Math.random(),1,.3);const s=new h(t,e);s.position.set(4*Math.random()-2,4*Math.random()-2,4*Math.random()-2),s.scale.multiplyScalar(.3*Math.random()+.1),this.group.add(s)}const a=new h(new u(12,12),new c({color:3235718,side:m}));a.rotation.x-=.5*Math.PI,a.position.y-=1.5,a.receiveShadow=!0,this.group.add(a)}onPointerMove(e){if(!e.isPrimary)return;R(e,this.container),z.setFromCamera(O,this.camera);const s=z.intersectObject(this.group,!0);if(s.length>0){const e=s[0].object;this.select=[],this.select.push(e),this.outlinePass.selectedObjects=this.select}}addGui(){var e;const s=this.gui;s.add(G,"value",.01,10).name("边缘强度"),s.add(H,"value",0,1).step(.01).name("边缘发光"),s.add(N,"value",0,6).step(.01).name("边缘厚度"),s.add(T,"value",0,6).step(.01).name("脉冲周期"),s.addColor({color:L.value.getHex()},"color").name("可见区域颜色").onChange((e=>{L.value.set(e)})),s.addColor({color:U.value.getHex()},"color").name("不可见区域颜色").onChange((e=>{U.value.set(e)})),s.domElement.className+=" gui-wrap",null==(e=this.container.parentNode)||e.appendChild(s.domElement)}setEnv(e){this.scene.environment=e,this.scene.background=e}animate(){this.postProcessing.renderAsync()}}const B={class:"three-page"},D=g({__name:"index",setup(e){const s=b({base:"",models:[{key:"tree",name:"大树",size:.1,url:"/oss/model/gpu/tree.glb"}],objects:[{type:"tree",name:"大树"}]}),{progress:t,loadModels:a,getModel:o,initModels:n}=P.useModelLoader({baseUrl:s.base}),r=v(),i={baseUrl:s.base,env:"/oss/textures/hdr/moonless_golf_1k.hdr",camera:{position:[0,0,15]}};let d;return w((()=>{i.container=r.value,d=new A(i).run(),S(d).resize(),a(s.models,(()=>{t.percentage=100,t.show=!1,n(s.objects,(e=>{const{type:s}=e,t=o(s);if(!t)return Promise.resolve();let a=_.modelDeepClone(t);const{position:n,scale:r,rotation:i}=_.get_P_S_R_param(a,e),[l,c,h]=n;return a.scale.set(...r),a.position.set(l,c,h),a.rotation.set(...i),d.addModel(a),Promise.resolve()}))}))})),(e,s)=>(f(),y("div",B,[M("div",{class:"h-100",ref_key:"containerRef",ref:r},null,512)]))}});export{D as default};
