var e,t,i=Object.defineProperty,s=(e,t,s)=>(((e,t,s)=>{t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s),n=(e,t,i)=>(((e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)})(e,t,"access private method"),i);import{bm as o,bn as r,b4 as a,bw as c,bx as h,b2 as l,ch as d,by as p,b3 as m,bp as b,bq as u,br as g,bs as w,bt as f,bu as v,bv as y,bA as C,b9 as x,bb as j,aU as A,ci as E,bf as L,bd as P,be as O,b0 as k,aW as S,aX as U,aY as M,bc as z,bk as D,bl as T,aZ as H,ba as W,w as B,ad as G}from"./vendor-fd8a184d.js";import{u as R}from"./common-ce9ec953.js";const F=e=>((e,t)=>Object.prototype.toString.call(t)===`[object ${e}]`)("Object",e),I=(e,t=new Map)=>{if(null!=e&&F(e)){let i=t.get(e);if(i)return i;const s=Array.isArray(e);let n=s?[]:{};return i=t.set(e,n),s?e.forEach(((e,t)=>{n[t]=I(e,i)})):Object.keys(e).forEach((t=>{F(n[t])?n[t]=I(e[t],i):n[t]=e[t]})),n}return e},Z=(e,t)=>{e=I(e);for(let i in t)i in e&&F(t[i])&&F(e[i])?e[i]=Z(e[i],t[i]):e[i]=t[i];return e},q=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,V=(e,t="")=>Array.isArray(e)?e.map((e=>V(e,t))):!(e=>(!e&&(e=""),!!/^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/)[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,}(\/\S*)?$/.test(e)))(e)&&e.indexOf(t)<0?t+e:e,$={container:document.body,width:window.innerWidth,height:window.innerHeight,baseUrl:"",bgColor:null,bgUrl:null,env:null,scale:1,fog:{visible:!1,near:100,far:1e3},render:{antialias:!0,logarithmicDepthBuffer:!0,preserveDrawingBuffer:!1},controls:{visible:!0,enableDamping:!1,dampingFactor:.25,autoRotate:!1,enableZoom:!0,enablePan:!0,screenSpacePanning:!0,minDistance:1,maxDistance:2e3},lightHelperVisible:!1,ambientLight:{visible:!0,color:16777215,intensity:1.5},directionalLight:{visible:!0,light2:!0,color:16777215,intensity:1.5},camera:{near:1,far:1e4,position:[-350,510,700]},cruise:{visible:!1,runing:!1,helper:!1,points:[],segment:2,tension:0,baseUrl:"",mapUrl:"/oss/textures/cruise/arrow.png",repeat:[.1,1],width:15,speed:1,mapSpeed:.006,offset:10,factor:1,index:0},grid:{visible:!1,opacity:.3,transparent:!0,width:800,divisions:80,centerLineColor:10592673,gridColor:10592673},axes:{visible:!1,size:50}},{createCruise:_,cruiseAnimate:N,updateCruise:X}=(()=>{let e,t,i,s={visible:!0,runing:!1,helper:!1,points:[],segment:2,tension:0,baseUrl:"",mapUrl:"/oss/textures/cruise/arrow.png",repeat:[.1,1],width:15,speed:1,mapSpeed:.006,offset:10,factor:1,index:0};const n=(t,n)=>{i=new m(new b(2),new u({color:0,opacity:.8,transparent:!0})),t.add(i);const o=(new g).setFromPoints(n),r=new w({color:255,opacity:1,transparent:!0}),a=new f(o,r);t.add(a);const c=new v(e,100,s.width/2,3,!0),h=new y({color:16711935,opacity:.1,transparent:!0}),l=new m(c,h),d=new u({color:16715760,opacity:.3,wireframe:!0,transparent:!0}),p=new m(c,d);l.add(p),t.add(l)},x=(e,t)=>new o(t.x,t.y+e,t.z);return{createCruise:(i={},b)=>{s=Z(s,i);const{points:u,tension:g,mapUrl:w,baseUrl:f,repeat:v,width:y,helper:x}=s,j=[];for(let e=0;e<u.length;e++){const t=u[e];j.push(new o(t[0],t[1],t[2]))}e=new r(j,!0,"catmullrom",g??0);const A=new a;t=(new c).load(V(w,f),(e=>{e.wrapS=h,e.repeat.x=v[0],e.repeat.y=v[1],e.anisotropy=b.capabilities.getMaxAnisotropy()}));const E=new l({map:t,opacity:.5,transparent:!0,depthWrite:!1,blending:d}),L=new o(0,1,0),P=new C;P.set(e.getPoints(1e3),5,1,L,!1);const O=new p;O.update(P,{width:y,arrow:!1});const k=new m(O,E);return A.add(k),A.name="cruise",x&&n(A,j),A},updateCruise:(e={})=>{s=Z(s,e)},cruiseAnimate:n=>{if(!n)return;if(!e)return;const{mapSpeed:o,speed:r,factor:a,runing:c,offset:h,helper:l}=s;t&&(t.offset.x-=o),c&&(s.index+=a*r);const d=1e3*(s.segment??2),p=s.index%d/d,m=e.getPointAt(p);if(l&&i){const e=x(h,m);i.position.copy(e)}const b=.03;let u=p-b;p<b&&(u=p+.97);const g=x(h,e.getPointAt(u));n.position.copy(g),n.lookAt(x(h,m))}}})(),Y=class i{constructor(t={}){((e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)})(this,e),s(this,"options"),s(this,"container"),s(this,"scene"),s(this,"renderer"),s(this,"baseCamera"),s(this,"cruiseCamera"),s(this,"cruiseGroup"),s(this,"controls"),s(this,"grid"),s(this,"animationId"),s(this,"pointer"),s(this,"clear",(e=>{e&&e.traverse&&(e.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),null==e||e.clear()})),null==e||e.clear())})),s(this,"disposeObj",(e=>{e&&e.traverse&&(e.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),null==e||e.clear()})),null==e||e.clear(),this.scene.remove(e))}));const n=$;var o;this.options=Z(n,t),i.total++,this.pointer={tsp:0,isClick:!1},(o=this.options.container)&&("object"==typeof HTMLElement?o instanceof HTMLElement:o&&"object"==typeof o&&1===o.nodeType&&"string"==typeof o.nodeName)?this.container=this.options.container:this.container=document.querySelector(this.options.container),this.options.width=this.container.offsetWidth,this.options.height=this.container.offsetHeight,this.scene=new x,this.renderer=this.initRenderer(),this.init(),this.baseCamera=this.initCamera(),this.controls=this.initControls(),this.initCruise()}get camera(){const{visible:e,runing:t}=this.options.cruise;return e&&t?this.cruiseCamera:this.baseCamera}init(){this.initLight(),this.initGrid(),this.initAxes(),this.initModel()}run(){this.loop()}loop(){this.animationId=window.requestAnimationFrame((()=>{this.loop()})),this.animate(),this.modelAnimate()}animate(){this.renderer&&this.renderer.render(this.scene,this.camera),this.options.controls.visible&&this.controls.update(),N(this.cruiseCamera),j()}initModel(){}modelAnimate(){}initRenderer(){const{width:e,height:t,bgColor:i,bgUrl:s,env:n}=this.options,o=new A(this.options.render);if(n&&this.setEnvironment(n),s?this.setBgTexture(s):this.setBgColor(i),this.options.fog.visible){const{color:e,near:t,far:i}=this.options.fog;this.scene.fog=new E(e??this.scene.background,t,i)}return o.sortObjects=!0,o.shadowMap.enabled=!0,o.shadowMap.type=L,o.setSize(e,t),o.setPixelRatio(window.devicePixelRatio),this.container.appendChild(o.domElement),o}initLight(){const{ambientLight:e,directionalLight:t,lightHelperVisible:i}=this.options;if(e.visible){const t=new P(e.color,e.intensity);this.addObject(t)}if(t.visible){const e=this.createDirectionalLight();if(this.addObject(e),i){const t=new O(e,1);this.addObject(t)}if(t.light2){const e=this.createDirectionalLight(!1);if(e.position.set(-500,800,-800),this.addObject(e),i){const t=new O(e,1);this.addObject(t)}}}}createDirectionalLight(e=!0,t=800,i=4096,s=1,n=2e3){const{color:o,intensity:r}=this.options.directionalLight,a=new k(o,r);if(a.position.set(500,800,800),e){a.shadow.mapSize.setScalar(i),a.shadow.bias=-1e-5,a.shadow.normalBias=.01,a.castShadow=e;const o=a.shadow.camera;o.radius=10,o.near=s,o.far=n,o.top=o.right=t,o.left=o.bottom=-t,o.updateProjectionMatrix()}return a}initCamera(){const{width:e,height:t,camera:i}=this.options,s=new S(36,e/t,i.near,i.far);return s.position.set(...i.position),this.addObject(s),s}initControls(){const e=this.options.controls;if(!e.visible)return;const t=new U(this.camera,this.renderer.domElement);return Object.keys(e).forEach((i=>{t[i]=e[i]})),t.target.set(0,0,0),t}initCruise(){const{visible:i}=this.options.cruise;i&&(this.cruiseCamera=this.initCamera(),n(this,e,t).call(this))}initGrid(){const e=this.options.grid;if(!e.visible)return;const{width:t,divisions:i,centerLineColor:s,gridColor:n,opacity:o,transparent:r}=e,a=new M(t,i,s,n);a.material.opacity=o,a.material.transparent=r,this.grid=a,this.addObject(a)}initAxes(){if(!this.options.axes.visible)return;const e=new z(this.options.axes.size);this.addObject(e)}setCruisePoint(e){this.options.cruise.points=e,this.createCruise()}createCruise(){const{visible:e,points:t}=this.options.cruise;if(!e)return;if(this.cruiseGroup&&this.disposeObj(this.cruiseGroup),!t||0==t.length)return;const i=_(this.options.cruise,this.renderer);this.cruiseGroup=i,this.addObject(i)}toggleCruise(){const{visible:e,runing:t}=this.options.cruise;e&&(this.options.cruise.runing=!t,this.controls.enabled=t,X(this.options.cruise))}setScale(e){this.options.scale=e}setEnvironment(e){(new D).load(V(e),(e=>{e.mapping=T,this.scene.environment=e}))}setBgTexture(e){if(Array.isArray(e)){const t=(new H).load(V(e));this.scene.background=t}else this.scene.background=(new c).load(V(e))}setBgColor(e){this.scene.background=e?new W(e):null}bindEvent(){const e=this.renderer.domElement;e.addEventListener("dblclick",this.onDblclick.bind(this)),e.addEventListener("pointerdown",this.onPointerDown.bind(this)),e.addEventListener("pointermove",this.onPointerMove.bind(this)),e.addEventListener("pointerup",this.onPointerUp.bind(this))}onDblclick(e){}onPointerDown(e){this.pointer.isClick=!0,this.pointer.tsp=e.timeStamp}onPointerMove(e){}onPointerUp(e){this.pointer.isClick=!1}exportImage(){const e=document.createElement("a");e.download="render.png",e.href=this.renderer.domElement.toDataURL().replace("image/png","image/octet-stream"),e.click()}addObject(...e){this.scene.add(...e)}resize(){this.options.width=this.container.offsetWidth||window.innerWidth,this.options.height=this.container.offsetHeight||window.innerHeight;const{width:e,height:t}=this.options,i=e/t;this.baseCamera.aspect=i,this.baseCamera.updateProjectionMatrix(),this.cruiseCamera&&(this.cruiseCamera.aspect=i,this.cruiseCamera.updateProjectionMatrix()),this.renderer.setSize(e,t)}stopAnimate(){window.cancelAnimationFrame(this.animationId)}dispose(){try{this.scene.clear(),this.renderer.dispose(),this.renderer.forceContextLoss(),this.renderer.content=null;let e=this.renderer.domElement.getContext("webgl");e&&e.getExtension("WEBGL_lose_context").loseContext()}catch(e){}}};e=new WeakSet,t=function(){const e=this.options.cruise;e.runing=!1,this.cruiseCamera.lookAt(this.controls.target),e.baseUrl&&(e.baseUrl=this.options.baseUrl),e.factor=1,e.index=0},s(Y,"total",0);let J=Y;const K=e=>({resize:()=>{const t=()=>null==e?void 0:e.resize();B((()=>R().sidebar.opened),(()=>{setTimeout(t,300)})),window.addEventListener("resize",t,!1),G((()=>{null==e||e.stopAnimate(),null==e||e.dispose(),window.removeEventListener("resize",t)}))}});export{J as T,Z as d,V as g,q as r,K as u};
