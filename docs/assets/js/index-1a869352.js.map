{"version":3,"file":"index-1a869352.js","sources":["../../../code/src/components/map-scene/imgs/border.png?url","../../../code/src/components/map-scene/config.ts","../../../code/src/components/map-scene/color.ts","../../../code/src/components/map-scene/methods.ts","../../../code/src/components/map-scene/imgs/circle.png?url","../../../code/src/components/map-scene/imgs/gz-map-fx.jpg?url","../../../code/src/components/map-scene/imgs/gz-map.jpg?url","../../../code/src/components/map-scene/imgs/inner-circle.png?url","../../../code/src/components/map-scene/imgs/label.png?url","../../../code/src/components/map-scene/imgs/light.png?url","../../../code/src/components/map-scene/imgs/out-circle.png?url","../../../code/src/components/map-scene/imgs/point.png?url","../../../code/src/components/map-scene/index.vue","../../../code/src/pages/webgl/scene/map/data.ts","../../../code/src/pages/webgl/scene/map/index.vue","../../../code/src/pages/webgl/scene/map/request.ts"],"sourcesContent":["export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGUAAAE1CAYAAAD+hS6MAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALrSURBVHgB7dOxDQJBEMDABV1fdE5Mhr4IwkMiIUNPGw5mWrB8ue19DinXIUeUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAkSJUiUIFGCRAlax+M+tDglSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlaH2fx9DilCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJEiVIlCBRgkQJWud+Dy1OCRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECRIlSJQgUYJECVq/12docUqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBIkSJEqQKEGiBP0B9I0QJBOMnj4AAAAASUVORK5CYII=\"","export default {\n  // 地图深度\n  depth: 1,\n  // 地图缩放倍数\n  scale: 40,\n  // 波纹板半径\n  plateRadius: 200,\n  // 判断点击间隔时间\n  clickIntervalTime: 100,\n\n  // 区域 label\n  areaLabel: false,\n  // 光柱\n  markLight: false,\n  // 上下边框\n  border: true,\n  // 地图背景\n  mapBg: true,\n  // 地图柱状图\n  mapBar: true,\n\n  // 背景因素（缩放大小）\n  bgOutFactor: 1,\n  bgInnerFactor: 0.9,\n\n  // 地图贴图\n  map: {\n    // map: '/oss/textures/map/gz-map.jpg',\n    // normal: '/oss/textures/map/gz-map-fx.jpg',\n    // side: '/oss/textures/map/border.png'\n    // bgOutCircle: '/oss/textures/map/out-circle.png'\n    // bgInnerCircle: '/oss/textures/map/inner-circle.png'\n  }\n}\n","export default {\n  // 主色（地图面）\n  main: 0x338ad7,\n  mainHover: 0x92ffff,\n  // 边(区域侧边)\n  borderColor: 0x92ffff,\n  borderHoverColor: 0x10467a,\n  // 浅色\n  light: 0x10467a,\n  lightHover: 0x92ffff,\n  // 波纹板\n  plateColor: 0x338ad7,\n  plateLight: 0x10467a,\n  // 线条(地图区块上下线条)\n  line: 0x91dbf3,\n  line2: 0x61fbfd,\n  // 网格线\n  gridColor: 0x0a2036,\n  // 网格交叉\n  gridFork: 0x0e2843,\n  // 轮廓线\n  outline: 0xb4eafc,\n  // mark 颜色(光柱)\n  markColor1: 0xcaffff,\n  markColor2: 0x69f8ff,\n  // 飞线\n  flyColor1: 0x91dbf3,\n  flyColor2: 0x61fbfd,\n  // 散点\n  scatterColor1: 0x91dbf3,\n  scatterColor2: 0x61fbfd\n}\n","import * as THREE from 'three'\nimport * as TWEEN from 'three/examples/jsm/libs/tween.module.js'\n\nimport * as ThreeScene from 'three-scene'\n\nimport CONFIG from './config'\nimport COLOR from './color'\n\nconst Hooks = ThreeScene.Hooks\nconst Utils = ThreeScene.Utils\n\nconst { initCSS3DRender, createCSS3DDom } = Hooks.useCSS3D()\nconst { raycaster, pointer, style, update: raycasterUpdate } = Hooks.useRaycaster()\nconst { createCorrugatedPlate, corrugatedPlateUpdate } = Hooks.useCorrugatedPlate()\nconst { getBoundingBox } = Hooks.useCoord()\nconst { createMarkLight } = Hooks.useMarkLight()\nconst { createCountryFlatLine, getPoints } = Hooks.useCountryLine()\nconst { createOutline, outlineUpdate } = Hooks.useOutline()\nconst { createFlywireTexture, createFlywire, flywireUpdate } = Hooks.useFlywire()\nconst { createBar } = Hooks.useMapBar()\n\n// 中心点\nconst centerPos = {\n  x: 105.06,\n  y: 0,\n  z: 32.93\n}\n\n//贴图材质加载\nconst textureLoader = new THREE.TextureLoader()\n// 省份贴图\nlet textureMap: any\n// 法线\nlet normalTextureMap: any\n// 边贴图\nlet sideTextureMap: any\n// 背景外圈\nlet outCircleTexture: any\n// 背景内圈\nlet innerRingTexture: any\n\nconst getImgUrl = (jpg: string, path = '') => {\n  return new URL(`./imgs${path}/${jpg}`, import.meta.url).href\n}\n\n// 转换地址\nconst transformUrl = (defaultUrl: string, url: string, baseUrl: string): string => {\n  if (url) return Utils.getUrl(url, baseUrl) as string\n  return defaultUrl\n}\n\n// 创建地图材质\nconst createMaptexture = (config: any, baseUrl: string) => {\n  textureMap = textureLoader.load(transformUrl(getImgUrl('gz-map.jpg'), config.map.map, baseUrl))\n  normalTextureMap = textureLoader.load(\n    transformUrl(getImgUrl('gz-map-fx.jpg'), config.map.normal, baseUrl)\n  )\n  sideTextureMap = textureLoader.load(\n    transformUrl(getImgUrl('border.png'), config.map.side, baseUrl)\n  )\n  // 材质属性设置\n  textureMap.wrapS = normalTextureMap.wrapS = sideTextureMap.wrapS = THREE.RepeatWrapping\n  textureMap.wrapT = normalTextureMap.wrapT = sideTextureMap.wrapT = THREE.RepeatWrapping\n  textureMap.flipY = false\n  // degToRad 将度数转换为弧度\n  // textureMap.rotation = THREE.MathUtils.degToRad(45)\n  const scale = 0.0128\n  textureMap.repeat.set(scale, scale)\n  normalTextureMap.repeat.set(scale, scale)\n\n  outCircleTexture = textureLoader.load(\n    transformUrl(getImgUrl('out-circle.png'), config.map.bgOutCircle, baseUrl)\n  )\n  innerRingTexture = textureLoader.load(\n    transformUrl(getImgUrl('inner-circle.png'), config.map.bgInnerCircle, baseUrl)\n  )\n}\n\n// 创建地图块\nconst createMapBlock = (_this: any, points: InstanceType<typeof THREE.Vector2>[]) => {\n  // 绘制二维平面\n  const shape = new THREE.Shape(points)\n  const opts = {\n    // 挤出深度\n    depth: _this.config.depth,\n    // 对挤出的形状应用是否斜角\n    bevelEnabled: true,\n    // 斜角的分段层数\n    bevelSegments: 1,\n    // 设置原始形状上斜角的厚度\n    bevelThickness: 0,\n    // 挤出样条的深度细分的点的数量\n    steps: 0,\n    // 斜角与原始形状轮廓之间的延伸距离\n    bevelSize: 0\n  }\n\n  // 挤压几何体\n  const geometry = new THREE.ExtrudeGeometry(shape, opts)\n\n  // 表面材质\n  const material = new THREE.MeshPhongMaterial({\n    color: _this.color.main,\n    map: textureMap,\n    normalMap: normalTextureMap,\n    // 颜色与贴图结合方式\n    // MeshLambertMaterial 和 MeshPhongMaterial 当中。\n    // MultiplyOperation 是默认值，它将环境贴图和物体表面颜色进行相乘。\n    // MixOperation 使用反射率来混和两种颜色。uses reflectivity to blend between the two colors.\n    // AddOperation 用于对两种颜色进行相加。\n    combine: THREE.MultiplyOperation,\n    transparent: true,\n    opacity: 0.8\n  })\n  // 边框材质\n  const sideMaterial = new THREE.MeshLambertMaterial({\n    color: COLOR.borderColor,\n    map: sideTextureMap,\n    transparent: true,\n    opacity: 0.9\n  })\n  const mesh = new THREE.Mesh(geometry, [material, sideMaterial])\n  mesh.scale.setScalar(_this.config.scale)\n  mesh.name = '地图拼块'\n  return mesh\n}\n\n// 省份名称背景\nconst labelImg = getImgUrl('label.png', '')\n\n// 创建 css3d 省份名称\nconst createCSS3Dlabel = (\n  _this: InstanceType<typeof MapThreeScene>,\n  properties: any,\n  group: InstanceType<typeof THREE.Object3D>\n) => {\n  // 判断省份数据中心点\n  if (!properties.centroid && !properties.center) {\n    return false\n  }\n  const { depth, scale } = _this.config\n  const [lon, lat] = properties.centroid || properties.center\n  const label = createCSS3DDom({\n    name: `\n      <img src=\"${labelImg}\" />\n      <div class=\"name\">${properties.name}</div>\n    `,\n    className: 'map-3D-label',\n    position: [lon * scale, lat * scale * 0.995, depth * scale]\n  })\n  label.rotateX(Math.PI * 0.5)\n  label.name = properties.name + '_CSS3D_label'\n  label.isLabel = true\n  group.add(label)\n}\n\nconst random = (min: number, max: number) => {\n  return Math.floor(Math.random() * (max - min + 1)) + min\n}\n// 创建省份光柱\nconst createMarkLightPoint = (\n  _this: InstanceType<typeof MapThreeScene>,\n  properties: any,\n  group: InstanceType<typeof THREE.Object3D>\n) => {\n  if (!properties.centroid && !properties.center) {\n    return false\n  }\n  const { depth, scale } = _this.config\n  // 创建光柱\n  const height = 1 + random(5, 10) / 4\n  const [lon, lat] = properties.centroid || properties.center\n  const light = createMarkLight(\n    [lon, lat, depth * 1.01].map(t => t * scale),\n    height * scale,\n    {\n      factor: scale,\n      color: _this.color.markColor1\n    }\n  )\n  light.rotateX(-Math.PI / 2)\n  group.add(light)\n}\n\n// 创建上下边框\nconst createBorderLine = (_this: InstanceType<typeof MapThreeScene>, mapJson: any) => {\n  let lineTop = createCountryFlatLine(\n    mapJson,\n    {\n      color: COLOR.line,\n      transparent: true\n    },\n    'Line2'\n  )\n  const { depth, scale } = _this.config\n  lineTop.name = '地图上边框'\n  lineTop.position.y += depth * scale\n  let lineBottom = createCountryFlatLine(\n    mapJson,\n    {\n      color: COLOR.line2\n    },\n    'Line2'\n  )\n  lineBottom.name = '地图下边框'\n  lineTop.scale.setScalar(scale)\n  lineBottom.scale.setScalar(scale)\n  _this.scene.add(lineTop)\n  _this.scene.add(lineBottom)\n}\n\n// 外圈背景\nconst createOutRing = (scene: InstanceType<typeof THREE.Scene>, width: number) => {\n  let plane = new THREE.PlaneGeometry(width, width)\n  let material = new THREE.MeshBasicMaterial({\n    map: outCircleTexture,\n    transparent: true,\n    opacity: 0.6,\n    depthTest: true\n  })\n  let mesh = new THREE.Mesh(plane, material)\n  const { x, z } = centerPos\n  mesh.position.set(x, -1, z)\n  mesh.scale.setScalar(1.2)\n  mesh.rotateX(-Math.PI * 0.5)\n  scene.add(mesh)\n  return mesh\n}\n\n// 内圈背景\nconst createInnerRing = (scene: InstanceType<typeof THREE.Scene>, width: number) => {\n  let plane = new THREE.PlaneGeometry(width, width)\n  let material = new THREE.MeshBasicMaterial({\n    map: innerRingTexture,\n    transparent: true,\n    opacity: 0.3,\n    depthTest: true\n  })\n  let mesh = new THREE.Mesh(plane, material)\n  const { x, z } = centerPos\n  mesh.position.set(x, -2, z)\n  mesh.scale.setScalar(1.2)\n  mesh.rotateX(-Math.PI * 0.5)\n  scene.add(mesh)\n  return mesh\n}\n\n// 创建散点\nconst createScatter = (\n  _this: InstanceType<typeof MapThreeScene>,\n  longitude: number,\n  latitude: number\n) => {\n  const { scale, depth } = _this.config\n  const group: InstanceType<typeof THREE.Group> & {\n    data?: any\n    isScatter?: boolean\n  } = new THREE.Group()\n  const size = 0.2 * scale\n  // 圆盘\n  const circle = new THREE.CircleGeometry(size, 32)\n  const circleMat = new THREE.MeshBasicMaterial({\n    color: COLOR.scatterColor1,\n    transparent: true,\n    opacity: 1\n  })\n  const circleMesh = new THREE.Mesh(circle, circleMat)\n\n  // 半球\n  const sphere = new THREE.SphereGeometry(size * 0.8, 32, 32, 0, Math.PI)\n  const sphereMat = new THREE.MeshBasicMaterial({\n    color: COLOR.scatterColor2,\n    transparent: true,\n    opacity: 1\n  })\n  const sphereMesh = new THREE.Mesh(sphere, sphereMat)\n  group.add(circleMesh, sphereMesh)\n  group.position.set(longitude * scale, latitude * scale, depth * scale * 1.005)\n  return group\n}\n\nexport class MapThreeScene extends ThreeScene.Scene {\n  // 配置\n  config: import('./index').Config\n  // 颜色\n  color: import('./index').Color\n  // 波纹板\n  corrugatedPlate?: InstanceType<typeof THREE.Mesh>\n  // 地图组\n  mapGroup?: InstanceType<typeof THREE.Group>\n  // 散点组\n  scatterGroup?: InstanceType<typeof THREE.Group>\n  // 飞线组\n  flywireGroup?: InstanceType<typeof THREE.Group>\n  // CSS3D 渲染器\n  css3DRender: InstanceType<typeof Hooks.CSS3DRenderer>\n  // 地图轮廓\n  outline?: ReturnType<typeof createOutline>\n  // hover 回调\n  #hoverBack?: (e: any, position: typeof style) => void\n  #clickBack?: (e: any) => void\n  // 外圈背景\n  outRingMesh?: InstanceType<typeof THREE.Mesh>\n  // 内圈背景\n  innerRingMesh?: InstanceType<typeof THREE.Mesh>\n\n  constructor(\n    options: ConstructorParameters<typeof ThreeScene.Scene>[0],\n    config: Partial<import('./index').Config> = {},\n    color: Partial<import('./index').Color> = {},\n    hoverBack?: (e: any, position: typeof style) => void,\n    clickBack?: (e: any) => void\n  ) {\n    super(options)\n    this.config = Utils.deepMerge(CONFIG, config)\n    this.color = Utils.deepMerge(COLOR, color)\n    this.#hoverBack = hoverBack\n    this.#clickBack = clickBack\n\n    this.createClock()\n    this.css3DRender = initCSS3DRender(this.options, this.container)\n\n    createMaptexture(this.config, this.options.baseUrl)\n    this.bindEvent()\n  }\n\n  // 添加波纹板\n  addCorrugatedPlate() {\n    if (this.corrugatedPlate) {\n      this.disposeObj(this.corrugatedPlate)\n      this.corrugatedPlate = void 0\n    }\n    // 波纹板\n    const cpMh = createCorrugatedPlate({\n      range: this.config.plateRadius,\n      factor: this.config.scale,\n      color: this.color.plateColor,\n      light: this.color.plateLight\n    })\n    cpMh.renderOrder = 0\n    this.corrugatedPlate = cpMh\n    this.addObject(cpMh)\n  }\n\n  // 初始化地图\n  initMap(geoJson: any) {\n    // 存在则销毁\n    if (this.mapGroup) {\n      this.disposeObj(this.mapGroup)\n      this.mapGroup = void 0\n    }\n    const mapGroup = new THREE.Group()\n    mapGroup.name = '地图'\n\n    const data = geoJson.features,\n      len = data.length\n    for (let i = 0; i < len; i++) {\n      const item = data[i]\n      // 定一个省份对象\n      const provinceObj: InstanceType<typeof THREE.Object3D> & {\n        isProvinceGroup?: boolean\n        data?: any\n      } = new THREE.Object3D()\n      // 坐标\n      const coordinates = item.geometry.coordinates\n      // city 属性\n      const properties = item.properties\n      for (let j = 0; j < coordinates.length; j++) {\n        coordinates[j].forEach((polygon: any[]) => {\n          // 点位集合\n          const points = polygon.map(el => new THREE.Vector2(el[0], el[1]))\n          // 创建地图区块\n          const mesh = createMapBlock(this, points) as any\n          // 省份区块标记\n          mesh.isProvinceBlock = true\n          provinceObj.add(mesh)\n        })\n      }\n\n      if (this.config.areaLabel) {\n        // 创建 label\n        createCSS3Dlabel(this, properties, provinceObj)\n      }\n      if (this.config.markLight) {\n        // 创建光柱\n        createMarkLightPoint(this, properties, provinceObj)\n      }\n\n      // 翻转角度\n      provinceObj.rotateX(-Math.PI / 2)\n      // 省份组合标记\n      provinceObj.isProvinceGroup = true\n      provinceObj.name = properties.name\n      provinceObj.data = properties\n      mapGroup.add(provinceObj)\n    }\n\n    this.mapGroup = mapGroup\n    this.addObject(mapGroup)\n\n    if (this.config.border) {\n      // 创建上下边线\n      createBorderLine(this, geoJson)\n    }\n\n    // 计算包围盒\n    const box = getBoundingBox(mapGroup)\n\n    if (!this.corrugatedPlate) return\n    let {\n      size,\n      center: { x, y, z }\n    } = box\n    centerPos.x = x\n    centerPos.y = y\n    centerPos.z = z\n    this.corrugatedPlate.position.set(x, 0 - 0.1 * this.config.scale, z)\n\n    // 重置场景元素\n    this.resetSceneEle()\n    if (this.config.mapBg) {\n      // 宽度\n      const width = size.x < size.y ? size.y + 1 : size.x + 1\n\n      // 添加背景，修饰元素\n      this.outRingMesh = createOutRing(this.scene, width * this.config.bgOutFactor)\n      this.innerRingMesh = createInnerRing(this.scene, width * this.config.bgInnerFactor)\n    }\n  }\n\n  // 轮廓\n  initMapOutLine(geoJson: any) {\n    // 存在则销毁\n    if (this.outline) {\n      this.disposeObj(this.outline)\n      this.outline = void 0\n    }\n    const points = getPoints(geoJson, this.config.depth, !true) as number[]\n    const outline = createOutline(points, {\n      factor: this.config.scale,\n      color: this.color.outline\n    })\n    outline.renderOrder = 10\n    this.outline = outline\n    this.addObject(outline)\n  }\n\n  // 飞线\n  initFlywire(points: import('./index').Flywire[]) {\n    const name = '飞线集合'\n    // 存在则销毁\n    if (this.flywireGroup) {\n      this.disposeObj(this.flywireGroup)\n      this.flywireGroup = void 0\n    }\n\n    const { scale, depth } = this.config\n    const COLOR = this.color\n    createFlywireTexture({\n      depth: depth,\n      color: COLOR.line,\n      flyColor: COLOR.flyColor2,\n      pointColor: COLOR.flyColor1,\n      factor: scale\n    })\n    const flywireGroup = new THREE.Group()\n    for (let i = 0; i < points.length; i++) {\n      const { coords, path } = points[i]\n      const mesh = createFlywire(\n        coords.map(it => {\n          return it.map(t => t * scale)\n        })\n      )\n      mesh.name = path\n      flywireGroup.add(mesh)\n    }\n    flywireGroup.name = name\n    flywireGroup.renderOrder = 20\n    this.flywireGroup = flywireGroup\n    this.addObject(flywireGroup)\n  }\n\n  // 柱状\n  initMapBar(citys: any[], labelRender: Function) {\n    if (!this.config.mapBar) return\n    console.log(this.mapGroup)\n    // 清除柱状\n    if (!this.mapGroup) return\n    this.clearMapBar()\n\n    // 找最大\n    const max = Math.max(...citys.map(it => it.value || 0))\n    const { scale, depth } = this.config\n    const COLOR = this.color\n    const options = {\n      height: 5,\n      size: 0.2,\n      factor: scale,\n      color1: COLOR.markColor1,\n      color2: COLOR.markColor2\n    }\n    for (let i = 0; i < citys.length; i++) {\n      const { name = '', value = 0 } = citys[i]\n      const el = this.mapGroup.getObjectByName(name) as any\n      if (!el) {\n        console.log(name, el)\n      } else {\n        const heightRatio = value / max || 0\n        const { centroid, center } = el.data\n        const pos = centroid || center\n        const bar = createBar(\n          {\n            position: [pos[0] * scale, pos[1] * scale, depth * scale],\n            heightRatio,\n            label: labelRender(citys[i])\n          },\n          options\n        )\n        bar.isBar = true\n        el.add(bar)\n      }\n    }\n  }\n\n  // 清除柱状图\n  clearMapBar() {\n    this.mapGroup?.traverse((el: any) => {\n      if (el.isBar) {\n        this.disposeObj(el)\n      }\n    })\n  }\n\n  // 散点\n  initScatter(points: import('./index').Scatter[]) {\n    const name = '散点集合'\n    // 存在则销毁\n    if (this.scatterGroup) {\n      this.disposeObj(this.scatterGroup)\n      this.scatterGroup = void 0\n    }\n    const scatterGroup = new THREE.Group()\n    scatterGroup.name = name\n\n    for (let i = 0; i < points.length; i++) {\n      const item = points[i]\n      const [longitude = 0, latitude = 0] = item.coord || []\n      const mesh = createScatter(this, longitude, latitude)\n      mesh.name = item.name\n      mesh.data = item\n      mesh.isScatter = true\n      scatterGroup.add(mesh)\n    }\n    scatterGroup.rotateX(-Math.PI * 0.5)\n    this.scatterGroup = scatterGroup\n    this.addObject(scatterGroup)\n  }\n\n  // 双击\n  onDblclick(_e: MouseEvent) {}\n\n  // 按下\n  onPointerDown(e: PointerEvent) {\n    this.pointer.isClick = true\n    this.pointer.tsp = e.timeStamp\n  }\n\n  // 鼠标移动\n  onPointerMove(e: any) {\n    const dom = this.container\n    const scale = this.options.scale\n    raycasterUpdate(e, dom, scale)\n\n    if (this.mapGroup) {\n      // 设置新的原点和方向向量更新射线, 用照相机的原点和点击的点构成一条直线\n      raycaster.setFromCamera(pointer, this.camera)\n      // 检查射线和物体之间的交叉点（包含或不包含后代）\n      const objects = [this.mapGroup]\n      if (this.scatterGroup) objects.push(this.scatterGroup)\n      const interscts = raycaster.intersectObjects(objects)\n      this.container.style.cursor = interscts.length ? 'pointer' : 'auto'\n      if (interscts.length > 0) {\n        const object = interscts[0].object\n        let puuid\n        const pObj = this.findParentGroupGroupUuid(object)\n        if (pObj) {\n          puuid = pObj.uuid\n          this.#hoverProvince(pObj)\n        }\n        this.setMapBlockColor(puuid)\n      } else {\n        this.#hoverProvince()\n        this.setMapBlockColor()\n      }\n    }\n  }\n\n  // 弹起\n  onPointerUp(e: PointerEvent): void {\n    this.pointer.isClick = false\n    let s = e.timeStamp - this.pointer.tsp\n    // 判断是否未点击\n    const isClick = s < this.config.clickIntervalTime\n    if (e.button == 2) {\n      // 右键\n    } else if (e.button == 0) {\n      // 左键\n      isClick && this.clickObject(e)\n    } else if (e.button == 1) {\n      // 滚轮\n    }\n  }\n\n  // 查找父级组合\n  findParentGroupGroupUuid(object: any) {\n    const _find = (obj: any) => {\n      let parent = obj.parent\n      if (!parent) {\n        return\n      }\n      if ((parent && parent.isProvinceGroup) || parent.isScatter) {\n        return parent\n      }\n      return _find(parent)\n    }\n    return _find(object)\n  }\n\n  // 地图省份 hover\n  #hoverProvince(pObj?: any) {\n    if (typeof this.#hoverBack === 'function') this.#hoverBack(pObj, style)\n  }\n\n  // 设置地图面颜色\n  setMapBlockColor(puuid?: string) {\n    this.mapGroup?.traverse((el: any) => {\n      if (el.isProvinceBlock) {\n        el.material[0].color.set(el.parent.uuid === puuid ? this.color.mainHover : this.color.main)\n        el.material[1].color.set(\n          el.parent.uuid === puuid ? this.color.borderHoverColor : this.color.borderColor\n        )\n      } else if (el.isLabel) {\n        const isTarget = el.parent.uuid === puuid\n        el.element.className = `map-3D-label${isTarget ? ' is-active' : ''}`\n      }\n    })\n  }\n  // 点击元素\n  clickObject(e: any) {\n    const dom = this.container\n    const scale = this.options.scale\n    raycasterUpdate(e, dom, scale)\n\n    if (this.scatterGroup) {\n      // 设置新的原点和方向向量更新射线, 用照相机的原点和点击的点构成一条直线\n      raycaster.setFromCamera(pointer, this.camera)\n      // 检查射线和物体之间的交叉点（包含或不包含后代）\n      const objects = [this.scatterGroup]\n      const interscts = raycaster.intersectObjects(objects)\n      this.container.style.cursor = interscts.length ? 'pointer' : 'auto'\n      if (interscts.length) {\n        const obj = interscts[0].object\n        const pObj = this.findParentGroupGroupUuid(obj)\n        const data = pObj.data || {}\n        if (typeof this.#clickBack === 'function') this.#clickBack(data)\n      }\n    }\n  }\n\n  // 重置场景元素\n  resetSceneEle() {\n    const { x, y, z } = centerPos\n    // 设置相机对焦位置\n    this.camera.lookAt(x, y, z)\n    const s = this.config.scale\n    new TWEEN.Tween(this.camera.position)\n      .to(\n        {\n          x: x,\n          y: 90 * s,\n          z: z + 40 * s\n        },\n        1000\n      )\n      .easing(TWEEN.Easing.Quadratic.In)\n      .start()\n      .onUpdate(pos => {\n        console.log(pos)\n      })\n\n    // 控制器\n    this.controls && (this.controls.target = new THREE.Vector3(x, y, z - 5 * this.config.scale))\n\n    // 网格\n    if (this.grid) {\n      this.grid.position.set(x, 0, z)\n      const group = this.scene.getObjectByProperty('_isGridFork_', true)\n      group && group.position.set(x, 0, z)\n    }\n  }\n\n  modelAnimate() {\n    let dalte = this.clock?.getDelta() as number\n    // 波纹板\n    if (this.corrugatedPlate) {\n      corrugatedPlateUpdate(this.corrugatedPlate, dalte)\n    }\n\n    // css 3D 渲染器\n    if (this.css3DRender) {\n      this.css3DRender.render(this.scene, this.camera)\n    }\n\n    // 地图边贴图\n    if (sideTextureMap) {\n      sideTextureMap.offset.y += 0.005\n    }\n\n    // 旋转背景外圈\n    if (this.outRingMesh) {\n      this.outRingMesh.rotation.z += 0.0005\n    }\n\n    // 旋转背景内圈\n    if (this.innerRingMesh) {\n      this.innerRingMesh.rotation.z -= 0.0005\n    }\n\n    // 轮廓\n    if (this.outline) {\n      outlineUpdate(this.outline)\n    }\n\n    // 飞线\n    if (this.flywireGroup) {\n      flywireUpdate()\n    }\n  }\n  resize() {\n    super.resize()\n    if (this.css3DRender) {\n      const { width, height } = this.options\n      this.css3DRender.setSize(width, height)\n    }\n  }\n\n  dispose() {\n    this.disposeObj(this.corrugatedPlate)\n    this.disposeObj(this.mapGroup)\n    this.disposeObj(this.scatterGroup)\n    this.disposeObj(this.flywireGroup)\n    this.disposeObj(this.outline)\n    this.disposeObj(this.outRingMesh)\n    this.disposeObj(this.innerRingMesh)\n\n    this.clock = void 0\n    // @ts-ignore\n    this.css3DRender = void 0\n    this.corrugatedPlate = void 0\n    this.mapGroup = void 0\n    this.scatterGroup = void 0\n    this.flywireGroup = void 0\n    this.outline = void 0\n    this.outRingMesh = void 0\n    this.innerRingMesh = void 0\n    super.dispose()\n  }\n}\n","export default \"__VITE_ASSET__d77ba675__\"","export default \"__VITE_ASSET__fcebb46b__\"","export default \"__VITE_ASSET__83c87850__\"","export default \"__VITE_ASSET__ebeb7966__\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAK+SURBVHgB7dzNbdswGIdxSugCRtGBuklWSO17nXs/J0hHywA11AEMu3wDsLFT5WCJ5PtI/D8nQ5cA/FmxJJLqtofhHBSmPihUAoElEFgCgfVu7ODX95suqOKNXVDpDIElEFgCgSUQWAKBJRBYAoE1G2Q3DJ/j9fRjUGE7DI+f4niEGc0CMYzzKezjx7vWUQwjnMJdF8djDsq8M+QYLu/om0VJGP8OXI/LTc0C+fJhs4/fiIeLQ82hvMaI/zEevsVxCROb/RvSMkpuDCvLVVaLKCUwrGyXvS2hlMKwst6HtIBSEsPKfmO4ZpTSGFaRO/U1otTAsIo9OlkTSi0Mq+izrDWg1MSwij9cXDJKbQyrytPeJaJ4YFjVHr8vCcULw6o6H7IEFE8Mq/oEFRnFG8NymTEkohAwLLcpXBIKBcNynVMnoJAwLPdFDp4oNAwLserEA4WIYXVjK7C9Vr+fY8Gh7e8/Lhha/f5GhDMjJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJZDwvIIQs2kIA/K81tYvzKYhBMh/75vyCYHiDgLBSLmjuIK8xrBV6J1HoO11biCk/Rmk7XUuIMTNMhSU6iDUnUsWAaUqCBkj5Y1SDWQJGClPlCogS8JIeaEUB1kiRsoDpSjIkjFStVGKgawBI1UTpQjImjBStVCyg6wRI1UDJSvImjFSpVGygbSAkSqJkgWkJYxUKZTZIC1ipEqgzAJpGSOVG2UyiDBeyokyCWR3OOyFcd0Yyu4wfA83Ngnk2Pe/ziE82WdhvHSJYuNz7MPPcGOTQH5sNk+nPnyMf/xeGNcZSvyS3tv42DiFG0O94q+19Iq/BSQQWAKBJRBYAoElEFgCgSUQWKM3hsovnSGwBAJLILAEAusvLK6Na4P/Au0AAAAASUVORK5CYII=\"","export default \"__VITE_ASSET__20aa4849__\"","export default \"__VITE_ASSET__af7509e2__\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAABCtJREFUWIXVmU1oXFUUx3/zSptF4qYliNAUJB8tUnRhXSiSWhcmEekiXVi1C20Ximm7li5EsFDUrYsuBVeNCCroIgXF2iKtCRioIp1shIC1I0g7TUIS7d/FPTfz+vLu+5i8GewfLjP33vPxf3fu3HfuOTVJbAG9wLPAQeAxYAR4GOiz+bvAn8AN4FfgEvADsNS2R0llW03SuKQLkpZVHsumO262SvmvlVzhSeBd4Anr3wNmgW+BOVvJxdgK9gK7gWHgAHAIeAqIbH4eeA/4ouoVHpQ0E1ulRUlnJO1p4xfaY7qLMXsz5iNXv4iDlyXdNsMNSScl9bRBNNl6zFbDbN+WdHQrhGuSzsZW4TNJuyogmmy7zLbHWWXs7SyyH5uBfySd6gDRZDspad18ng+RDimfM8VlSYe7QNa3lyQtme9zRQkfja1sEbI1SaOSPpB0WdJNSavWbtrYhyZT5Bg7bL4l6ZU8woNq/cFO5xiOJB2XVFdx1E0nyrF92uTvKHF6JAX90TWdY/BRSddKEE3imtnI8jFtsjMhwpMm8Jek/gxDz6l1FG0FDbltEvKzU9Itk51MEq5J+tkmpzKMvCC3N6vCqqSxDH9vmdy8cdwgPGYTv0vaHlDeK7enqkbTbKf53G6cJBd7bLzT37DP88B6yht8G/Ap8FDhd35x9JntbSlz68YJ4HUAJPVKWpH0r6SBwJMe78DKJnEi4HvAuK1I6o1vh6sBhZrKHV3toq7wOX3VZMYiXPANLkRMwygwVNkGCGPIfKXBczsYAfutMxcQfrFKVjkI+fLc9ke44Brgt4DwM5VSysbTgXHPbTgC+q3zR0B4ODDeCYwExj23/pqkVWAH0AOspQj7+W5gzXgkscN4rEUpk/9rREDTvodeCn93iUuWL8+tGQEN6zwSEK5XSikbNwLjnlsjokVob0D4x0opZSPky3OrR8B16zwZEP66UkrZ+CYwfsA+r0e49BHA8wHhS8BClawCWMClsdJwaIOLigU/J7oQSxQKfiJcWulL3IlxLPCEn+BSUp3CnPlIwzEct6+AJf8U4/aUWQH8Prlgu2o0zXZeAD+hxBVp3ibeDihjSlVfkSYy/L1pcpuuSGUuoROqZqWbOWTjl9AjfjwpVPSav0/S7BbIziq8DXy7YLIX4+NJoUG1Lpp5+TSfSFkoQXRBxRIpp0z+jqShLMKofKoqkssvfCTpijanqq7Y3GgBoqhkqsq3ByoZiB7AdKsnHU9oT6szCe2dauXRpDYT2vH2qu4vGUypupLBlO4vGbyWp1fU+JDc8eKxKOkdtVeUGTDdeFHmohKnQaiVLXsdwZW9Hrf+PeAn4DtcrOHLXndtvg9X9hohXPZ6H/i8MIM2VsgXFqflIqiyWDHdrhQWk+jDlW5HcQmZYTaXbm/hVv4X4HvgMq1foDT+A+dj9DaZa2PgAAAAAElFTkSuQmCC\"","<template>\n  <div :class=\"$style['map-scene']\">\n    <div :class=\"$style.container\" ref=\"containerRef\"></div>\n\n    <div :class=\"$style['dialog-view']\" v-if=\"show\" :style=\"dialog.style\">\n      <slot name=\"dialog\" :data=\"dialog.extend\" />\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ref, onMounted, watch, withDefaults, toRaw } from 'vue'\nimport { MapThreeScene } from './methods'\n\nimport { Utils, Hooks } from 'three-scene/build/three-scene.module'\n\nconst { backgroundLoad, skys } = Hooks.useBackground()\nconst { transformGeoJSON } = Hooks.useConvertData()\nconst { show, dialog } = Hooks.useDialog({\n  style: {\n    left: '0px',\n    top: '0px'\n  },\n  extend: {}\n})\n\nconst props = withDefaults(defineProps<import('./index').Props>(), {\n  camera: () => ({}),\n  cruise: () => ({}),\n  fog: () => ({}),\n  render: () => ({}),\n  controls: () => ({}),\n  grid: () => ({}),\n  axes: () => ({}),\n  config: () => ({}),\n  color: () => ({}),\n  corrugatedPlate: true\n})\n\nconst containerRef = ref()\n\n// 加载完成\nconst emits = defineEmits<{\n  init: [scene: InstanceType<typeof MapThreeScene>]\n  'change-map': []\n  click: [e: import('./index').Scatter]\n}>()\n\n// 缩放\nwatch(\n  () => props.scale,\n  v => {\n    scene?.setScale(v || 1)\n  }\n)\n\n// 地图数据\nwatch(\n  () => props.mapJson,\n  json => {\n    if (json) {\n      scene?.initMap(transformGeoJSON(json))\n      emits('change-map')\n    }\n  }\n)\n\n// 轮廓线\nwatch(\n  () => props.outlineJson,\n  json => {\n    if (json) {\n      scene?.initMapOutLine(transformGeoJSON(json))\n      if (props.barList) {\n        scene?.initMapBar(props.barList || [], barLabelRender)\n      }\n    }\n  }\n)\n\n// 飞线\nwatch(\n  () => props.flywire,\n  list => {\n    scene?.initFlywire(list || [])\n  }\n)\n\n// 柱状\nwatch(\n  () => props.barList,\n  list => {\n    scene?.initMapBar(list || [], barLabelRender)\n  }\n)\n\n// 散点\nwatch(\n  () => props.scatters,\n  list => {\n    scene?.initScatter(list || [])\n  }\n)\n\nconst barLabelRender = item => {\n  if (typeof props.barLabelRender === 'function') return props.barLabelRender(item)\n  const { name = '', value = 0, unit = '' } = item\n  return {\n    name: `\n      <div class=\"label-wrap\">\n        <div class=\"name\">${name}</div>\n        <div class=\"text\">\n          <span class=\"value\">${Utils.numConverter(value)}</span>\n          <span class=\"unit\">${unit}</span>\n        </div>\n      </div>\n    `,\n    className: 'map-bar-label'\n  }\n}\n\nconst options: ConstructorParameters<typeof MapThreeScene>[0] = {\n  baseUrl: props.baseUrl,\n  bgUrl: props.bgUrl,\n  env: props.env,\n  bgColor: props.bgColor,\n  camera: props.camera,\n  cruise: props.cruise,\n  fog: props.fog,\n  render: props.render,\n  grid: props.grid,\n  controls: props.controls,\n  axes: props.axes\n}\n\nlet scene: InstanceType<typeof MapThreeScene>\n\nconst initPage = () => {\n  if (props.skyCode) {\n    backgroundLoad(scene, props.skyCode as typeof skys[number])\n  }\n  // 波纹板\n  if (props.corrugatedPlate) {\n    scene?.addCorrugatedPlate()\n  }\n\n  // 飞线\n  if (props.flywire && props.flywire.length) {\n    scene?.initFlywire(props.flywire)\n  }\n}\n\nonMounted(() => {\n  options.container = containerRef.value\n  scene = new MapThreeScene(\n    options,\n    props.config,\n    props.color,\n    // 鼠标 hover\n    (e, position) => {\n      let isShow = !!e\n      if (isShow) {\n        if (dialog.style) {\n          dialog.style.left = position.left + 'px'\n          dialog.style.top = position.top + 'px'\n        }\n        const isScatter = e.isScatter\n        const data = e.data\n        if (isScatter) {\n          data.isScatter = true\n          dialog.extend = data\n        } else {\n          const obj = (props.barList || []).find(it => it.name == e.name)\n          if (obj) {\n            dialog.extend = obj\n          } else {\n            isShow = false\n          }\n        }\n      }\n      show.value = isShow\n    },\n    // 点击事件\n    data => {\n      emits('click', toRaw(data))\n    }\n  )\n  scene.run()\n\n  emits('init', scene)\n  initPage()\n})\n\ndefineExpose({\n  exportImage: () => scene?.exportImage()\n})\n</script>\n\n<style lang=\"scss\" module>\n@import './style.scss';\n</style>\n","const base = import.meta.env.VITE_BEFORE_STATIC_PATH\n\nconst devEnv = import.meta.env.VITE_MODE !== 'production-'\n\nconst OPTS = {\n  // 地图深度\n  depth: 2,\n  // 地图缩放倍数\n  scale: 40,\n  // 波纹板半径\n  plateRadius: 100\n  // 判断点击间隔时间\n  // clickIntervalTime: 100\n}\n\n// 全局颜色\nconst COLOR = {\n  // 主色（地图面）\n  main: 0x338ad7,\n  mainHover: 0x92ffff,\n  // 边(区域侧边)\n  borderColor: 0x92ffff,\n  borderHoverColor: 0x10467a,\n  // 浅色\n  light: 0x10467a,\n  lightHover: 0x92ffff,\n  // 波纹板\n  plateColor: 0x338ad7,\n  plateLight: 0x10467a,\n  // 线条(地图区块上下线条)\n  line: 0x91dbf3,\n  line2: 0x61fbfd,\n  // 网格线\n  gridColor: 0x0a2036,\n  // 网格交叉\n  gridFork: 0x0e2843,\n  // 轮廓线\n  outline: 0xb4eafc,\n  // mark 颜色(光柱)\n  markColor1: 0xcaffff,\n  markColor2: 0x69f8ff,\n  // 飞线\n  flyColor1: 0x91dbf3,\n  flyColor2: 0x61fbfd,\n  // 散点\n  scatterColor1: 0x91dbf3,\n  scatterColor2: 0x61fbfd\n}\n\nexport const getPageOpts = (): {} & import('@/components/map-scene/index').Props => ({\n  devEnv: devEnv,\n  baseUrl: base,\n  // skyCode: '217',\n  bgColor: 0x071729,\n  color: COLOR,\n  config: {\n    ...OPTS,\n    areaLabel: true,\n    markLight: true,\n    // mapBg: false,\n    // bgOutFactor: 0.5,\n    // bgInnerFactor: 0.3,\n    map: {\n      // map: '/oss/textures/map/gz-map.jpg',\n      // normal: '/oss/textures/map/gz-map-fx.jpg',\n      // side: '/oss/textures/map/border.png',\n      // bgOutCircle: '/oss/textures/map/out-circle.png',\n      // bgInnerCircle: '/oss/textures/map/inner-circle.png'\n    }\n  },\n  camera: {\n    // helper: true,\n    position: [0, 100, 200]\n  },\n  directionalLight: {\n    helper: true\n  },\n  fog: {\n    visible: false,\n    near: 2000,\n    far: 3000\n  },\n  render: {\n    preserveDrawingBuffer: true\n  },\n  grid: {\n    visible: true,\n    gridColor: COLOR.gridColor,\n    centerLineColor: COLOR.gridColor,\n    fork: true,\n    divisions: 40,\n    width: OPTS.plateRadius * 2 * OPTS.scale,\n    forkSize: 1.4 * OPTS.scale,\n    forkColor: COLOR.gridFork\n  },\n  controls: {\n    maxPolarAngle: Math.PI * 0.46,\n    maxDistance: 5000,\n    enableDamping: true,\n    screenSpacePanning: false\n  },\n  axes: {\n    visible: true\n  },\n  mapJson: null,\n  outlineJson: null,\n  flywire: [],\n  barList: [],\n  scatters: []\n})\n","<template>\n  <div :class=\"$style.page\" class=\"h-100 o-h\">\n    <div :class=\"$style.operate\">\n      <el-button type=\"primary\" size=\"small\" @click=\"onExport\">导出</el-button>\n    </div>\n\n    <t-map-scene\n      ref=\"threeSceneRef\"\n      :dev-env=\"pageOpts.devEnv\"\n      :base-url=\"pageOpts.baseUrl\"\n      :bg-color=\"pageOpts.bgColor\"\n      :bg-url=\"pageOpts.bgUrl\"\n      :env=\"pageOpts.env\"\n      :sky-code=\"pageOpts.skyCode\"\n      :camera=\"pageOpts.camera\"\n      :cruise=\"pageOpts.cruise\"\n      :render=\"pageOpts.render\"\n      :controls=\"pageOpts.controls\"\n      :directional-light=\"pageOpts.directionalLight\"\n      :grid=\"pageOpts.grid\"\n      :axes=\"pageOpts.axes\"\n      :config=\"pageOpts.config\"\n      :color=\"pageOpts.color\"\n      :map-json=\"pageOpts.mapJson\"\n      :outline-json=\"pageOpts.outlineJson\"\n      :flywire=\"pageOpts.flywire\"\n      :bar-list=\"pageOpts.barList\"\n      :scatters=\"pageOpts.scatters\"\n      :bar-label-render=\"barLabelRender\"\n      @init=\"onInit\"\n      @click=\"onMapClick\"\n      @change-map=\"queryMap\"\n    >\n      <template #dialog=\"{ data }\">\n        <div :class=\"$style['dialog-view']\">\n          <div :class=\"$style.city\" class=\"flex\">\n            <span :class=\"$style.name\">{{ data.isScatter ? data.city : data.name }}</span>\n            <span :class=\"$style.total\">{{ data.total }}个项目</span>\n          </div>\n\n          <div :class=\"$style.project\" class=\"flex flex-ac\" v-if=\"data.isScatter\">\n            <img :src=\"`${pageOpts.baseUrl}/oss/img/map/pos.png`\" alt=\"\" />\n            <span :class=\"$style.name\">{{ data.name }}</span>\n          </div>\n\n          <div :class=\"$style.count\">\n            <div :class=\"$style.item\">\n              <span>今日用电量</span>\n              <span>{{ numConverter(data.value) }}</span>\n              <span>kWh</span>\n            </div>\n            <div :class=\"$style.item\" v-if=\"data.isScatter\">\n              <span>今日碳排放</span>\n              <span>{{ numConverter(data.carbon) }}</span>\n              <span>kgCO₂</span>\n            </div>\n          </div>\n        </div>\n      </template>\n    </t-map-scene>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport tMapScene from '@/components/map-scene/index.vue'\n\nimport * as request from './request'\nimport { getPageOpts } from './data'\n\nimport { numConverter } from '@/common/utils/reckon'\n\nimport { useResize } from '@/hooks/scene-resize'\nimport { Hooks } from 'three-scene'\n\nconst { load } = Hooks.useFileLoader()\n\nconst threeSceneRef = ref()\n\nconst pageOpts = reactive(getPageOpts())\n\nconst onExport = () => threeSceneRef.value?.exportImage()\n\nconst onInit = scene => {\n  const base = pageOpts.baseUrl\n\n  // 地图\n  load(`${base}/oss/map/china.json`).then(res => {\n    pageOpts.mapJson = res\n  })\n\n  // 轮廓\n  load(`${base}/oss/map/china-outline.json`).then(res => {\n    pageOpts.outlineJson = res\n  })\n\n  useResize(scene).resize()\n}\n\nconst onMapClick = data => {\n  console.log(data)\n  ElMessage.info({\n    message: data.name,\n    grouping: true\n  })\n}\n\nconst barLabelRender = item => {\n  const { name = '', value = 0, unit = '' } = item\n  return {\n    name: `\n      <div class=\"label-wrap\">\n        <div class=\"name\">${name}</div>\n        <div class=\"text\">\n          <span class=\"value\">${numConverter(value)}</span>\n          <span class=\"unit\">${unit}</span>\n        </div>\n      </div>\n    `,\n    className: 'map-bar-label'\n    // onClick: e => {console.log(e)}\n  }\n}\n\nconst queryMap = () => {\n  request.getMap().then(res => {\n    pageOpts.flywire = res.lines\n    pageOpts.scatters = res.projects\n    pageOpts.barList = res.citys\n  })\n}\n\nonMounted(() => {})\n</script>\n\n<style lang=\"scss\" module>\n@import './style.scss';\n</style>\n","import { Axios, Api } from '@/config'\n\n// 查询地图配置\nexport const getMap = () => {\n  return Axios.get(Api.d3.map).then(res => {\n    const projects: import('.').MapPoint[] = []\n    const citys: Partial<import('.').MapPoint>[] = []\n    res.list.forEach(item => {\n      const len = item.projects.length\n      let city = item.province\n      if (['重庆', '北京', '天津', '上海'].includes(city)) city = city + '市'\n      if (['台湾'].includes(city)) city = city + '省'\n      item.projects.forEach(it => {\n        projects.push({\n          coord: [it.lng, it.lat],\n          name: it.name,\n          carbon: it.carbon,\n          value: it.use,\n          total: len,\n          city: item.province,\n          id: it.id\n        })\n      })\n      const value = item.total\n      if (citys.findIndex(t => t.name === city) === -1) {\n        citys.push({\n          id: item.code,\n          name: city,\n          total: len,\n          value: value,\n          unit: 'kWh'\n        })\n      }\n    })\n\n    return {\n      citys,\n      projects,\n      lines: res.lines\n    }\n  })\n}\n"],"names":["CONFIG","depth","scale","plateRadius","clickIntervalTime","areaLabel","markLight","border","mapBg","mapBar","bgOutFactor","bgInnerFactor","map","COLOR$1","main","mainHover","borderColor","borderHoverColor","light","lightHover","plateColor","plateLight","line","line2","gridColor","gridFork","outline","markColor1","markColor2","flyColor1","flyColor2","scatterColor1","scatterColor2","Hooks","ThreeScene.Hooks","Utils","ThreeScene.Utils","initCSS3DRender","createCSS3DDom","useCSS3D","raycaster","pointer","style","update","raycasterUpdate","useRaycaster","createCorrugatedPlate","corrugatedPlateUpdate","useCorrugatedPlate","getBoundingBox","useCoord","createMarkLight","useMarkLight","createCountryFlatLine","getPoints","useCountryLine","createOutline","outlineUpdate","useOutline","createFlywireTexture","createFlywire","flywireUpdate","useFlywire","createBar","useMapBar","centerPos","x","y","z","textureLoader","THREE.TextureLoader","textureMap","normalTextureMap","sideTextureMap","outCircleTexture","innerRingTexture","getImgUrl","jpg","path","URL","Object","assign","self","location","href","transformUrl","defaultUrl","url","baseUrl","getUrl","createMapBlock","_this","points","shape","THREE.Shape","opts","config","bevelEnabled","bevelSegments","bevelThickness","steps","bevelSize","geometry","THREE.ExtrudeGeometry","material","THREE.MeshPhongMaterial","color","normalMap","combine","THREE.MultiplyOperation","transparent","opacity","sideMaterial","THREE.MeshLambertMaterial","COLOR","mesh","THREE.Mesh","setScalar","name","labelImg","createCSS3Dlabel","properties","group","centroid","center","lon","lat","label","className","position","rotateX","Math","PI","isLabel","add","createMarkLightPoint","height","min","max","floor","random","t","factor","createScatter","longitude","latitude","THREE.Group","size","circle","THREE.CircleGeometry","circleMat","THREE.MeshBasicMaterial","circleMesh","sphere","THREE.SphereGeometry","sphereMat","sphereMesh","set","MapThreeScene","ThreeScene.Scene","constructor","options","hoverBack","clickBack","super","__privateAdd","this","_hoverProvince","__publicField","_hoverBack","_clickBack","deepMerge","__privateSet","createClock","css3DRender","container","load","normal","side","wrapS","THREE.RepeatWrapping","wrapT","flipY","repeat","bgOutCircle","bgInnerCircle","createMaptexture","bindEvent","addCorrugatedPlate","corrugatedPlate","disposeObj","cpMh","range","renderOrder","addObject","initMap","geoJson","mapGroup","data","features","len","length","i","item","provinceObj","THREE.Object3D","coordinates","j","forEach","polygon","el","THREE.Vector2","isProvinceBlock","isProvinceGroup","mapJson","lineTop","lineBottom","scene","createBorderLine","box","resetSceneEle","width","outRingMesh","plane","THREE.PlaneGeometry","depthTest","createOutRing","innerRingMesh","createInnerRing","initMapOutLine","initFlywire","flywireGroup","flyColor","pointColor","coords","it","initMapBar","citys","labelRender","console","log","clearMapBar","value","color1","color2","getObjectByName","heightRatio","pos","bar","isBar","_a","traverse","initScatter","scatterGroup","coord","isScatter","onDblclick","_e","onPointerDown","e","isClick","tsp","timeStamp","onPointerMove","dom","setFromCamera","camera","objects","push","interscts","intersectObjects","cursor","object","puuid","pObj","findParentGroupGroupUuid","uuid","__privateMethod","call","setMapBlockColor","hoverProvince_fn","onPointerUp","button","clickObject","_find","obj","parent","isTarget","element","__privateGet","lookAt","s","TWEEN.Tween","to","easing","TWEEN.Easing","Quadratic","In","start","onUpdate","controls","target","THREE.Vector3","grid","getObjectByProperty","modelAnimate","dalte","clock","getDelta","render","offset","rotation","resize","setSize","dispose","WeakMap","WeakSet","backgroundLoad","skys","useBackground","transformGeoJSON","useConvertData","show","dialog","useDialog","left","top","extend","props","__props","containerRef","ref","emits","__emit","watch","v","setScale","json","outlineJson","barList","barLabelRender","flywire","list","scatters","unit","numConverter","bgUrl","env","bgColor","cruise","fog","axes","onMounted","isShow","find","toRaw","run","skyCode","__expose","exportImage","OPTS","useFileLoader","threeSceneRef","pageOpts","reactive","devEnv","directionalLight","helper","visible","near","far","preserveDrawingBuffer","centerLineColor","fork","divisions","forkSize","forkColor","maxPolarAngle","maxDistance","enableDamping","screenSpacePanning","onExport","onInit","base","then","res","useResize","onMapClick","ElMessage","info","message","grouping","queryMap","Axios","get","Api","d3","projects","city","province","includes","lng","carbon","use","total","id","findIndex","code","lines"],"mappings":"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"}