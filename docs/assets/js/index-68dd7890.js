var e=Object.defineProperty,t=(t,o,n)=>(((t,o,n)=>{o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n})(t,"symbol"!=typeof o?o+"":o,n),n);import{bz as o,bH as n,b4 as a,a_ as s,a$ as r,i,Y as l,bE as c,bF as d,bw as p,bx as u,bv as m,bG as h,bj as f,bB as y,bC as g,bD as b,e as v,w as _,l as x,aM as w,o as C,g as O,u as M,q as E,p as k,I as D,m as B,B as j,h as L,n as S,a9 as N,s as z,t as T,a5 as F,aH as U,aa as G,R}from"./vendor-fd8a184d.js";import{T as P,d as A,g as $,u as J}from"./scene-resize-e304954a.js";import{u as I}from"./raycaster-e549834a.js";import{_ as X,j as H,A as Q,k as K}from"./common-ce9ec953.js";const V={indexdb:{dbName:"THREE__MODEL__DB",tbName:"TB",version:1},mesh:{receiveShadowName:["地面","底座","底板","基础","基础底座","冷却塔基础"]},keys:{TEXT:"TEXT",JSQ:"JSQ",LDB:"LDB",LQB:"LQB",XBC:"XBC",LXJ:"LXJ",LGJ:"LGJ",LGJ_2:"LGJ_2",LGJ_3:"LGJ_3",LGJ_4:"LGJ_4",LQT:"LQT",GL:"GL",BSHRQ:"BSHRQ",BSHLQ:"BSHLQ",FLRB:"FLRB",FJY_X:"FJY_X",FJZ_X:"FJZ_X",FJY:"FJY",FJZ:"FJZ",FM:"FM",XFM:"XFM"},rightClickBackDiffTime:100,meshKey:{body:Symbol("__BODY_")}},{raycaster:Y,pointer:Z,update:W}=I(),{initCSS2DRender:q,createCSS2DDom:ee}={initCSS2DRender:(e,t)=>{const{width:n,height:a}=e,s=new o;return s.setSize(n,a),s.domElement.style.position="absolute",s.domElement.style.left="0px",s.domElement.style.top="0px",s.domElement.style.pointerEvents="none",t.appendChild(s.domElement),s},createCSS2DDom:e=>{const{name:t,className:o="",onClick:a,position:s}=e,r=document.createElement("div");r.innerHTML=t,r.className=o;const i=new n(r);return r.style.pointerEvents=a?"auto":"none",r.style.position="absolute","function"==typeof a&&r.addEventListener("click",a),s&&i.position.set(...s),i}};class te extends P{constructor(e,o){super(e),t(this,"deviceGroup"),t(this,"dotGroup"),t(this,"extend"),t(this,"css2DRender"),this.extend=o,this.css2DRender=q(this.options,this.container),this.css2DRender.domElement.className="three-scene__dot-wrap",this.deviceGroup=new a,this.bindEvent(),this.addDotGroup()}addDotGroup(){const e=new a;this.scene.add(e),this.dotGroup=e}createDot(e,t){const o=e.position,{size:n,color:a}=e.font||{},{x:s=0,y:r=0,z:i=0}=o||{},l=ee({name:`\n        <div class="bg"></div>\n        <span class="inner" style="${null!=n?`font-size: ${"string"==typeof n?n:n+"px"};`:""} ${null!=a?`color: ${a}`:""}"></span>\n      `,className:"dot-2D-label",position:[s,r,i],onClick:t});return l.name=e.name,l.data=e,l._position_={x:s,y:r,z:i},this.dotGroup.add(l),l}modelAnimate(){this.css2DRender.render(this.scene,this.camera),"function"==typeof this.extend.animateCall&&this.extend.animateCall()}onDblclick(e){var t;const o=this.container,n=this.options.scale;if(W(e,o,n),this.deviceGroup){Y.setFromCamera(Z,this.camera);const e=[this.deviceGroup],o=Y.intersectObjects(e);if(o.length){const e=o[0].object,n=this.findParentGroupGroup(e);if(!n)return;"function"==typeof(null==(t=this.extend)?void 0:t.onDblclick)&&this.extend.onDblclick(n)}}}onPointerMove(e){this.checkIntersectObjects(e)}onPointerUp(e){var t;super.onPointerUp(e);const o=e.timeStamp-this.pointer.tsp<V.rightClickBackDiffTime;2==e.button?o&&"function"==typeof(null==(t=this.extend)?void 0:t.onClickRight)&&this.extend.onClickRight(e):0==e.button?o&&this.checkIntersectObjects(e):e.button}checkIntersectObjects(e){var t,o;const n=this.container,a=this.options.scale;W(e,n,a);let s="pointerdown"==e.type||"pointerup"==e.type;const r=this.deviceGroup.children.filter((e=>e.visible&&e._isAnchor_));Y.setFromCamera(Z,this.camera);let i=Y.intersectObjects(r,s);if(n.style.cursor=i.length>0?"pointer":"auto",s)if(i.length){const e=i[0].object;if(!e)return;"function"==typeof(null==(t=this.extend)?void 0:t.onClickLeft)&&this.extend.onClickLeft(e)}else"function"==typeof(null==(o=this.extend)?void 0:o.onClickLeft)&&this.extend.onClickLeft()}findParentGroupGroup(e){const t=e=>{let o=e.parent;if(o)return o&&o._isDevice_?o:t(o)};return t(e)}clearDevice(){this.deviceGroup&&(this.disposeObj(this.deviceGroup),this.deviceGroup=new a,this.addObject(this.deviceGroup))}addDevice(...e){this.deviceGroup&&this.deviceGroup.add(...e)}getFloor(){return this.deviceGroup.children.filter((e=>e._isFloor_))}hideOmitFloor(e){this.deviceGroup.children.forEach((t=>{t.visible=t._isFloor_||e}))}getAll(){return this.deviceGroup.children.concat(this.dotGroup.children)}getFlowMark(e){return this.getAll().filter((t=>{var o;return(null==(o=t.data)?void 0:o.followMark)===e}))}getAnimTargetPos(e,t,o){const n=t||e.to||{x:-104,y:7,z:58},a=o||e.target||{x:0,y:0,z:0};return this.controls.target.set(a.x,a.y,a.z),n}getPosition(){}resize(){super.resize();const{width:e,height:t}=this.options;this.css2DRender.setSize(e,t)}}const oe={normal:{color:8954293,main:[8954293,2698801],text:12180479,FM:6319220},runing:{color:3045368,main:3045368,FM:422935},error:{color:12717056,main:11879461,FM:15215899}},ne=(e,t,o=1)=>{const n=e.position,a=e.rotation,s=e.scale,r=t.position||{x:0,y:0,z:0},i=t.rotation||{x:0,y:0,z:0},l=t.scale||{x:1,y:1,z:1},c=Math.abs(i.x)<2?1:180,d=Math.abs(i.y)<2?1:180,p=Math.abs(i.z)<2?1:180;return{position:[n.x+r.x,n.y+r.y,n.z+r.z],rotation:[a.x+Math.PI/c*i.x,a.y+Math.PI/d*i.y,a.z+Math.PI/p*i.z],scale:[s.x*o*l.x,s.y*o*l.y,s.z*o*l.z]}},ae=e=>e.map((e=>(e.children&&e.children.length>0?e.children=ae(e.children):e.material&&(e.material instanceof Array?e.material=e.material.map((e=>e.clone())):e.material=e.material.clone()),e))),se=e=>{let t=e.clone();return t.children=ae(t.children),t},re=e=>{let t=[];return Array.isArray(e)?t=e:null!=e&&(t=[e]),t},ie=(e,t)=>{e.traverse((e=>{e.isMesh&&(Array.isArray(e.material)?e.material.forEach((e=>{e.color.set(t)})):e.material.color.set(t))}))},le=(e,t,o)=>(e.lookAt(o),new Promise((n=>{new s(e.position).to(t,1e3).easing(r.Quadratic.In).start().onUpdate((()=>{e.lookAt(o)})).onComplete((()=>{n(e)}))}))),ce=e=>new Promise((t=>{const o=window.indexedDB.deleteDatabase(e);o.onsuccess=e=>{t(!0)},o.onerror=e=>{t(!1)}})),de=async(e,t="THREE__MODEL_DB",o=1)=>{if(!window.indexedDB)return Promise.resolve(void 0);await((e,t,o)=>new Promise((n=>{window.indexedDB.open(e).onsuccess=a=>{const s=a.target.result,r=s.version;s.close(),r!==t?ce(e).then((e=>{n(e?t:r)})):s.objectStoreNames.contains(o)?n(r):ce(e).then((e=>{n(e?t:r)}))}})))(t,o,e);let n=window.indexedDB.open(t,o);return new Promise((t=>{n.onupgradeneeded=t=>{const o=t.target.result;o.objectStoreNames.contains(e)||o.createObjectStore(e,{keyPath:"path"})},n.onsuccess=e=>{const o=e.target.result;t(o)},n.onerror=e=>{t(void 0)}}))},pe=(e={})=>{let t;const o=A({baseUrl:"",dracoPath:"/draco/gltf/",modelSizeKB:1048576,colors:{normal:{color:8954293},runing:{color:3045368},error:{color:12717056}},loadCache:!0,colorMeshName:[],indexDB:{cache:!0}},e),n=l({percentage:0,show:!1,isEnd:!1,list:[],total:0,loaded:0}),a={base:"base",device:"device",font:"font",sprite:"sprite",pipe:"pipe",warning:"warning",remote:"remote",local:"local",disabled:"disabled"},s=new Map,r=new c;r.setDecoderPath(o.baseUrl+o.dracoPath);const i=new d;i.setDRACOLoader(r);const v=e=>{const t=e.loaded,o=n.total;let a=Number((t+n.loaded)/o*100);a>100&&(a=100),n.percentage=Number(a.toFixed(2))},_=(e,t,n,a)=>{if(!n)return;const{baseUrl:r,colorMeshName:i}=o,{mapUrl:l,key:c,mapMeshName:d,repeat:f=[1,1]}=e;let y;l&&d&&(y=(new p).load($(l,r)),y.wrapS=u,y.wrapT=u,y.repeat.set(f[0],f[1]));const g=se(n);return g.traverse((e=>{e.isMesh&&y&&e.name.indexOf(d)?e.material=new m({side:h,transparent:!0,opacity:0,map:y.clone()}):((e,t=6776165,o,n)=>{const{type:a,name:s}=e;a.indexOf("Light"),V.mesh.receiveShadowName.some((e=>s.indexOf(e)>-1))?e.traverse((e=>{e.isMesh&&(e.receiveShadow=!0)})):o.some((e=>s.indexOf(e)>-1))?ie(e,t):e.isMesh&&(n&&(e.material.envMap=n),e.castShadow=!0)})(e,t,i||[])})),g.animations=a,s.set(c,g),g},x=(e,n=0)=>{const a=new d;return new Promise((async s=>{var r;o.indexDB.cache||s(null);const i=f.get(e);if(i)i instanceof ArrayBuffer?(v({loaded:i.byteLength}),a.parse(i,"",(t=>{f.add(e,t),s(t)}))):(v({loaded:n*o.modelSizeKB}),setTimeout((()=>{s(i)}),10));else{const n=await((e,t,o)=>{if(!e||!t||!o)return Promise.resolve(null);const n=e.transaction([t],"readonly").objectStore(t).get(o);return new Promise(((e,t)=>{n.onsuccess=t=>{const o=t.target.result;e(o)},n.onerror=e=>{t(e)}}))})(t,(null==(r=o.indexDB)?void 0:r.tbName)||V.indexdb.tbName,e);if(n&&n.data){const e=n.data;"string"==typeof e?(v({loaded:e.length}),f.add(n.path,e),setTimeout((()=>{s(e)}),10)):(v({loaded:e.byteLength}),a.parse(e,"",(e=>{f.add(n.path,e),s(e)})))}else s(null)}}))},w=e=>{var n;if(!o.indexDB.cache)return;const a=f.get(e);if(a&&t){const s=(null==(n=o.indexDB)?void 0:n.tbName)||V.indexdb.tbName;t.transaction(s,"readwrite").objectStore(s).add({path:e,data:a})}},C=(e,t)=>{const{key:n,url:a="",size:s=0}=e,{baseUrl:r,colors:l}=o;return new Promise((async(o,c)=>{let d=l.normal[n]||l.normal.color;d=re(d)[0];const p=$(a,r),u=await x(a,s);if(u){const t=u.scene.children[0],n=_(e,d,t,u.animations);return void o(n)}let m=p.split(".").pop().toLowerCase();if("glb"!==m)throw new Error("模型类型错误,必须为 GLB 格式，当前格式："+m);i.load(p,(t=>{let n=t.scene.children[0];const a=_(e,d,n,t.animations);w(p),o(a)}),(e=>{v(e),"function"==typeof t&&t(e)}),c)}))};let O;return{progress:n,MODEL_MAP:a,loadModel:C,loadModels:async(e,r,i)=>{var l,c,d;await de((null==(l=o.indexDB)?void 0:l.tbName)||V.indexdb.tbName,(null==(c=o.indexDB)?void 0:c.dbName)||V.indexdb.dbName,(null==(d=o.indexDB)?void 0:d.version)||V.indexdb.version).then((e=>(e&&(f.enabled=!0,t=e),e)));const u=e.length;if(!(0==u?(n.isEnd=!0,n.show=!1,0):(n.isEnd=!1,n.percentage=0,n.show=!0,1)))return;(e=>{for(let t=0;t<e.length;t++)n.total+=e[t].size*o.modelSizeKB})(e);let m=0;const h=async()=>{const t=e[m],{type:l=a.device,size:c=0}=t;switch(l){case a.device:await C(t,i);break;case a.sprite:(e=>{const{key:t,range:n={x:1,y:1},mapUrl:a=""}=e;let r=(new p).load(o.baseUrl+a),i=new y({map:r}),l=new g(i),c=n.x,d=n.y;l.scale.set(c,d,1),l.name="sprite",s.set(t,l)})(t);break;case a.font:(e=>{const{url:t="",size:n=0}=e,{baseUrl:a}=o,s=$(t,a),r=new b;new Promise((async e=>{const o=await x(s,n);if(o)return O=r.parse(JSON.parse(o)),void setTimeout((()=>{e(O)}),10);r.load(s,(o=>{O=o,w(t),e(o)}))}))})(t)}m++,n.loaded+=c*o.modelSizeKB,m>=u?r():h()};h()},getModel:e=>s.get(e)}},ue={key:0,class:"scene-operation"},me=X(v({__name:"index",props:{devEnv:{type:Boolean},baseUrl:{},dracoUrl:{default:""},bgColor:{},skyCode:{},bgUrl:{},env:{},scale:{},indexDB:{default:()=>({cache:!0})},camera:{default:()=>({})},cruise:{default:()=>({})},fog:{default:()=>({})},render:{default:()=>({})},controls:{default:()=>({})},grid:{default:()=>({})},axes:{default:()=>({})},models:{},config:{},objects:{},dotKey:{default:"DOT"},dotShowStrict:{type:Boolean,default:!0},colorMeshName:{default:()=>[]},getColorCall:{},formatObject:{},dotUpdateObjectCall:{},updateObjectCall:{},randomUpdateObjectCall:{},animationModelType:{},floorModelType:{},textModelType:{},anchorType:{default:()=>[]},mainBodyChangeColor:{type:Boolean},mainBodyMeshName:{default:()=>["主体"]}},emits:["init","loaded","update","select","dblclick","click-dot","click-dialog-dot"],setup(e,{expose:t,emit:o}){const n=e,{change:c,load:d}=((e="")=>{const t=["216","217","218","219","220","221","222","223","224","225"],o=i("/oss/img/sky"),n=t.findIndex((t=>t==e)),a=i(n<0?0:n),s=(e,t)=>{null==e||e.setBgTexture(["/posX.jpeg","/negX.jpeg","/posY.jpeg","/negY.jpeg","/posZ.jpeg","/negZ.jpeg"].map((e=>`${o.value}/${t}${e}`)))};return{skys:t,index:a,skyPath:o,change:e=>{const o=t[a.value];o&&(s(e,o),a.value++,a.value>=t.length&&(a.value=0))},load:s}})(),{progress:p,loadModel:u,loadModels:m,getModel:h}=pe({baseUrl:n.dracoUrl,colors:oe,colorMeshName:n.colorMeshName,indexDB:n.indexDB}),{dialog:f}={dialog:l({show:!1,style:{left:"",top:""},select:[],data:{},title:"",position:{top:0,left:0}})},y=o,g=i(),b=n.devEnv,v={baseUrl:n.baseUrl,bgUrl:n.bgUrl,env:n.env,bgColor:n.bgColor,camera:n.camera,cruise:n.cruise,fog:n.fog,render:n.render,grid:n.grid,controls:n.controls,axes:n.axes};let R;_((()=>n.dotShowStrict),(()=>P())),_((()=>n.scale),(e=>{null==R||R.setScale(e||1)})),_((()=>n.cruise.points),(e=>{R.setCruisePoint(e)}));const P=()=>{const e=R.dotGroup.children;for(let t=0;t<e.length;t++){const o=e[t];if(!o.data)continue;o.data.type===n.dotKey&&I(o)}},A=e=>{var t,o,a,i;const l=R.getFloor();if(0===l.length)return;const c=void 0!==e&&e>-1;if((null==(t=n.config)?void 0:t.floorExpandHiddenOther)&&R.hideOmitFloor(!c),l.forEach(((t,o)=>{var a,i,l;const d=t._position_;let p=o-(c?e:o);const u=(null==(a=n.config)?void 0:a.floorExpandMargin)||200,m=(null==(i=n.config)?void 0:i.floorExpandMode)||"UD",h=p*u,f=((null==d?void 0:d.y)??0)+h,y=e==o?((null==d?void 0:d.z)??0)+u:(null==d?void 0:d.z)??0;if("UD"===m){if(t.position.y===f)return}else if("BA"===m&&t.position.z===y)return;if(null==(l=t.data)?void 0:l.mark){const n=t.data.mark,a=R.getFlowMark(n);J(m,a,h,e==o?u:0)}new s(t.position).to({y:"UD"===m?f:t.position.y,z:"BA"===m?y:t.position.z},500).easing(r.Quadratic.Out).start()})),!(null==(o=n.config)?void 0:o.floorExpandChangeViewAngle))return;let d,p;if(c){const t=l[e]||{};d=null==(a=t.data)?void 0:a.to,d&&(p=(null==(i=t.data)?void 0:i.target)||t._position_)}d=R.getAnimTargetPos(n.config||{},d,p),$(d)||le(R.camera,d,R.controls.target)},$=e=>{const t=R.camera.position;return Math.abs(t.x-e.x)<1&&Math.abs(t.y-e.y)<1&&Math.abs(t.z-e.z)<1},J=(e,t,o,n)=>{0!==t.length&&t.forEach((t=>{const a=t._position_,i="UD"==e?((null==a?void 0:a.y)??0)+o:(null==a?void 0:a.y)??0,l="BA"==e?((null==a?void 0:a.z)??0)+n:(null==a?void 0:a.z)??0;new s(t.position).to({y:i,z:l},500).easing(r.Quadratic.Out).start()}))},I=e=>{var t;if("function"!=typeof n.dotUpdateObjectCall)throw Error("未传人点位更新对象回调方法 dotUpdateObjectCall");const o=e.data,a=n.dotUpdateObjectCall(o,R.deviceGroup);if("object"!=typeof a)throw Error("点位更新回调方法返回类型不是 Object，当前返回类型为："+typeof a);Object.keys(a).forEach((e=>{o[e]=a[e]})),e.visible=o.show||!n.dotShowStrict;const s=null==(t=e.element)?void 0:t.getElementsByClassName("inner")[0];if(s){const{size:e,color:t}=o.font||{};null!=e&&(s.style.fontSize="string"==typeof e?e:e+"px"),null!=t&&(s.style.color=t),s.textContent=`${o.value||0}${o.unit}`}},X=e=>{const t=((e,t,o)=>{let n=e.clientWidth/2,a=e.clientHeight/2,s=t.position.clone();const r=t.scale;s.y+=r.x/2;let i=s.project(o);return{left:i.x*n+n,top:-i.y*a+a}})(g.value,e,R.camera);return f.position=t,f.style.left=t.left+"px",f.style.top=t.top+"px",t},H=async e=>{var t;if(!e)return;const{type:o,url:s}=e,r=h(o);if(!r)return void(s?await(async e=>{const{type:t,url:o="",name:n}=e,a=await u({key:t,url:o,name:n,size:0}),{position:s,scale:r,rotation:i}=ne(a,e);return a.scale.set(...r),a.position.set(...s),a.rotation.set(...i),a._isBase_=!0,R.addDevice(a),Promise.resolve(a)})(e):o===n.dotKey&&(e=>{I(R.createDot(e,(e=>{})))})(e));const i=n.floorModelType||[],l=n.anchorType||[];let c=se(r);const{position:d,scale:p,rotation:m}=ne(c,e),[f,y,g]=d;c.scale.set(...p),c.position.set(f,y,g),c.rotation.set(...m);if((n.animationModelType||[]).includes(o)){if("Group"!==c.type){const e=new a;e.add(c),c=e}if(n.mainBodyChangeColor){const e=((null==(t=c.children[0])?void 0:t.children)||[]).filter((e=>(n.mainBodyMeshName||[]).some((t=>e.name.indexOf(t)>-1)))),o=oe.normal;let a=o.main||o.color,s=re(a);s.length&&e.forEach(((e,t)=>{ie(e,s[t%s.length])})),c[V.meshKey.body]=e}}return c._isDevice_=!0,c.data=e,i.includes(o)&&(c._position_={x:f,y:y,z:g},c._isFloor_=!0),l.includes(o)&&(c._isAnchor_=!0),R.addDevice(c),Promise.resolve()},Q=i([]),K=async()=>{var e,t,o,a;p.percentage=100,p.show=!1,R.clearDevice(),await G(),(()=>{Q.value.length=0;const e=w(n.objects)||[];if("function"!=typeof n.formatObject)throw Q.value=e,Error("未传入格式化函数 formatObject");{const t=n.formatObject(e);Q.value=t}})(),await(()=>{let e=0,t=Q.value.length;return new Promise((o=>{if(0==t)return o(null);const n=async()=>{const a=Q.value[e];await H(a),e++,e<t?n():o(e)};n()}))})(),R.createCruise(),"function"==typeof(null==(e=n.config)?void 0:e.load)&&(null==(t=n.config)||t.load(R));const s=(null==(o=n.config)?void 0:o.floorExpandIndex)||-1,r=R.getAnimTargetPos(n.config||{}),i=R.getFloor();s>-1&&i.length?(A(s),(null==(a=n.config)?void 0:a.floorExpandChangeViewAngle)||le(R.camera,r,R.controls.target).then((()=>{y("loaded")}))):le(R.camera,r,R.controls.target).then((()=>{y("loaded")}))},Y=()=>{m(n.models,(()=>{K()})),n.skyCode&&d(R,n.skyCode)},Z=()=>{const e=[];if("function"!=typeof n.randomUpdateObjectCall)throw Error("未传入随机更新回调函数 randomUpdateObjectCall");R.getAll().forEach(((t,o)=>{if(!t.data)return;const a=t.data;let s=a.type;if(s===n.dotKey)return void I(t);const r=n.randomUpdateObjectCall(a);if(!r)return;if("object"!=typeof r)throw Error("更新回调函数返回对象不为 Object，当前类型："+typeof r);Object.keys(r).forEach((e=>{a[e]=r[e]})),e.push(w(a));let{status:i=0,error:l=0,remote:c=0,local:d=0,disabled:p=0}=a;const u=oe[l>0?"error":i>0?"runing":"normal"];let m=u[s]||u.color;if("function"==typeof n.getColorCall){const e=n.getColorCall(a);e&&(m=e)}W({type:s,el:t,colorObj:u,color:m,paused:0==i,error:l>0,remote:c>0,local:d>0,disabled:p>0})})),y("update",e,!0)},W=e=>{let{el:t,colorObj:o,color:a,type:s,paused:r,error:i}=e,l=re(a);a=l[0];const c=t.extra;if(c&&(c.action&&(c.action.paused=r),null!=a)){(c.meshs||[]).forEach((e=>{ie(e,a)}))}if(n.mainBodyChangeColor&&t[V.meshKey.body]){const e=o.main;let n=re(e);n.length&&t[V.meshKey.body].forEach(((e,t)=>{ie(e,n[t%n.length])}))}};return x((()=>{v.container=g.value,R=new te(v,{onDblclick:e=>{const t=e.data,o=R.getFloor().findIndex((t=>e.uuid===t.uuid));"function"==typeof t.onDblclick&&t.onDblclick(w(t),e,o),o>-1&&A(o)},onClickLeft(e){e?(f.select=[e],y("select",e),(()=>{const e=f.select[0],t=e.data;f.data=t,f.title=(null==t?void 0:t.name)||"";const o=X(e);y("click-dialog-dot",t,o)})()):f.select=[],f.show=!!e},onClickRight:e=>{var t;"function"==typeof(null==(t=n.config)?void 0:t.back)?n.config.back(R):A(-1)},animateCall:()=>{if(f.show&&f.select.length){const e=f.select[0];X(e)}}}),R.run(),y("init",R),Y()})),t({floorAnimate:A}),(e,t)=>{const o=U;return C(),O("div",{class:S(e.$style["floor-scene"])},[M(b)?(C(),O("div",ue,[E(o,{type:"success",onClick:Z},{default:k((()=>t[4]||(t[4]=[D("随机更新")]))),_:1}),e.cruise.visible?(C(),B(o,{key:0,onClick:t[0]||(t[0]=()=>{var e;return null==(e=M(R))?void 0:e.toggleCruise()}),type:"danger"},{default:k((()=>t[5]||(t[5]=[D("定点巡航")]))),_:1})):j("",!0),E(o,{onClick:t[1]||(t[1]=()=>{var e;return null==(e=M(R))?void 0:e.getPosition()}),type:"success"},{default:k((()=>t[6]||(t[6]=[D("场景坐标")]))),_:1}),E(o,{type:"warning",onClick:t[2]||(t[2]=()=>M(c)(M(R)))},{default:k((()=>t[7]||(t[7]=[D("切换背景")]))),_:1})])):j("",!0),L("div",{class:S(e.$style.container),ref_key:"containerRef",ref:g},null,2),M(p).show?(C(),O("div",{key:1,class:S(["loading",e.$style.loading]),style:N({"--bg-color":e.bgColor?String(e.bgColor):""}),onDblclick:t[3]||(t[3]=z((()=>{}),["stop"]))},[L("div",{class:S(e.$style.progress),style:N({"--percentage":M(p).percentage+"%"})},[L("div",{class:S(e.$style["bar-out"])},[L("div",{class:S(e.$style.bar)},null,2)],2),L("div",{class:S(e.$style.text)},T(M(p).percentage)+"%",3)],6)],38)):j("",!0),M(f).show?(C(),O("div",{key:2,class:S(e.$style.dialog),style:N(M(f).style)},[F(e.$slots,"dialog",{data:M(f).data,title:M(f).title,position:M(f).position})],6)):j("",!0)],2)}}}),[["__cssModules",{$style:{"floor-scene":"_floor-scene_130hp_2",container:"_container_130hp_8",loading:"_loading_130hp_12",progress:"_progress_130hp_27","bar-out":"_bar-out_130hp_31",bar:"_bar_130hp_31","striped-flow":"_striped-flow_130hp_1",text:"_text_130hp_47",dialog:"_dialog_130hp_63"}}]]),he={class:"flex flex-ac"},fe={class:"flex flex-ac"},ye=X(v({__name:"index",setup(e){const t=K(),o=l({devEnv:!0,baseUrl:"",bgColor:"",skyCode:"221",render:{alpha:!0},env:"/oss/textures/hdr/skidpan_2k.hdr",camera:{far:1e6},cruise:{visible:!0,helper:!0,points:[[450,1,450],[450,1,-450],[-450,1,-450],[-450,1,450]]},controls:{screenSpacePanning:!1,maxDistance:5e4,maxPolarAngle:.46*Math.PI},grid:{visible:!0},models:[{key:"FLOOR_ONE",name:"大堂",size:8.5,url:"/1楼.glb"},{key:"FLOOR_COMMON",name:"楼层",size:13.7,url:"/楼层.glb"},{key:"FLOOR_ATTIC",name:"楼顶",size:.1,url:"/楼顶.glb"},{key:"COLD_CAMERA",name:"摄像头",type:"sprite",size:1,range:{x:37,y:77},mapUrl:"/sxt.png"},{key:"COLD_ROOM_INLET",name:"房间入口",type:"sprite",size:1,range:{x:37,y:77},mapUrl:"/fjdw.png"},{key:"COLD_GPS",name:"定位",type:"sprite",size:1,range:{x:51,y:56},mapUrl:"/dw.png"}].map((e=>(e.url&&(e.url="/oss/model/floor"+e.url),e.mapUrl&&(e.mapUrl="/oss/textures/floor"+e.mapUrl),e))),objects:[],config:{},indexDB:{cache:!0,dbName:"THREE__FLOOR__DB",tbName:"TB",version:1},dotShowStrict:!1,colorMeshName:[],floorModelType:["FLOOR_COMMON","FLOOR_ONE","FLOOR_TWO_FIVE","FLOOR_SIX","FLOOR_SEVEN_ELEVEN","FLOOR_TWELVE_THIRTEEN","FLOOR_FOURTEEN_SIXTEEN","FLOOR_SEVENTEEN_EIGHTEEN"],anchorType:["COLD_CAMERA","COLD_ROOM_INLET","COLD_GPS"],mainBodyChangeColor:!0,mainBodyMeshName:["立方体062"],animationModelType:["FLOOR_COMMON"]}),n=i(),a=e=>t.formatData(e),s=(e,t)=>{const o=40*Math.random();return void 0!==o&&(e.value=o),e.show=Math.random()>.5,e.value=Number(Number(e.value||0).toFixed(2)),{value:e.value,show:e.show,font:{...e.font||{},color:e.value>35?"#f00":null}}},r=e=>{const t=Math.random()>.5?1:0,o=Math.random()>.5?1:0,n=Math.random()>.8?1:0,a=Math.floor(3*Math.random());return{status:n>0?0:t,error:n>0?0:o,remote:1==a?1:0,local:2==a?1:0,disabled:n}},c=e=>{J(e).resize()},d=()=>{const e=[[450,1,450],[450,1,-450],[-450,1,-450],[-450,1,450]].map((e=>e.map((e=>e*(.5-.5*Math.random()+1)))));o.cruise&&(o.cruise.points=e)};return x((()=>{H.get(Q.d3.floor).then((e=>{let t=e.JsonList;const n=e.ModelUrl;t.unshift({name:e.Name,type:"",url:n?`${o.baseUrl}${n}`:""});let a={};if(e.ConfigJson instanceof Object)a=e.ConfigJson;else if("string"==typeof e.ConfigJson)try{a=JSON.parse(e.ConfigJson)}catch(s){}Object.keys(a).forEach((e=>{o.config&&(o.config[e]=a[e])})),o.objects=t}))})),(e,t)=>{const i=R,l=U;return C(),O("div",{class:S([e.$style.page,"h-100 o-h"])},[L("div",{class:S(e.$style.operate)},[L("div",he,[t[1]||(t[1]=L("span",null,"点位：",-1)),E(i,{modelValue:M(o).dotShowStrict,"onUpdate:modelValue":t[0]||(t[0]=e=>M(o).dotShowStrict=e),"active-text":"严格","inactive-text":"全显","inline-prompt":""},null,8,["modelValue"])]),L("div",fe,[E(l,{type:"success",onClick:d},{default:k((()=>t[2]||(t[2]=[D("切换巡航点位")]))),_:1})])],2),E(me,{ref_key:"threeSceneRef",ref:n,"dev-env":M(o).devEnv,"base-url":M(o).baseUrl,"bg-color":M(o).bgColor,"bg-url":M(o).bgUrl,env:M(o).env,indexDB:M(o).indexDB,"sky-code":M(o).skyCode,camera:M(o).camera,cruise:M(o).cruise,render:M(o).render,controls:M(o).controls,grid:M(o).grid,config:M(o).config,models:M(o).models,"anchor-type":M(o).anchorType,"dot-show-strict":M(o).dotShowStrict,"floor-model-type":M(o).floorModelType,"main-body-change-color":M(o).mainBodyChangeColor,"main-body-mesh-name":M(o).mainBodyMeshName,"animation-model-type":M(o).animationModelType,objects:M(o).objects,"format-object":a,"dot-update-object-call":s,"random-update-object-call":r,onInit:c},{dialog:k((({data:t,title:o})=>[L("div",{class:S(e.$style["dialog-wrap"])},[L("div",{class:S(e.$style.circle)},null,2),L("div",{class:S(e.$style.line)},null,2),L("div",{class:S(e.$style.content)},[L("div",{class:S(e.$style.title)},T(o),3),L("div",{class:S(e.$style.data)},T(t),3)],2)],2)])),_:1},8,["dev-env","base-url","bg-color","bg-url","env","indexDB","sky-code","camera","cruise","render","controls","grid","config","models","anchor-type","dot-show-strict","floor-model-type","main-body-change-color","main-body-mesh-name","animation-model-type","objects"])],2)}}}),[["__cssModules",{$style:{page:"_page_m4oc3_2",operate:"_operate_m4oc3_8","dialog-wrap":"_dialog-wrap_m4oc3_16",circle:"_circle_m4oc3_22",line:"_line_m4oc3_52",content:"_content_m4oc3_78",title:"_title_m4oc3_85",data:"_data_m4oc3_89"}}]]);export{ye as default};
