var e,t,s,a,o=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},n=(e,t,s)=>(o(e,t,"read from private field"),s?s.call(e):t.get(e)),i=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},r=(e,t,s,a)=>(o(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s),l=(e,t,s)=>(o(e,t,"access private method"),s);import{c1 as c,ca as p,bs as g,be as d,cb as u,cc as m,c0 as h,cd as f,bw as v,ce as y,cf as w,bd as b,cg as x,bh as C,bc as k,ch as j,ci as S,b6 as I,ba as M,bk as A,bp as P,bO as L,ck as O,cw as _,cx as z,cz as U,bX as R,c3 as B,cy as G,i as E,co as F,cq as D,cS as T,bW as X,bP as Y,bV as J,d9 as W,da as $,bo as Z,db as N,c4 as V,dc as K,b$ as Q,e as H,w as q,l as ee,aP as te,o as se,g as ae,h as oe,n as ne,u as ie,a9 as re,a5 as le,B as ce,Y as pe,q as ge,p as de,I as ue,t as me,c as he,ak as fe}from"./vendor-16889df9.js";import{_ as ve,a as ye,b as we,c as be,d as xe,e as Ce,f as ke,g as je,h as Se,i as Ie,j as Me,k as Ae,l as Pe,m as Le,n as Oe,o as _e,p as ze,q as Ue,r as Re,s as Be,t as Ge,v as Ee,w as Fe,x as De,y as Te,z as Xe,A as Ye,B as Je,C as We,D as $e,E as Ze,F as Ne,G as Ve,H as Ke,I as Qe,J as He,K as qe,L as et,M as tt,N as st,O as at,P as ot,Q as nt,R as it,S as rt,T as lt,U as ct,V as pt,W as gt,X as dt,Y as ut,Z as mt,$ as ht,a0 as ft,a1 as vt,a2 as yt,a3 as wt,a4 as bt,a5 as xt,a6 as Ct,a7 as kt,a8 as jt,a9 as St,aa as It,ab as Mt,ac as At,u as Pt}from"./background-b37af10e.js";import{g as Lt,_ as Ot,a as _t,b as zt,c as Ut,d as Rt,e as Bt,f as Gt,h as Et,i as Ft,j as Dt,k as Tt,l as Xt,m as Yt,n as Jt,o as Wt,p as $t,q as Zt}from"./asssets-c6facb32.js";import{S as Nt}from"./index-807de784.js";import{d as Vt,D as Kt}from"./object-fb68a4c2.js";import{r as Qt}from"./random-8d361657.js";import{g as Ht,n as qt}from"./convert-17a5875b.js";import{u as es}from"./raycaster-7977e527.js";import{u as ts}from"./dialog-7350ae61.js";import{_ as ss,e as as,A as os,n as ns}from"./index-c95106e6.js";import{u as is}from"./scene-resize-81793ab7.js";const rs=()=>({initCSS3DRender:(e,t)=>{const{width:s,height:a}=e,o=new v;return o.setSize(s,a),o.domElement.style.position="absolute",o.domElement.style.left="0px",o.domElement.style.top="0px",o.domElement.style.pointerEvents="none",t.appendChild(o.domElement),o},createCSS3DDom:e=>{const{name:t,className:s="",onClick:a,position:o,sprite:n}=e,i=document.createElement("div");i.innerHTML=t,i.className=s;const r=n?new y(i):new w(i);return i.style.pointerEvents=a?"auto":"none",i.style.position="absolute","function"==typeof a&&i.addEventListener("click",a),o&&r.position.set(...o),r}}),{createCSS3DDom:ls}=rs(),cs={depth:1,scale:40,plateRadius:200,rightClickBackDiffTime:100,areaLabel:!1,markLight:!1,border:!0,mapBg:!0,mapBar:!0,bgOutFactor:1,bgInnerFactor:.9,map:{}},ps={main:3377879,mainHover:9633791,borderColor:9633791,borderHoverColor:1066618,light:1066618,lightHover:9633791,plateColor:3377879,plateLight:1066618,line:9559027,line2:6421501,gridColor:663606,gridFork:927811,outline:11856636,markColor1:13303807,markColor2:6945023,flyColor1:9559027,flyColor2:6421501,scatterColor1:9559027,scatterColor2:6421501},{initCSS3DRender:gs,createCSS3DDom:ds}=rs(),{raycaster:us,pointer:ms,style:hs,update:fs}=es(),{createCorrugatedPlate:vs,corrugatedPlateUpdate:ys}=((e={})=>{let t=Vt({range:100,interval:.8,size:.2,color:47273,light:881527,factor:1},e);const s=(e,t)=>{const s=e.material,a=s.uniforms.uRange.value,o=s.uniforms.uLength.value;s.uniforms.uRadius.value+=t*(a/4),s.uniforms.uRadius.value>=a+o&&(s.uniforms.uRadius.value=0)};return{createCorrugatedPlate:(e={})=>{t=Vt(t,e);let{range:s,color:a,light:o,factor:n}=t;s*=n;const i=(()=>{let{range:e,interval:s,size:a,factor:o}=t;e*=o,s*=o,a*=o;const n=[],i=Math.floor(e/s);for(let t=-i;t<=i;t++)for(let e=-i;e<=i;e++){const o=new M(a,a),i=t*s,r=e*s,l=new _,c=new d(i,-a,r),p=new U,g=new z,u=new d(1,1,1);p.setFromEuler(g),l.compose(c,p,u),o.applyMatrix4(l),n.push(o)}return n})(),r=O(i),l=new x({uniforms:{uColor:{value:new C(o)},uTcolor:{value:new C(a)},uRadius:{value:1.25},uLength:{value:s/10},uRange:{value:s}},vertexShader:"\n        varying vec3 vp;\n        void main(){\n          vp = position;\n          gl_Position\t= projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        varying vec3 vp;\n        uniform vec3 uColor;\n        uniform vec3 uTcolor;\n        uniform float uRadius;\n        uniform float uLength;\n        float getLeng(float x, float y){\n          return  sqrt((x-0.0)*(x-0.0)+(y-0.0)*(y-0.0));\n        }\n        void main(){\n          float uOpacity = 0.8;\n          vec3 vColor = uColor;\n          float length = getLeng(vp.x,vp.z);\n          if ( length <= uRadius && length > uRadius - uLength ) {\n            float op = sin( (uRadius - length) / uLength ) ;\n            uOpacity = op;\n            if ( vp.y < 0.0 ) {\n              vColor = uColor * op;\n            } else {\n              vColor = uTcolor;\n            };\n            vColor = uTcolor;\n          }\n          gl_FragColor = vec4(vColor,uOpacity);\n        }\n      ",transparent:!0,depthWrite:!1,side:P}),c=new k(r,l);return c.name="波纹板",c},update:s,corrugatedPlateUpdate:s}})(),{getBoundingBox:ws}={getBoundingBox:e=>{var t=new D;t.expandByObject(e);var s=new d;t.getSize(s);var a=new d;return t.getCenter(a),{box3:t,center:a,size:s}}},{createMarkLight:bs}=((e={})=>{let t=Vt({pointTextureUrl:Lt("point.png"),circleTextureUrl:Lt("circle.png"),lightTextureUrl:Lt("light.png"),factor:1,color:65535},e);const s=new I;return{createMarkLight:(e=[0,0,0],a=10,o={})=>{t=Vt(t,o);const n=new g,i=new M(a/6.219,a);i.rotateX(-Math.PI/2),i.translate(0,0,a/2);const r=new A({map:s.load(t.lightTextureUrl),color:t.color,transparent:!0,depthWrite:!1,side:P});let l=new k(i,r);l.rotateX(Math.PI),l.position.z=a,l.renderOrder=3,l.name="光柱 01";let c=l.clone();c.name="光柱 02",c.rotateZ(Math.PI/2);const p=(()=>{const e=new M(3,3),a=new A({map:s.load(t.pointTextureUrl),color:t.color,side:P,transparent:!0,depthWrite:!1});let o=new k(e,a);o.renderOrder=1,o.name="底部光点";const n=.3*t.factor;return o.scale.setScalar(n),o})(),d=(()=>{const e=new M(3,3),a=new A({map:s.load(t.circleTextureUrl),color:t.color,side:P,opacity:0,transparent:!0,depthWrite:!1});let o=new k(e,a);o.renderOrder=2,o.name="createLightHalo";const n=.5*t.factor;o.scale.setScalar(n);const i=Qt(0,2e3);return o.tween1=new L({scale:n,opacity:0}).to({scale:1.5*n,opacity:1},1e3).delay(i).onUpdate((e=>{let{scale:t,opacity:s}=e;o.scale.setScalar(t),o.material.opacity=s})),o.tween2=new L({scale:1.5*n,opacity:1}).to({scale:2*n,opacity:0},1e3).onUpdate((e=>{let{scale:t,opacity:s}=e;o.scale.setScalar(t),o.material.opacity=s})),o.tween1.chain(o.tween2),o.tween2.chain(o.tween1),o.tween1.start(),o})();n.add(l,c,p,d);const[u,m,h]=e;return n.position.set(u,m,h),n.rotateX(.5*Math.PI),n.name="光柱标记",n}}})(),{createCountryFlatLine:xs,getPoints:Cs}=(()=>{const e=(e,t,s="LineLoop")=>{let a;if("Line2"===s){const s=new u;s.setPositions(e),a=new m(s,t),a.name="countryLine2",a.computeLineDistances()}else{const o=new h;o.setFromPoints(e),a=new f[s](o,t),a.name="countryLine"}return a};return{createCountryFlatLine:(t,s,a="LineLoop")=>{let o={color:65535,linewidth:1,depthTest:!1};o=Vt(o,s);let n=new c(o);"Line2"===a&&(n=new p(o));let i=t.features,r=new g;for(let l=0;l<i.length;l++){const t=i[l].geometry.coordinates;for(let s=0;s<t.length;s++){const o=t[s],i=[];"Line2"===a?o.forEach((e=>{e.forEach((e=>{i.push(e[0],0,-e[1])}))})):o.forEach((e=>{e.forEach((e=>{i.push(new d(e[0],e[1],0))}))}));let l=e(i,n,a);r.add(l)}}return r},getPoints:(e,t=0,s)=>{let a=e.features;const o=[];for(let n=0;n<a.length;n++){const e=a[n].geometry.coordinates;for(let a=0;a<e.length;a++)e[a].forEach((e=>{e.forEach((e=>{s?o.push(new d(e[0],t,-e[1])):o.push(e[0],t,-e[1])}))}))}return o}}})(),{createOutline:ks,outlineUpdate:js}=((e={})=>{let t=Vt({size:.1,color:16085360,range:500,factor:1,speed:6},e);const s=e=>{const s=e.material,a=s.uniforms.uLength.value;s.uniforms.uIndex.value+=t.speed,s.uniforms.uIndex.value>=a&&(s.uniforms.uIndex.value=0)};return{createOutline:(e,s={})=>{t=Vt(t,s);const{size:a,factor:o,range:n,color:i}=t,r=new Float32Array(e),l=new h;l.setAttribute("position",new j(r,3));const c=new Float32Array(Math.floor(r.length/3)).map(((e,t)=>t));l.setAttribute("aIndex",new j(c,1));const p=new x({vertexShader:"\n        attribute float aOpacity;\n        uniform float uSize;\n\n        attribute float aIndex;\n        varying vec3 vp;\n        varying float vertexIndex;\n\n        void main(){\n          gl_Position = projectionMatrix*modelViewMatrix*vec4(position,1.0);\n          gl_PointSize = uSize;\n\n          vp = position;\n          vertexIndex = aIndex;\n        }\n      ",fragmentShader:"\n        varying float vertexIndex;\n        uniform vec3 uColor;\n        uniform float uIndex;\n        uniform float uRange;\n\n        float invert(float n){\n          return 1.-n;\n        }\n\n        void main(){\n          float uOpacity = 1.0;\n          if(vertexIndex <= uIndex || vertexIndex >= (uRange + uIndex)){\n              discard;\n          }\n          uOpacity = (vertexIndex - uIndex)/uRange;\n          if ( uOpacity < 0.2) {\n            discard;\n          }\n          vec2 uv=vec2(gl_PointCoord.x,invert(gl_PointCoord.y));\n          vec2 cUv=2.*uv-1.;\n          vec4 color=vec4(1./length(cUv));\n          color*=uOpacity;\n          color.rgb*=uColor;\n          gl_FragColor=color;\n        }\n      ",transparent:!0,depthTest:!1,uniforms:{uSize:{value:a*o},uIndex:{value:0},uLength:{value:c.length},uRange:{value:n},uColor:{value:new C(i)}}}),g=new S(l,p);return g.name="轮廓",g.scale.setScalar(o),g},update:s,outlineUpdate:s}})(),{createFlywireTexture:Ss,createFlywire:Is,flywireUpdate:Ms}=((e={})=>{let t,s,a=Vt({depth:0,height:4,divisions:1e3,color:16777215,flyColor:16761095,pointColor:16715760,pointWidth:2.5,flyPointWidth:2.4,tubularSegments:256,radius:.5,radialSegments:8,closed:!1,length:100,factor:1,speed:4},e);const o=e=>{const[t,o]=e;let{pointWidth:n,depth:i,factor:r}=a;const l=n*r;i*=r;const c=new M(l,l,1,1),p=new k(c,s);return p.position.set(t,i,-o),p.rotateX(.5*-Math.PI),p},n=(e={})=>{a=Vt(a,e),t=new x({depthTest:!1,uniforms:{uColor:{value:new C(a.flyColor)},uIndex:{value:0},uTotal:{value:a.divisions},uWidth:{value:a.flyPointWidth},uLength:{value:a.length}},vertexShader:["attribute float aIndex;","uniform float uIndex;","uniform float uWidth;","uniform vec3 uColor;","varying float vSize;","uniform float uLength;","void main(){","    vec4 viewPosition = viewMatrix * modelMatrix * vec4(position,1);","    gl_Position = projectionMatrix * viewPosition;","    if(aIndex >= uIndex - uLength && aIndex < uIndex){","      vSize = uWidth * ((aIndex - uIndex + uLength) / uLength);","    }","    gl_PointSize = vSize;","}"].join(""),side:P,fragmentShader:["varying float vSize;","uniform vec3 uColor;","void main(){","    if(vSize<=0.0){","      gl_FragColor = vec4(1,0,0,0);","    }else{","      gl_FragColor = vec4(uColor,1);","    }","}"].join(""),transparent:!0,vertexColors:!1}),s=new x({uniforms:{uColor:{value:new C(a.pointColor)},uOpacity:{value:1},uSpeed:{value:.1},uSge:{value:4},uRadius:{value:a.pointWidth*a.factor/2},time:{value:0}},transparent:!0,depthTest:!1,vertexShader:["varying vec2 vUv;","void main() {","  vUv = uv;","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(""),fragmentShader:["varying vec2 vUv;","uniform vec3 uColor;","uniform float uOpacity;","uniform float uSpeed;","uniform float uSge;","uniform float time;","float PI = 3.14159265;","float drawCircle(float index, float range) {","  float opacity = 1.0;","  if (index >= 1.0 - range) {","    opacity = 1.0 - (index - (1.0 - range)) / range;","  } else if(index <= range) {","    opacity = index / range;","  }","  return opacity;","}","float distanceTo(vec2 src, vec2 dst) {","  float dx = src.x - dst.x;","  float dy = src.y - dst.y;","  float dv = dx * dx + dy * dy;","  return sqrt(dv);","}","void main() {","  float iTime = -time * uSpeed;","  float opacity = 0.0;","  float len = distanceTo(vec2(0.5, 0.5), vec2(vUv.x, vUv.y));","  float size = 1.0 / uSge;","  vec2 range = vec2(0.65, 0.75);","  float index = mod(iTime + len, size);","  vec2 cRadius = vec2(0.06, 0.12);","  if (index < size && len <= 0.5) {","    float i = sin(index / size * PI);","    if (i >= range.x && i <= range.y){","      // 归一","      float t = (i - range.x) / (range.y - range.x);","      // 边缘锯齿范围","      float r = 0.3;","      opacity = drawCircle(t, r);","    }","    // 渐变","    opacity *=  1.0 - len / 0.5;","  };","  gl_FragColor = vec4(uColor, uOpacity * opacity);","}"].join("\n"),side:P})},i=()=>{const e=t,o=e.uniforms.uTotal.value;e.uniforms.uIndex.value+=a.speed,e.uniforms.uIndex.value>=o&&(e.uniforms.uIndex.value=0);const n=.001*performance.now();s.uniforms.time.value=n};return n(),{createFlywireTexture:n,createFlywire:e=>{const s=new g,n=o(e[0]),i=o(e[1]);s.add(n,i);const r=(e=>{const[t,s]=e[0],[o,n]=e[1];let{depth:i,height:r,factor:l,divisions:c}=a;r=(i+r)*l,i*=l;const p=new d(t,i,-s),g=new d(t+(o-t)/4,r,-(s+(n-s)/4)),u=new d(t+3*(o-t)/4,r,-(s+3*(n-s)/4)),m=new d(o,i,-n);return new G(p,g,u,m).getPoints(c)})(e),l=new R(r,!1,"centripetal",.5),c=new B(l,a.tubularSegments,a.radius,a.radialSegments,a.closed),p=new x({transparent:!0,opacity:1,depthTest:!1,vertexColors:!1,uniforms:{uColor:{value:new C(a.color)},uOpacity:{value:.6}},vertexShader:["varying vec3 vColor;","uniform vec3 uColor;","void main() {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join(""),fragmentShader:["uniform vec3 uColor;","uniform float uOpacity;","void main() {","  gl_FragColor = vec4(uColor, uOpacity);","}"].join("")}),u=new k(c,p);u.renderOrder=10;const m=(e=>{const s=new Float32Array(e.map(((e,t)=>t))),a=(new h).setFromPoints(e);return a.setAttribute("aIndex",new j(s,1)),new S(a,t)})(r);return s.add(u,m),s},update:i,flywireUpdate:i}})(),{createBar:As}=((e={})=>{let t=Vt({height:10,size:2,factor:1,color1:1048575,color2:16777215},e);return{createBar:(e={},s={})=>{t=Vt(t,s);let{size:a,height:o,factor:n,color1:i,color2:r}=t;a*=n,o*=n,o*=e.heightRatio??n;const[l,c,p]=e.position||[0,0,0],d=new g,u=new b(a,a,o),m=new x({depthTest:!1,transparent:!0,vertexColors:!1,uniforms:{uColor1:{value:new C(i)},uColor2:{value:new C(r)},uOpacity:{value:.6}},vertexShader:"\n        varying vec3 vColor;\n        uniform vec3 uColor1;\n        uniform vec3 uColor2;\n        void main() {\n          float percent = (position.z + 0.0) / 100.0; // 计算当前像素点在立方体高度上的百分比\n          vColor = mix(uColor1.rgb, uColor2.rgb, percent);\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        varying vec3 vColor;\n        uniform float uOpacity;\n        void main() {\n          gl_FragColor = vec4(vColor, uOpacity);\n        }\n      "}),h=new k(u,m);if(d.add(h),d.name="柱状图",d.position.set(l,c,p+o/2),d.renderOrder=99,e.label){const{name:t="",className:s="",onClick:a}=e.label,n=ls({name:t,className:s,position:[0,0,o/2],onClick:a});n.rotateX(.5*Math.PI),d.add(n)}return d}}})(),Ps={x:105.06,y:0,z:32.93},Ls=new I;let Os,_s,zs,Us,Rs;const Bs=(e,t="/texttures")=>new URL(Object.assign({"../../assets/imgs/label.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAK+SURBVHgB7dzNbdswGIdxSugCRtGBuklWSO17nXs/J0hHywA11AEMu3wDsLFT5WCJ5PtI/D8nQ5cA/FmxJJLqtofhHBSmPihUAoElEFgCgfVu7ODX95suqOKNXVDpDIElEFgCgSUQWAKBJRBYAoE1G2Q3DJ/j9fRjUGE7DI+f4niEGc0CMYzzKezjx7vWUQwjnMJdF8djDsq8M+QYLu/om0VJGP8OXI/LTc0C+fJhs4/fiIeLQ82hvMaI/zEevsVxCROb/RvSMkpuDCvLVVaLKCUwrGyXvS2hlMKwst6HtIBSEsPKfmO4ZpTSGFaRO/U1otTAsIo9OlkTSi0Mq+izrDWg1MSwij9cXDJKbQyrytPeJaJ4YFjVHr8vCcULw6o6H7IEFE8Mq/oEFRnFG8NymTEkohAwLLcpXBIKBcNynVMnoJAwLPdFDp4oNAwLserEA4WIYXVjK7C9Vr+fY8Gh7e8/Lhha/f5GhDMjJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJZDwvIIQs2kIA/K81tYvzKYhBMh/75vyCYHiDgLBSLmjuIK8xrBV6J1HoO11biCk/Rmk7XUuIMTNMhSU6iDUnUsWAaUqCBkj5Y1SDWQJGClPlCogS8JIeaEUB1kiRsoDpSjIkjFStVGKgawBI1UTpQjImjBStVCyg6wRI1UDJSvImjFSpVGygbSAkSqJkgWkJYxUKZTZIC1ipEqgzAJpGSOVG2UyiDBeyokyCWR3OOyFcd0Yyu4wfA83Ngnk2Pe/ziE82WdhvHSJYuNz7MPPcGOTQH5sNk+nPnyMf/xeGNcZSvyS3tv42DiFG0O94q+19Iq/BSQQWAKBJRBYAoElEFgCgSUQWKM3hsovnSGwBAJLILAEAusvLK6Na4P/Au0AAAAASUVORK5CYII=","../../assets/imgs/sky/216/negX.jpeg":ve,"../../assets/imgs/sky/216/negY.jpeg":ye,"../../assets/imgs/sky/216/negZ.jpeg":we,"../../assets/imgs/sky/216/posX.jpeg":be,"../../assets/imgs/sky/216/posY.jpeg":xe,"../../assets/imgs/sky/216/posZ.jpeg":Ce,"../../assets/imgs/sky/217/negX.jpeg":ke,"../../assets/imgs/sky/217/negY.jpeg":je,"../../assets/imgs/sky/217/negZ.jpeg":Se,"../../assets/imgs/sky/217/posX.jpeg":Ie,"../../assets/imgs/sky/217/posY.jpeg":Me,"../../assets/imgs/sky/217/posZ.jpeg":Ae,"../../assets/imgs/sky/218/negX.jpeg":Pe,"../../assets/imgs/sky/218/negY.jpeg":Le,"../../assets/imgs/sky/218/negZ.jpeg":Oe,"../../assets/imgs/sky/218/posX.jpeg":_e,"../../assets/imgs/sky/218/posY.jpeg":ze,"../../assets/imgs/sky/218/posZ.jpeg":Ue,"../../assets/imgs/sky/219/negX.jpeg":Re,"../../assets/imgs/sky/219/negY.jpeg":Be,"../../assets/imgs/sky/219/negZ.jpeg":Ge,"../../assets/imgs/sky/219/posX.jpeg":Ee,"../../assets/imgs/sky/219/posY.jpeg":Fe,"../../assets/imgs/sky/219/posZ.jpeg":De,"../../assets/imgs/sky/220/negX.jpeg":Te,"../../assets/imgs/sky/220/negY.jpeg":Xe,"../../assets/imgs/sky/220/negZ.jpeg":Ye,"../../assets/imgs/sky/220/posX.jpeg":Je,"../../assets/imgs/sky/220/posY.jpeg":We,"../../assets/imgs/sky/220/posZ.jpeg":$e,"../../assets/imgs/sky/221/negX.jpeg":Ze,"../../assets/imgs/sky/221/negY.jpeg":Ne,"../../assets/imgs/sky/221/negZ.jpeg":Ve,"../../assets/imgs/sky/221/posX.jpeg":Ke,"../../assets/imgs/sky/221/posY.jpeg":Qe,"../../assets/imgs/sky/221/posZ.jpeg":He,"../../assets/imgs/sky/222/negX.jpeg":qe,"../../assets/imgs/sky/222/negY.jpeg":et,"../../assets/imgs/sky/222/negZ.jpeg":tt,"../../assets/imgs/sky/222/posX.jpeg":st,"../../assets/imgs/sky/222/posY.jpeg":at,"../../assets/imgs/sky/222/posZ.jpeg":ot,"../../assets/imgs/sky/223/negX.jpeg":nt,"../../assets/imgs/sky/223/negY.jpeg":it,"../../assets/imgs/sky/223/negZ.jpeg":rt,"../../assets/imgs/sky/223/posX.jpeg":lt,"../../assets/imgs/sky/223/posY.jpeg":ct,"../../assets/imgs/sky/223/posZ.jpeg":pt,"../../assets/imgs/sky/224/negX.jpeg":gt,"../../assets/imgs/sky/224/negY.jpeg":dt,"../../assets/imgs/sky/224/negZ.jpeg":ut,"../../assets/imgs/sky/224/posX.jpeg":mt,"../../assets/imgs/sky/224/posY.jpeg":ht,"../../assets/imgs/sky/224/posZ.jpeg":ft,"../../assets/imgs/sky/225/negX.jpeg":vt,"../../assets/imgs/sky/225/negY.jpeg":yt,"../../assets/imgs/sky/225/negZ.jpeg":wt,"../../assets/imgs/sky/225/posX.jpeg":bt,"../../assets/imgs/sky/225/posY.jpeg":xt,"../../assets/imgs/sky/225/posZ.jpeg":Ct,"../../assets/imgs/sky/226/negX.jpeg":kt,"../../assets/imgs/sky/226/negY.jpeg":jt,"../../assets/imgs/sky/226/negZ.jpeg":St,"../../assets/imgs/sky/226/posX.jpeg":It,"../../assets/imgs/sky/226/posY.jpeg":Mt,"../../assets/imgs/sky/226/posZ.jpeg":At,"../../assets/imgs/texttures/arrow.png":Ot,"../../assets/imgs/texttures/border.png":_t,"../../assets/imgs/texttures/circle.png":zt,"../../assets/imgs/texttures/fenceMap0.png":Ut,"../../assets/imgs/texttures/fenceMap1.png":Rt,"../../assets/imgs/texttures/fenceMap2.png":Bt,"../../assets/imgs/texttures/gz-map-fx.jpg":Gt,"../../assets/imgs/texttures/gz-map.jpg":Et,"../../assets/imgs/texttures/inner-circle.png":Ft,"../../assets/imgs/texttures/lensflare0.png":Dt,"../../assets/imgs/texttures/lensflare0_alpha.png":Tt,"../../assets/imgs/texttures/lensflare1.png":Xt,"../../assets/imgs/texttures/lensflare2.png":Yt,"../../assets/imgs/texttures/lensflare3.png":Jt,"../../assets/imgs/texttures/light.png":Wt,"../../assets/imgs/texttures/out-circle.png":$t,"../../assets/imgs/texttures/point.png":Zt})[`../../assets/imgs${t}/${e}`],self.location).href,Gs=(e,t,s)=>t?Ht(t,s):e,Es=(e,t)=>{const s=new W(t),a={depth:e.config.depth,bevelEnabled:!0,bevelSegments:1,bevelThickness:0,steps:0,bevelSize:0},o=new $(s,a),n=new Z({color:e.color.main,map:Os,normalMap:_s,combine:N,transparent:!0,opacity:.8}),i=new V({color:ps.borderColor,map:zs,transparent:!0,opacity:.9}),r=new k(o,[n,i]);return r.scale.setScalar(e.config.scale),r.name="地图拼块",r},Fs=Bs("label.png",""),Ds=(e,t,s)=>{if(!t.centroid&&!t.center)return!1;const{depth:a,scale:o}=e.config,[n,i]=t.centroid||t.center,r=ds({name:`\n      <img src="${Fs}" />\n      <div class="name">${t.name}</div>\n    `,className:"map-3D-label",position:[n*o,i*o*.995,a*o]});r.rotateX(.5*Math.PI),r.name=t.name+"_CSS3D_label",r.isLabel=!0,s.add(r)},Ts=(e,t,s)=>{if(!t.centroid&&!t.center)return!1;const{depth:a,scale:o}=e.config,n=1+(i=5,r=10,(Math.floor(Math.random()*(r-i+1))+i)/4);var i,r;const[l,c]=t.centroid||t.center,p=bs([l,c,1.01*a].map((e=>e*o)),n*o,{factor:o,color:e.color.markColor1});p.rotateX(-Math.PI/2),s.add(p)},Xs=(e,t,s)=>{const{scale:a,depth:o}=e.config,n=new g,i=.2*a,r=new K(i,32),l=new A({color:ps.scatterColor1,transparent:!0,opacity:1}),c=new k(r,l),p=new Q(.8*i,32,32,0,Math.PI),d=new A({color:ps.scatterColor2,transparent:!0,opacity:1}),u=new k(p,d);return n.add(c,u),n.position.set(t*a,s*a,o*a*1.005),n};class Ys extends Nt{constructor(a,o={},n={},l,c){super(a),i(this,s),i(this,e,void 0),i(this,t,void 0),this.config=Vt(cs,o),this.color=Vt(ps,n),r(this,e,l),r(this,t,c),this.createClock(),this.css3DRender=gs(this.options,this.container),((e,t)=>{Os=Ls.load(Gs(Bs("gz-map.jpg"),e.map.map,t)),_s=Ls.load(Gs(Bs("gz-map-fx.jpg"),e.map.normal,t)),zs=Ls.load(Gs(Bs("border.png"),e.map.side,t)),Os.wrapS=_s.wrapS=zs.wrapS=J,Os.wrapT=_s.wrapT=zs.wrapT=J,Os.flipY=!1;const s=.0128;Os.repeat.set(s,s),_s.repeat.set(s,s),Us=Ls.load(Gs(Bs("out-circle.png"),e.map.bgOutCircle,t)),Rs=Ls.load(Gs(Bs("inner-circle.png"),e.map.bgInnerCircle,t))})(this.config,this.options.baseUrl),this.bindEvent()}addCorrugatedPlate(){this.corrugatedPlate&&(this.disposeObj(this.corrugatedPlate),this.corrugatedPlate=void 0);const e=vs({range:this.config.plateRadius,factor:this.config.scale,color:this.color.plateColor,light:this.color.plateLight});e.renderOrder=0,this.corrugatedPlate=e,this.addObject(e)}initMap(e){this.mapGroup&&(this.disposeObj(this.mapGroup),this.mapGroup=void 0);const t=new g;t.name="地图";const s=e.features,a=s.length;for(let c=0;c<a;c++){const e=s[c],a=new T,o=e.geometry.coordinates,n=e.properties;for(let t=0;t<o.length;t++)o[t].forEach((e=>{const t=e.map((e=>new X(e[0],e[1]))),s=Es(this,t);s.isProvinceBlock=!0,a.add(s)}));this.config.areaLabel&&Ds(this,n,a),this.config.markLight&&Ts(this,n,a),a.rotateX(-Math.PI/2),a.isProvinceGroup=!0,a.name=n.name,a.data=n,t.add(a)}this.mapGroup=t,this.addObject(t),this.config.border&&((e,t)=>{let s=xs(t,{color:ps.line,transparent:!0},"Line2");const{depth:a,scale:o}=e.config;s.name="地图上边框",s.position.y+=a*o;let n=xs(t,{color:ps.line2},"Line2");n.name="地图下边框",s.scale.setScalar(o),n.scale.setScalar(o),e.scene.add(s),e.scene.add(n)})(this,e);const o=ws(t);if(!this.corrugatedPlate)return;let{size:n,center:{x:i,y:r,z:l}}=o;if(Ps.x=i,Ps.y=r,Ps.z=l,this.corrugatedPlate.position.set(i,0-.1*this.config.scale,l),this.resetSceneEle(),this.config.mapBg){const e=n.x<n.y?n.y+1:n.x+1;this.outRingMesh=((e,t)=>{let s=new M(t,t),a=new A({map:Us,transparent:!0,opacity:.6,depthTest:!0}),o=new k(s,a);const{x:n,z:i}=Ps;return o.position.set(n,-1,i),o.scale.setScalar(1.2),o.rotateX(.5*-Math.PI),e.add(o),o})(this.scene,e*this.config.bgOutFactor),this.innerRingMesh=((e,t)=>{let s=new M(t,t),a=new A({map:Rs,transparent:!0,opacity:.3,depthTest:!0}),o=new k(s,a);const{x:n,z:i}=Ps;return o.position.set(n,-2,i),o.scale.setScalar(1.2),o.rotateX(.5*-Math.PI),e.add(o),o})(this.scene,e*this.config.bgInnerFactor)}}initMapOutLine(e){this.outline&&(this.disposeObj(this.outline),this.outline=void 0);const t=Cs(e,this.config.depth,!1),s=ks(t,{factor:this.config.scale,color:this.color.outline});s.renderOrder=10,this.outline=s,this.addObject(s)}initFlywire(e){this.flywireGroup&&(this.disposeObj(this.flywireGroup),this.flywireGroup=void 0);const{scale:t,depth:s}=this.config,a=this.color;Ss({depth:s,color:a.line,flyColor:a.flyColor2,pointColor:a.flyColor1,factor:t});const o=new g;for(let n=0;n<e.length;n++){const{coords:s,path:a}=e[n],i=Is(s.map((e=>e.map((e=>e*t)))));i.name=a,o.add(i)}o.name="飞线集合",o.renderOrder=20,this.flywireGroup=o,this.addObject(o)}initMapBar(e,t){if(!this.config.mapBar)return;if(!this.mapGroup)return;this.clearMapBar();const s=Math.max(...e.map((e=>e.value||0))),{scale:a,depth:o}=this.config,n=this.color,i={height:5,size:.2,factor:a,color1:n.markColor1,color2:n.markColor2};for(let r=0;r<e.length;r++){const{name:n="",value:l=0}=e[r],c=this.mapGroup.getObjectByName(n);if(c){const n=l/s||0,{centroid:p,center:g}=c.data,d=p||g,u=As({position:[d[0]*a,d[1]*a,o*a],heightRatio:n,label:t(e[r])},i);u.isBar=!0,c.add(u)}else;}}clearMapBar(){var e;null==(e=this.mapGroup)||e.traverse((e=>{e.isBar&&this.disposeObj(e)}))}initScatter(e){this.scatterGroup&&(this.disposeObj(this.scatterGroup),this.scatterGroup=void 0);const t=new g;t.name="散点集合";for(let s=0;s<e.length;s++){const a=e[s],[o=0,n=0]=a.coord||[],i=Xs(this,o,n);i.name=a.name,i.data=a,i.isScatter=!0,t.add(i)}t.rotateX(.5*-Math.PI),this.scatterGroup=t,this.addObject(t)}onDblclick(e){}onPointerDown(e){this.pointer.isClick=!0,this.pointer.tsp=e.timeStamp}onPointerMove(e){const t=this.container,o=this.options.scale;if(fs(e,t,o),this.mapGroup){us.setFromCamera(ms,this.camera);const e=[this.mapGroup];this.scatterGroup&&e.push(this.scatterGroup);const t=us.intersectObjects(e);if(this.container.style.cursor=t.length?"pointer":"auto",t.length>0){const e=t[0].object;let o;const n=this.findParentGroupGroupUuid(e);n&&(o=n.uuid,l(this,s,a).call(this,n)),this.setMapBlockColor(o)}else l(this,s,a).call(this),this.setMapBlockColor()}}onPointerUp(e){this.pointer.isClick=!1;const t=e.timeStamp-this.pointer.tsp<(this.config.rightClickBackDiffTime||Kt.rightClickBackDiffTime);2==e.button||(0==e.button?t&&this.clickObject(e):e.button)}findParentGroupGroupUuid(e){const t=e=>{let s=e.parent;if(s)return s&&s.isProvinceGroup||s.isScatter?s:t(s)};return t(e)}setMapBlockColor(e){var t;null==(t=this.mapGroup)||t.traverse((t=>{if(t.isProvinceBlock)t.material[0].color.set(t.parent.uuid===e?this.color.mainHover:this.color.main),t.material[1].color.set(t.parent.uuid===e?this.color.borderHoverColor:this.color.borderColor);else if(t.isLabel){const s=t.parent.uuid===e;t.element.className="map-3D-label"+(s?" is-active":"")}}))}clickObject(e){const s=this.container,a=this.options.scale;if(fs(e,s,a),this.scatterGroup){us.setFromCamera(ms,this.camera);const e=[this.scatterGroup],s=us.intersectObjects(e);if(this.container.style.cursor=s.length?"pointer":"auto",s.length){const e=s[0].object,a=this.findParentGroupGroupUuid(e).data||{};"function"==typeof n(this,t)&&n(this,t).call(this,a)}}}resetSceneEle(){const{x:e,y:t,z:s}=Ps;if(this.camera.lookAt(e,t,s),new L(this.camera.position).to({x:e,y:90*this.config.scale,z:s+40*this.config.scale},1e3).easing(Y.Quadratic.In).start().onUpdate((()=>{})),this.controls&&(this.controls.target=new d(e,t,s-5*this.config.scale)),this.grid){this.grid.position.set(e,0,s);const t=this.scene.getObjectByProperty("_isGridFork_",!0);t&&t.position.set(e,0,s)}}modelAnimate(){var e;let t=null==(e=this.clock)?void 0:e.getDelta();this.corrugatedPlate&&ys(this.corrugatedPlate,t),this.css3DRender&&this.css3DRender.render(this.scene,this.camera),zs&&(zs.offset.y+=.005),this.outRingMesh&&(this.outRingMesh.rotation.z+=5e-4),this.innerRingMesh&&(this.innerRingMesh.rotation.z-=5e-4),this.outline&&js(this.outline),this.flywireGroup&&Ms()}resize(){if(super.resize(),this.css3DRender){const{width:e,height:t}=this.options;this.css3DRender.setSize(e,t)}}dispose(){this.disposeObj(this.corrugatedPlate),this.disposeObj(this.mapGroup),this.disposeObj(this.scatterGroup),this.disposeObj(this.flywireGroup),this.disposeObj(this.outline),this.disposeObj(this.outRingMesh),this.disposeObj(this.innerRingMesh),this.clock=void 0,this.css3DRender=void 0,this.corrugatedPlate=void 0,this.mapGroup=void 0,this.scatterGroup=void 0,this.flywireGroup=void 0,this.outline=void 0,this.outRingMesh=void 0,this.innerRingMesh=void 0,super.dispose()}}e=new WeakMap,t=new WeakMap,s=new WeakSet,a=function(t){"function"==typeof n(this,e)&&n(this,e).call(this,t,hs)};const Js=ss(H({__name:"index",props:{devEnv:{type:Boolean},baseUrl:{},bgColor:{},skyCode:{},bgUrl:{},env:{},scale:{},camera:{default:()=>({})},cruise:{default:()=>({})},fog:{default:()=>({})},render:{default:()=>({})},controls:{default:()=>({})},grid:{default:()=>({})},axes:{default:()=>({})},directionalLight:{},color:{default:()=>({})},config:{default:()=>({})},corrugatedPlate:{type:Boolean,default:!0},mapJson:{},outlineJson:{},flywire:{},barList:{},scatters:{},barLabelRender:{}},emits:["init","click"],setup(e,{expose:t,emit:s}){const{backgroundLoad:a,skys:o}=Pt(),{transformGeoJSON:n}={transformGeoJSON:e=>{let t=e.features;for(let s=0;s<t.length;s++){const e=t[s];"Polygon"===e.geometry.type&&(e.geometry.coordinates=[e.geometry.coordinates])}return e}},{show:i,dialog:r}=ts({style:{left:"0px",top:"0px"},extend:{}}),l=e,c=E(),p=s;q((()=>l.scale),(e=>{null==u||u.setScale(e||1)})),q((()=>l.mapJson),(e=>{e&&(null==u||u.initMap(n(e)))})),q((()=>l.outlineJson),(e=>{e&&(null==u||u.initMapOutLine(n(e)),l.barList&&(null==u||u.initMapBar(l.barList||[],g)))})),q((()=>l.flywire),(e=>{null==u||u.initFlywire(e||[])})),q((()=>l.barList),(e=>{null==u||u.initMapBar(e||[],g)})),q((()=>l.scatters),(e=>{null==u||u.initScatter(e||[])}));const g=e=>{if("function"==typeof l.barLabelRender)return l.barLabelRender(e);const{name:t="",value:s=0,unit:a=""}=e;return{name:`\n      <div class="label-wrap">\n        <div class="name">${t}</div>\n        <div class="text">\n          <span class="value">${qt(s)}</span>\n          <span class="unit">${a}</span>\n        </div>\n      </div>\n    `,className:"map-bar-label"}},d={baseUrl:l.baseUrl,bgUrl:l.bgUrl,env:l.env,bgColor:l.bgColor,camera:l.camera,cruise:l.cruise,fog:l.fog,render:l.render,grid:l.grid,controls:l.controls,axes:l.axes};let u;return ee((()=>{d.container=c.value,u=new Ys(d,l.config,l.color,((e,t)=>{let s=!!e;if(s){r.style&&(r.style.left=t.left+"px",r.style.top=t.top+"px");const a=e.isScatter,o=e.data;if(a)o.isScatter=!0,r.extend=o;else{const t=(l.barList||[]).find((t=>t.name==e.name));t?r.extend=t:s=!1}}i.value=s}),(e=>{p("click",te(e))})),u.run(),p("init",u),l.skyCode&&a(u,l.skyCode),l.corrugatedPlate&&(null==u||u.addCorrugatedPlate()),l.flywire&&l.flywire.length&&(null==u||u.initFlywire(l.flywire))})),t({exportImage:()=>null==u?void 0:u.exportImage()}),(e,t)=>(se(),ae("div",{class:ne(e.$style["map-scene"])},[oe("div",{class:ne(e.$style.container),ref_key:"containerRef",ref:c},null,2),ie(i)?(se(),ae("div",{key:0,class:ne(e.$style["dialog-view"]),style:re(ie(r).style)},[le(e.$slots,"dialog",{data:ie(r).extend})],6)):ce("",!0)],2))}}),[["__cssModules",{$style:{"map-scene":"_map-scene_5opvk_2",container:"_container_5opvk_8","dialog-view":"_dialog-view_5opvk_12"}}]]),Ws={depth:2,scale:40,plateRadius:100},$s={main:3377879,mainHover:9633791,borderColor:9633791,borderHoverColor:1066618,light:1066618,lightHover:9633791,plateColor:3377879,plateLight:1066618,line:9559027,line2:6421501,gridColor:663606,gridFork:927811,outline:11856636,markColor1:13303807,markColor2:6945023,flyColor1:9559027,flyColor2:6421501,scatterColor1:9559027,scatterColor2:6421501},Zs=["src"],Ns=ss(H({__name:"index",setup(e){const{load:t}=(()=>{const e=E(0);return{load:t=>{const s=new F;return new Promise(((a,o)=>{s.load(t,(e=>{let t={};try{t=JSON.parse(e)}catch(s){}a(t)}),(t=>{let{loaded:s,total:a}=t;e.value=Number((s/a*100).toFixed(0))}),o)}))},progress:e}})(),s=E(),a=pe({devEnv:!0,baseUrl:"",bgColor:464681,color:$s,config:{...Ws,areaLabel:!0,markLight:!0,map:{}},camera:{position:[0,100,200]},directionalLight:{helper:!0},fog:{visible:!1,near:2e3,far:3e3},render:{preserveDrawingBuffer:!0},grid:{visible:!0,gridColor:$s.gridColor,centerLineColor:$s.gridColor,fork:!0,divisions:40,width:2*Ws.plateRadius*Ws.scale,forkSize:1.4*Ws.scale,forkColor:$s.gridFork},controls:{maxPolarAngle:.46*Math.PI,maxDistance:5e3,enableDamping:!0,screenSpacePanning:!1},axes:{visible:!0},mapJson:null,outlineJson:null,flywire:[],barList:[],scatters:[]}),o=()=>{var e;return null==(e=s.value)?void 0:e.exportImage()},n=e=>{const s=a.baseUrl;t(`${s}/oss/map/china.json`).then((e=>{a.mapJson=e})),t(`${s}/oss/map/china-outline.json`).then((e=>{a.outlineJson=e})),is(e).resize()},i=e=>{he.info({message:e.name,grouping:!0})},r=e=>{const{name:t="",value:s=0,unit:a=""}=e;return{name:`\n      <div class="label-wrap">\n        <div class="name">${t}</div>\n        <div class="text">\n          <span class="value">${ns(s)}</span>\n          <span class="unit">${a}</span>\n        </div>\n      </div>\n    `,className:"map-bar-label"}},l=()=>{as.get(os.d3.map).then((e=>{const t=[],s=[];return e.list.forEach((e=>{const a=e.projects.length;let o=e.province;["重庆","北京","天津","上海"].includes(o)&&(o+="市"),["台湾"].includes(o)&&(o+="省"),e.projects.forEach((s=>{t.push({coord:[s.lng,s.lat],name:s.name,carbon:s.carbon,value:s.use,total:a,city:e.province,id:s.id})}));const n=e.total;-1===s.findIndex((e=>e.name===o))&&s.push({id:e.code,name:o,total:a,value:n,unit:"kWh"})})),{citys:s,projects:t,lines:e.lines}})).then((e=>{a.flywire=e.lines,a.barList=e.citys,a.scatters=e.projects}))};return ee((()=>{l()})),(e,t)=>{const l=fe;return se(),ae("div",{class:ne([e.$style.page,"h-100 o-h"])},[oe("div",{class:ne(e.$style.operate)},[ge(l,{type:"primary",size:"small",onClick:o},{default:de((()=>t[0]||(t[0]=[ue("导出")]))),_:1})],2),ge(Js,{ref_key:"threeSceneRef",ref:s,"dev-env":ie(a).devEnv,"base-url":ie(a).baseUrl,"bg-color":ie(a).bgColor,"bg-url":ie(a).bgUrl,env:ie(a).env,"sky-code":ie(a).skyCode,camera:ie(a).camera,cruise:ie(a).cruise,render:ie(a).render,controls:ie(a).controls,"directional-light":ie(a).directionalLight,grid:ie(a).grid,axes:ie(a).axes,config:ie(a).config,color:ie(a).color,"map-json":ie(a).mapJson,"outline-json":ie(a).outlineJson,flywire:ie(a).flywire,"bar-list":ie(a).barList,scatters:ie(a).scatters,"bar-label-render":r,onInit:n,onClick:i},{dialog:de((({data:s})=>[oe("div",{class:ne(e.$style["dialog-view"])},[oe("div",{class:ne([e.$style.city,"flex"])},[oe("span",{class:ne(e.$style.name)},me(s.isScatter?s.city:s.name),3),oe("span",{class:ne(e.$style.total)},me(s.total)+"个项目",3)],2),s.isScatter?(se(),ae("div",{key:0,class:ne([e.$style.project,"flex flex-ac"])},[oe("img",{src:`${ie(a).baseUrl}/oss/img/map/pos.png`,alt:""},null,8,Zs),oe("span",{class:ne(e.$style.name)},me(s.name),3)],2)):ce("",!0),oe("div",{class:ne(e.$style.count)},[oe("div",{class:ne(e.$style.item)},[t[1]||(t[1]=oe("span",null,"今日用电量",-1)),oe("span",null,me(ie(ns)(s.value)),1),t[2]||(t[2]=oe("span",null,"kWh",-1))],2),s.isScatter?(se(),ae("div",{key:0,class:ne(e.$style.item)},[t[3]||(t[3]=oe("span",null,"今日碳排放",-1)),oe("span",null,me(ie(ns)(s.carbon)),1),t[4]||(t[4]=oe("span",null,"kgCO₂",-1))],2)):ce("",!0)],2)],2)])),_:1},8,["dev-env","base-url","bg-color","bg-url","env","sky-code","camera","cruise","render","controls","directional-light","grid","axes","config","color","map-json","outline-json","flywire","bar-list","scatters"])],2)}}}),[["__cssModules",{$style:{page:"_page_dcgzt_2",operate:"_operate_dcgzt_8","dialog-view":"_dialog-view_dcgzt_15",city:"_city_dcgzt_20",name:"_name_dcgzt_20",total:"_total_dcgzt_28",project:"_project_dcgzt_33",count:"_count_dcgzt_48",item:"_item_dcgzt_52"}}]]);export{Ns as default};
