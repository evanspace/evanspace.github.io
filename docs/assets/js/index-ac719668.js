var e,t,s,n,a=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},o=(e,t,s)=>(a(e,t,"read from private field"),s?s.call(e):t.get(e)),i=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},r=(e,t,s,n)=>(a(e,t,"write to private field"),n?n.call(e,s):t.set(e,s),s),l=(e,t,s)=>(a(e,t,"access private method"),s);import{ci as c,cQ as p,cj as g,cR as u,co as d,bh as m,bp as h,bc as f,ba as v,cb as y,be as w,cc as b,cd as x,cS as C,b6 as k,bs as j,bk as S,cm as A,bB as I,cT as M,cU as L,cV as P,bA as O,cW as _,c0 as z,cX as U,bv as R,bD as B,cY as G,bd as E,b7 as F,ck as D,cg as T,cn as Y,bw as X,cZ as J,c_ as W,bo as $,c$ as Z,bE as N,d0 as V,bz as K,e as Q,i as H,w as q,l as ee,aP as te,o as se,g as ne,h as ae,n as oe,u as ie,a9 as re,a5 as le,B as ce,d1 as pe,Y as ge,q as ue,p as de,I as me,t as he,c as fe,ak as ve}from"./vendor-e7f34225.js";import{_ as ye,a as we,b as be,c as xe,d as Ce,e as ke,f as je,g as Se,h as Ae,i as Ie,j as Me,k as Le,l as Pe,m as Oe,n as _e,o as ze,p as Ue,q as Re,r as Be,s as Ge,t as Ee,u as Fe,v as De,w as Te,x as Ye,y as Xe,z as Je,A as We,B as $e,C as Ze,D as Ne,E as Ve,F as Ke,G as Qe,H as He,I as qe,J as et,K as tt,L as st,M as nt,N as at,O as ot,P as it,Q as rt,R as lt,S as ct,T as pt,U as gt,V as ut,W as dt,X as mt,Y as ht,Z as ft,$ as vt,a0 as yt,a1 as wt,a2 as bt,a3 as xt,a4 as Ct,a5 as kt}from"./posZ-54c73ffc.js";import{d as jt,a as St,r as At,T as It,_ as Mt,b as Lt,c as Pt,e as Ot,f as _t,h as zt,i as Ut,j as Rt,k as Bt,l as Gt,m as Et,n as Ft,o as Dt,p as Tt,q as Yt,s as Xt,t as Jt,g as Wt,v as $t,u as Zt}from"./scene-resize-d28e167b.js";import{u as Nt,a as Vt}from"./background-835b6336.js";import{D as Kt}from"./config-b6242c11.js";import{u as Qt}from"./dialog-d3e452f5.js";import{_ as Ht,e as qt,A as es,n as ts}from"./index-002d2389.js";const ss=()=>({initCSS3DRender:(e,t)=>{const{width:s,height:n}=e,a=new c;return a.setSize(s,n),a.domElement.style.position="absolute",a.domElement.style.left="0px",a.domElement.style.top="0px",a.domElement.style.pointerEvents="none",t.appendChild(a.domElement),a},createCSS3DDom:e=>{const{name:t,className:s="",onClick:n,position:a,sprite:o}=e,i=document.createElement("div");i.innerHTML=t,i.className=s;const r=o?new p(i):new g(i);return i.style.pointerEvents=n?"auto":"none",i.style.position="absolute","function"==typeof n&&i.addEventListener("click",n),a&&r.position.set(...a),r}}),{createCSS3DDom:ns}=ss(),as={depth:1,scale:40,plateRadius:200,rightClickBackDiffTime:100,areaLabel:!1,markLight:!1,border:!0,mapBg:!0,mapBar:!0,bgOutFactor:1,bgInnerFactor:.9,map:{}},os={main:3377879,mainHover:9633791,borderColor:9633791,borderHoverColor:1066618,light:1066618,lightHover:9633791,plateColor:3377879,plateLight:1066618,line:9559027,line2:6421501,gridColor:663606,gridFork:927811,outline:11856636,markColor1:13303807,markColor2:6945023,flyColor1:9559027,flyColor2:6421501,scatterColor1:9559027,scatterColor2:6421501},{initCSS3DRender:is,createCSS3DDom:rs}=ss(),{raycaster:ls,pointer:cs,style:ps,update:gs}=Nt(),{createCorrugatedPlate:us,corrugatedPlateUpdate:ds}=((e={})=>{let t=jt({range:100,interval:.8,size:.2,color:47273,light:881527,factor:1},e);const s=(e,t)=>{const s=e.material,n=s.uniforms.uRange.value,a=s.uniforms.uLength.value;s.uniforms.uRadius.value+=t*(n/4),s.uniforms.uRadius.value>=n+a&&(s.uniforms.uRadius.value=0)};return{createCorrugatedPlate:(e={})=>{t=jt(t,e);let{range:s,color:n,light:a,factor:o}=t;s*=o;const i=(()=>{let{range:e,interval:s,size:n,factor:a}=t;e*=a,s*=a,n*=a;const o=[],i=Math.floor(e/s);for(let t=-i;t<=i;t++)for(let e=-i;e<=i;e++){const a=new v(n,n),i=t*s,r=e*s,l=new y,c=new w(i,-n,r),p=new b,g=new x,u=new w(1,1,1);p.setFromEuler(g),l.compose(c,p,u),a.applyMatrix4(l),o.push(a)}return o})(),r=u(i),l=new d({uniforms:{uColor:{value:new m(a)},uTcolor:{value:new m(n)},uRadius:{value:1.25},uLength:{value:s/10},uRange:{value:s}},vertexShader:"\n        varying vec3 vp;\n        void main(){\n          vp = position;\n          gl_Position\t= projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        varying vec3 vp;\n        uniform vec3 uColor;\n        uniform vec3 uTcolor;\n        uniform float uRadius;\n        uniform float uLength;\n        float getLeng(float x, float y){\n          return  sqrt((x-0.0)*(x-0.0)+(y-0.0)*(y-0.0));\n        }\n        void main(){\n          float uOpacity = 0.8;\n          vec3 vColor = uColor;\n          float length = getLeng(vp.x,vp.z);\n          if ( length <= uRadius && length > uRadius - uLength ) {\n            float op = sin( (uRadius - length) / uLength ) ;\n            uOpacity = op;\n            if ( vp.y < 0.0 ) {\n              vColor = uColor * op;\n            } else {\n              vColor = uTcolor;\n            };\n            vColor = uTcolor;\n          }\n          gl_FragColor = vec4(vColor,uOpacity);\n        }\n      ",transparent:!0,depthWrite:!1,side:h}),c=new f(r,l);return c.name="波纹板",c},update:s,corrugatedPlateUpdate:s}})(),{getBoundingBox:ms}={getBoundingBox:e=>{var t=new C;t.expandByObject(e);var s=new w;t.getSize(s);var n=new w;return t.getCenter(n),{box3:t,center:n,size:s}}},{createMarkLight:hs}=((e={})=>{let t=jt({pointTextureUrl:St("point.png"),circleTextureUrl:St("circle.png"),lightTextureUrl:St("light.png"),factor:1,color:65535},e);const s=new k;return{createMarkLight:(e=[0,0,0],n=10,a={})=>{t=jt(t,a);const o=new j,i=new v(n/6.219,n);i.rotateX(-Math.PI/2),i.translate(0,0,n/2);const r=new S({map:s.load(t.lightTextureUrl),color:t.color,transparent:!0,depthWrite:!1,side:h});let l=new f(i,r);l.rotateX(Math.PI),l.position.z=n,l.renderOrder=3,l.name="光柱 01";let c=l.clone();c.name="光柱 02",c.rotateZ(Math.PI/2);const p=(()=>{const e=new v(3,3),n=new S({map:s.load(t.pointTextureUrl),color:t.color,side:h,transparent:!0,depthWrite:!1});let a=new f(e,n);a.renderOrder=1,a.name="底部光点";const o=.3*t.factor;return a.scale.setScalar(o),a})(),g=(()=>{const e=new v(3,3),n=new S({map:s.load(t.circleTextureUrl),color:t.color,side:h,opacity:0,transparent:!0,depthWrite:!1});let a=new f(e,n);a.renderOrder=2,a.name="createLightHalo";const o=.5*t.factor;a.scale.setScalar(o);const i=At(0,2e3);return a.tween1=new A({scale:o,opacity:0}).to({scale:1.5*o,opacity:1},1e3).delay(i).onUpdate((e=>{let{scale:t,opacity:s}=e;a.scale.setScalar(t),a.material.opacity=s})),a.tween2=new A({scale:1.5*o,opacity:1}).to({scale:2*o,opacity:0},1e3).onUpdate((e=>{let{scale:t,opacity:s}=e;a.scale.setScalar(t),a.material.opacity=s})),a.tween1.chain(a.tween2),a.tween2.chain(a.tween1),a.tween1.start(),a})();return o.add(l,c,p,g),o.position.set(...e),o.rotateX(.5*Math.PI),o.name="光柱标记",o}}})(),{createCountryFlatLine:fs,getPoints:vs}=(()=>{const e=(e,t,s="LineLoop")=>{let n;if("Line2"===s){const s=new L;s.setPositions(e),n=new P(s,t),n.name="countryLine2",n.computeLineDistances()}else{const a=new O;a.setFromPoints(e),n=new _[s](a,t),n.name="countryLine"}return n};return{createCountryFlatLine:(t,s={},n="LineLoop")=>{let a={color:65535,linewidth:1,depthTest:!1};a=jt(a,s);let o=new I(a);"Line2"===n&&(o=new M(a));let i=t.features,r=new j;for(let l=0;l<i.length;l++){const t=i[l].geometry.coordinates;for(let s=0;s<t.length;s++){const a=t[s],i=[];"Line2"===n?a.forEach((e=>{e.forEach((e=>{i.push(e[0],0,-e[1])}))})):a.forEach((e=>{e.forEach((e=>{i.push(new w(e[0],e[1],0))}))}));let l=e(i,o,n);r.add(l)}}return r},getPoints:(e,t=0,s)=>{let n=e.features;const a=[];for(let o=0;o<n.length;o++){const e=n[o].geometry.coordinates;for(let n=0;n<e.length;n++)e[n].forEach((e=>{e.forEach((e=>{s?a.push(new w(e[0],t,-e[1])):a.push(e[0],t,-e[1])}))}))}return a}}})(),{createOutline:ys,outlineUpdate:ws}=((e={})=>{let t=jt({size:.1,color:16085360,range:500,factor:1,speed:6},e);const s=e=>{const s=e.material,n=s.uniforms.uLength.value;s.uniforms.uIndex.value+=t.speed,s.uniforms.uIndex.value>=n&&(s.uniforms.uIndex.value=0)};return{createOutline:(e,s={})=>{t=jt(t,s);const{size:n,factor:a,range:o,color:i}=t,r=new Float32Array(e),l=new O;l.setAttribute("position",new z(r,3));const c=new Float32Array(Math.floor(r.length/3)).map(((e,t)=>t));l.setAttribute("aIndex",new z(c,1));const p=new d({vertexShader:"\n        attribute float aOpacity;\n        uniform float uSize;\n\n        attribute float aIndex;\n        varying vec3 vp;\n        varying float vertexIndex;\n\n        void main(){\n          gl_Position = projectionMatrix*modelViewMatrix*vec4(position,1.0);\n          gl_PointSize = uSize;\n\n          vp = position;\n          vertexIndex = aIndex;\n        }\n      ",fragmentShader:"\n        varying float vertexIndex;\n        uniform vec3 uColor;\n        uniform float uIndex;\n        uniform float uRange;\n\n        float invert(float n){\n          return 1.-n;\n        }\n\n        void main(){\n          float uOpacity = 1.0;\n          if(vertexIndex <= uIndex || vertexIndex >= (uRange + uIndex)){\n              discard;\n          }\n          uOpacity = (vertexIndex - uIndex)/uRange;\n          if ( uOpacity < 0.2) {\n            discard;\n          }\n          vec2 uv=vec2(gl_PointCoord.x,invert(gl_PointCoord.y));\n          vec2 cUv=2.*uv-1.;\n          vec4 color=vec4(1./length(cUv));\n          color*=uOpacity;\n          color.rgb*=uColor;\n          gl_FragColor=color;\n        }\n      ",transparent:!0,depthTest:!1,uniforms:{uSize:{value:n*a},uIndex:{value:0},uLength:{value:c.length},uRange:{value:o},uColor:{value:new m(i)}}}),g=new U(l,p);return g.name="轮廓",g.scale.setScalar(a),g},update:s,outlineUpdate:s}})(),{createFlywireTexture:bs,createFlywire:xs,flywireUpdate:Cs}=((e={})=>{let t,s,n=jt({depth:0,height:4,divisions:1e3,color:16777215,flyColor:16761095,pointColor:16715760,pointWidth:2.5,flyPointWidth:2.4,tubularSegments:256,radius:.5,radialSegments:8,closed:!1,length:100,factor:1,speed:4},e);const a=e=>{const[t,a]=e;let{pointWidth:o,depth:i,factor:r}=n;const l=o*r;i*=r;const c=new v(l,l,1,1),p=new f(c,s);return p.position.set(t,i,-a),p.rotateX(.5*-Math.PI),p},o=(e={})=>{n=jt(n,e),t=new d({depthTest:!1,uniforms:{uColor:{value:new m(n.flyColor)},uIndex:{value:0},uTotal:{value:n.divisions},uWidth:{value:n.flyPointWidth},uLength:{value:n.length}},vertexShader:"\n        attribute float aIndex;\n        uniform float uIndex;\n        uniform float uWidth;\n        uniform vec3 uColor;\n        varying float vSize;\n        uniform float uLength;\n  \n        void main(){\n            vec4 viewPosition = viewMatrix * modelMatrix * vec4(position,1);\n            gl_Position = projectionMatrix * viewPosition;\n  \n            if(aIndex >= uIndex - uLength && aIndex < uIndex){\n              vSize = uWidth * ((aIndex - uIndex + uLength) / uLength);\n            }\n            gl_PointSize = vSize;\n        }\n      ",side:h,fragmentShader:"\n        varying float vSize;\n        uniform vec3 uColor;\n        void main(){\n            if(vSize<=0.0){\n              gl_FragColor = vec4(1,0,0,0);\n            }else{\n              gl_FragColor = vec4(uColor,1);\n            }\n        }\n      ",transparent:!0,vertexColors:!1}),s=new d({uniforms:{uColor:{value:new m(n.pointColor)},uOpacity:{value:1},uSpeed:{value:.1},uSge:{value:4},uRadius:{value:n.pointWidth*n.factor/2},time:{value:0}},transparent:!0,depthTest:!1,vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          // 最终顶点位置信息=投影矩阵*模型视图矩阵*每个顶点坐标\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n      ",fragmentShader:"\n        varying vec2 vUv;\n        uniform vec3 uColor;\n        uniform float uOpacity;\n        uniform float uSpeed;\n        uniform float uSge;\n        uniform float time;\n        float PI = 3.14159265;\n        float drawCircle(float index, float range) {\n          float opacity = 1.0;\n          if (index >= 1.0 - range) {\n            opacity = 1.0 - (index - (1.0 - range)) / range;\n          } else if(index <= range) {\n            opacity = index / range;\n          }\n          return opacity;\n        }\n        float distanceTo(vec2 src, vec2 dst) {\n          float dx = src.x - dst.x;\n          float dy = src.y - dst.y;\n          float dv = dx * dx + dy * dy;\n          return sqrt(dv);\n        }\n        void main() {\n          float iTime = -time * uSpeed;\n          float opacity = 0.0;\n          float len = distanceTo(vec2(0.5, 0.5), vec2(vUv.x, vUv.y));\n  \n          float size = 1.0 / uSge;\n          vec2 range = vec2(0.65, 0.75);\n          float index = mod(iTime + len, size);\n          // 中心圆\n          vec2 cRadius = vec2(0.06, 0.12);\n  \n          if (index < size && len <= 0.5) {\n            float i = sin(index / size * PI);\n  \n            // 处理边缘锯齿\n            if (i >= range.x && i <= range.y){\n              // 归一\n              float t = (i - range.x) / (range.y - range.x);\n              // 边缘锯齿范围\n              float r = 0.3;\n              opacity = drawCircle(t, r);\n            }\n            // 渐变\n            opacity *=  1.0 - len / 0.5;\n          };\n          gl_FragColor = vec4(uColor, uOpacity * opacity);\n        }\n      ",side:h})},i=()=>{const e=t,a=e.uniforms.uTotal.value;e.uniforms.uIndex.value+=n.speed,e.uniforms.uIndex.value>=a&&(e.uniforms.uIndex.value=0);const o=.001*performance.now();s.uniforms.time.value=o};return o(),{createFlywireTexture:o,createFlywire:e=>{const s=new j,o=a(e[0]),i=a(e[1]);s.add(o,i);const r=(e=>{const[t,s]=e[0],[a,o]=e[1];let{depth:i,height:r,factor:l,divisions:c}=n;r=(i+r)*l,i*=l;const p=new w(t,i,-s),g=new w(t+(a-t)/4,r,-(s+(o-s)/4)),u=new w(t+3*(a-t)/4,r,-(s+3*(o-s)/4)),d=new w(a,i,-o);return new G(p,g,u,d).getPoints(c)})(e),l=new R(r,!1,"centripetal",.5),c=new B(l,n.tubularSegments,n.radius,n.radialSegments,n.closed),p=new d({transparent:!0,opacity:1,depthTest:!1,vertexColors:!1,uniforms:{uColor:{value:new m(n.color)},uOpacity:{value:.6}},vertexShader:"\n        varying vec3 vColor;\n        uniform vec3 uColor;\n        void main() {\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        uniform vec3 uColor;\n        uniform float uOpacity;\n        void main() {\n          gl_FragColor = vec4(uColor, uOpacity);\n        }\n      "}),g=new f(c,p);g.renderOrder=10;const u=(e=>{const s=new Float32Array(e.map(((e,t)=>t))),n=(new O).setFromPoints(e);return n.setAttribute("aIndex",new z(s,1)),new U(n,t)})(r);return s.add(g,u),s},update:i,flywireUpdate:i}})(),{createBar:ks}=((e={})=>{let t=jt({height:10,size:2,factor:1,color1:1048575,color2:16777215},e);return{createBar:(e={},s={})=>{t=jt(t,s);let{size:n,height:a,factor:o,color1:i,color2:r}=t;n*=o,a*=o,a*=e.heightRatio??o;const[l,c,p]=e.position||[0,0,0],g=new j,u=new E(n,n,a),h=new d({depthTest:!1,transparent:!0,vertexColors:!1,uniforms:{uColor1:{value:new m(i)},uColor2:{value:new m(r)},uOpacity:{value:.6}},vertexShader:"\n        varying vec3 vColor;\n        uniform vec3 uColor1;\n        uniform vec3 uColor2;\n        void main() {\n          float percent = (position.z + 0.0) / 100.0; // 计算当前像素点在立方体高度上的百分比\n          vColor = mix(uColor1.rgb, uColor2.rgb, percent);\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        varying vec3 vColor;\n        uniform float uOpacity;\n        void main() {\n          gl_FragColor = vec4(vColor, uOpacity);\n        }\n      "}),v=new f(u,h);if(g.add(v),g.name="柱状图",g.position.set(l,c,p+a/2),g.renderOrder=99,e.label){const{name:t="",className:s="",onClick:n}=e.label,o=ns({name:t,className:s,position:[0,0,a/2],onClick:n});o.rotateX(.5*Math.PI),g.add(o)}return g}}})(),js={x:105.06,y:0,z:32.93},Ss=new k;let As,Is,Ms,Ls,Ps;const Os=(e,t="/texttures")=>new URL(Object.assign({"../../assets/imgs/label.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAK+SURBVHgB7dzNbdswGIdxSugCRtGBuklWSO17nXs/J0hHywA11AEMu3wDsLFT5WCJ5PtI/D8nQ5cA/FmxJJLqtofhHBSmPihUAoElEFgCgfVu7ODX95suqOKNXVDpDIElEFgCgSUQWAKBJRBYAoE1G2Q3DJ/j9fRjUGE7DI+f4niEGc0CMYzzKezjx7vWUQwjnMJdF8djDsq8M+QYLu/om0VJGP8OXI/LTc0C+fJhs4/fiIeLQ82hvMaI/zEevsVxCROb/RvSMkpuDCvLVVaLKCUwrGyXvS2hlMKwst6HtIBSEsPKfmO4ZpTSGFaRO/U1otTAsIo9OlkTSi0Mq+izrDWg1MSwij9cXDJKbQyrytPeJaJ4YFjVHr8vCcULw6o6H7IEFE8Mq/oEFRnFG8NymTEkohAwLLcpXBIKBcNynVMnoJAwLPdFDp4oNAwLserEA4WIYXVjK7C9Vr+fY8Gh7e8/Lhha/f5GhDMjJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJRBYAoElEFgCgSUQWAKBJZDwvIIQs2kIA/K81tYvzKYhBMh/75vyCYHiDgLBSLmjuIK8xrBV6J1HoO11biCk/Rmk7XUuIMTNMhSU6iDUnUsWAaUqCBkj5Y1SDWQJGClPlCogS8JIeaEUB1kiRsoDpSjIkjFStVGKgawBI1UTpQjImjBStVCyg6wRI1UDJSvImjFSpVGygbSAkSqJkgWkJYxUKZTZIC1ipEqgzAJpGSOVG2UyiDBeyokyCWR3OOyFcd0Yyu4wfA83Ngnk2Pe/ziE82WdhvHSJYuNz7MPPcGOTQH5sNk+nPnyMf/xeGNcZSvyS3tv42DiFG0O94q+19Iq/BSQQWAKBJRBYAoElEFgCgSUQWKM3hsovnSGwBAJLILAEAusvLK6Na4P/Au0AAAAASUVORK5CYII=","../../assets/imgs/sky/216/negX.jpeg":ye,"../../assets/imgs/sky/216/negY.jpeg":we,"../../assets/imgs/sky/216/negZ.jpeg":be,"../../assets/imgs/sky/216/posX.jpeg":xe,"../../assets/imgs/sky/216/posY.jpeg":Ce,"../../assets/imgs/sky/216/posZ.jpeg":ke,"../../assets/imgs/sky/217/negX.jpeg":je,"../../assets/imgs/sky/217/negY.jpeg":Se,"../../assets/imgs/sky/217/negZ.jpeg":Ae,"../../assets/imgs/sky/217/posX.jpeg":Ie,"../../assets/imgs/sky/217/posY.jpeg":Me,"../../assets/imgs/sky/217/posZ.jpeg":Le,"../../assets/imgs/sky/218/negX.jpeg":Pe,"../../assets/imgs/sky/218/negY.jpeg":Oe,"../../assets/imgs/sky/218/negZ.jpeg":_e,"../../assets/imgs/sky/218/posX.jpeg":ze,"../../assets/imgs/sky/218/posY.jpeg":Ue,"../../assets/imgs/sky/218/posZ.jpeg":Re,"../../assets/imgs/sky/219/negX.jpeg":Be,"../../assets/imgs/sky/219/negY.jpeg":Ge,"../../assets/imgs/sky/219/negZ.jpeg":Ee,"../../assets/imgs/sky/219/posX.jpeg":Fe,"../../assets/imgs/sky/219/posY.jpeg":De,"../../assets/imgs/sky/219/posZ.jpeg":Te,"../../assets/imgs/sky/220/negX.jpeg":Ye,"../../assets/imgs/sky/220/negY.jpeg":Xe,"../../assets/imgs/sky/220/negZ.jpeg":Je,"../../assets/imgs/sky/220/posX.jpeg":We,"../../assets/imgs/sky/220/posY.jpeg":$e,"../../assets/imgs/sky/220/posZ.jpeg":Ze,"../../assets/imgs/sky/221/negX.jpeg":Ne,"../../assets/imgs/sky/221/negY.jpeg":Ve,"../../assets/imgs/sky/221/negZ.jpeg":Ke,"../../assets/imgs/sky/221/posX.jpeg":Qe,"../../assets/imgs/sky/221/posY.jpeg":He,"../../assets/imgs/sky/221/posZ.jpeg":qe,"../../assets/imgs/sky/222/negX.jpeg":et,"../../assets/imgs/sky/222/negY.jpeg":tt,"../../assets/imgs/sky/222/negZ.jpeg":st,"../../assets/imgs/sky/222/posX.jpeg":nt,"../../assets/imgs/sky/222/posY.jpeg":at,"../../assets/imgs/sky/222/posZ.jpeg":ot,"../../assets/imgs/sky/223/negX.jpeg":it,"../../assets/imgs/sky/223/negY.jpeg":rt,"../../assets/imgs/sky/223/negZ.jpeg":lt,"../../assets/imgs/sky/223/posX.jpeg":ct,"../../assets/imgs/sky/223/posY.jpeg":pt,"../../assets/imgs/sky/223/posZ.jpeg":gt,"../../assets/imgs/sky/224/negX.jpeg":ut,"../../assets/imgs/sky/224/negY.jpeg":dt,"../../assets/imgs/sky/224/negZ.jpeg":mt,"../../assets/imgs/sky/224/posX.jpeg":ht,"../../assets/imgs/sky/224/posY.jpeg":ft,"../../assets/imgs/sky/224/posZ.jpeg":vt,"../../assets/imgs/sky/225/negX.jpeg":yt,"../../assets/imgs/sky/225/negY.jpeg":wt,"../../assets/imgs/sky/225/negZ.jpeg":bt,"../../assets/imgs/sky/225/posX.jpeg":xt,"../../assets/imgs/sky/225/posY.jpeg":Ct,"../../assets/imgs/sky/225/posZ.jpeg":kt,"../../assets/imgs/texttures/arrow.png":Mt,"../../assets/imgs/texttures/border.png":Lt,"../../assets/imgs/texttures/circle.png":Pt,"../../assets/imgs/texttures/fenceMap0.png":Ot,"../../assets/imgs/texttures/fenceMap1.png":_t,"../../assets/imgs/texttures/fenceMap2.png":zt,"../../assets/imgs/texttures/gz-map-fx.jpg":Ut,"../../assets/imgs/texttures/gz-map.jpg":Rt,"../../assets/imgs/texttures/inner-circle.png":Bt,"../../assets/imgs/texttures/lensflare0.png":Gt,"../../assets/imgs/texttures/lensflare0_alpha.png":Et,"../../assets/imgs/texttures/lensflare1.png":Ft,"../../assets/imgs/texttures/lensflare2.png":Dt,"../../assets/imgs/texttures/lensflare3.png":Tt,"../../assets/imgs/texttures/light.png":Yt,"../../assets/imgs/texttures/out-circle.png":Xt,"../../assets/imgs/texttures/point.png":Jt})[`../../assets/imgs${t}/${e}`],self.location).href,_s=(e,t,s)=>t?Wt(t,s):e,zs=(e,t)=>{const s=new J(t),n={depth:e.config.depth,bevelEnabled:!0,bevelSegments:1,bevelThickness:0,steps:0,bevelSize:0},a=new W(s,n),o=new $({color:e.color.main,map:As,normalMap:Is,combine:Z,transparent:!0,opacity:.8}),i=new N({color:os.borderColor,map:Ms,transparent:!0,opacity:.9}),r=new f(a,[o,i]);return r.scale.setScalar(e.config.scale),r.name="地图拼块",r},Us=Os("label.png",""),Rs=(e,t,s)=>{if(!t.centroid&&!t.center)return!1;const{depth:n,scale:a}=e.config,[o,i]=t.centroid||t.center,r=rs({name:`\n      <img src="${Us}" />\n      <div class="name">${t.name}</div>\n    `,className:"map-3D-label",position:[o*a,i*a*.995,n*a]});r.rotateX(.5*Math.PI),r.name=t.name+"_CSS3D_label",r.isLabel=!0,s.add(r)},Bs=(e,t,s)=>{if(!t.centroid&&!t.center)return!1;const{depth:n,scale:a}=e.config,o=1+(i=5,r=10,(Math.floor(Math.random()*(r-i+1))+i)/4);var i,r;const[l,c]=t.centroid||t.center,p=hs([l,c,1.01*n].map((e=>e*a)),o*a,{factor:a,color:e.color.markColor1});p.rotateX(-Math.PI/2),s.add(p)},Gs=(e,t,s)=>{const{scale:n,depth:a}=e.config,o=new j,i=.2*n,r=new V(i,32),l=new S({color:os.scatterColor1,transparent:!0,opacity:1}),c=new f(r,l),p=new K(.8*i,32,32,0,Math.PI),g=new S({color:os.scatterColor2,transparent:!0,opacity:1}),u=new f(p,g);return o.add(c,u),o.position.set(t*n,s*n,a*n*1.005),o};class Es extends It{constructor(n,a={},o={},l,c){super(n),i(this,s),i(this,e,void 0),i(this,t,void 0),this.config=jt(as,a),this.color=jt(os,o),r(this,e,l),r(this,t,c),this.clock=new F,this.css3DRender=is(this.options,this.container),((e,t)=>{As=Ss.load(_s(Os("gz-map.jpg"),e.map.map,t)),Is=Ss.load(_s(Os("gz-map-fx.jpg"),e.map.normal,t)),Ms=Ss.load(_s(Os("border.png"),e.map.side,t)),As.wrapS=Is.wrapS=Ms.wrapS=X,As.wrapT=Is.wrapT=Ms.wrapT=X,As.flipY=!1;const s=.0128;As.repeat.set(s,s),Is.repeat.set(s,s),Ls=Ss.load(_s(Os("out-circle.png"),e.map.bgOutCircle,t)),Ps=Ss.load(_s(Os("inner-circle.png"),e.map.bgInnerCircle,t))})(this.config,this.options.baseUrl),this.bindEvent()}addCorrugatedPlate(){this.corrugatedPlate&&(this.disposeObj(this.corrugatedPlate),this.corrugatedPlate=void 0);const e=us({range:this.config.plateRadius,factor:this.config.scale,color:this.color.plateColor,light:this.color.plateLight});e.renderOrder=0,this.corrugatedPlate=e,this.addObject(e)}initMap(e){this.mapGroup&&(this.disposeObj(this.mapGroup),this.mapGroup=null);const t=new j;t.name="地图";const s=e.features,n=s.length;for(let c=0;c<n;c++){const e=s[c],n=new D,a=e.geometry.coordinates,o=e.properties;for(let t=0;t<a.length;t++)a[t].forEach((e=>{const t=e.map((e=>new T(e[0],e[1]))),s=zs(this,t);s.isProvinceBlock=!0,n.add(s)}));this.config.areaLabel&&Rs(this,o,n),this.config.markLight&&Bs(this,o,n),n.rotateX(-Math.PI/2),n.isProvinceGroup=!0,n.name=o.name,n.data=o,t.add(n)}this.mapGroup=t,this.addObject(t),this.config.border&&((e,t)=>{let s=fs(t,{color:os.line,transparent:!0},"Line2");const{depth:n,scale:a}=e.config;s.name="地图上边框",s.position.y+=n*a;let o=fs(t,{color:os.line2},"Line2");o.name="地图下边框",s.scale.setScalar(a),o.scale.setScalar(a),e.scene.add(s),e.scene.add(o)})(this,e);const a=ms(t);let{size:o,center:{x:i,y:r,z:l}}=a;if(js.x=i,js.y=r,js.z=l,this.corrugatedPlate.position.set(i,0-.1*this.config.scale,l),this.resetSceneEle(),this.config.mapBg){const e=o.x<o.y?o.y+1:o.x+1;this.outRingMesh=((e,t)=>{let s=new v(t,t),n=new S({map:Ls,transparent:!0,opacity:.6,depthTest:!0}),a=new f(s,n);const{x:o,z:i}=js;return a.position.set(o,-1,i),a.scale.setScalar(1.2),a.rotateX(.5*-Math.PI),e.add(a),a})(this.scene,e*this.config.bgOutFactor),this.innerRingMesh=((e,t)=>{let s=new v(t,t),n=new S({map:Ps,transparent:!0,opacity:.3,depthTest:!0}),a=new f(s,n);const{x:o,z:i}=js;return a.position.set(o,-2,i),a.scale.setScalar(1.2),a.rotateX(.5*-Math.PI),e.add(a),a})(this.scene,e*this.config.bgInnerFactor)}}initMapOutLine(e){this.outline&&(this.disposeObj(this.outline),this.outline=null);const t=vs(e,this.config.depth,!1),s=ys(t,{factor:this.config.scale,color:this.color.outline});s.renderOrder=10,this.outline=s,this.addObject(s)}initFlywire(e){this.flywireGroup&&(this.disposeObj(this.flywireGroup),this.flywireGroup=null);const{scale:t,depth:s}=this.config,n=this.color;bs({depth:s,color:n.line,flyColor:n.flyColor2,pointColor:n.flyColor1,factor:t});const a=new j;for(let o=0;o<e.length;o++){const{coords:s,path:n}=e[o],i=xs(s.map((e=>e.map((e=>e*t)))));i.name=n,a.add(i)}a.name="飞线集合",a.renderOrder=20,this.flywireGroup=a,this.addObject(a)}initMapBar(e,t){if(!this.config.mapBar)return;if(!this.mapGroup)return;this.clearMapBar();const s=Math.max(...e.map((e=>e.value||0))),{scale:n,depth:a}=this.config,o=this.color,i={height:5,size:.2,factor:n,color1:o.markColor1,color2:o.markColor2};for(let r=0;r<e.length;r++){const{name:o="",value:l=0}=e[r],c=this.mapGroup.getObjectByName(o);if(c){const o=l/s||0,{centroid:p,center:g}=c.data,u=p||g,d=ks({position:[u[0]*n,u[1]*n,a*n],heightRatio:o,label:t(e[r])},i);d.isBar=!0,c.add(d)}else;}}clearMapBar(){this.mapGroup.traverse((e=>{e.isBar&&this.disposeObj(e)}))}initScatter(e){this.scatterGroup&&(this.disposeObj(this.scatterGroup),this.scatterGroup=null);const t=new j;t.name="散点集合";for(let s=0;s<e.length;s++){const n=e[s],[a=0,o=0]=n.coord||[],i=Gs(this,a,o);i.name=n.name,i.data=n,i.isScatter=!0,t.add(i)}t.rotateX(.5*-Math.PI),this.scatterGroup=t,this.addObject(t)}onDblclick(e){}onPointerDown(e){this.pointer.isClick=!0,this.pointer.tsp=e.timeStamp}onPointerMove(e){const t=this.container,a=this.options.scale;if(gs(e,t,a),this.mapGroup){ls.setFromCamera(cs,this.camera);const e=[this.mapGroup];this.scatterGroup&&e.push(this.scatterGroup);const t=ls.intersectObjects(e);if(this.container.style.cursor=t.length?"pointer":"auto",t.length>0){const e=t[0].object;let a;const o=this.findParentGroupGroupUuid(e);o&&(a=o.uuid,l(this,s,n).call(this,o)),this.setMapBlockColor(a)}else l(this,s,n).call(this),this.setMapBlockColor()}}onPointerUp(e){this.pointer.isClick=!1;const t=e.timeStamp-this.pointer.tsp<(this.config.rightClickBackDiffTime||Kt.rightClickBackDiffTime);2==e.button||(0==e.button?t&&this.clickObject(e):e.button)}findParentGroupGroupUuid(e){const t=e=>{let s=e.parent;if(s)return s&&s.isProvinceGroup||s.isScatter?s:t(s)};return t(e)}setMapBlockColor(e){this.mapGroup.traverse((t=>{if(t.isProvinceBlock)t.material[0].color.set(t.parent.uuid===e?this.color.mainHover:this.color.main),t.material[1].color.set(t.parent.uuid===e?this.color.borderHoverColor:this.color.borderColor);else if(t.isLabel){const s=t.parent.uuid===e;t.element.className="map-3D-label"+(s?" is-active":"")}}))}clickObject(e){const s=this.container,n=this.options.scale;if(gs(e,s,n),this.scatterGroup){ls.setFromCamera(cs,this.camera);const e=[this.scatterGroup],s=ls.intersectObjects(e);if(this.container.style.cursor=s.length?"pointer":"auto",s.length){const e=s[0].object,n=this.findParentGroupGroupUuid(e).data||{};"function"==typeof o(this,t)&&o(this,t).call(this,n)}}}resetSceneEle(){const{x:e,y:t,z:s}=js;if(this.camera.lookAt(e,t,s),new A(this.camera.position).to({x:e,y:90*this.config.scale,z:s+40*this.config.scale},1e3).easing(Y.Quadratic.In).start().onUpdate((()=>{})),this.controls.target=new w(e,t,s-5*this.config.scale),this.grid){this.grid.position.set(e,0,s);const t=this.scene.getObjectByProperty("_isGridFork_",!0);t&&t.position.set(e,0,s)}}modelAnimate(){let e=this.clock.getDelta();this.corrugatedPlate&&ds(this.corrugatedPlate,e),this.css3DRender&&this.css3DRender.render(this.scene,this.camera),Ms&&(Ms.offset.y+=.005),this.outRingMesh&&(this.outRingMesh.rotation.z+=5e-4),this.innerRingMesh&&(this.innerRingMesh.rotation.z-=5e-4),this.outline&&ws(this.outline),this.flywireGroup&&Cs()}resize(){if(super.resize(),this.css3DRender){const{width:e,height:t}=this.options;this.css3DRender.setSize(e,t)}}dispose(){this.disposeObj(this.corrugatedPlate),this.disposeObj(this.mapGroup),this.disposeObj(this.scatterGroup),this.disposeObj(this.flywireGroup),this.disposeObj(this.outline),this.disposeObj(this.outRingMesh),this.disposeObj(this.innerRingMesh),this.clock=null,this.css3DRender=null,this.corrugatedPlate=null,this.mapGroup=null,this.scatterGroup=null,this.flywireGroup=null,this.outline=null,this.outRingMesh=null,this.innerRingMesh=null,super.dispose()}}e=new WeakMap,t=new WeakMap,s=new WeakSet,n=function(t){"function"==typeof o(this,e)&&o(this,e).call(this,t,ps)};const Fs=Ht(Q({__name:"index",props:{devEnv:{type:Boolean},baseUrl:{},bgColor:{},skyCode:{},bgUrl:{},env:{},scale:{},camera:{default:()=>({})},cruise:{default:()=>({})},fog:{default:()=>({})},render:{default:()=>({})},controls:{default:()=>({})},grid:{default:()=>({})},axes:{default:()=>({})},directionalLight:{},color:{default:()=>({})},config:{default:()=>({})},corrugatedPlate:{type:Boolean,default:!0},mapJson:{},outlineJson:{},flywire:{},barList:{},scatters:{},barLabelRender:{}},emits:["init","click"],setup(e,{expose:t,emit:s}){const{backgroundLoad:n}=Vt(),{transformGeoJSON:a}={transformGeoJSON:e=>{let t=e.features;for(let s=0;s<t.length;s++){const e=t[s];"Polygon"===e.geometry.type&&(e.geometry.coordinates=[e.geometry.coordinates])}return e}},{show:o,dialog:i}=Qt({style:{left:"0px",top:"0px"},extend:{}}),r=e,l=H(),c=s;q((()=>r.scale),(e=>{null==u||u.setScale(e||1)})),q((()=>r.mapJson),(e=>{e&&(null==u||u.initMap(a(e)))})),q((()=>r.outlineJson),(e=>{e&&(null==u||u.initMapOutLine(a(e)),r.barList&&(null==u||u.initMapBar(r.barList||[],p)))})),q((()=>r.flywire),(e=>{null==u||u.initFlywire(e||[])})),q((()=>r.barList),(e=>{null==u||u.initMapBar(e||[],p)})),q((()=>r.scatters),(e=>{null==u||u.initScatter(e||[])}));const p=e=>{if("function"==typeof r.barLabelRender)return r.barLabelRender(e);const{name:t="",value:s=0,unit:n=""}=e;return{name:`\n      <div class="label-wrap">\n        <div class="name">${t}</div>\n        <div class="text">\n          <span class="value">${$t(s)}</span>\n          <span class="unit">${n}</span>\n        </div>\n      </div>\n    `,className:"map-bar-label"}},g={baseUrl:r.baseUrl,bgUrl:r.bgUrl,env:r.env,bgColor:r.bgColor,camera:r.camera,cruise:r.cruise,fog:r.fog,render:r.render,grid:r.grid,controls:r.controls,axes:r.axes};let u;return ee((()=>{g.container=l.value,u=new Es(g,r.config,r.color,((e,t)=>{let s=!!e;if(s){i.style&&(i.style.left=t.left+"px",i.style.top=t.top+"px");const n=e.isScatter,a=e.data;if(n)a.isScatter=!0,i.extend=a;else{const t=(r.barList||[]).find((t=>t.name==e.name));t?i.extend=t:s=!1}}o.value=s}),(e=>{c("click",te(e))})),u.run(),c("init",u),r.skyCode&&n(u,r.skyCode),r.corrugatedPlate&&(null==u||u.addCorrugatedPlate()),r.flywire&&r.flywire.length&&(null==u||u.initFlywire(r.flywire))})),t({exportImage:()=>null==u?void 0:u.exportImage()}),(e,t)=>(se(),ne("div",{class:oe(e.$style["map-scene"])},[ae("div",{class:oe(e.$style.container),ref_key:"containerRef",ref:l},null,2),ie(o)?(se(),ne("div",{key:0,class:oe(e.$style["dialog-view"]),style:re(ie(i).style)},[le(e.$slots,"dialog",{data:ie(i).extend})],6)):ce("",!0)],2))}}),[["__cssModules",{$style:{"map-scene":"_map-scene_5opvk_2",container:"_container_5opvk_8","dialog-view":"_dialog-view_5opvk_12"}}]]),Ds={depth:2,scale:40,plateRadius:100},Ts={main:3377879,mainHover:9633791,borderColor:9633791,borderHoverColor:1066618,light:1066618,lightHover:9633791,plateColor:3377879,plateLight:1066618,line:9559027,line2:6421501,gridColor:663606,gridFork:927811,outline:11856636,markColor1:13303807,markColor2:6945023,flyColor1:9559027,flyColor2:6421501,scatterColor1:9559027,scatterColor2:6421501},Ys=["src"],Xs=Ht(Q({__name:"index",setup(e){const{load:t}=(()=>{const e=H(0);return{load:t=>{const s=new pe;return new Promise(((n,a)=>{s.load(t,(e=>{let t={};try{t=JSON.parse(e)}catch(s){}n(t)}),(t=>{let{loaded:s,total:n}=t;e.value=Number((s/n*100).toFixed(0))}),a)}))},progress:e}})(),s=H(),n=ge({devEnv:!0,baseUrl:"",bgColor:464681,color:Ts,config:{...Ds,areaLabel:!0,markLight:!0,map:{}},camera:{position:[0,100,200]},directionalLight:{helper:!0},fog:{visible:!1,near:2e3,far:3e3},render:{preserveDrawingBuffer:!0},grid:{visible:!0,gridColor:Ts.gridColor,centerLineColor:Ts.gridColor,fork:!0,divisions:40,width:2*Ds.plateRadius*Ds.scale,forkSize:1.4*Ds.scale,forkColor:Ts.gridFork},controls:{maxPolarAngle:.46*Math.PI,maxDistance:5e3,enableDamping:!0,screenSpacePanning:!1},axes:{visible:!0},mapJson:null,outlineJson:null,flywire:[],barList:[],scatters:[]}),a=()=>{var e;return null==(e=s.value)?void 0:e.exportImage()},o=e=>{const s=n.baseUrl;t(`${s}/oss/map/china.json`).then((e=>{n.mapJson=e})),t(`${s}/oss/map/china-outline.json`).then((e=>{n.outlineJson=e})),Zt(e).resize()},i=e=>{fe.info({message:e.name,grouping:!0})},r=e=>{const{name:t="",value:s=0,unit:n=""}=e;return{name:`\n      <div class="label-wrap">\n        <div class="name">${t}</div>\n        <div class="text">\n          <span class="value">${ts(s)}</span>\n          <span class="unit">${n}</span>\n        </div>\n      </div>\n    `,className:"map-bar-label"}},l=()=>{qt.get(es.d3.map).then((e=>{const t=[],s=[];return e.list.forEach((e=>{const n=e.projects.length;let a=e.province;["重庆","北京","天津","上海"].includes(a)&&(a+="市"),["台湾"].includes(a)&&(a+="省"),e.projects.forEach((s=>{t.push({coord:[s.lng,s.lat],name:s.name,carbon:s.carbon,value:s.use,total:n,city:e.province,id:s.id})}));const o=e.total;-1===s.findIndex((e=>e.name===a))&&s.push({id:e.code,name:a,total:n,value:o,unit:"kWh"})})),{citys:s,projects:t,lines:e.lines}})).then((e=>{n.flywire=e.lines,n.barList=e.citys,n.scatters=e.projects}))};return ee((()=>{l()})),(e,t)=>{const l=ve;return se(),ne("div",{class:oe([e.$style.page,"h-100 o-h"])},[ae("div",{class:oe(e.$style.operate)},[ue(l,{type:"primary",size:"small",onClick:a},{default:de((()=>t[0]||(t[0]=[me("导出")]))),_:1})],2),ue(Fs,{ref_key:"threeSceneRef",ref:s,"dev-env":ie(n).devEnv,"base-url":ie(n).baseUrl,"bg-color":ie(n).bgColor,"bg-url":ie(n).bgUrl,env:ie(n).env,"sky-code":ie(n).skyCode,camera:ie(n).camera,cruise:ie(n).cruise,render:ie(n).render,controls:ie(n).controls,"directional-light":ie(n).directionalLight,grid:ie(n).grid,axes:ie(n).axes,config:ie(n).config,color:ie(n).color,"map-json":ie(n).mapJson,"outline-json":ie(n).outlineJson,flywire:ie(n).flywire,"bar-list":ie(n).barList,scatters:ie(n).scatters,"bar-label-render":r,onInit:o,onClick:i},{dialog:de((({data:s})=>[ae("div",{class:oe(e.$style["dialog-view"])},[ae("div",{class:oe([e.$style.city,"flex"])},[ae("span",{class:oe(e.$style.name)},he(s.isScatter?s.city:s.name),3),ae("span",{class:oe(e.$style.total)},he(s.total)+"个项目",3)],2),s.isScatter?(se(),ne("div",{key:0,class:oe([e.$style.project,"flex flex-ac"])},[ae("img",{src:`${ie(n).baseUrl}/oss/img/map/pos.png`,alt:""},null,8,Ys),ae("span",{class:oe(e.$style.name)},he(s.name),3)],2)):ce("",!0),ae("div",{class:oe(e.$style.count)},[ae("div",{class:oe(e.$style.item)},[t[1]||(t[1]=ae("span",null,"今日用电量",-1)),ae("span",null,he(ie(ts)(s.value)),1),t[2]||(t[2]=ae("span",null,"kWh",-1))],2),s.isScatter?(se(),ne("div",{key:0,class:oe(e.$style.item)},[t[3]||(t[3]=ae("span",null,"今日碳排放",-1)),ae("span",null,he(ie(ts)(s.carbon)),1),t[4]||(t[4]=ae("span",null,"kgCO₂",-1))],2)):ce("",!0)],2)],2)])),_:1},8,["dev-env","base-url","bg-color","bg-url","env","sky-code","camera","cruise","render","controls","directional-light","grid","axes","config","color","map-json","outline-json","flywire","bar-list","scatters"])],2)}}}),[["__cssModules",{$style:{page:"_page_dcgzt_2",operate:"_operate_dcgzt_8","dialog-view":"_dialog-view_dcgzt_15",city:"_city_dcgzt_20",name:"_name_dcgzt_20",total:"_total_dcgzt_28",project:"_project_dcgzt_33",count:"_count_dcgzt_48",item:"_item_dcgzt_52"}}]]);export{Xs as default};
