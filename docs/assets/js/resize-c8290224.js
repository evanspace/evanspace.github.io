var t=Object.defineProperty,e=(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s);import{ba as i,bc as s,aW as n,ci as o,bj as r,bf as a,bg as h,b1 as c,aX as l,aY as d,aZ as p,be as m,bh as b,bi as g,a_ as w,bx as f,bb as u,w as v,af as y}from"./vendor-8d16b5c9.js";import{u as j}from"./common-412f8517.js";const x=t=>((t,e)=>Object.prototype.toString.call(e)===`[object ${t}]`)("Object",t),L=(t,e=new Map)=>{if(null!=t&&x(t)){let i=e.get(t);if(i)return i;const s=Array.isArray(t);let n=s?[]:{};return i=e.set(t,n),s?t.forEach(((t,e)=>{n[e]=L(t,i)})):Object.keys(t).forEach((e=>{x(n[e])?n[e]=L(t[e],i):n[e]=t[e]})),n}return t},C=(t,e)=>{t=L(t);for(let i in e)i in t&&x(e[i])&&x(t[i])?t[i]=C(t[i],e[i]):t[i]=e[i];return t},O=(t,e)=>Math.floor(Math.random()*(e-t+1))+t,E={container:document.body,width:window.innerWidth,height:window.innerHeight,bgColor:null,bgUrl:null,env:null,scale:1,fog:{visible:!1,near:100,far:1e3},controls:{visible:!0,enableDamping:!1,dampingFactor:.25,autoRotate:!1,enableZoom:!0,enablePan:!0,screenSpacePanning:!0,minDistance:1,maxDistance:2e3},lightHelperVisible:!1,ambientLight:{visible:!0,color:16777215,intensity:1.5},directionalLight:{visible:!0,light2:!0,color:16777215,intensity:1.5},camera:{near:1,far:1e4,position:[-350,510,700]},grid:{visible:!1,opacity:.3,transparent:!0,width:800,divisions:80,centerLineColor:10592673,gridColor:10592673},axes:{visible:!1,size:50}},A=class t{constructor(s={}){e(this,"options"),e(this,"container"),e(this,"scene"),e(this,"renderer"),e(this,"camera"),e(this,"controls"),e(this,"grid"),e(this,"animationId"),e(this,"clear",(t=>{t&&t.traverse&&(t.traverse((t=>{t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose(),null==t||t.clear()})),null==t||t.clear())})),e(this,"disposeObj",(t=>{t&&t.traverse&&(t.traverse((t=>{t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose(),null==t||t.clear()})),null==t||t.clear(),this.scene.remove(t))}));const n=E;var o;this.options=C(n,s),t.total++,(o=this.options.container)&&("object"==typeof HTMLElement?o instanceof HTMLElement:o&&"object"==typeof o&&1===o.nodeType&&"string"==typeof o.nodeName)?this.container=this.options.container:this.container=document.querySelector(this.options.container),this.options.width=this.container.offsetWidth,this.options.height=this.container.offsetHeight,this.scene=new i,this.renderer=this.initRenderer(),this.init(),this.camera=this.initCamera(),this.controls=this.initControls()}init(){this.initLight(),this.initGrid(),this.initAxes(),this.initModel()}run(){this.loop()}loop(){this.animationId=window.requestAnimationFrame((()=>{this.loop()})),this.animate(),this.modelAnimate()}animate(){this.renderer&&this.renderer.render(this.scene,this.camera),this.options.controls.visible&&this.controls.update(),s()}initModel(){}modelAnimate(){}initRenderer(){const{width:t,height:e,bgColor:i,bgUrl:s,env:a}=this.options,h=new n({antialias:!0,logarithmicDepthBuffer:!0});if(a&&this.setEnvironment(a),s?this.setBgTexture(s):this.setBgColor(i),this.options.fog.visible){const{color:t,near:e,far:i}=this.options.fog;this.scene.fog=new o(t??this.scene.background,e,i)}return h.sortObjects=!0,h.shadowMap.enabled=!0,h.shadowMap.type=r,h.setSize(t,e),h.setPixelRatio(window.devicePixelRatio),this.container.appendChild(h.domElement),h}initLight(){const{ambientLight:t,directionalLight:e,lightHelperVisible:i}=this.options;if(t.visible){const e=new a(t.color,t.intensity);this.addObject(e)}if(e.visible){const t=this.createDirectionalLight();if(this.addObject(t),i){const e=new h(t,1);this.addObject(e)}if(e.light2){const t=this.createDirectionalLight(!1);if(t.position.set(-500,800,-800),this.addObject(t),i){const e=new h(t,1);this.addObject(e)}}}}createDirectionalLight(t=!0,e=800,i=4096,s=1,n=2e3){const{color:o,intensity:r}=this.options.directionalLight,a=new c(o,r);if(a.position.set(500,800,800),t){a.shadow.mapSize.setScalar(i),a.shadow.bias=-1e-5,a.shadow.normalBias=.01,a.castShadow=t;const o=a.shadow.camera;o.radius=10,o.near=s,o.far=n,o.top=o.right=e,o.left=o.bottom=-e,o.updateProjectionMatrix()}return a}initCamera(){const{width:t,height:e,camera:i}=this.options,s=new l(36,t/e,i.near,i.far);return s.position.set(...i.position),this.addObject(s),s}initControls(){const t=this.options.controls;if(!t.visible)return;const e=new d(this.camera,this.renderer.domElement);return Object.keys(t).forEach((i=>{e[i]=t[i]})),e.target.set(0,0,0),e}initGrid(){const t=this.options.grid;if(!t.visible)return;const{width:e,divisions:i,centerLineColor:s,gridColor:n,opacity:o,transparent:r}=t,a=new p(e,i,s,n);a.material.opacity=o,a.material.transparent=r,this.grid=a,this.addObject(a)}initAxes(){if(!this.options.axes.visible)return;const t=new m(this.options.axes.size);this.addObject(t)}setEnvironment(t){(new b).load(t,(t=>{t.mapping=g,this.scene.environment=t}))}setBgTexture(t){if(Array.isArray(t)){const e=(new w).load(t);this.scene.background=e}else this.scene.background=(new f).load(t)}setBgColor(t){this.scene.background=t?new u(t):null}addObject(...t){this.scene.add(...t)}resize(){if(!this.camera)return;this.options.width=this.container.offsetWidth||window.innerWidth,this.options.height=this.container.offsetHeight||window.innerHeight;const{width:t,height:e}=this.options,i=t/e;this.camera.aspect=i,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e)}stopAnimate(){window.cancelAnimationFrame(this.animationId)}dispose(){try{this.scene.clear(),this.renderer.dispose(),this.renderer.forceContextLoss(),this.renderer.content=null;let t=this.renderer.domElement.getContext("webgl");t&&t.getExtension("WEBGL_lose_context").loseContext()}catch(t){}}};e(A,"total",0);let M=A;const z=t=>({resize:()=>{const e=()=>null==t?void 0:t.resize();v((()=>j().sidebar.opened),(()=>{setTimeout(e,300)})),window.addEventListener("resize",e,!1),y((()=>{null==t||t.stopAnimate(),null==t||t.dispose(),window.removeEventListener("resize",e)}))}});export{M as T,C as d,O as r,z as u};
