{"version":3,"file":"index-e0e5b42c.js","sources":["../../../code/src/pages/webgl/controls/transform/methods.ts","../../../code/src/pages/webgl/controls/transform/index.vue"],"sourcesContent":["import * as THREE from 'three'\nimport * as ThreeScene from 'three-scene'\nimport { TransformControls } from 'three/examples/jsm/controls/TransformControls'\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js'\n\nexport class NewThreeScene extends ThreeScene.Scene {\n  clock: InstanceType<typeof THREE.Clock>\n  gui: InstanceType<typeof GUI>\n  transformControls?: InstanceType<typeof TransformControls>\n\n  constructor(options: ConstructorParameters<typeof ThreeScene.Scene>[0]) {\n    super(options)\n\n    this.clock = new THREE.Clock()\n\n    this.addControls()\n    this.initModel()\n\n    this.gui = new GUI()\n    this.addGui()\n  }\n\n  init() {\n    this.initLight()\n    this.initGrid()\n    this.initAxes()\n  }\n\n  addControls() {\n    const camera = this.camera\n    const controls = new TransformControls(camera, this.renderer.domElement)\n\n    // 监听相机变化\n    controls.addEventListener('dragging-changed', e => {\n      this.controls && (this.controls.enabled = !e.value)\n    })\n\n    this.transformControls = controls\n    this.addObject(controls.getHelper())\n  }\n\n  addGui() {\n    const gui = this.gui\n    const control = this.transformControls\n    if (!control) return\n    const params = {\n      w: () => {\n        control.setMode('translate')\n      },\n      e: () => {\n        control.setMode('rotate')\n      },\n      r: () => {\n        control.setMode('scale')\n      },\n\n      x: false,\n      y: false,\n      z: false,\n\n      add: () => {\n        control.setSize(control.size + 0.1)\n      },\n      sub: () => {\n        control.setSize(Math.max(control.size - 0.1, 0.1))\n      },\n      space: false\n    }\n    const group = gui.addFolder('键盘快捷键')\n\n    group.add(params, 'w').name('“W”切换坐标辅助)')\n    group.add(params, 'e').name('“E”切换旋转辅助)')\n    group.add(params, 'r').name('“R”切换缩放辅助)')\n\n    group.add(control, 'showX').name('“X”坐标系 x 轴隐显)')\n    group.add(control, 'showY').name('“Y”坐标系 y 轴隐显)')\n    group.add(control, 'showZ').name('“Z”坐标系 z 轴隐显)')\n\n    group.add(params, 'add').name('“+”,\"=\"坐标系放大)')\n    group.add(params, 'sub').name('“-”,\"_\"坐标系缩小)')\n    group.add(control, 'enabled').name('“空格”坐标系禁/启用)')\n\n    // @ts-ignore\n    gui.domElement.style = 'position: absolute; top: 0px; right: 0px'\n    this.container.parentNode?.appendChild(gui.domElement)\n  }\n\n  initModel() {\n    const geo = new THREE.PlaneGeometry(300, 300)\n    const mat = new THREE.MeshStandardMaterial({\n      color: 0xb2dbdb\n      // shininess: 10\n    })\n    const ground = new THREE.Mesh(geo, mat)\n    ground.name = 'ground'\n    ground.rotation.x = Math.PI * 1.5\n    // 接收阴影\n    ground.receiveShadow = true\n    this.addObject(ground)\n\n    const size = 50\n    const box = new THREE.BoxGeometry(size, size, size)\n    const boxMat = new THREE.MeshStandardMaterial({\n      color: 0x137b02\n      // shininess: 10\n    })\n    const boxMesh = new THREE.Mesh(box, boxMat)\n    boxMesh.position.y = size / 2\n    boxMesh.castShadow = true\n    this.addObject(boxMesh)\n\n    // 添加需要变换的网格\n    this.transformControls?.attach(boxMesh)\n\n    const onKeydown = e => this.onKeydown(e)\n    const onKeyup = e => this.onKeyup(e)\n\n    window.addEventListener('keydown', onKeydown, false)\n    window.addEventListener('keyup', onKeyup, false)\n\n    onBeforeUnmount(() => {\n      window.removeEventListener('keydown', onKeydown)\n      window.removeEventListener('keyup', onKeyup)\n    })\n  }\n\n  modelAnimate() {}\n\n  onKeydown(e) {\n    console.log(e, this)\n    const control = this.transformControls\n    if (!control) return\n    switch (e.key) {\n      case 'w':\n        control.setMode('translate')\n        break\n\n      case 'e':\n        control.setMode('rotate')\n        break\n\n      case 'r':\n        control.setMode('scale')\n        break\n\n      case '+':\n      case '=':\n        control.setSize(control.size + 0.1)\n        break\n\n      case '-':\n      case '_':\n        control.setSize(Math.max(control.size - 0.1, 0.1))\n        break\n\n      case 'x':\n        control.showX = !control.showX\n        break\n\n      case 'y':\n        control.showY = !control.showY\n        break\n\n      case 'z':\n        control.showZ = !control.showZ\n        break\n\n      case ' ':\n        control.enabled = !control.enabled\n        break\n\n      case 'Escape':\n        control.reset()\n        break\n    }\n  }\n\n  onKeyup(e) {\n    console.log(e)\n  }\n}\n","<template>\n  <div class=\"three-page\">\n    <div class=\"h-100\" ref=\"containerRef\"></div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { NewThreeScene } from './methods'\nimport { useResize } from '@/hooks/scene-resize'\n\nconst containerRef = ref()\n\nconst options: ConstructorParameters<typeof NewThreeScene>[0] = {\n  axes: {\n    visible: true\n  },\n  render: {\n    alpha: true\n  },\n  grid: {\n    visible: true\n  }\n}\nlet scene: InstanceType<typeof NewThreeScene>\n\nonMounted(() => {\n  options.container = containerRef.value\n  scene = new NewThreeScene(options)\n  scene.run()\n\n  useResize(scene).resize()\n})\n</script>\n\n<style lang=\"scss\" module></style>\n"],"names":["NewThreeScene","ThreeScene.Scene","constructor","options","super","__publicField","this","clock","THREE.Clock","addControls","initModel","gui","GUI","addGui","init","initLight","initGrid","initAxes","camera","controls","TransformControls","renderer","domElement","addEventListener","e","enabled","value","transformControls","addObject","getHelper","control","params","w","setMode","r","x","y","z","add","setSize","size","sub","Math","max","space","group","addFolder","name","style","_a","container","parentNode","appendChild","geo","THREE.PlaneGeometry","mat","THREE.MeshStandardMaterial","color","ground","THREE.Mesh","rotation","PI","receiveShadow","box","THREE.BoxGeometry","boxMat","boxMesh","position","castShadow","attach","onKeydown","onKeyup","window","onBeforeUnmount","removeEventListener","modelAnimate","console","log","key","showX","showY","showZ","reset","containerRef","ref","axes","visible","render","alpha","grid","scene","onMounted","run","useResize","resize"],"mappings":"8XAKa,MAAAA,UAAsBC,EAKjC,WAAAC,CAAYC,GACVC,MAAMD,GALRE,EAAAC,KAAA,SACAD,EAAAC,KAAA,OACAD,EAAAC,KAAA,qBAKOA,KAAAC,MAAQ,IAAIC,EAEjBF,KAAKG,cACLH,KAAKI,YAEAJ,KAAAK,IAAM,IAAIC,EACfN,KAAKO,QACP,CAEA,IAAAC,GACER,KAAKS,YACLT,KAAKU,WACLV,KAAKW,UACP,CAEA,WAAAR,GACE,MAAMS,EAASZ,KAAKY,OACdC,EAAW,IAAIC,EAAkBF,EAAQZ,KAAKe,SAASC,YAGpDH,EAAAI,iBAAiB,oBAAyBC,IACjDlB,KAAKa,WAAab,KAAKa,SAASM,SAAWD,EAAEE,MAAA,IAG/CpB,KAAKqB,kBAAoBR,EACpBb,KAAAsB,UAAUT,EAASU,YAC1B,CAEA,MAAAhB,SACE,MAAMF,EAAML,KAAKK,IACXmB,EAAUxB,KAAKqB,kBACrB,IAAKG,EAAS,OACd,MAAMC,EAAS,CACbC,EAAG,KACDF,EAAQG,QAAQ,YAAW,EAE7BT,EAAG,KACDM,EAAQG,QAAQ,SAAQ,EAE1BC,EAAG,KACDJ,EAAQG,QAAQ,QAAO,EAGzBE,GAAG,EACHC,GAAG,EACHC,GAAG,EAEHC,IAAK,KACKR,EAAAS,QAAQT,EAAQU,KAAO,GAAG,EAEpCC,IAAK,KACHX,EAAQS,QAAQG,KAAKC,IAAIb,EAAQU,KAAO,GAAK,IAAI,EAEnDI,OAAO,GAEHC,EAAQlC,EAAImC,UAAU,SAE5BD,EAAMP,IAAIP,EAAQ,KAAKgB,KAAK,cAC5BF,EAAMP,IAAIP,EAAQ,KAAKgB,KAAK,cAC5BF,EAAMP,IAAIP,EAAQ,KAAKgB,KAAK,cAE5BF,EAAMP,IAAIR,EAAS,SAASiB,KAAK,iBACjCF,EAAMP,IAAIR,EAAS,SAASiB,KAAK,iBACjCF,EAAMP,IAAIR,EAAS,SAASiB,KAAK,iBAEjCF,EAAMP,IAAIP,EAAQ,OAAOgB,KAAK,iBAC9BF,EAAMP,IAAIP,EAAQ,OAAOgB,KAAK,iBAC9BF,EAAMP,IAAIR,EAAS,WAAWiB,KAAK,gBAGnCpC,EAAIW,WAAW0B,MAAQ,2CACvB,OAAAC,EAAA3C,KAAK4C,UAAUC,aAAYF,EAAAG,YAAYzC,EAAIW,WAC7C,CAEA,SAAAZ,SACE,MAAM2C,EAAM,IAAIC,EAAoB,IAAK,KACnCC,EAAM,IAAIC,EAA2B,CACzCC,MAAO,WAGHC,EAAS,IAAIC,EAAWN,EAAKE,GACnCG,EAAOX,KAAO,SACPW,EAAAE,SAASzB,EAAc,IAAVO,KAAKmB,GAEzBH,EAAOI,eAAgB,EACvBxD,KAAKsB,UAAU8B,GAEf,MACMK,EAAM,IAAIC,EADH,UAEPC,EAAS,IAAIT,EAA2B,CAC5CC,MAAO,UAGHS,EAAU,IAAIP,EAAWI,EAAKE,GAC5BC,EAAAC,SAAS/B,EAAII,GACrB0B,EAAQE,YAAa,EACrB9D,KAAKsB,UAAUsC,GAGV,OAAAjB,EAAA3C,KAAAqB,sBAAmB0C,OAAOH,GAE/B,MAAMI,EAAY9C,GAAKlB,KAAKgE,UAAU9C,GAChC+C,EAAU/C,GAAKlB,KAAKiE,QAAQ/C,GAE3BgD,OAAAjD,iBAAiB,UAAW+C,GAAW,GACvCE,OAAAjD,iBAAiB,QAASgD,GAAS,GAE1CE,GAAgB,KACPD,OAAAE,oBAAoB,UAAWJ,GAC/BE,OAAAE,oBAAoB,QAASH,EAAO,GAE/C,CAEA,YAAAI,GAAgB,CAEhB,SAAAL,CAAU9C,GACAoD,QAAAC,IAAIrD,EAAGlB,MACf,MAAMwB,EAAUxB,KAAKqB,kBACrB,GAAKG,EACL,OAAQN,EAAEsD,KACR,IAAK,IACHhD,EAAQG,QAAQ,aAChB,MAEF,IAAK,IACHH,EAAQG,QAAQ,UAChB,MAEF,IAAK,IACHH,EAAQG,QAAQ,SAChB,MAEF,IAAK,IACL,IAAK,IACKH,EAAAS,QAAQT,EAAQU,KAAO,IAC/B,MAEF,IAAK,IACL,IAAK,IACHV,EAAQS,QAAQG,KAAKC,IAAIb,EAAQU,KAAO,GAAK,KAC7C,MAEF,IAAK,IACKV,EAAAiD,OAASjD,EAAQiD,MACzB,MAEF,IAAK,IACKjD,EAAAkD,OAASlD,EAAQkD,MACzB,MAEF,IAAK,IACKlD,EAAAmD,OAASnD,EAAQmD,MACzB,MAEF,IAAK,IACKnD,EAAAL,SAAWK,EAAQL,QAC3B,MAEF,IAAK,SACHK,EAAQoD,QAGd,CAEA,OAAAX,CAAQ/C,GACNoD,QAAQC,IAAIrD,EACd,4DCzKF,MAAA2D,EAAAC,IAEAjF,EAAA,CAAgEkF,KAAA,CACxDC,SAAA,GAENC,OAAA,CACQC,OAAA,GAERC,KAAA,CACMH,SAAA,IAIR,IAAAI,SAEAC,GAAA,KACExF,EAAA+C,UAAAiC,EAAAzD,MACAgE,EAAA,IAAA1F,EAAAG,GACAuF,EAAAE,MAEAC,EAAAH,GAAAI"}