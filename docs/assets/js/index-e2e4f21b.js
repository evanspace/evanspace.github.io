import{o as e,f as t,g as a,c as n,b4 as s,h as r,X as l,k as o,ae as i,u as c,p as d,m as u,q as m,t as h,a8 as v,B as p,a6 as f,a7 as g,F as w,r as y,n as L,C as k,H as x,A as C,a9 as b,aJ as M,aB as _}from"./vendor-0648fc2e.js";import{_ as z}from"./index-8d96952a.js";const A={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};const I={name:"ep-mic",render:function(n,s){return e(),t("svg",A,s[0]||(s[0]=[a("path",{fill:"currentColor",d:"M480 704h160a64 64 0 0 0 64-64v-32h-96a32 32 0 0 1 0-64h96v-96h-96a32 32 0 0 1 0-64h96v-96h-96a32 32 0 0 1 0-64h96v-32a64 64 0 0 0-64-64H384a64 64 0 0 0-64 64v32h96a32 32 0 0 1 0 64h-96v96h96a32 32 0 0 1 0 64h-96v96h96a32 32 0 0 1 0 64h-96v32a64 64 0 0 0 64 64zm64 64v128h192a32 32 0 1 1 0 64H288a32 32 0 1 1 0-64h192V768h-96a128 128 0 0 1-128-128V192A128 128 0 0 1 384 64h256a128 128 0 0 1 128 128v448a128 128 0 0 1-128 128z"},null,-1)]))}},V={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};const q={name:"ep-menu",render:function(n,s){return e(),t("svg",V,s[0]||(s[0]=[a("path",{fill:"currentColor",d:"M160 448a32 32 0 0 1-32-32V160.064a32 32 0 0 1 32-32h256a32 32 0 0 1 32 32V416a32 32 0 0 1-32 32zm448 0a32 32 0 0 1-32-32V160.064a32 32 0 0 1 32-32h255.936a32 32 0 0 1 32 32V416a32 32 0 0 1-32 32zM160 896a32 32 0 0 1-32-32V608a32 32 0 0 1 32-32h256a32 32 0 0 1 32 32v256a32 32 0 0 1-32 32zm448 0a32 32 0 0 1-32-32V608a32 32 0 0 1 32-32h255.936a32 32 0 0 1 32 32v256a32 32 0 0 1-32 32z"},null,-1)]))}},B={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};const E={name:"ep-d-arrow-right",render:function(n,s){return e(),t("svg",B,s[0]||(s[0]=[a("path",{fill:"currentColor",d:"M452.864 149.312a29.12 29.12 0 0 1 41.728.064L826.24 489.664a32 32 0 0 1 0 44.672L494.592 874.624a29.12 29.12 0 0 1-41.728 0a30.59 30.59 0 0 1 0-42.752L764.736 512L452.864 192a30.59 30.59 0 0 1 0-42.688m-256 0a29.12 29.12 0 0 1 41.728.064L570.24 489.664a32 32 0 0 1 0 44.672L238.592 874.624a29.12 29.12 0 0 1-41.728 0a30.59 30.59 0 0 1 0-42.752L508.736 512L196.864 192a30.59 30.59 0 0 1 0-42.688"},null,-1)]))}},T={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};const S={name:"ep-arrow-right",render:function(n,s){return e(),t("svg",T,s[0]||(s[0]=[a("path",{fill:"currentColor",d:"M340.864 149.312a30.59 30.59 0 0 0 0 42.752L652.736 512L340.864 831.872a30.59 30.59 0 0 0 0 42.752a29.12 29.12 0 0 0 41.728 0L714.24 534.336a32 32 0 0 0 0-44.672L382.592 149.376a29.12 29.12 0 0 0-41.728 0z"},null,-1)]))}},$={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};const P={name:"ep-video-pause",render:function(n,s){return e(),t("svg",$,s[0]||(s[0]=[a("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896a448 448 0 0 1 0-896m0 832a384 384 0 0 0 0-768a384 384 0 0 0 0 768m-96-544q32 0 32 32v256q0 32-32 32t-32-32V384q0-32 32-32m192 0q32 0 32 32v256q0 32-32 32t-32-32V384q0-32 32-32"},null,-1)]))}},R={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};const j={name:"ep-video-play",render:function(n,s){return e(),t("svg",R,s[0]||(s[0]=[a("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896a448 448 0 0 1 0-896m0 832a384 384 0 0 0 0-768a384 384 0 0 0 0 768m-48-247.616L668.608 512L464 375.616zm10.624-342.656l249.472 166.336a48 48 0 0 1 0 79.872L474.624 718.272A48 48 0 0 1 400 678.336V345.6a48 48 0 0 1 74.624-39.936z"},null,-1)]))}},H={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};const N={name:"ep-arrow-left",render:function(n,s){return e(),t("svg",H,s[0]||(s[0]=[a("path",{fill:"currentColor",d:"M609.408 149.376L277.76 489.6a32 32 0 0 0 0 44.672l331.648 340.352a29.12 29.12 0 0 0 41.728 0a30.59 30.59 0 0 0 0-42.752L339.264 511.936l311.872-319.872a30.59 30.59 0 0 0 0-42.688a29.12 29.12 0 0 0-41.728 0"},null,-1)]))}},D={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};const F={name:"ep-d-arrow-left",render:function(n,s){return e(),t("svg",D,s[0]||(s[0]=[a("path",{fill:"currentColor",d:"M529.408 149.376a29.12 29.12 0 0 1 41.728 0a30.59 30.59 0 0 1 0 42.688L259.264 511.936l311.872 319.936a30.59 30.59 0 0 1-.512 43.264a29.12 29.12 0 0 1-41.216-.512L197.76 534.272a32 32 0 0 1 0-44.672zm256 0a29.12 29.12 0 0 1 41.728 0a30.59 30.59 0 0 1 0 42.688L515.264 511.936l311.872 319.936a30.59 30.59 0 0 1-.512 43.264a29.12 29.12 0 0 1-41.216-.512L453.76 534.272a32 32 0 0 1 0-44.672z"},null,-1)]))}};class U{constructor(){}load(e,t,a,n){const s=new Request(e,{headers:new Headers({}),credentials:"same-origin"});fetch(s).then((e=>{if(200==e.status||0===e.status){const t=e.body.getReader(),n=e.headers.get("Content-Length"),s=n?parseInt(n):0,r=0!==s;let l=0;return new ReadableStream({start(e){!function n(){t.read().then((({done:t,value:o})=>{if(t)e.close();else{l+=o.byteLength;const t=new ProgressEvent("progress",{lengthComputable:r,loaded:l,total:s});a&&a(t),e.enqueue(o),n()}}))}()}})}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((e=>new Response(e).text())).then((e=>{const a=this.formste(e);if(!a)throw Error("文件格式不对!");t&&t(a)})).catch((e=>{n&&n(e)}))}formste(e){const t={ti:"",ar:"",al:"",by:"",offset:0,lrc:[]};e.split("\n").filter((e=>""!==e.trim())).map((e=>{const a=this.parseLyricLine(e.trim());return!!a&&("lyric"===a.type?t.lrc.push(a.data):t[a.type]=a.data,e.trim())}));let a=new RegExp("^\\d+(?:\\.\\d{0,3})?");return t.lrc.forEach(((e,n)=>{const s=(t.lrc[n+1]||{}).tsp;let r=s?s-e.tsp:2;r=Number(r.toString().match(a)),e.duration=r})),t}parseLyricLine(e){let t;if(null!==(t=e.match(/^\[(ti|ar|al|by|offset):(.*)\]$/)))return{type:t[1],data:t[2]};if(null!==(t=e.match(/^\[(\d{2}):(\d{2}).(\d{2})\](.*)/))){const e=Number(t[1]),a=Number(t[2]),n=Number(t[3]);return{type:"lyric",data:{time:{m:e,s:a,ms:n},tsp:(60*e*1e3+1e3*a+n)/1e3,lyric:t[4].trim()}}}}}const J=e=>{let t=parseInt((e/60).toString()),a=parseInt((e%60).toString());return t=t>9?t:"0"+t,a=a>9?a:"0"+a,t+":"+a},K={class:"page"},O={class:"music-box"},W=["src"],X={class:"left-control"},G={class:"process-control"},Q={class:"up"},Y={class:"music-name"},Z={class:"time"},ee={class:"cu"},te={class:"total"},ae={class:"progress"},ne={class:"right-control"},se={class:"progress"},re={class:"music-list"},le=["onClick"],oe={class:"canvas-box"},ie={class:"lrc-box"},ce={class:"list"},de={class:"w"},ue=z(n({__name:"index",setup(n){s((e=>({"4f43ae12":Pe,"5201b206":$e})));let z=/\.(mp3|ogg)$/;const A=r(),V=r(),B=l({src:"",status:"",totalTime:0,currentTime:0,process:0,volume:100}),T=l({list:["人为情叹 - 阿悠悠.mp3","南北组合 吉萍 - 你曾是我炫耀的资本.ogg","小少焱-上下五千年.mp3","就是南方凯 - 离别开出花.mp3","李驰- - 吻得太逼真DJ（弹棉花的小花）.mp3","程响 - 可能.ogg","走卒(戏腔版)-昊轩京剧-吴昊.128.mp3","邵帅 - 你是人间四月天.ogg"],index:-1,name:"",show:!1}),$=l({al:"",lrc:[],active:0}),R=r("#ff4500"),H=r(["#0add31","#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgba(255, 69, 0, 0.68)","rgb(255, 120, 0)","hsv(51, 100, 98)","hsva(120, 40, 94, 0.5)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#c7158577"]);let D=!1,ue=!1,me=!1;const he=()=>{var e;null==(e=A.value)||e.play(),D=!0,pe(),B.status="play",ue||(ke(),ue=!0,Ce())};let ve;const pe=()=>{clearInterval(ve),ve=setInterval(fe,300)},fe=()=>{var e,t;let a=(null==(e=A.value)?void 0:e.currentTime)||0,n=(null==(t=A.value)?void 0:t.duration)||0;B.totalTime=n,B.currentTime=a,B.process=a/n*100,ge(),n>0&&a==n&&_e(1)},ge=()=>{if(!A.value)return;if("play"!==B.status)return;let e=A.value.currentTime||0;const t=$.lrc.findIndex((t=>t.tsp<=e&&e<=t.tsp+t.duration));t!=$.active&&($.active=t)};let we,ye,Le;const ke=()=>{const e=new(0,window.AudioContext);we=e.createAnalyser(),Le=new Uint8Array(we.frequencyBinCount),e.createMediaElementSource(A.value).connect(we),we.connect(e.destination)};let xe;const Ce=()=>{let e;if(xe=requestAnimationFrame(Ce),ue&&(e=we),me&&(e=ye),!e)return;e.getByteFrequencyData(Le);const t=Math.floor(2*Le.length/3),a=new Array(2*t);for(let n=0;n<t;n++)a[n]=a[a.length-n-1]=Le[n];be(a,255,250)},be=(e,t,a=100)=>{const n=V.value,s=n.width,r=n.height,l=n.getContext("2d");l.lineWidth=2,l.clearRect(0,0,s,r);const o=Math.min(s,r)/2,i=e.length,c=parseInt((.5*o).toString()),d=parseInt((.99*o-c).toString()),u=Math.min(a,i),m=Math.round(i/u);for(let h=0;h<u;h++){const a=e[h*m+m],n=parseInt((d*(a/t)).toString())||1;l.beginPath();const o=Math.round(360*h/u);l.strokeStyle=`hsla(${o}, 100%, 50%, 1)`,l.save(),l.translate(s/2,r/2),l.rotate(h*Math.PI*2/u-.5*Math.PI),l.moveTo(0,c),l.lineTo(0,c+n),l.closePath(),l.stroke(),l.restore()}},Me=()=>{var e;D=!1,null==(e=A.value)||e.pause(),B.status="paused",clearInterval(ve)},_e=(e=1)=>{let t=T.index;t+=e;const a=T.list.length;t>=a?t=0:t<0&&(t=a-1),ze(t)},ze=(e=0)=>{if(T.index==e)return;T.index=e;let t=T.list[e];B.src=`./audio/${t}`,t=t.replace(z,""),T.name=t;const a=`./audio/${t}.lrc`;$.active=-1,(new U).load(a,(e=>{Object.keys(e).forEach((t=>{$[t]=e[t]}))}),void 0,(()=>{Object.keys($).forEach((e=>{$[e]="lrc"==e?[]:"active"==e?0:""}))})),ue&&b((()=>{var e;null==(e=A.value)||e.play()}))},Ae=(e=0)=>{A.value.currentTime+=e,fe()},Ie=(e=.1)=>{let t=A.value.volume;t+=e,t>1?t=1:t<0&&(t=0),A.value.volume=t,B.volume=100*t};let Ve;const qe=()=>{if(navigator.mediaDevices){if(me)return Be(),void he();Me(),navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{Ve=e;const t=new(0,window.AudioContext),a=t.createAnalyser();ye=a,Le=new Uint8Array(a.frequencyBinCount),t.createMediaStreamSource(Ve).connect(a),a.connect(t.destination),me=!0,Ce()}))}else console.log("获取麦克风失败!")},Be=()=>{Ve&&(me=!1,Ve.getAudioTracks().forEach((e=>{e.stop()})))},Ee=()=>{const e="running"===(new AudioContext).state;console.log("是否可自动播放",e),D=e,e&&he()},Te=e=>{switch(e.keyCode){case 32:D?Me():he();break;case 37:e.ctrlKey?_e(-1):Ae(-10);break;case 39:e.ctrlKey?_e(1):Ae(10)}},Se=()=>{const e=V.value,t=e.parentNode,a=t.offsetWidth,n=t.offsetHeight;e.width=a,e.height=n};o((()=>{(()=>{ze(1),b(Ee),Se();let e=new Array(256).fill(0);be(e,255,190)})(),window.addEventListener("resize",Se),window.addEventListener("keydown",Te)})),i((()=>{clearInterval(ve),cancelAnimationFrame(xe),window.removeEventListener("resize",Se),window.removeEventListener("keydown",Te)}));const $e="url(https://ye6.atomgit.net/3d-demo-data/imgs/common/music-bg.jpg)",Pe="url(https://ye6.atomgit.net/3d-demo-data/imgs/common/sk-dark.png)";return(n,s)=>{const r=F,l=M,o=N,i=j,b=P,z=S,D=E,U=q,ue=I,me=_;return e(),t("div",K,[a("div",O,[a("audio",{src:c(B).src,ref_key:"mysong",ref:A,controls:""},null,8,W),a("div",X,[d(l,{underline:!1,type:"info",onClick:s[0]||(s[0]=m((e=>_e(-1)),["stop"]))},{default:u((()=>[d(r)])),_:1}),d(l,{title:"快退",underline:!1,type:"info",onClick:s[1]||(s[1]=e=>Ae(-10))},{default:u((()=>[d(o)])),_:1}),d(l,{title:"播放",underline:!1,type:"info",onClick:he},{default:u((()=>[d(i)])),_:1}),d(l,{title:"暂停",underline:!1,type:"info",onClick:Me},{default:u((()=>[d(b)])),_:1}),d(l,{title:"快进",underline:!1,type:"info",onClick:s[2]||(s[2]=e=>Ae(10))},{default:u((()=>[d(z)])),_:1}),d(l,{title:"下一首",underline:!1,type:"info",onClick:s[3]||(s[3]=e=>_e(1))},{default:u((()=>[d(D)])),_:1})]),a("div",G,[a("div",Q,[a("div",Y,h(c(T).name),1),a("div",Z,[a("span",ee,h(c(J)(c(B).currentTime)),1),s[8]||(s[8]=a("span",{class:"line"},null,-1)),a("span",te,h(c(J)(c(B).totalTime)),1)])]),a("div",ae,[a("div",{class:"bar",style:v({width:c(B).process+"%"})},null,4)])]),a("div",ne,[a("div",{class:"min",title:"音量-",onClick:s[4]||(s[4]=e=>Ie(-.1))}),a("div",se,[a("div",{class:"bar",style:v({width:c(B).volume+"%"})},null,4)]),a("div",{class:"max",title:"音量+",onClick:s[5]||(s[5]=e=>Ie(.1))}),d(l,{title:"歌单",underline:!1,type:"info",onClick:s[6]||(s[6]=m((e=>c(T).show=!c(T).show),["stop"]))},{default:u((()=>[d(U)])),_:1}),d(l,{title:"麦克风",underline:!1,type:"info",onClick:m(qe,["stop"])},{default:u((()=>[d(ue)])),_:1}),d(me,{title:"歌词颜色",modelValue:c(R),"onUpdate:modelValue":s[7]||(s[7]=e=>p(R)?R.value=e:null),"show-alpha":"",size:"small",style:{marginLeft:"4px"},predefine:c(H)},null,8,["modelValue","predefine"])]),d(k,{name:"el-zoom-in-bottom"},{default:u((()=>[f(a("div",re,[(e(!0),t(w,null,y(c(T).list,((a,n)=>(e(),t("div",{key:n,class:L(["item",{"is-active":n==c(T).index}]),onClick:m((e=>ze(n)),["stop"])},h(a),11,le)))),128))],512),[[g,c(T).show]])])),_:1})]),a("div",oe,[a("div",ie,[a("div",{class:"move",style:v({top:`-${30*c($).active}px`,"--color":c(R)})},[a("div",ce,[(e(!0),t(w,null,y(c($).lrc,((n,s)=>(e(),t("div",{key:s,class:"item",style:v({"--time":n.duration+"s"})},[a("span",de,[x(h(n.lyric)+" ",1),s==c($).active?(e(),t("span",{key:s,class:"c",style:v({animationPlayState:"paused"==c(B).status?"paused":""})},h(n.lyric),5)):C("",!0)])],4)))),128))])],4)]),a("canvas",{ref_key:"cvs",ref:V},null,512)])])}}}),[["__scopeId","data-v-4dcf7f8a"]]);export{ue as default};
