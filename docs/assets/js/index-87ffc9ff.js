var e=Object.defineProperty,t=(t,i,s)=>(((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(t,"symbol"!=typeof i?i+"":i,s),s);import{e as i,el as s,em as o,a7 as n,a8 as a,o as r,g as l,h as c,n as d,a9 as h,t as u,q as p,B as _,c as m,au as g,F as y,r as C,u as v,bq as T,eB as S,eC as f,eD as E,bi as b,er as A,et as M,eu as O,bj as R,ex as I,d8 as L,ey as G,de as N,dG as H,eF as k,dY as x,dW as P,bg as D,eE as w,ez as U,bk as W,bn as j,Y as B,i as F,f as z,l as V,m as $,p as Y,I as K,aP as J,ak as Z,aa as q}from"./vendor-750afcd3.js";import{t as X}from"./index-582fe229.js";import{_ as Q,t as ee,d as te,A as ie,k as se,s as oe}from"./index-617d5fb6.js";import{m as ne,n as ae,I as re,u as le}from"./scene-resize-8cf31fff.js";import{u as ce}from"./dialog-4b948f5c.js";const de=["innerHTML"],he=Q(i({__name:"tip-msg",props:s({style:{},msg:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=o(e,"modelValue");return(e,i)=>n((r(),l("div",{class:d(e.$style.page),style:h({left:e.style.left+"px",top:e.style.top+"px"})},[c("div",{class:d(e.$style.msg),innerHTML:e.msg},null,10,de)],6)),[[a,t.value]])}}),[["__cssModules",{$style:{page:"_page_1sskt_2",msg:"_msg_1sskt_12"}}]]),ue={key:0,class:"screen-welcom-dialog"},pe={class:"wrap"},_e={class:"body"},me={class:"title"},ge={class:"bg"},ye={class:"text"},Ce={class:"content"},ve=i({__name:"edit-dialog",props:s({title:{},errMessage:{}},{modelValue:{type:Boolean},modelModifiers:{},content:{},contentModifiers:{}}),emits:s(["confirm"],["update:modelValue","update:content"]),setup(e,{emit:t}){const i=e,s=o(e,"modelValue"),n=o(e,"content"),a=t,d=()=>{ee(n.value||"")?(s.value=!1,a("confirm",n.value)):m.warning({message:i.errMessage,grouping:!0})};return(e,t)=>{const i=g;return s.value?(r(),l("div",ue,[c("div",{class:"mask",onClick:t[0]||(t[0]=e=>s.value=!s.value)}),c("div",pe,[c("div",_e,[c("div",me,[c("div",ge,u(e.title),1),c("div",ye,u(e.title),1)]),c("div",Ce,[p(i,{type:"textarea",modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value=e),placeholder:"请输入",maxlength:"24","show-word-limit":""},null,8,["modelValue"])]),c("div",{class:"footer"},[c("div",{class:"btn",onClick:d})])])])])):_("",!0)}}}),Te={baseUrl:"",sky:{day:"/oss/textures/hdr/101.hdr",evening:"/oss/textures/hdr/201.hdr",night:"/oss/textures/hdr/301.hdr"},indexDB:{cache:!0,dbName:"THREE__OFFICE__GPU_DB",tbName:"TB",version:30},clickIntervalTime:300,personSightHeight:3.5,personSightClass:"person-sight",personKeys:[{code:"W",desc:"前进"},{code:"S",desc:"后退"},{code:"A",desc:"向左转向"},{code:"D",desc:"向右转向"},{code:"X",desc:"加速"},{code:"Z",desc:"减速"}],liftGroundMeshName:["电梯地板002","电梯地板"],groundMeshName:["地面002","立方体306","平面118","立方体475","立方体514","立方体552","地面020","地面","平面391","立方体474","立方体1617","ground"],companyModelName:"二十五楼",collisionSpace:1,moveFactor:1,styleTimes:[[8,18],[18,20],[20,8]],fleetings:[[[-1247.3804124641044,1.5,275.8568665121467],[-385.54913233299317,1.5,235.37414186604545],[-74.15440788927455,1.5,249.36770549275383],[465.22573985771027,1.5,245.43607244481086],[725.5941701917296,1.5,249.85748872521614],[1298.4540604962947,1.5,246.2826397113465],[1540.3121752120794,1.5,248.16462011553776],[2035.0305758526924,1.5,250.3197618335575],[2247.330156763603,1.5,247.35851806181827],[2614.171817337305,1.5,241.05764461471873]],[[653.0182392436438,1.5,186.20541161524878],[640.5314650233396,1.5,-478.1628829727225],[641.5186617371273,1.5,-741.7856284596322],[641.8860570932816,1.5,-1180.303297128374],[636.5706330757,1.5,-1435.6099074377244],[651.4496990930706,1.5,-2151.481360404476]],[[-184.48466894299744,1.5,2447.03846990951],[-186.588766153597,1.5,1617.8540886409082],[-184.69458845133832,1.5,1300.1784227505875],[-186.39769511236557,1.5,361.1691127475875],[-181.39186291802253,1.5,100.79623785390046],[-153.08794728573116,1.5,-361.6354243767241],[-149.96162120866242,1.5,-670.0291574302669],[-143.93274083461012,1.5,-1094.1977278309487],[-146.55180744515872,1.5,-1375.823600978301],[-116.02623152983233,1.5,-2108.4946603582016]],[[254.9890486347282,1.5,188.40181034697815],[248.52761744154438,1.5,-519.7744116293145]],[[-1247.9079420458377,1.5,301.9431764689599],[-383.5097210507664,1.5,264.71915732788005],[-71.23512580197027,1.5,275.3629302523157],[466.128250712296,1.5,275.2716282312793],[741.6370632026585,1.5,277.66102510376084],[1297.4737719762595,1.5,277.2168628506806],[1541.7297005023304,1.5,280.31972525507285],[2037.2405649559382,1.5,280.98678580599466],[2246.595015753523,1.5,283.1011600230837],[2617.1867659153927,1.5,278.8253659556488]],[[2611.3420640520076,1.5,163.96935494305524],[2239.038081627408,1.5,174.12102368223074],[2032.5550985659966,1.5,188.6090112066963],[1532.405982209116,1.5,189.6348998853747],[1298.330733919915,1.5,185.10779629834326],[732.0840195081455,1.5,187.16481480781331],[470.24205339525065,1.5,189.90699833376397],[-84.06660102385868,1.5,192.15782227582906],[-384.7643865790769,1.5,185.23744642336993],[-1257.0964658502476,1.5,220.7083203147085]],[[-1494.2513045295325,1.5,-523.9699855391409],[-347.25187028816856,1.5,-474.65671096988984],[-15.027389984711675,1.5,-487.5419186263196],[460.1280047533312,1.5,-554.9641189234129],[769.3595908495539,1.5,-610.2755139698855],[1295.7126441671367,1.5,-685.7478189381841],[1514.966726681715,1.5,-702.0163690628412],[2028.26504557221,1.5,-708.4714990968719],[2229.5644216212645,1.5,-702.2878946149901],[2629.0123847430777,1.5,-711.4343799242977]],[[2617.633985591895,1.5,201.60419658108776],[2243.909428783476,1.5,206.87474446964558],[2034.8776601667457,1.5,214.17713607035415],[1533.6654999142486,1.5,216.16096497050023],[1292.917491810635,1.5,211.694521877535],[733.5212884806997,1.5,212.4150255097067],[468.0441428401828,1.5,211.83554003650767],[-81.88484692151263,1.5,215.50162318985943],[-385.33313200911095,1.5,208.79517510379873],[-1252.2402103549757,1.5,246.2595475811134]],[[-216.74411496965007,1.5,2446.1899911004953],[-212.54025051280874,1.5,1618.4430966822365],[-213.1531765155122,1.5,1299.5372821282467],[-212.88029306826311,1.5,361.004463092096],[-204.31776521867644,1.5,95.17239553880012],[-175.35362468958635,1.5,-361.2624545092945],[-176.90039928865932,1.5,-675.9746927279216],[-169.7193594972355,1.5,-1094.745742326411],[-170.74265977198806,1.5,-1381.291722860903],[-143.83153846069854,1.5,-2106.089132268412]],[[-166.69061346783928,1.5,-2106.8143772513126],[-198.0488246554272,1.5,-1381.582043826204],[-199.7107069657603,1.5,-1095.6028221394768],[-206.74060670641225,1.5,-677.0697121202405],[-202.700259003459,1.5,-365.7406797551388],[-230.01591899796063,1.5,91.60705400934745],[-242.9062425497127,1.5,359.4021473586805],[-242.27821018691782,1.5,1297.7164477844215],[-242.66307406448757,1.5,1615.4387891061058],[-243.2521320513111,1.5,2442.9364318668368]],[[-191.438779413371,1.5,-2106.3282094666683],[-220.73958879833555,1.5,-1384.5763798106966],[-227.4255891103798,1.5,-1097.5557009252084],[-232.3590701921136,1.5,-676.5102411464416],[-229.60449004853604,1.5,-363.66500472487803],[-254.03347391022893,1.5,88.02859900453808],[-270.9119445790846,1.5,355.8050561117999],[-271.8960506127454,1.5,1297.4563069322603],[-269.32241688262354,1.5,1619.2232293653196],[-269.6085197110389,1.5,2442.486822687859]],[[-1490.9279956818982,1.5,-546.4210301147804],[-347.46827976878035,1.5,-499.19644259345415],[-10.407826447936372,1.5,-512.7596249145535],[456.4211224463379,1.5,-576.9125511231589],[759.2761525703872,1.5,-631.8081248108039],[1293.0791107409004,1.5,-705.0280213831614],[1508.7704296505792,1.5,-728.3802290028357],[2032.6982432385287,1.5,-731.5117672205906],[2219.6072248811265,1.5,-734.637580331011],[2625.643276984354,1.5,-743.8101299753371]],[[2626.3901700736037,1.5,-781.1017696857378],[2220.8514498299905,1.5,-769.0356255284045],[2032.2913703532724,1.5,-762.8575496165022],[1511.3552256541166,1.5,-759.2404009381686],[1286.7820276626376,1.5,-730.1059576100947],[756.3682832855267,1.5,-652.7145464611291],[452.61843137679864,1.5,-606.8682449037161],[-12.78416595913032,1.5,-543.2368997160044],[-343.08772274031026,1.5,-527.962481270673],[-1489.2130939698452,1.5,-574.8731410713193]],[[2623.1011840628594,1.5,-814.6475022807425],[2216.036849549517,1.5,-801.011576545054],[2030.0825780786195,1.5,-787.8840257205616],[1506.3601369519993,1.5,-784.4496008940721],[1287.1959219288165,1.5,-752.7952322380231],[752.9829675686118,1.5,-673.170208139215],[445.89106268451593,1.5,-631.647110579748],[-19.911685547898884,1.5,-566.4904449943363],[-345.4294265338732,1.5,-548.87622952709],[-1491.0183116346152,1.5,-596.5878109151417]],[[231.82903145902645,1.5,189.17638213146898],[224.3313036580691,1.5,-523.6629269807526]],[[199.34569678838128,1.5,-519.3457911109576],[206.1046050573263,1.5,188.7851087774285]],[[174.1270577790077,1.5,-515.3193396429033],[182.4833928328745,1.5,188.894326911243]],[[622.1583807823386,1.5,185.58693904691773],[615.5669746892655,1.5,-478.02316117666794],[616.5459390204022,1.5,-744.0007790209756],[613.1324539553776,1.5,-1181.9088663464408],[611.6114090950623,1.5,-1438.6207884389128],[628.3415357586932,1.5,-2153.3845865461985]],[[602.78350309092,1.5,-2154.719743541784],[583.8038920679553,1.5,-1440.8315284661855],[586.7498907865534,1.5,-1180.8808974289223],[586.8406384033154,1.5,-747.7377094033409],[586.8508956121347,1.5,-484.2064033588732],[593.0310370827052,1.5,185.91229223707006]],[[578.7234766214117,1.5,-2156.363001113399],[561.8484645719363,1.5,-1438.6215071324666],[560.7857436547948,1.5,-1182.8499596656188],[560.3517043728388,1.5,-745.4949702873103],[557.7773034922892,1.5,-480.2852643380643],[558.7645775584266,1.5,186.38583329069326]],[[-1484.025498440763,1.5,1589.088331309893],[-393.96910868208226,1.5,1516.2559403282253],[-74.7466791237108,1.5,1497.2077562666695],[1256.1050380329816,1.5,1412.9053951256778],[1545.7613661614432,1.5,1375.475445534589],[2019.3052651779678,1.5,1347.0045562400246],[2264.380569551577,1.5,1321.736985473143],[2621.038902449388,1.5,1303.2632694976223]],[[2615.521068926143,1.5,1238.5780936003941],[2258.3918670930802,1.5,1261.9895519289669],[2015.9065155623832,1.5,1279.1369316700068],[1543.5687412388943,1.5,1313.0857264496485],[1255.9910752964493,1.5,1347.0259911383498],[-74.73105195415519,1.5,1433.156851131467],[-395.3144573092685,1.5,1450.856342285389],[-1484.7746552134213,1.5,1518.2654466877468]],[[-1486.2521698460682,1.5,1553.8383362668728],[-396.19750801269345,1.5,1482.7486065742262],[-71.92088044886327,1.5,1464.5297925685127],[1256.918068908873,1.5,1380.3764995293263],[1545.485404268628,1.5,1347.0908211842523],[2017.8608712283437,1.5,1312.5458999512684],[2263.3526606706505,1.5,1291.6292619335034],[2618.0900692681894,1.5,1271.7679045071297]],[[2609.2336753049603,1.5,1207.2326715997492],[2258.0447448771533,1.5,1234.200060988093],[2013.2433453232213,1.5,1246.4385924864744],[1537.9497670856265,1.5,1285.6015154261588],[1246.9671405964586,1.5,1319.4097956914059],[-76.34105135541756,1.5,1400.1133691807436],[-403.6761898257357,1.5,1426.2143591380525],[-1488.8439414589297,1.5,1488.4834195052688]],[[-1489.9127119985296,1.5,-1305.0787226341486],[-354.29187759205456,1.5,-1199.4424925727942],[-17.325336635572626,1.5,-1210.9973136817894],[479.38519152284806,1.5,-1253.4931898814023],[712.7186683885026,1.5,-1277.225823638084],[1251.9705359784543,1.5,-1323.1594271542313],[1536.9075733445457,1.5,-1342.4231138533764],[2633.970640303025,1.5,-1441.150769865169]],[[2626.7360744966045,1.5,-1500.0907029322143],[1536.1874247547,1.5,-1393.944739235368],[1249.9934542169772,1.5,-1372.6442832591213],[706.0316536599506,1.5,-1323.3622498761565],[475.75181205384024,1.5,-1304.4244974268722],[-23.831381496092263,1.5,-1258.6965801793433],[-345.81148653711205,1.5,-1246.9140156460867],[-1488.2813502899066,1.5,-1360.6189050427602]],[[-1489.3330840643912,1.5,-1333.3203188878533],[-345.07038603482135,1.5,-1224.0929300365299],[-19.92873696625179,1.5,-1232.701480252149],[481.0928175641447,1.5,-1277.4934279216766],[713.0346817725144,1.5,-1300.2035395183932],[1253.4400925497391,1.5,-1349.6955854297387],[1531.382167354786,1.5,-1367.9632989336503],[2628.8682212127546,1.5,-1472.9252382891727]],[[2628.36687079996,1.5,-1531.557671018591],[1531.4864401770299,1.5,-1420.701301081861],[1240.9120402885014,1.5,-1394.9797637220593],[704.2016429913713,1.5,-1347.7184457859767],[476.2658333877147,1.5,-1322.90344068362],[-26.623918325591035,1.5,-1281.7971567634181],[-345.49130989835896,1.5,-1270.872303562496],[-1485.277362327018,1.5,-1387.7346376410196]]],streetLamps:[[-374.6,30,284.2],[-372,30,168.8],[-95.35,30,299.24],[-95.31,30,168.33],[272.61,30,299.17],[276.47,30,168.4],[271.04,30,-58.709],[159.86,30,-56.24],[-134.27,30,30.457],[-247.92,30,-302.57]],residentLights:[[-13,169.8,447.2],[668,114.9,481.9]]},Se=Q(i({__name:"first-person",setup(e){const t=Te.personKeys||[];return(e,i)=>(r(),l("div",{class:d([e.$style.page,v(Te).personSightClass])},[c("div",{class:d(e.$style.tip)},[(r(!0),l(y,null,C(v(t),(t=>(r(),l("div",{class:d(e.$style.item)},[c("span",null,u(t.code),1),c("span",null,u(t.desc),1)],2)))),256))],2),c("div",{class:d(e.$style.center)},null,2)],2))}}),[["__cssModules",{$style:{page:"_page_13ksh_2",tip:"_tip_13ksh_15",item:"_item_13ksh_22",center:"_center_13ksh_34"}}]]),fe={M_MAIN_SCENE:"MAIN_SCENE",M_CURTAIN:"curtain",M_CONPANT_FLOOR:"campany_floor",M_PERSON:"PERSON",M_ROBOT:"ROBOT",M_MODE_SWITCH:"MODE_SWITCH",M_ANCHOR_POS:"ANCHOR_POS",M_ANCHOR_TARGET:"ANCHOR_TARGET",M_WAIT_LIFT:"WAIT_LIFT",M_DOUBLE_HORIZONTAL_SWITCH:"DOUBLE_HORIZONTAL_SWITCH",M_DOUBLE_ROTATE_SWITCH:"DOUBLE_ROTATE_SWITCH",M_ODD_ROTATE_SWITCH:"ODD_ROTATE_SWITCH",M_VIDEO_SWITCH:"VIDEO_SWITCH",M_SCREEN_EDIT:"SCREEN_EDIT",M_CURTAIN_SWITCH:"CURTAIN_SWITCH",M_GATE_SWITCH:"GATE_SWITCH",M_LIGHT_MAIN_SWITCH:"LIGHT_MAIN_SWITCH",M_LIGHT_SWITCH:"LIGHT_SWITCH",M_AIR_SWITCH:"AIR_SWITCH",DOT:"DOT"},Ee=[{key:fe.M_MAIN_SCENE,name:"场景",size:13.6,url:"/公司总部.glb"},{key:fe.M_CONPANT_FLOOR,name:"公司",size:16.6,url:"/二十五楼.glb"},{key:"floor_low",name:"低层",size:6.1,url:"/低层.glb"},{key:fe.M_CURTAIN,name:"窗帘",size:.2,url:"/窗帘.glb"},{key:"floor_heigh",name:"高层",size:2.7,url:"/高层.glb"},{key:fe.M_ROBOT,name:"机器人",size:.3,url:"/oss/model/park/机器人.glb"},{key:fe.M_PERSON,name:"人物",size:2.2,url:"/oss/model/park/RobotExpressive.glb"},{key:"spot_light_floor_1",type:"GPUspotlight",name:"主机聚光灯",intensity:4,color:16777197,castShadow:!1,distance:20,penumbra:.5},{key:"spot_light_floor_2",type:"GPUspotlight",name:"会议室聚光灯",intensity:2,color:16777197,castShadow:!1,penumbra:.5,angle:.36*Math.PI,distance:10},{key:"spot_light_floor_3",type:"GPUspotlight",name:"屏幕聚光灯",intensity:1,color:16777197,distance:15,penumbra:.5,castShadow:!1,angle:.36*Math.PI},{key:"spot_light_floor_4",type:"GPUspotlight",name:"屏幕聚光灯",intensity:2,color:16777197,distance:12,penumbra:.5,castShadow:!1,angle:.4*Math.PI},{key:"spot_light_floor_5",type:"GPUspotlight",name:"屏幕聚光灯",intensity:2,color:16777197,distance:8,penumbra:.5,castShadow:!1,angle:.23*Math.PI},{key:"rect_area_light_1",type:"GPUplanelight",name:"面光灯",intensity:1.2,color:16777215,width:134,height:134},{key:"rect_area_light_2",type:"GPUplanelight",name:"面光灯",intensity:.5,color:16777215,width:134,height:134},{key:fe.M_ANCHOR_POS,name:"定位",type:"sprite",range:{x:4,y:4},mapUrl:"/pos.png"},{key:fe.M_ANCHOR_TARGET,name:"锚点",type:"sprite",mapUrl:"/dw.png"},{key:fe.M_WAIT_LIFT,name:"电梯门",type:"sprite",mapUrl:"/lift.png"},{key:fe.M_DOUBLE_HORIZONTAL_SWITCH,name:"双横推开关门",type:"sprite",mapUrl:"/lift.png",range:{x:.3,y:.3}},{key:fe.M_DOUBLE_ROTATE_SWITCH,name:"双旋转开关门",type:"sprite",mapUrl:"/lift.png",range:{x:.3,y:.3}},{key:fe.M_ODD_ROTATE_SWITCH,name:"单旋转开关门",type:"sprite",mapUrl:"/lift.png",range:{x:.3,y:.3}},{key:fe.M_GATE_SWITCH,name:"闸机开关",type:"sprite",mapUrl:"/gate.png"},{key:fe.M_VIDEO_SWITCH,name:"视频播放开关",type:"sprite",mapUrl:"/video.png"},{key:fe.M_SCREEN_EDIT,name:"编辑大屏按钮",type:"sprite",mapUrl:"/edit.png"},{key:fe.M_CURTAIN_SWITCH,name:"窗帘-开关",type:"sprite",mapUrl:"/curtain.png"},{key:fe.M_LIGHT_SWITCH,name:"开关灯",type:"sprite",mapUrl:"/light.png"},{key:fe.M_LIGHT_MAIN_SWITCH,name:"开关灯",type:"sprite",mapUrl:"/light.png"},{key:fe.M_AIR_SWITCH,name:"空调开关",type:"sprite",mapUrl:"/air.png"},{key:fe.M_MODE_SWITCH,name:"模式切换按钮",type:"sprite",mapUrl:"/mode.png"}].map((e=>(e.url&&e.url.indexOf("oss")<0&&(e.url="/oss/model/office"+e.url),e.mapUrl&&(e.mapUrl="/oss/textures/office"+e.mapUrl),e.range||(e.range={x:.5,y:.5}),e))),be=["CAMERA:ROAM","CAMERA:CRUISE","CAMERA:RESET","CAMERA:FIRST","CAMERA:THREE","CAMERA:GATE","CAMERA:RECCEPTION","CAMERA:OFFICE","CAMERA:LCR","CAMERA:BOSS","PERSON:ADD","PERSON:SUB","LIGHT:RECCEPTION","LIGHT:AILSE","LIGHT:PM","LIGHT:HOST","LIGHT:LCR","LIGHT:CLG","LIGHT:FIRSTFLOOR","LIGHT:CLOSE","LIGHT:AUTO","CURTAIN:TOGGLE","DOOR:COMPANY","DOOR:LCR","DOOR:BOSS","SCREEN:COMPANY","SCREEN:WELCOM","SCREEN:SCR","SCREEN:LCR","AIR:MAIN","AIR:ODD","SCENE:POS","SKY:DAY","SKY:EVENING","SKY:NIGHT","EFFECT:FLEETING","BIRD:COMPANY"];const Ae=new class{constructor(){t(this,"listteners",be.reduce(((e,t)=>(e[t]=new Set,e)),{}))}on(e,t){this.listteners[e].forEach((i=>{i.toString()===t.toString()&&this.listteners[e].delete(i)})),this.listteners[e].add(t)}emit(e,...t){this.listteners[e].forEach((e=>e(...t)))}},Me=ne,Oe=ae,{initCSS2DRender:Re,createCSS2DDom:Ie}=Me.useCSS2D(),{createFleeting:Le,fleetingAnimate:Ge}=Me.useFleeting(),{raycaster:Ne,pointer:He,update:ke,style:xe}=Me.useRaycaster(),{pass:Pe,mrt:De,output:we,emissive:Ue,float:We}=k,je=(e,t,i,s)=>{const o=Pe(e,t);s?o.setMRT(De({output:we,emissive:Ue})):o.setMRT(De({output:we,bloomIntensity:We(.01)}));const n=o.getTextureNode();let a;if(s){const e=o.getTextureNode("emissive");a=S(e,2.5,.5)}else{const e=o.getTextureNode("bloomIntensity");a=S(n.mul(e))}i.toneMapping=f;const r=new E(i);return s?r.outputNode=n.add(a):(r.outputColorTransform=!1,r.outputNode=n.add(a).renderOutput()),r},Be=(e,t)=>{const i=40*Math.random();return void 0!==i&&(e.value=i),e.show=Math.random()>.5,e.value=Number(Number(e.value||0).toFixed(2)),{value:e.value,show:e.show,font:{...e.font||{},color:"#"+(16777215+1e6*i).toString(16).substring(0,6)}}},Fe=(e,t,i)=>{var s;const o=t.data,n=Be(o,e.buildingGroup);"object"==typeof n&&Object.keys(n).forEach((e=>{o[e]=n[e]})),t.visible=o.show||!i;const a=null==(s=t.element)?void 0:s.getElementsByClassName("inner")[0];if(a){const{size:e,color:t}=o.font||{};null!=e&&(a.style.fontSize="string"==typeof e?e:e+"px"),null!=t&&(a.style.color=t),a.textContent=`${o.value||0}${o.unit??""}`}},ze=(e,t)=>Re(e,t),Ve=(e,t)=>{const i=e.position,{size:s,color:o}=e.font||{},{x:n=0,y:a=0,z:r=0}=i||{},l=Ie({name:`\n      <div class="bg"></div>\n      <span class="inner" style="${null!=s?`font-size: ${"string"==typeof s?s:s+"px"};`:""} ${null!=o?`color: ${o}`:""}"></span>\n    `,className:"dot-2D-label",position:[n,a,r],onClick:t});return l.name=e.name,l.data=e,l._position_={x:n,y:a,z:r},l},$e=(e,t,i)=>{const s=new b;t.name=e.name;const o=e.position||{x:0,y:0,z:0},{to:n={x:o.x,y:o.y-2,z:o.z}}=e;if(t.isRectAreaLight||(t.target.position.set(n.x,n.y,n.z),s.add(t.target)),t.visible=!1,s.add(t),i)if(t.isRectAreaLight){const e=new A(t);s.add(e)}else{const e=new M(t,t.color);s.add(e)}return s},Ye=(e=[],t,i)=>{const s=new b;for(let o=0;o<e.length;o++){const n=e[o],a=Le({color:t,points:n,tubularSegments:1e3,radius:.6,repeat:{x:2,y:4},bloom:!0,bloomIntensity:i});s.add(a)}return s.name="流光组",s},Ke=Ge,Je=(e,t=16777215)=>{const i=new b,s=new O(t,10,100,.6*Math.PI,.6,.4);for(let o=0;o<e.length;o++){const t=s.clone(),[n,a,r]=e[o];t.position.set(n,a,r),t.target.position.set(n,a-1,r),t.add(s.target),i.add(t);const l=new M(t);l.visible=!1,i.add(l)}return i.name="路灯组",i.visible=!1,i},Ze=(e,t=[],i=!0,s=1)=>{if(!t.length)return;const o=new R(e),n=t.reduce(((e,t)=>{const n=t.name||"";return e[n]=o.clipAction(t),i&&e[n].play(),e[n].timeScale=s,e}),{});e.__action__=n,e.__mixer__=o},qe=(e,t)=>{e.__close__=t??!e.__close__;const{__action__:i,__mixer__:s}=e;Object.keys(i).forEach((t=>{e.__close__&&(i[t].loop=I,i[t].clampWhenFinished=!0,i[t].play())})),e.__close__||s.stopAllAction()},Xe=(e,t,i,s,o,n)=>(ke(e,t,i),Ne.setFromCamera(He,s),Ne.intersectObjects(o,n)),Qe=(e,t,i,s)=>{if("function"==typeof t&&t(e[0],xe),e.length){const t=e[0].object;if(i.style.cursor=t._isAnchor_?"pointer":"auto",!t._isAnchor_)return void(null==s||s.children.forEach((e=>{e.__change_color__=!1})));const o=t.material;void 0===t.__mat_color__&&(t.__mat_color__=o.color),o.color=new L(16715760),null==s||s.children.forEach((e=>{e.__change_color__=e.uuid===t.uuid}))}else i.style.cursor="auto",null==s||s.children.forEach((e=>{e.__change_color__=!1}))},et=e=>{null==e||e.children.forEach((e=>{!e.__change_color__&&e.__mat_color__&&(e.material.color=e.__mat_color__)}))},tt=e=>{const t=e=>{if(e._isBuilding_)return e;let i=e.parent;return i?i&&i._isBuilding_?i:t(i):void 0};return t(e)},it=(e,t="")=>{const i=e.offsetWidth,s=e.offsetHeight;e.width=i,e.height=s;const o=e.getContext("2d");if(!o)return;o.clearRect(0,0,i,s),o.fillStyle="#f00";const n=t.length,a=n>12?Math.ceil(n/2):12;let r=[],l=0;for(;l<n;){const e=l+a;r.push(t.substring(l,e)),l=e}o.font="100 40px 微软雅黑",o.textAlign="center",o.textBaseline="middle";const c=r.length;r.forEach(((e,t)=>{const n=t*c+1;o.fillText(e,i/2,s/c/2*n)}))},st=e=>{const t=document.createElement("video");return t.src=Te.baseUrl+(e||"/oss/textures/park/sintel.mp4"),t.loop=!0,t},ot=(new T).load(Te.baseUrl+"/oss/textures/office/cover.jpg"),nt=(new T).load(Te.baseUrl+"/oss/textures/office/wind.png"),at=e=>{const t=st(),i=new G(t);return e.__video_texture__=i,e.__cover_texture__=ot.clone(),e.material=new N({map:ot}),e.__video__=t,e},rt=(e,t)=>{if(e&&e.__video__){const i=e.__video__;null!=t&&!t||i.paused?(e.material.map=e.__video_texture__,null==i||i.play()):(null==i||i.pause(),e.material.map=e.__cover_texture__)}},lt=e=>{for(let t=0;t<e.length;t++){const i=e[t],{__video__:s,__cover_texture__:o,__video_texture__:n}=i;s&&(s.pause(),s.remove(),null==o||o.dispose(),null==n||n.dispose())}},ct=e=>{const t=e.animations,i=new R(e),s={};for(let o=0;o<t.length;o++){const e=t[o],n=i.clipAction(e);s[e.name]=n}return{mixer:i,actions:s}},dt=(e,t,i)=>{const s=5e3;return m.success({message:`【${e}】移动中，请稍候，5秒后到达!`,duration:s}),new H(t).to(i,s).delay(0).start()},ht=Object.freeze(Object.defineProperty({__proto__:null,Hooks:Me,Utils:Oe,addVideoMaterial:at,clearVideo:lt,createCSS2DRender:ze,createDotCSS2DDom:Ve,createFleetingGroup:Ye,createLightGroup:$e,createModelAnimate:Ze,createPostProcessing:je,createStreetLampGroup:Je,createVideoDom:st,dotUpdateObjectCall:Be,drawBdCanvas:it,findParentIsBuilding:tt,fleetingGroupAnimate:Ke,getIntersectObjects:Xe,getModelAction:ct,hoverAnchor:Qe,liftMove:dt,restoreAnchorMaterial:et,toggleCurtainAnimate:qe,updateDotVisible:Fe,videoCoverTexture:ot,videoMaterilPlay:rt,windTexture:nt},Symbol.toStringTag,{value:"Module"})),{Utils:ut,Hooks:pt}=ht,{createRoam:_t,executeRoam:mt,pause:gt,play:yt,getStatus:Ct}=pt.useRoam(),{dubleHorizontal:vt,dubleRotate:Tt,oddRotate:St}=pt.useOpenTheDoor(),{keyboardPressed:ft,destroyEvent:Et,insertEvent:bt}=pt.useKeyboardState(),{createMove:At,moveAnimate:Mt}=pt.useMoveAnimate(),{checkCollide:Ot}=pt.useCollide(),{virtualization:Rt,closeVirtualization:It}=pt.useModelLoader({}),{createDiffusion:Lt,updateDiffusion:Gt}=pt.useDiffusion2(["1.png","2.png","3.png","4.png","5.png","6.png","7.png","8.png","9.png","10.png","11.png","12.png"].map((e=>`${Te.baseUrl}/oss/textures/diffusion/${e}`))),Nt="SCREEN",Ht="PERSON_FIRST",kt="PERSON_THREE",xt=Te.groundMeshName.concat(Te.liftGroundMeshName);class Pt extends re{constructor(e,i){super(e),t(this,"extend"),t(this,"postProcessing"),t(this,"buildingGroup"),t(this,"anchorGroup"),t(this,"css2DRender"),t(this,"dotGroup"),t(this,"lightGroup"),t(this,"animateModels",[]),t(this,"ambientLight",new x),t(this,"directionalLight",new P),t(this,"sky",Te.sky),t(this,"style",-1),t(this,"styleTimes",Te.styleTimes),t(this,"fleetingGroup"),t(this,"streetLampGroup"),t(this,"residentLightGroup"),t(this,"canvasTextures",[]),t(this,"videoModels",[]),t(this,"person"),t(this,"personSightHeight",Te.personSightHeight),t(this,"moveFactor",Te.moveFactor),t(this,"currentSight",Nt),t(this,"historyTarget"),t(this,"historyCameraPosition"),t(this,"diffusion",new D),t(this,"collisionSpace",Te.collisionSpace),this.extend=i,this.createClock(),this.postProcessing=je(this.scene,this.camera,this.renderer),this.addBuildingGroup(),this.addAnchorGroup(),this.css2DRender=ze(this.options,this.container),this.addDotGroup(),this.addLightGroup(),this.addFleeting(),this.addStreetLamp(),this.findLight(),this.bindEvent(),this.addDiffusion()}setEnv(e){this.scene.environment=e,this.scene.background=e}createRender(){return new w}render(){this.postProcessing.renderAsync()}run(){return this.renderer.setAnimationLoop((()=>{this.animate(),this.modelAnimate()})),this}modelAnimate(){var e,t,i;let s=null==(e=this.clock)?void 0:e.getDelta();null==(t=this.css2DRender)||t.render(this.scene,this.camera),this.autoChangeStyle(),this.anchorAnimateUpdate(s),(null==(i=this.fleetingGroup)?void 0:i.visible)&&Ke(1),this.modelAnimateUpdate(s),mt(this.camera,this.controls),et(this.anchorGroup),this.persionAnimate(s),this.diffusionAnimate()}findLight(){const e=this.scene.getObjectByProperty("isAmbientLight",!0);this.ambientLight=e;const t=this.scene.getObjectByProperty("isDirectionalLight",!0);this.directionalLight=t}toByday(e=1){this.style=e;const{ambientLight:t,directionalLight:i}=this.options;this.setStyleOptions(t.intensity,i.intensity,this.sky.day)}toEvening(e=2){this.style=e,this.setStyleOptions(.01,.5,this.sky.evening)}toNight(e=3){this.style=e,this.setStyleOptions(.01,.3,this.sky.night,!0)}setStyleOptions(e,t,i,s=!1){this.ambientLight.intensity=e,this.directionalLight.intensity=t,this.fleetingGroup&&(this.fleetingGroup.visible=s),this.streetLampGroup&&(this.streetLampGroup.visible=s),this.residentLightGroup&&(this.residentLightGroup.visible=s),this.toggleCruiseBloom(s),this.loadEnvTexture(i,(e=>{}))}autoChangeStyle(){const e=this.styleTimes,t=(new Date).getHours(),i=e.findIndex(((i,s)=>s==e.length-1?t>=i[0]||t<i[1]:t>=i[0]&&t<i[1]));this.style!=i+1&&(0==i?this.toByday():1==i?this.toEvening():2==i&&this.toNight())}addBuildingGroup(){const e=new b;e.name="建筑组",this.buildingGroup=e,this.addObject(e)}addBuilding(...e){this.buildingGroup&&this.buildingGroup.add(...e)}addAnchorGroup(){const e=new b;e.name="锚点组",this.anchorGroup=e,this.addObject(e)}addAnchor(e){this.anchorGroup&&this.anchorGroup.add(e);const{x:t,y:i,z:s}=e.position;ut.createSpriteAnimate(e,[t,i,s],.2,8)}anchorAnimateUpdate(e){var t;null==(t=this.anchorGroup)||t.children.forEach((t=>{t.__mixer__&&t.__mixer__.update(e)}))}addDotGroup(){if(!this.css2DRender)return;this.css2DRender.domElement.className="three-scene__dot-wrap";const e=new b;e.name="点位组",this.dotGroup=e,this.scene.add(e)}addDot(e,t){const i=Ve(e,t);return this.dotGroup.add(i),i}addLightGroup(){const e=new b;e.name="灯光组",this.lightGroup=e,this.addObject(e)}addLight(e,t,i){if(!this.lightGroup)return;const s=$e(e,t,i);this.lightGroup.add(s)}lightSwitch(e,t,i){var s,o;const n=null==(o=this.lightGroup)?void 0:o.getObjectsByProperty("name",null==(s=e.data)?void 0:s.bind);n&&n.forEach(((e,s)=>{let o=!(null!=i&&i>=0)&&(null!=t?t:!e.visible);null!=i&&i>=0&&s<i&&(o=null==t||t),e.visible=o}))}closeLightGroup(e=!1){var t;null==(t=this.lightGroup)||t.traverse((t=>{(t.isSpotLight||t.isRectAreaLight)&&(t.visible=e)}))}addFleeting(){this.fleetingGroup=Ye(Te.fleetings,21503,1),this.addObject(this.fleetingGroup)}toggleFleeting(e){this.fleetingGroup&&(this.fleetingGroup.visible=e??!this.fleetingGroup.visible)}addStreetLamp(){this.streetLampGroup=Je(Te.streetLamps),this.addObject(this.streetLampGroup)}toggleCurtain(e,t){const i=this.animateModels.find((t=>{var i;return t.name===(null==(i=e.data)?void 0:i.bind)}));if(i)return qe(i,t),i.__close__}dubleHorizontalDoor(e,t=400,i){const{bind:s,axle:o="z"}=e.data;return vt(this.scene,{value:s,axle:o,scale:t,isOpen:i})}dubleRotateDoor(e){const{bind:t,axle:i="y",left:s="右",right:o="左",internal:n,autoClose:a=!0}=e.data;return Tt(this.scene,{value:t,axle:i,autoClose:a,angle:Math.PI*(n?-.5:.5),leftMatch:s,rightMatch:o})}oddRotateDoor(e){const{bind:t,axle:i="y",internal:s,autoClose:o=!1}=e.data;return St(this.scene,{value:t,axle:i,angle:Math.PI*(s?-.5:.5),autoClose:o})}openGate(e){return this.dubleRotateDoor(e)}waitLift(e,t){var i;const s=e.data.target,o=this.scene.getObjectByName(s);o||m.error({message:`【${s}】模块未找到！`,grouping:!0});const n=null==(i=e.data)?void 0:i.to;if(!o||!n)return;const a=o.position;if(Math.abs(n.y-a.y)>.2){const i=o.__bind_lift__;if(void 0!==i){const e={data:{bind:i}};this.dubleHorizontalDoor(e,2.3,!1)}const r={data:{bind:s}};this.dubleHorizontalDoor(r,2.3,!1).then((()=>{dt(s,a,{y:n.y}).onUpdate((e=>{if(t){if(!this.person)return;this.person.position.y=e.y,this.camera.position.y=e.y,this.setControlTarget(this.person.position)}})).onComplete((()=>{o.__bind_lift__=e.data.bind,this.openDoorByLift(e,s)}))}))}else this.openDoorByLift(e,s)}openDoorByLift(e,t){this.dubleHorizontalDoor(e,2.3);const i={data:{bind:t}};this.dubleHorizontalDoor(i,2.3)}addVideoMaterial(e){var t,i;this.videoModels=[];for(let s=0;s<e.length;s++){const o=e[s],n=null==(t=this.buildingGroup)?void 0:t.getObjectByName(o);if(!n)continue;const a=null==(i=this.lightGroup)?void 0:i.getObjectByName(o+"-照明灯");a&&(a.visible=!0),at(n),this.videoModels.push(n)}}clearVideo(){lt(this.videoModels)}videoPlay(e){const t=this.scene.getObjectByName(e.data.bind);rt(t)}drawCanvas(e=""){this.extend.canvas&&(it(this.extend.canvas,e),this.canvasTextures.length&&this.canvasTextures.forEach((e=>{e.needsUpdate=!0})))}addCanvasMaterial(e){var t;if(!this.extend.canvas)return;const i=new N({map:new U(this.extend.canvas),side:W});this.canvasTextures=[];for(let s=0;s<e.length;s++){const o=this.scene.getObjectByName(e[s]);o&&(o.material=i.clone(),o.__cover_texture__=null==(t=i.map)?void 0:t.clone(),this.canvasTextures.push(o.material.map))}}addPerson(e){this.person=e;const{mixer:t,actions:i}=ct(e);i.Dance.play();const s=i.Walking;e.extra={mixer:t,actions:i,runging:s},this.addObject(e),this.addPersonEvent()}addPersonEvent(){const e=this.person,t=e.extra.runging,i=["W","S"].map((e=>e.toUpperCase().charCodeAt(0)));bt((s=>{e.__runing__||(i.includes(s.keyCode)&&t.play(),this.isPersonSight()&&(ft("X")&&this.personSpeed(1),ft("Z")&&this.personSpeed(-1)))}),(s=>{e.__runing__||i.includes(s.keyCode)&&t.stop()}))}persionAnimate(e){const t=this.person;if(t){if(t.extra.mixer.update(e),Mt(.2*this.moveFactor),this.isPersonSight()&&!t.__runing__){const i=1+this.moveFactor/5,s=5*e*i,o=.2*Math.PI*e*i;this.keyboardToMove(s),ft("A")?(t.rotation.y+=o,this.keyboardToTotation()):ft("D")&&(t.rotation.y-=o,this.keyboardToTotation())}}}keyboardToMove(e){const t=this.person,i=ft("S");if(ft("W")||i){const s=new j;null==t||t.getWorldDirection(s);const o=s.clone().multiplyScalar(i?-e:e),n=(null==t?void 0:t.position.clone().add(o))||new j;if(!this.checkCharacterCollide(n)){if(null==t||t.position.copy(n),i){const t=s.clone().multiplyScalar(2*-e);this.camera.position.copy(this.camera.position.clone().add(t))}this.setControlTarget(null==t?void 0:t.position)}}}keyboardToTotation(){var e;const t=this.person,i=new j;null==t||t.getWorldDirection(i);const s=(null==(e=this.controls)?void 0:e.maxDistance)||1,o=i.clone().multiplyScalar(-s),n=(null==t?void 0:t.position.clone().setY(this.camera.position.y).add(o))||new j;this.camera.position.copy(n),this.setControlTarget(null==t?void 0:t.position)}togglePersonSight(e){if(this.judgeCruise())return;this.judgeAndStopRoam();const t=this.isPersonSight()?Nt:1==e?Ht:kt;this.currentSight=t,this.controlsLimitSet(),this.togglePersonView(),this.cameraChangeByPerson()}controlsLimitSet(){if(!this.controls)return;const e=this.currentSight,t=e===Ht,i=t||e===kt;this.controls.maxDistance=i?t?0:10:800,this.controls.screenSpacePanning=!i,this.controls.enablePan=!i}isPersonSight(){return this.currentSight===Ht||this.currentSight===kt}togglePersonView(){var e;const t=null==(e=this.container.parentNode)?void 0:e.querySelector("."+Te.personSightClass);if(!t)return;const i=this.isPersonSight();t.style.display=i?"block":"none"}clearCharacterSight(){this.currentSight=Nt,this.togglePersonView()}cameraChangeByPerson(){if(!this.person||!this.controls)return;const e=this.isPersonSight(),t=this.person.position,i=new j(0,this.personSightHeight,0);if(e){m.success({message:`鼠标点击地面移动，或键盘按键 ${Te.personKeys.map((e=>`${e.code} ${e.desc}`)).join("、")}，来控制人物！`,grouping:!0}),this.historyTarget=this.controls.target.clone(),this.historyCameraPosition=this.camera.position.clone();const e=t.clone().add(i);this.camera.lookAt(e),Math.abs(this.camera.position.y-e.y)>8&&(this.camera.position.y=e.y)}else this.camera.position.copy(this.historyCameraPosition),this.camera.lookAt(t);const s=(e?t:this.historyTarget).clone().add(i);this.controls.target.copy(s)}personSpeed(e=1){this.moveFactor+=e,this.moveFactor>=10?this.moveFactor=10:this.moveFactor<=1&&(this.moveFactor=1),m.success({message:"人物速度："+this.moveFactor,grouping:!0})}personMove(e){if(this.judgeCruise())return Promise.reject();if(!this.isPersonSight())return Promise.reject();const t=this.person;if(!t)return Promise.reject();const i=Te.liftGroundMeshName,s=e.point,o=this.diffusion,{runging:n}=t.extra;return n.play(),o.position.copy(s.clone().add(new j(0,.05,0))),o.visible=!0,new Promise((a=>{At(t,s,((s,a)=>{this.setControlTarget(s),this.checkCharacterCollide(s,i.includes(e.object.name)?2:.3)&&(a(),n.stop(),t.__runing__=!1,o.visible=!1)}),(e=>{this.setControlTarget(e),n.stop(),t.__runing__=!1,o.visible=!1,a(t)}))}))}checkCharacterCollide(e,t=.3){var i;if(!this.person)return;const s=Ot(this.person,e,(null==(i=this.buildingGroup)?void 0:i.children)||[],!0,new j(0,t,0));if(s.length){if(s[0].distance<this.collisionSpace)return m.warning({message:"撞到了！",grouping:!0}),!0}}addDiffusion(){const e=Lt(2);e.rotation.x=.5*-Math.PI,e.position.y=.5,e.visible=!1,this.addObject(e),this.diffusion=e}diffusionAnimate(){this.diffusion.visible&&Gt(2)}toggleBridCompany(){var e,t;if(this.judgeCruise())return;this.clearCharacterSight(),this.judgeAndStopRoam();const i=Te.companyModelName,s=null==(e=this.buildingGroup)?void 0:e.getObjectByName(i);if(s){if(s.__isFocus__=!s.__isFocus__,!s.__isFocus__)return this.closeVirtualization(),void this.toggleCompanyFocus(!1);this.toggleCompanyFocus(!0),Rt((null==(t=this.buildingGroup)?void 0:t.children)||[],s,{wireframe:!0,hidden:!0,opacity:.1,filter:["电梯-1"]})}else m.warning({message:`未找到【${i}】模块！`,grouping:!0})}closeVirtualization(){var e,t;const i=Te.companyModelName;(null==(e=this.buildingGroup)?void 0:e.getObjectByName(i)).__isFocus__=!1,It(null==(t=this.buildingGroup)?void 0:t.children,{filter:["_空调风_grp"]})}toggleCompanyFocus(e){if(!this.controls)return;let t=this.historyTarget,i=this.historyCameraPosition;e&&(this.historyTarget=(new j).copy(this.controls.target),this.historyCameraPosition=(new j).copy(this.camera.position),t=new j(0,185,0),i={x:0,y:340,z:0});const s=t.distanceTo(i);this.controls.maxDistance=s,ut.cameraLinkageControlsAnimate(this.controls,this.camera,i,t)}cameraLookatMoveTo(e){this.controls&&ut.cameraLookatAnimate(this.camera,e,this.controls.target)}cameraTransition(e){if(this.judgeCruise())return;this.clearCharacterSight();const{to:t,target:i=e.position}=e.data;t&&!this.isCameraMove(t)&&this.controls&&(this.judgeAndStopRoam(),this.controls.enablePan=!0,this.controls.maxDistance=5,ut.cameraLinkageControlsAnimate(this.controls,this.camera,t,i))}addModelAnimate(e,t=[],i=!0,s=1){Ze(e,t,i,s),this.animateModels.push(e)}modelAnimateUpdate(e){this.animateModels.length&&this.animateModels.forEach((t=>{t.__mixer__&&t.__mixer__.update(e)}))}controlReset(){this.judgeAndStopRoam(),this.controls&&(this.controls.enablePan=!0,this.controls.maxDistance=1500,this.controls.maxPolarAngle=.48*Math.PI,super.controlReset())}setControlTarget(e){this.controls&&(this.controls.target.copy(e.clone().add(new j(0,this.personSightHeight,0))),this.camera.lookAt(this.controls.target))}toggleRoam(){if(this.judgeAndStopRoam())return;const e=this.extend.roamPoints||[];0!=e.length&&this.controls&&(this.controls.maxDistance=5,_t({points:e,segment:6,tension:0,speed:2,close:!1,factor:1}),yt())}setRoamPoint(e){this.extend.roamPoints=e}judgeAndStopRoam(){return!!Ct()&&(this.controls&&(this.controls.maxDistance=1500),gt(),!0)}toggleCruise(e){super.toggleCruise(e),this.postProcessing=je(this.scene,this.camera,this.renderer)}judgeCruise(){return!!this.options.cruise.runing&&(m.warning({message:"请退出巡航！",grouping:!0}),!0)}onPointerMove(e){this.checkIntersectObjects(e)}onPointerUp(e){var t;super.onPointerUp(e);const i=e.timeStamp-this.pointer.tsp<Te.clickIntervalTime;2==e.button?i&&"function"==typeof(null==(t=this.extend)?void 0:t.onClickRight)&&this.extend.onClickRight(e):0==e.button&&i&&this.checkIntersectObjects(e)}checkIntersectObjects(e){var t,i,s,o,n;let a="pointerdown"==e.type||"pointerup"==e.type;const r=(null==(i=this.buildingGroup)?void 0:i.children.filter((e=>e.visible)).map((e=>(e.children=e.children.filter((e=>e.visible)),e))).concat((null==(t=this.anchorGroup)?void 0:t.children)||[]))||[],l=Xe(e,this.container,this.options.scale,this.camera,r,a);if(Qe(l,this.extend.onHoverAnchor,this.container,this.anchorGroup),a)if(l.length){const e=l[0],t=e.object,i=tt(t);if("string"==typeof t.name&&xt.some((e=>t.name.indexOf(e)>-1))&&"function"==typeof(null==(s=this.extend)?void 0:s.onClickGround)&&this.extend.onClickGround(i,e),!i)return;"function"==typeof(null==(o=this.extend)?void 0:o.onClickLeft)&&this.extend.onClickLeft(i,e)}else"function"==typeof(null==(n=this.extend)?void 0:n.onClickLeft)&&this.extend.onClickLeft()}dispose(){this.animateModels=[],this.canvasTextures=[],this.videoModels=[],this.disposeObj(this.buildingGroup),this.disposeObj(this.dotGroup),this.disposeObj(this.anchorGroup),this.disposeObj(this.lightGroup),this.disposeObj(this.fleetingGroup),this.disposeObj(this.streetLampGroup),this.disposeObj(this.residentLightGroup),this.clearVideo(),this.clock=void 0,this.css2DRender=void 0,this.buildingGroup=void 0,this.dotGroup=void 0,this.anchorGroup=void 0,this.lightGroup=void 0,this.fleetingGroup=void 0,this.streetLampGroup=void 0,this.residentLightGroup=void 0,this.extend={},this.renderer.dispose(),Et(),super.dispose()}}const Dt={class:"scene-operation"},wt=["onClick"],Ut="welcom.key",Wt=Q(i({__name:"index",setup(e){const{Hooks:t,Utils:i}=ht,s=B({anchorType:[fe.M_ANCHOR_POS,fe.M_ANCHOR_TARGET,fe.M_WAIT_LIFT,fe.M_LIGHT_SWITCH,fe.M_LIGHT_MAIN_SWITCH,fe.M_AIR_SWITCH,fe.M_GATE_SWITCH,fe.M_VIDEO_SWITCH,fe.M_SCREEN_EDIT,fe.M_DOUBLE_HORIZONTAL_SWITCH,fe.M_ODD_ROTATE_SWITCH,fe.M_DOUBLE_ROTATE_SWITCH,fe.M_CURTAIN_SWITCH,fe.M_MODE_SWITCH],animationModelType:[fe.M_MAIN_SCENE,fe.M_CONPANT_FLOOR,fe.M_CURTAIN],config:{},cruise:{color:2090220,visible:!0,auto:!1,mapUrl:"/oss/textures/cruise/line2.png",repeat:[.2,1],width:2,segment:100,tension:.01,speed:20,mapSpeed:.02,points:[],close:!0,offset:5.2,bloomIntensity:.5},roamPoints:[],models:Ee}),o=B({show:!1,style:{left:0,top:0},msg:""}),_=B({active:2,show:!1,targetName:"",list:[{target:"电梯-2",items:[{name:"一楼",key:1,y:.1,bind:"_一楼电梯门-2_grp"},{name:"公司",key:2,y:184.7,bind:"_电梯外门_2_grp"}]},{target:"电梯-1",items:[{name:"一楼",key:1,y:.1,bind:"_一楼电梯门-1_grp"},{name:"公司",key:2,y:184.7,bind:"_电梯外门_1_grp"}]}]}),{options:m}=ce({title:"编辑欢迎词",content:se(Ut)||"中碳能源",errMessage:"请输入欢迎词！"}),{progress:g,loadModels:T,initModels:S,getModel:f}=t.useModelLoader({baseUrl:Te.baseUrl,indexDB:Te.indexDB}),E=F(),b=F(),A={cruise:s.cruise,baseUrl:Te.baseUrl,controls:{visible:!0,enableDamping:!0,dampingFactor:.25,maxPolarAngle:.48*Math.PI,screenSpacePanning:!1,maxDistance:1500},axes:{visible:!0,size:1e3},camera:{near:3,fov:45},ambientLight:{intensity:.01},directionalLight:{intensity:4,light2:!1}};let M;const O=z((()=>{var e;return(null==(e=_.list.find((e=>e.target===_.targetName)))?void 0:e.items)||[]})),R=()=>{S(L.value,(e=>{if(!e)return Promise.resolve();const{type:t}=e;if(t===fe.M_ANCHOR_POS)return Promise.resolve();const o=f(t);if(!o)return t===fe.DOT&&(e=>{Fe(M,M.addDot(e,(t=>{M.cameraLookatMoveTo(e.position)})),!1)})(e),Promise.resolve();const{anchorType:n=[],animationModelType:a=[]}=s;let r=i.modelDeepClone(o);const{position:l,scale:c,rotation:d}=i.get_P_S_R_param(r,e),[h,u,p]=l;return r.scale.set(...c),r.position.set(h,u,p),r.rotation.set(...d),r._isBuilding_=!0,r.data=e,a.includes(t)&&M.addModelAnimate(r,o.animations,t!==fe.M_CURTAIN,1),n.includes(t)?(r._isAnchor_=!0,M.addAnchor(r)):r.isSpotLight||r.isRectAreaLight?M.addLight(e,r,!1):M.addBuilding(r),Promise.resolve()}))},I=()=>te.get(ie.d3.office).then((e=>te.get(ie.d3.office_mode).then((t=>(t.forEach(((t,i)=>{e.JsonList.push({...t,type:fe.M_MODE_SWITCH,position:{x:19-.6*i,y:186.8,z:49}})})),e))))),L=F([]),G=z((()=>L.value.filter((e=>e.type===fe.M_ANCHOR_POS)))),N=()=>{T(s.models,(()=>{I().then((e=>{let t={};if(e.ConfigJson instanceof Object)t=e.ConfigJson;else if("string"==typeof e.ConfigJson)try{t=JSON.parse(e.ConfigJson)}catch(o){}L.value=e.JsonList,Object.keys(t).forEach((e=>{s.config&&(s.config[e]=t[e])})),s.cruise.points=t.cruise||[],s.roamPoints=t.roamPoints||[],setTimeout((()=>{new Promise((async e=>{var t;g.percentage=100,g.show=!1,await q(),await R(),M.setRoamPoint(s.roamPoints),M.setCruisePoint((null==(t=s.cruise)?void 0:t.points)||[]);const o=M.getValidTargetPosition(s.config||{});i.cameraInSceneAnimate(M.camera,o,M.controls.target).then((()=>{M.controlSave(),q((()=>{Ae.emit("LIGHT:CLOSE"),e(1)}))}))})).then((()=>{H(),Ae.emit("SCREEN:WELCOM",m.content),M.addVideoMaterial(e.JsonList.filter((e=>e.type===fe.M_VIDEO_SWITCH)).map((e=>e.bind))),M.addCanvasMaterial(e.JsonList.filter((e=>e.type===fe.M_SCREEN_EDIT)).map((e=>e.bind)))}))}),100)}))}))},H=()=>{const e=f(fe.M_PERSON);e.traverse((e=>{e.isMesh&&(e.castShadow=!0)}));const{x:t,y:i,z:s}={x:14.4,y:184.6,z:37.6};e.position.set(t,i,s),e.scale.setScalar(.75);const o=e.getObjectByName("HandL"),n=e.getObjectByName("HandR");o.visible=!1,n.visible=!1,M.addPerson(e)},k=()=>{N(),(e=>{Ae.on("CAMERA:ROAM",(()=>null==e?void 0:e.toggleRoam())),Ae.on("CAMERA:CRUISE",(()=>null==e?void 0:e.toggleCruise())),Ae.on("CAMERA:RESET",(()=>null==e?void 0:e.controlReset())),Ae.on("CAMERA:FIRST",(()=>null==e?void 0:e.togglePersonSight(1))),Ae.on("CAMERA:THREE",(()=>null==e?void 0:e.togglePersonSight(3))),Ae.on("CAMERA:GATE",(()=>{null==e||e.cameraTransition({data:{name:"一楼大门",type:"ANCHOR_POS",to:{x:-1.3,y:6.2,z:102.3},target:{x:-1.4,y:5.8,z:97.4}}})})),Ae.on("CAMERA:RECCEPTION",(()=>{null==e||e.cameraTransition({data:{name:"公司前台",type:"ANCHOR_POS",to:{x:15.3,y:188,z:33.2},target:{x:15.3,y:188,z:36.3}}})})),Ae.on("CAMERA:OFFICE",(()=>{null==e||e.cameraTransition({data:{name:"办公区域",type:"ANCHOR_POS",to:{x:-38,y:188,z:35.3},target:{x:-35.4,y:188,z:36.4}}})})),Ae.on("CAMERA:LCR",(()=>{null==e||e.cameraTransition({data:{name:"大会议室",type:"ANCHOR_POS",to:{x:-28.8,y:188,z:52.7},target:{x:-33.7,y:188,z:53.4}}})})),Ae.on("CAMERA:BOSS",(()=>{null==e||e.cameraTransition({data:{name:"领导办公",type:"ANCHOR_POS",to:{x:69.4,y:188,z:-.4},target:{x:65,y:188,z:-2.7}}})})),Ae.on("PERSON:ADD",(()=>null==e?void 0:e.personSpeed())),Ae.on("PERSON:SUB",(()=>null==e?void 0:e.personSpeed(-1))),Ae.on("LIGHT:RECCEPTION",((t,i)=>{null==e||e.lightSwitch({data:{bind:"前台聚光灯"}},t,i)})),Ae.on("LIGHT:AILSE",((t,i)=>{null==e||e.lightSwitch({data:{bind:"区域A"}},t,i)})),Ae.on("LIGHT:PM",((t,i)=>{null==e||e.lightSwitch({data:{bind:"区域B"}},t,i)})),Ae.on("LIGHT:HOST",((t,i)=>{null==e||e.lightSwitch({data:{bind:"主机照明灯"}},t,i)})),Ae.on("LIGHT:LCR",((t,i)=>{null==e||e.lightSwitch({data:{bind:"大会议室照明灯"}},t,i)})),Ae.on("LIGHT:CLG",(t=>{null==e||e.lightSwitch({data:{bind:"公司主灯光组"}},t)})),Ae.on("LIGHT:FIRSTFLOOR",(t=>{null==e||e.lightSwitch({data:{bind:"一楼灯光组"}},t)})),Ae.on("LIGHT:CLOSE",(t=>null==e?void 0:e.closeLightGroup(t))),Ae.on("LIGHT:AUTO",((t,i,s)=>null==e?void 0:e.lightSwitch(t,i,s))),Ae.on("CURTAIN:TOGGLE",(t=>{null==e||e.toggleCurtain({data:{bind:"_GROUP_013_grp"}},t)})),Ae.on("DOOR:COMPANY",(()=>{null==e||e.dubleHorizontalDoor({data:{bind:"_公司大门_grp",axle:"x"}},5.4)})),Ae.on("DOOR:LCR",(()=>{null==e||e.dubleRotateDoor({data:{bind:"_大会议室-门_grp",axle:"y"}})})),Ae.on("DOOR:BOSS",(()=>{null==e||e.dubleRotateDoor({data:{bind:"_老板办公室-门_grp",autoClose:0}})})),Ae.on("SCREEN:COMPANY",(()=>{null==e||e.videoPlay({data:{bind:"公司大屏"}})})),Ae.on("SCREEN:WELCOM",(t=>null==e?void 0:e.drawCanvas(t))),Ae.on("SCREEN:SCR",(()=>{null==e||e.videoPlay({data:{bind:"小会议室大屏"}})})),Ae.on("SCREEN:LCR",(()=>{null==e||e.videoPlay({data:{bind:"大会议电视屏幕"}})})),Ae.on("SCENE:POS",(()=>null==e?void 0:e.getPosition())),Ae.on("SKY:DAY",(()=>null==e?void 0:e.toByday(e.style))),Ae.on("SKY:EVENING",(()=>null==e?void 0:e.toEvening(e.style))),Ae.on("SKY:NIGHT",(()=>null==e?void 0:e.toNight(e.style))),Ae.on("EFFECT:FLEETING",(t=>null==e?void 0:e.toggleFleeting(t))),Ae.on("BIRD:COMPANY",(()=>null==e?void 0:e.toggleBridCompany()))})(M)},x=e=>{m.content=e,oe(Ut,m.content||""),Ae.emit("SCREEN:WELCOM",m.content)};return V((()=>{A.container=b.value,M=new Pt(A,{canvas:E.value,onHoverAnchor:(e,t)=>{const i=!!e&&e.object._isAnchor_;if(o.show=i,i){o.style.top=t.top,o.style.left=t.left;const i=e.object.data;o.msg=`\n          <p>${i.name}</p>\n          <p>类型：${i.type}</p>\n          <p>绑定：${i.bind||"无"}</p>\n        `}},onClickLeft:(e,t)=>{e&&e.data&&(e=>{const t=e.data;switch(null==t?void 0:t.type){case fe.M_ANCHOR_POS:M.cameraTransition(e);break;case fe.M_WAIT_LIFT:_.targetName=e.data.target,M.waitLift(e);break;case fe.M_LIGHT_SWITCH:Ae.emit("LIGHT:AUTO",e);break;case fe.M_LIGHT_MAIN_SWITCH:e.__close__=!e.__close__,Ae.emit("LIGHT:CLOSE",!e.__close__);break;case fe.M_GATE_SWITCH:M.openGate(e);break;case fe.M_DOUBLE_HORIZONTAL_SWITCH:M.dubleHorizontalDoor(e,5.4);break;case fe.M_ODD_ROTATE_SWITCH:M.oddRotateDoor(e);break;case fe.M_DOUBLE_ROTATE_SWITCH:M.dubleRotateDoor(e);break;case fe.M_CURTAIN_SWITCH:Ae.emit("CURTAIN:TOGGLE");break;case fe.M_VIDEO_SWITCH:M.videoPlay(e);break;case fe.M_SCREEN_EDIT:m.show=!0;break;case fe.M_AIR_SWITCH:Ae.emit("AIR:ODD",e);case fe.M_MODE_SWITCH:}})(e)},onClickGround:(e,t)=>{M.personMove(t).then((e=>{_.show=Te.liftGroundMeshName.includes(t.object.name)})).catch((()=>{}))}}).run(),le(M).resize(),k()})),(e,t)=>{const i=Z;return r(),l("div",{class:d(["three-page",e.$style.page])},[c("div",Dt,[c("div",{class:"btn",onClick:t[0]||(t[0]=()=>v(Ae).emit("SCENE:POS"))},"场景坐标"),c("div",{class:"item",onClick:t[1]||(t[1]=()=>v(Ae).emit("CAMERA:ROAM"))},"全景漫游"),(r(!0),l(y,null,C(v(G),(e=>(r(),l("div",{class:"item",onClick:t=>(e=>{M.cameraTransition({position:e.position,data:e})})(e)},u(e.name),9,wt)))),256)),c("div",{class:"item",onClick:t[2]||(t[2]=()=>v(Ae).emit("CAMERA:CRUISE"))},"定点巡航"),c("div",{class:"item",onClick:t[3]||(t[3]=()=>v(Ae).emit("CAMERA:RESET"))},"视角重置"),c("div",{class:"item",onClick:t[4]||(t[4]=()=>v(Ae).emit("LIGHT:CLG"))},"灯组开关"),c("div",{class:"item",onClick:t[5]||(t[5]=()=>v(Ae).emit("LIGHT:FIRSTFLOOR"))},"一楼灯开关"),c("div",{class:"item",onClick:t[6]||(t[6]=()=>v(Ae).emit("LIGHT:LCR",null,Math.floor(5*Math.random())))}," 大会议室灯 "),c("div",{class:"item",onClick:t[7]||(t[7]=()=>v(Ae).emit("CURTAIN:TOGGLE"))},"窗帘开关"),c("div",{class:"item",onClick:t[8]||(t[8]=()=>v(Ae).emit("EFFECT:FLEETING"))},"流光开关"),c("div",{class:"item",onClick:t[9]||(t[9]=()=>v(Ae).emit("SKY:DAY"))},"白天"),c("div",{class:"item",onClick:t[10]||(t[10]=()=>v(Ae).emit("SKY:EVENING"))},"傍晚"),c("div",{class:"item",onClick:t[11]||(t[11]=()=>v(Ae).emit("SKY:NIGHT"))},"夜间"),c("div",{class:"item",onClick:t[12]||(t[12]=()=>v(Ae).emit("AIR:MAIN"))},"空调开关"),c("div",{class:"item",onClick:t[13]||(t[13]=()=>v(Ae).emit("CAMERA:FIRST"))},"第一人称"),c("div",{class:"item",onClick:t[14]||(t[14]=()=>v(Ae).emit("CAMERA:THREE"))},"第三人称"),c("div",{class:"item",onClick:t[15]||(t[15]=()=>v(Ae).emit("PERSON:ADD"))},"人物加速"),c("div",{class:"item",onClick:t[16]||(t[16]=()=>v(Ae).emit("PERSON:SUB"))},"人物减速"),c("div",{class:"item",onClick:t[17]||(t[17]=()=>v(Ae).emit("BIRD:COMPANY"))},"鸟瞰")]),c("div",{class:"h-100",ref_key:"containerRef",ref:b},null,512),p(X,{modelValue:v(g).show,"onUpdate:modelValue":t[18]||(t[18]=e=>v(g).show=e),progress:v(g).percentage},null,8,["modelValue","progress"]),p(he,{modelValue:v(o).show,"onUpdate:modelValue":t[19]||(t[19]=e=>v(o).show=e),style:h(v(o).style),msg:v(o).msg},null,8,["modelValue","style","msg"]),p(Se),c("canvas",{class:d(e.$style["canvas-texture"]),ref_key:"canvasTextureRef",ref:E},null,2),n(c("div",{class:d(e.$style["floor-select"])},[(r(!0),l(y,null,C(v(O),(e=>(r(),$(i,{type:"primary",disabled:v(_).active===e.key,onClick:t=>(e=>{_.active=e.key;const t={data:{bind:e.bind,to:{y:e.y},target:_.targetName}};null==M||M.waitLift(t,!0)})(e)},{default:Y((()=>[K(u(e.name),1)])),_:2},1032,["disabled","onClick"])))),256))],2),[[a,v(_).show]]),p(ve,{modelValue:v(m).show,"onUpdate:modelValue":t[20]||(t[20]=e=>v(m).show=e),title:v(m).title,content:v(m).content,"onUpdate:content":t[21]||(t[21]=e=>v(m).content=e),"err-message":v(m).errMessage,onConfirm:x},null,8,["modelValue","title","content","err-message"])],2)}}}),[["__cssModules",{$style:{"canvas-texture":"_canvas-texture_1mmu5_2","floor-select":"_floor-select_1mmu5_14",page:"_page_1mmu5_20"}}]]);export{Wt as default};
