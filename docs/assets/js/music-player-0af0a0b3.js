import{_ as e}from"./_vite-a5811b86.js";import{d as t,r as a,k as s,i as n,L as i,o as l,a as r,b as o,u as c,C as u,s as d,w as p,t as m,n as v,a2 as f,A as h,B as _,F as y,j as g,l as w,U as b,m as k,e as E,bh as x,ak as C,aa as I,p as T,h as A}from"./vendor-ebf5717c.js";import{_ as L,a as j,b as P,c as O,d as R,e as S,f as D,g as V}from"./ep-0e474aa0.js";import{_ as M}from"./_plugin-vue_export-helper-1b428a4d.js";const $={title:"musicPlayer"};class q{constructor(){}load(e,t,a,s){const n=new Request(e,{headers:new Headers({}),credentials:"same-origin"});fetch(n).then((e=>{if(200==e.status||0===e.status){const t=e.body.getReader(),s=e.headers.get("Content-Length"),n=s?parseInt(s):0,i=0!==n;let l=0;return new ReadableStream({start(e){!function s(){t.read().then((({done:t,value:r})=>{if(t)e.close();else{l+=r.byteLength;const t=new ProgressEvent("progress",{lengthComputable:i,loaded:l,total:n});a&&a(t),e.enqueue(r),s()}}))}()}})}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((e=>new Response(e).text())).then((e=>{const a=this.formste(e);if(!a)throw Error("文件格式不对!");t&&t(a)})).catch((e=>{s&&s(e)}))}formste(e){const t={ti:"",ar:"",al:"",by:"",offset:0,lrc:[]};e.split("\n").filter((e=>""!==e.trim())).map((e=>{const a=this.parseLyricLine(e.trim());return!!a&&("lyric"===a.type?t.lrc.push(a.data):t[a.type]=a.data,e.trim())}));let a=new RegExp("^\\d+(?:\\.\\d{0,3})?");return t.lrc.forEach(((e,s)=>{const n=(t.lrc[s+1]||{}).tsp;let i=n?n-e.tsp:2;i=Number(i.toString().match(a)),e.duration=i})),t}parseLyricLine(e){let t;if(null!==(t=e.match(/^\[(ti|ar|al|by|offset):(.*)\]$/)))return{type:t[1],data:t[2]};if(null!==(t=e.match(/^\[(\d{2}):(\d{2}).(\d{2})\](.*)/))){const e=Number(t[1]),a=Number(t[2]),s=Number(t[3]);return{type:"lyric",data:{time:{m:e,s:a,ms:s},tsp:(60*e*1e3+1e3*a+s)/1e3,lyric:t[4].trim()}}}}}const z=e=>{let t=parseInt((e/60).toString()),a=parseInt((e%60).toString());return t=t>9?t:"0"+t,a=a>9?a:"0"+a,t+":"+a},N={class:"page"},U={class:"music-box"},B=["src"],F={class:"left-control"},H={class:"process-control"},K={class:"up"},W={class:"music-name"},J={class:"time"},G={class:"cu"},Q=(e=>(T("data-v-5e476086"),e=e(),A(),e))((()=>o("span",{class:"line"},null,-1))),X={class:"total"},Y={class:"progress"},Z={class:"right-control"},ee={class:"progress"},te={class:"music-list"},ae=["onClick"],se={class:"canvas-box"},ne={class:"lrc-box"},ie={class:"list"},le={class:"w"},re=M(t({__name:"index",setup(t){let T=/\.(mp3|ogg)$/;const A=Object.assign({"../../../../public/audio/人为情叹 - 阿悠悠.mp3":()=>e((()=>import("./audio-b4cf8bda.js").then((e=>e._))),[]),"../../../../public/audio/南北组合 吉萍 - 你曾是我炫耀的资本.ogg":()=>e((()=>import("./audio-b4cf8bda.js").then((e=>e.a))),[]),"../../../../public/audio/小少焱-上下五千年.mp3":()=>e((()=>import("./audio-b4cf8bda.js").then((e=>e.b))),[]),"../../../../public/audio/就是南方凯 - 离别开出花.mp3":()=>e((()=>import("./audio-b4cf8bda.js").then((e=>e.c))),[]),"../../../../public/audio/李驰- - 吻得太逼真DJ（弹棉花的小花）.mp3":()=>e((()=>import("./audio-b4cf8bda.js").then((e=>e.d))),[]),"../../../../public/audio/程响 - 可能.ogg":()=>e((()=>import("./audio-b4cf8bda.js").then((e=>e.e))),[]),"../../../../public/audio/走卒(戏腔版)-昊轩京剧-吴昊.128.mp3":()=>e((()=>import("./audio-b4cf8bda.js").then((e=>e.f))),[]),"../../../../public/audio/邵帅 - 你是人间四月天.ogg":()=>e((()=>import("./audio-b4cf8bda.js").then((e=>e.g))),[])}),M=Object.entries(A).map((([e])=>((e||"").match(/\/([^\/]+)\.\w+$/)||[""])[0].replace(/\//,""))),$=a(),re=a(),oe=s({src:"",status:"",totalTime:0,currentTime:0,process:0,volume:100}),ce=s({list:M,index:-1,name:"",show:!1}),ue=s({al:"",lrc:[],active:0}),de=a("#ff4500"),pe=a(["#0add31","#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgba(255, 69, 0, 0.68)","rgb(255, 120, 0)","hsv(51, 100, 98)","hsva(120, 40, 94, 0.5)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#c7158577"]);let me=!1,ve=!1,fe=!1;const he=()=>{var e;null==(e=$.value)||e.play(),me=!0,ye(),oe.status="play",ve||(xe(),ve=!0,Ie())};let _e;const ye=()=>{clearInterval(_e),_e=setInterval(ge,300)},ge=()=>{var e,t;let a=(null==(e=$.value)?void 0:e.currentTime)||0,s=(null==(t=$.value)?void 0:t.duration)||0;oe.totalTime=s,oe.currentTime=a,oe.process=a/s*100,we(),s>0&&a==s&&Le(1)},we=()=>{if(!$.value)return;if("play"!==oe.status)return;let e=$.value.currentTime||0;const t=ue.lrc.findIndex((t=>t.tsp<=e&&e<=t.tsp+t.duration));t!=ue.active&&(ue.active=t)};let be,ke,Ee;const xe=()=>{const e=new(0,window.AudioContext);be=e.createAnalyser(),Ee=new Uint8Array(be.frequencyBinCount),e.createMediaElementSource($.value).connect(be),be.connect(e.destination)};let Ce;const Ie=()=>{let e;if(Ce=requestAnimationFrame(Ie),ve&&(e=be),fe&&(e=ke),!e)return;e.getByteFrequencyData(Ee);const t=Math.floor(2*Ee.length/3),a=new Array(2*t);for(let s=0;s<t;s++)a[s]=a[a.length-s-1]=Ee[s];Te(a,255,250)},Te=(e,t,a=100)=>{const s=re.value,n=s.width,i=s.height,l=s.getContext("2d");l.lineWidth=2,l.clearRect(0,0,n,i);const r=Math.min(n,i)/2,o=e.length,c=parseInt((.5*r).toString()),u=parseInt((.99*r-c).toString()),d=Math.min(a,o),p=Math.round(o/d);for(let m=0;m<d;m++){const a=e[m*p+p],s=parseInt((u*(a/t)).toString())||1;l.beginPath();const r=Math.round(360*m/d);l.strokeStyle=`hsla(${r}, 100%, 50%, 1)`,l.save(),l.translate(n/2,i/2),l.rotate(m*Math.PI*2/d-.5*Math.PI),l.moveTo(0,c),l.lineTo(0,c+s),l.closePath(),l.stroke(),l.restore()}},Ae=()=>{var e;me=!1,null==(e=$.value)||e.pause(),oe.status="paused",clearInterval(_e)},Le=(e=1)=>{let t=ce.index;t+=e;const a=ce.list.length;t>=a?t=0:t<0&&(t=a-1),je(t)},je=(e=0)=>{if(ce.index==e)return;ce.index=e;let t=ce.list[e];oe.src=`/audio/${t}`,t=t.replace(T,""),ce.name=t;const a=`/audio/${t}.lrc`;ue.active=-1,(new q).load(a,(e=>{Object.keys(e).forEach((t=>{ue[t]=e[t]}))}),void 0,(()=>{Object.keys(ue).forEach((e=>{ue[e]="lrc"==e?[]:"active"==e?0:""}))})),ve&&x((()=>{var e;null==(e=$.value)||e.play()}))},Pe=(e=0)=>{$.value.currentTime+=e,ge()},Oe=(e=.1)=>{let t=$.value.volume;t+=e,t>1?t=1:t<0&&(t=0),$.value.volume=t,oe.volume=100*t};let Re;const Se=()=>{if(navigator.mediaDevices){if(fe)return De(),void he();Ae(),navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{Re=e;const t=new(0,window.AudioContext),a=t.createAnalyser();ke=a,Ee=new Uint8Array(a.frequencyBinCount),t.createMediaStreamSource(Re).connect(a),a.connect(t.destination),fe=!0,Ie()}))}},De=()=>{Re&&(fe=!1,Re.getAudioTracks().forEach((e=>{e.stop()})))},Ve=()=>{const e="running"===(new AudioContext).state;me=e,e&&he()},Me=e=>{switch(e.keyCode){case 32:me?Ae():he();break;case 37:e.ctrlKey?Le(-1):Pe(-10);break;case 39:e.ctrlKey?Le(1):Pe(10)}},$e=()=>{const e=re.value,t=e.parentNode,a=t.offsetWidth,s=t.offsetHeight;e.width=a,e.height=s};return n((()=>{(()=>{je(1),x(Ve),$e();let e=new Array(256).fill(0);Te(e,255,190)})(),window.addEventListener("resize",$e),window.addEventListener("keydown",Me)})),i((()=>{clearInterval(_e),cancelAnimationFrame(Ce),window.removeEventListener("resize",$e),window.removeEventListener("keydown",Me)})),(e,t)=>{const a=L,s=C,n=j,i=P,x=O,T=R,A=S,M=D,q=V,me=I;return l(),r("div",N,[o("div",U,[o("audio",{src:c(oe).src,ref_key:"mysong",ref:$,controls:""},null,8,B),o("div",F,[u(s,{underline:!1,type:"info",onClick:t[0]||(t[0]=p((e=>Le(-1)),["stop"]))},{default:d((()=>[u(a)])),_:1}),u(s,{title:"快退",underline:!1,type:"info",onClick:t[1]||(t[1]=e=>Pe(-10))},{default:d((()=>[u(n)])),_:1}),u(s,{title:"播放",underline:!1,type:"info",onClick:he},{default:d((()=>[u(i)])),_:1}),u(s,{title:"暂停",underline:!1,type:"info",onClick:Ae},{default:d((()=>[u(x)])),_:1}),u(s,{title:"快进",underline:!1,type:"info",onClick:t[2]||(t[2]=e=>Pe(10))},{default:d((()=>[u(T)])),_:1}),u(s,{title:"下一首",underline:!1,type:"info",onClick:t[3]||(t[3]=e=>Le(1))},{default:d((()=>[u(A)])),_:1})]),o("div",H,[o("div",K,[o("div",W,m(c(ce).name),1),o("div",J,[o("span",G,m(c(z)(c(oe).currentTime)),1),Q,o("span",X,m(c(z)(c(oe).totalTime)),1)])]),o("div",Y,[o("div",{class:"bar",style:v({width:c(oe).process+"%"})},null,4)])]),o("div",Z,[o("div",{class:"min",title:"音量-",onClick:t[4]||(t[4]=e=>Oe(-.1))}),o("div",ee,[o("div",{class:"bar",style:v({width:c(oe).volume+"%"})},null,4)]),o("div",{class:"max",title:"音量+",onClick:t[5]||(t[5]=e=>Oe(.1))}),u(s,{title:"歌单",underline:!1,type:"info",onClick:t[6]||(t[6]=p((e=>c(ce).show=!c(ce).show),["stop"]))},{default:d((()=>[u(M)])),_:1}),u(s,{title:"麦克风",underline:!1,type:"info",onClick:p(Se,["stop"])},{default:d((()=>[u(q)])),_:1}),u(me,{title:"歌词颜色",modelValue:c(de),"onUpdate:modelValue":t[7]||(t[7]=e=>f(de)?de.value=e:null),"show-alpha":"",size:"small",style:{marginLeft:"4px"},predefine:c(pe)},null,8,["modelValue","predefine"])]),u(b,{name:"el-zoom-in-bottom"},{default:d((()=>[h(o("div",te,[(l(!0),r(y,null,g(c(ce).list,((e,t)=>(l(),r("div",{key:t,class:w(["item",{"is-active":t==c(ce).index}]),onClick:p((e=>je(t)),["stop"])},m(e),11,ae)))),128))],512),[[_,c(ce).show]])])),_:1})]),o("div",se,[o("div",ne,[o("div",{class:"move",style:v({top:`-${30*c(ue).active}px`,"--color":c(de)})},[o("div",ie,[(l(!0),r(y,null,g(c(ue).lrc,((e,t)=>(l(),r("div",{key:t,class:"item",style:v({"--time":e.duration+"s"})},[o("span",le,[k(m(e.lyric)+" ",1),t==c(ue).active?(l(),r("span",{key:t,class:"c",style:v({animationPlayState:"paused"==c(oe).status?"paused":""})},m(e.lyric),5)):E("",!0)])],4)))),128))])],4)]),o("canvas",{ref_key:"cvs",ref:re},null,512)])])}}}),[["__scopeId","data-v-5e476086"]]),oe=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"}));export{$ as _,oe as i};
