import{bO as t,bP as e,be as o,bQ as a,bR as n,bS as s,bT as i,bo as r,bc as l,bs as c,bU as p}from"./vendor-16889df9.js";import{D as m,d as x}from"./object-fb68a4c2.js";const d=(t,e,o=1)=>{const a=t.position,n=t.rotation,s=t.scale,i=e.position||{x:0,y:0,z:0},r=e.rotation||{x:0,y:0,z:0},l=e.scale||{x:1,y:1,z:1},c=Math.abs(r.x)<2?1:180,p=Math.abs(r.y)<2?1:180,m=Math.abs(r.z)<2?1:180;return{position:[a.x+i.x,a.y+i.y,a.z+i.z],rotation:[n.x+Math.PI/c*r.x,n.y+Math.PI/p*r.y,n.z+Math.PI/m*r.z],scale:[s.x*o*l.x,s.y*o*l.y,s.z*o*l.z]}},h=t=>{t.material instanceof Array?t.material=t.material.map((t=>t.clone())):t.material=t.material.clone()},u=t=>{let e=t.clone();return(t.isMesh||t.isSprite)&&h(t),e.traverse((t=>{t.isMesh&&h(t)})),e},y=(t,e=6776165,o,a)=>{const{type:n,name:s}=t;n.indexOf("Light"),m.mesh.receiveShadowName.some((t=>s.indexOf(t)>-1))?t.traverse((t=>{t.isMesh&&(t.receiveShadow=!0)})):o.some((t=>s.indexOf(t)>-1))?b(t,e):t.isMesh&&(a&&(t.material.envMap=a),t.castShadow=!0,t.receiveShadow=!0)},w=t=>{let e=[];return Array.isArray(t)?e=t:null!=t&&(e=[t]),e},b=(t,e)=>{t.traverse((t=>{t.isMesh&&(t.castShadow=!0,t.receiveShadow=!0,Array.isArray(t.material)?t.material.forEach((t=>{t.color.set(e)})):t.material.color.set(e))}))},z=(a,n,s=new o)=>(a.lookAt(s),a._lookAt_=s,new Promise((o=>{new t(a.position).to(n,1e3).easing(e.Quadratic.In).start().onUpdate((()=>{a.lookAt(s),a._lookAt_=s})).onComplete((()=>{o(a)}))}))),_=(o,a,n)=>new Promise((s=>{new t(n).to(a,1e3).easing(e.Quadratic.In).start().onUpdate((t=>{o.lookAt(t),o._lookAt_=t})).onComplete((()=>{s(o)}))})),f=(o,a,n,s)=>new Promise((i=>{new t(a.position).to(n,1e3).easing(e.Quadratic.In).start().onUpdate((()=>{const t=o.target;a.lookAt(t),a._lookAt_=t})),new t(o.target).to(s,1e3).easing(e.Quadratic.In).start().onComplete((()=>{i(a)}))})),g=(t,e,o=1,i=10)=>{let r=[0,i/2,i],l=[...e,e[0],e[1]+o,e[2],...e],c=new a("sprite.position",r,l),p=new n("sprite_up_down",i,[c]);const m=new s(t),x=m.clipAction(p);return x.timeScale=5,x.play(),t.__action__=x,t.__mixer__=m,t},A=(t,e,o)=>{let a=t.clientWidth/2,n=t.clientHeight/2,s=e.position.clone();const i=e.scale;s.y+=i.x/2;let r=s.project(o);return{left:r.x*a+a,top:-r.y*n+n}},S=(t,e,o="name")=>{let a=[];if(!t||!t.length)return[];return function t(n){n.forEach((n=>{const s=n[o];"string"==typeof s&&e.some((t=>s.indexOf(t)>-1))&&a.push(n),n.children&&t(n.children)}))}(t),a},v=m.statusOffset,M=(t,e,o={})=>{const a=e.type,n=v[t]||{},s=o[a]||n[a]||{};let i=x({x:0,y:0,z:0},s.position||{}),r=x({x:0,y:0,z:0},s.rotation||{});return r.x=Math.PI/180*r.x,r.y=Math.PI/180*r.y,r.z=Math.PI/180*r.z,{position:i,rotation:r}},I=(t,e,o=16777215,a)=>{const n=M("TEXT",t,a);let s=t.font||{},c=new i(t.name||"",{font:e,size:s.size||10,depth:0,curveSegments:12,bevelThickness:1,bevelSize:.1,bevelEnabled:!0});const p=n.rotation;c.rotateX(p.x),c.rotateY(p.y),c.rotateZ(p.z);const m=n.position;c.computeBoundingBox(),c.computeVertexNormals();let x=.5*(c.boundingBox.max.x-c.boundingBox.min.x),d=.5*(c.boundingBox.max.z-c.boundingBox.min.z),h=new r({color:null!=s.color?s.color:o,flatShading:!1}),u=new l(c,h);return u.castShadow=!0,u.position.set((m.x||0)-x,m.y||0,(m.z||0)-d),u.name="text",u._isText_=!0,u},k=(t,e,o,i,r=100,l=1)=>{if(!o)return;const m=M("WARNING",e,i);let x=new c,d=u(o);d.scale.set(l,l,l);const h=m.position;d.position.set(h.x,h.y,h.z);const y=m.rotation;d.rotation.set(y.x,y.y,y.z),x.add(d);let w=new p(12717056,8,r,0);w.name="灯光",w.position.y=h.y+30,x.add(w),x.name=t;let b=new s(x),z=new a("红色.material.color",[0,.25,.75],[1,0,0,1,1,0,1,0,0]),_=new a("灯光.color",[0,.25,.75],[1,0,0,1,1,0,1,0,0]),f=new a("警告标识.scale",[0,.5,1],[1,1,1,1.2,1.2,2,1,1,1]),g=new n("warning_",1,[z,_,f]),A=b.clipAction(g);return A.paused=!0,A.play(),x.visible=!1,x._isWarning_=!0,{group:x,action:A,mixer:b}},P=(t,e,o,a)=>{if(!e)return;const n=M(a?"DISABLED":"STATUS",t,o);let s=u(e);const i=n.position;s.position.set(i.x,i.y,i.z);const r=n.rotation;return s.rotation.set(r.x,r.y,r.z),s.visible=!1,s._isStatus_=!0,s};export{A as a,d as b,z as c,I as d,k as e,S as f,w as g,P as h,f as i,_ as j,g as k,M as l,u as m,y as r,b as s};
