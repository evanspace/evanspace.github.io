var e=Object.defineProperty,t=(t,i,a)=>(((t,i,a)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a})(t,"symbol"!=typeof i?i+"":i,a),a);import{bn as i,eY as a,dl as s,dH as o,d6 as r,d8 as n,bg as l,dG as c,eZ as p,bq as h,e_ as d,eO as u,eH as y,e$ as w,be as g,c_ as m,dm as v,bm as S,bk as f,eI as B,e as A,i as x,l as T,o as z,g as C,h as b}from"./vendor-01fc5bd0.js";import{w as M,E as V,u as P}from"./scene-resize-9435930a.js";import"./index-8ac7069f.js";const E=Object.freeze({CUBE:1,SPHERE:2}),D=["in vec3  uColor;","in float uOpacity;","in float uSize;","in float uAngle;","in float uVisible;","varying vec4  vColor;","varying float vAngle;","void main() {","  if ( uVisible > 0.5 )","    vColor = vec4( uColor, uOpacity );","  else","    vColor = vec4(0.0, 0.0, 0.0, 0.0);","  vAngle = uAngle;","  vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","  gl_PointSize = uSize * ( 300.0 / length( mvPosition.xyz ) );","  gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),U=["uniform sampler2D uTx;","varying vec4 vColor;","varying float vAngle;","void main() {","  gl_FragColor = vColor;","  float c = cos(vAngle);","  float s = sin(vAngle);","  vec2 rotatedUV = vec2(c * (gl_PointCoord.x - 0.5) + s * (gl_PointCoord.y - 0.5) + 0.5,","  c * (gl_PointCoord.y - 0.5) - s * (gl_PointCoord.x - 0.5) + 0.5);","  vec4 rotatedTexture = texture2D( uTx,  rotatedUV );","  gl_FragColor = gl_FragColor * rotatedTexture;","}"].join("\n");class k{constructor(e,i){t(this,"times"),t(this,"values"),this.times=e||[],this.values=i||[]}lerp(e){for(var t=0,a=this.times.length;t<a&&e>this.times[t];)t++;if(0==t)return this.values[0];if(t==a)return this.values[a-1];var s=(e-this.times[t-1])/(this.times[t]-this.times[t-1]);return this.values[0]instanceof i?this.values[t-1].clone().lerp(this.values[t],s):this.values[t-1]+s*(this.values[t]-this.values[t-1])}}class R extends p{constructor(e){super(),t(this,"color",new r(16777215)),t(this,"map",null),t(this,"size",1),t(this,"sizeAttenuation",!0),t(this,"vertexColors",!1),t(this,"fog",!0),this.setValues(e)}}class O extends c{constructor(e,i){super(),t(this,"geometry"),t(this,"material"),t(this,"sortParticles",!1),t(this,"frustumCulled",!1),this.geometry=void 0!==e?e:new s,this.material=void 0!==i?i:new R({color:16777215*Math.random()})}clone(e){return void 0===e&&(e=new O(this.geometry,this.material)),e.sortParticles=this.sortParticles,super.clone(e),e}}class G{constructor(){t(this,"position",new i),t(this,"velocity",new i),t(this,"acceleration",new i),t(this,"angle",0),t(this,"angleVelocity",0),t(this,"angleAcceleration",0),t(this,"size",16),t(this,"color",new r),t(this,"opacity",1),t(this,"age",0),t(this,"alive",0),t(this,"sizeTween",new k),t(this,"colorTween",new k),t(this,"opacityTween",new k)}update(e){if(this.position.add(this.velocity.clone().multiplyScalar(e)),this.velocity.add(this.acceleration.clone().multiplyScalar(e)),this.angle+=.01745329251*this.angleVelocity*e,this.angleVelocity+=.01745329251*this.angleAcceleration*e,this.age+=e,this.sizeTween.times.length>0&&(this.size=this.sizeTween.lerp(this.age)),this.colorTween.times.length>0){var t=this.colorTween.lerp(this.age);this.color=(new r).setHSL(t.x,t.y,t.z)}this.opacityTween.times.length>0&&(this.opacity=this.opacityTween.lerp(this.age))}}class _{constructor(){t(this,"positionStyle",E.CUBE),t(this,"positionBase",new i),t(this,"positionSpread",new i),t(this,"positionRadius",0),t(this,"velocityStyle",E.CUBE),t(this,"velocityBase",new i),t(this,"velocitySpread",new i),t(this,"speedBase",0),t(this,"speedSpread",0),t(this,"accelerationBase",new i),t(this,"accelerationSpread",new i),t(this,"angleBase",0),t(this,"angleSpread",0),t(this,"angleVelocityBase",0),t(this,"angleVelocitySpread",0),t(this,"angleAccelerationBase",0),t(this,"angleAccelerationSpread",0),t(this,"sizeBase",0),t(this,"sizeSpread",0),t(this,"sizeTween",new k),t(this,"colorBase",new i(0,1,.5)),t(this,"colorSpread",new i(0,0,0)),t(this,"colorTween",new k),t(this,"opacityBase",1),t(this,"opacitySpread",0),t(this,"opacityTween",new k),t(this,"blendStyle",a),t(this,"particleArray",[]),t(this,"particlesPerSecond",100),t(this,"particleDeathAge",1),t(this,"emitterAge",0),t(this,"emitterAlive",!0),t(this,"emitterDeathAge",60),t(this,"particleCount",0),t(this,"particleGeometry",new s),t(this,"particleTexture",null),t(this,"particleMaterial",new o({uniforms:{uTx:{value:this.particleTexture},uVisible:{value:[]},uAngle:{value:[]},uSize:{value:[]},uColor:{value:[]},uOpacity:{value:[]}},vertexShader:D,fragmentShader:U,transparent:!0,alphaTest:.5,blending:a,depthTest:!0})),t(this,"particleMesh",new O),this.particleCount=this.particlesPerSecond*Math.min(this.particleDeathAge,this.emitterDeathAge)}randomValue(e,t){return e+t*(Math.random()-.5)}randomVector3(e,t){var a=new i(Math.random()-.5,Math.random()-.5,Math.random()-.5);return(new i).addVectors(e,(new i).multiplyVectors(t,a))}createParticle(){var e=new G;if(this.positionStyle==E.CUBE)e.position=this.randomVector3(this.positionBase,this.positionSpread);else if(this.positionStyle==E.SPHERE){var t=2*Math.random()-1,a=6.2832*Math.random(),s=Math.sqrt(1-t*t),o=new i(s*Math.cos(a),s*Math.sin(a),t);e.position=(new i).addVectors(this.positionBase,o.multiplyScalar(this.positionRadius))}if(this.velocityStyle==E.CUBE)e.velocity=this.randomVector3(this.velocityBase,this.velocitySpread);else if(this.velocityStyle==E.SPHERE){var n=(new i).subVectors(e.position,this.positionBase),l=this.randomValue(this.speedBase,this.speedSpread);e.velocity=n.normalize().multiplyScalar(l)}e.acceleration=this.randomVector3(this.accelerationBase,this.accelerationSpread),e.angle=this.randomValue(this.angleBase,this.angleSpread),e.angleVelocity=this.randomValue(this.angleVelocityBase,this.angleVelocitySpread),e.angleAcceleration=this.randomValue(this.angleAccelerationBase,this.angleAccelerationSpread),e.size=this.randomValue(this.sizeBase,this.sizeSpread);var c=this.randomVector3(this.colorBase,this.colorSpread);return e.color=(new r).setHSL(c.x,c.y,c.z),e.opacity=this.randomValue(this.opacityBase,this.opacitySpread),e.age=0,e.alive=0,e}setValues(e){if(console.log("%cconfig","color: red",e),void 0!==e){this.sizeTween=new k,this.colorTween=new k,this.opacityTween=new k;for(let t in e)this[t]=e[t];G.prototype.sizeTween=this.sizeTween,G.prototype.colorTween=this.colorTween,G.prototype.opacityTween=this.opacityTween,this.particleArray=[],this.emitterAge=0,this.emitterAlive=!0,this.particleCount=this.particlesPerSecond*Math.min(this.particleDeathAge,this.emitterDeathAge),this.particleGeometry=new s,this.particleMaterial=new o({uniforms:{uTx:{value:this.particleTexture},uVisible:{value:[]},uAngle:{value:[]},uSize:{value:[]},uColor:{value:[]},uOpacity:{value:[]}},vertexShader:D,fragmentShader:U,transparent:!0,alphaTest:.5,blending:a,depthTest:!0})}}initialize(){const e=[],t=[],i=[],s=[],o=[],r=[];for(var c=0;c<this.particleCount;c++){const a=this.createParticle();this.particleArray[c]=a,t.push(a.alive);const n=a.color;i.push(n.r,n.g,n.b),s.push(a.opacity),o.push(a.size),r.push(a.angle),e.push(a.position);const l=this.particleMaterial.uniforms;l&&(l.uVisible.value[c]=a.alive,l.uColor.value[c]=a.color,l.uOpacity.value[c]=a.opacity,l.uSize.value[c]=a.size,l.uAngle.value[c]=a.angle)}this.particleGeometry.setFromPoints(e),this.particleGeometry.setAttribute("uVisible",new n(t,1)),this.particleGeometry.setAttribute("uColor",new n(i,3)),this.particleGeometry.setAttribute("uOpacity",new n(s,1)),this.particleGeometry.setAttribute("uSize",new n(o,1)),this.particleGeometry.setAttribute("uAngle",new n(r,1)),this.particleMaterial.blending=this.blendStyle,this.blendStyle!=a&&(this.particleMaterial.depthTest=!1),this.particleMesh=new l(this.particleGeometry,this.particleMaterial),this.particleMesh.dynamic=!0,this.particleMesh.sortParticles=!0}update(e){const t=[];if(!this.particleArray.length)return;const i=this.particleGeometry.attributes.uVisible,a=this.particleGeometry.attributes.uOpacity,s=this.particleGeometry.attributes.uSize,o=this.particleGeometry.attributes.uAngle,r=this.particleGeometry.attributes.uColor;for(let n=0;n<this.particleCount;n++){const l=this.particleArray[n];if(l.alive){l.update(e),l.age>this.particleDeathAge&&(l.alive=0,t.push(n)),i.setX(n,l.alive),i.needsUpdate=!0,a.setX(n,l.opacity),a.needsUpdate=!0,s.setX(n,l.size),s.needsUpdate=!0,o.setX(n,l.angle),o.needsUpdate=!0;const c=l.color;r.setXYZ(n,c.r,c.g,c.b),r.needsUpdate=!0;const p=this.particleMaterial.uniforms;p&&(p.uVisible.value[n]=l.alive,p.uColor.value[n]=l.color,p.uOpacity.value[n]=l.opacity,p.uSize.value[n]=l.size,p.uAngle.value[n]=l.angle)}}if(this.emitterAlive){if(this.emitterAge<this.particleDeathAge){const t=Math.round(this.particlesPerSecond*(this.emitterAge+0));let i=Math.round(this.particlesPerSecond*(this.emitterAge+e));i>this.particleCount&&(i=this.particleCount);for(let e=t;e<i;e++)this.particleArray[e].alive=1}for(let e=0;e<t.length;e++){const i=t[e],a=this.createParticle();a.alive=1,this.particleArray[i]=a;const s=this.particleGeometry.attributes.position,{x:o,y:r,z:n}=a.position;s.setXYZ(i,o,r,n),s.needsUpdate=!0}this.emitterAge+=e,this.emitterAge>this.emitterDeathAge&&(this.emitterAlive=!1)}}destroy(e){e.remove(this.particleMesh)}}const j=new h,H={fountain:{positionStyle:E.CUBE,positionBase:new i(0,5,0),positionSpread:new i(10,0,10),velocityStyle:E.CUBE,velocityBase:new i(0,160,0),velocitySpread:new i(100,20,100),accelerationBase:new i(0,-100,0),particleTexture:j.load("/oss/textures/effect/star.png"),angleBase:0,angleSpread:180,angleVelocityBase:0,angleVelocitySpread:1440,sizeTween:new k([0,1],[1,20]),opacityTween:new k([2,3],[1,0]),colorTween:new k([.5,2],[new i(0,1,.5),new i(.8,1,.5)]),particlesPerSecond:200,particleDeathAge:3,emitterDeathAge:60},fireball:{positionStyle:E.SPHERE,positionBase:new i(0,50,0),positionRadius:2,velocityStyle:E.SPHERE,speedBase:40,speedSpread:8,particleTexture:j.load("/oss/textures/effect/smokeparticle.png"),sizeTween:new k([0,.1],[1,150]),opacityTween:new k([.7,1],[1,0]),colorBase:new i(.02,1,.4),blendStyle:d,particlesPerSecond:60,particleDeathAge:1.5,emitterDeathAge:60},smoke:{positionStyle:E.CUBE,positionBase:new i(0,0,0),positionSpread:new i(10,0,10),velocityStyle:E.CUBE,velocityBase:new i(0,150,0),velocitySpread:new i(80,50,80),accelerationBase:new i(0,-10,0),particleTexture:j.load("/oss/textures/effect/smokeparticle.png"),angleBase:0,angleSpread:720,angleVelocityBase:0,angleVelocitySpread:720,sizeTween:new k([0,1],[32,128]),opacityTween:new k([.8,2],[.5,0]),colorTween:new k([.4,1],[new i(0,0,.2),new i(0,0,.5)]),particlesPerSecond:200,particleDeathAge:2,emitterDeathAge:60},clouds:{positionStyle:E.CUBE,positionBase:new i(-100,100,0),positionSpread:new i(0,50,60),velocityStyle:E.CUBE,velocityBase:new i(40,0,0),velocitySpread:new i(20,0,0),particleTexture:j.load("/oss/textures/effect/smokeparticle.png"),sizeBase:80,sizeSpread:100,colorBase:new i(0,0,1),opacityTween:new k([0,1,4,5],[0,1,1,0]),particlesPerSecond:50,particleDeathAge:10,emitterDeathAge:60},snow:{positionStyle:E.CUBE,positionBase:new i(0,200,0),positionSpread:new i(500,0,500),velocityStyle:E.CUBE,velocityBase:new i(0,-60,0),velocitySpread:new i(50,20,50),accelerationBase:new i(0,-10,0),angleBase:0,angleSpread:720,angleVelocityBase:0,angleVelocitySpread:60,particleTexture:j.load("/oss/textures/effect/snowflake.png"),sizeTween:new k([0,.25],[1,10]),colorBase:new i(.66,1,.9),opacityTween:new k([2,3],[.8,0]),particlesPerSecond:200,particleDeathAge:4,emitterDeathAge:60},rain:{positionStyle:E.CUBE,positionBase:new i(0,200,0),positionSpread:new i(600,0,600),velocityStyle:E.CUBE,velocityBase:new i(0,-400,0),velocitySpread:new i(10,50,10),accelerationBase:new i(0,-10,0),particleTexture:j.load("/oss/textures/effect/raindrop2flip.png"),sizeBase:8,sizeSpread:4,colorBase:new i(.66,1,.7),colorSpread:new i(0,0,.2),opacityBase:.6,particlesPerSecond:1e3,particleDeathAge:1,emitterDeathAge:60},starfield:{positionStyle:E.CUBE,positionBase:new i(0,200,0),positionSpread:new i(600,400,600),velocityStyle:E.CUBE,velocityBase:new i(0,0,0),velocitySpread:new i(.5,.5,.5),angleBase:0,angleSpread:720,angleVelocityBase:0,angleVelocitySpread:4,particleTexture:j.load("/oss/textures/effect/spikey.png"),sizeBase:10,sizeSpread:2,colorBase:new i(.15,1,.9),colorSpread:new i(0,0,.2),opacityBase:1,particlesPerSecond:2e4,particleDeathAge:60,emitterDeathAge:.1},fireflies:{positionStyle:E.CUBE,positionBase:new i(0,100,0),positionSpread:new i(400,200,400),velocityStyle:E.CUBE,velocityBase:new i(0,0,0),velocitySpread:new i(60,20,60),particleTexture:j.load("/oss/textures/effect/spark.png"),sizeBase:30,sizeSpread:2,opacityTween:new k([0,1,1.1,2,2.1,3,3.1,4,4.1,5,5.1,6,6.1],[.2,.2,1,1,.2,.2,1,1,.2,.2,1,1,.2]),colorBase:new i(.3,1,.6),colorSpread:new i(.3,0,0),particlesPerSecond:20,particleDeathAge:6.1,emitterDeathAge:600},startunnel:{positionStyle:E.CUBE,positionBase:new i(0,0,0),positionSpread:new i(10,10,10),velocityStyle:E.CUBE,velocityBase:new i(0,100,200),velocitySpread:new i(40,40,80),angleBase:0,angleSpread:720,angleVelocityBase:10,angleVelocitySpread:0,particleTexture:j.load("/oss/textures/effect/spikey.png"),sizeBase:4,sizeSpread:2,colorBase:new i(.15,1,.8),opacityBase:1,blendStyle:d,particlesPerSecond:500,particleDeathAge:4,emitterDeathAge:60},firework:{positionStyle:E.SPHERE,positionBase:new i(0,100,0),positionRadius:10,velocityStyle:E.SPHERE,speedBase:90,speedSpread:10,accelerationBase:new i(0,-80,0),particleTexture:j.load("/oss/textures/effect/spark.png"),sizeTween:new k([.5,.7,1.3],[5,40,1]),opacityTween:new k([.2,.7,2.5],[.75,1,0]),colorTween:new k([.4,.8,1],[new i(0,1,1),new i(0,1,.6),new i(.8,1,.6)]),blendStyle:d,particlesPerSecond:3e3,particleDeathAge:2.5,emitterDeathAge:.2},candle:{positionStyle:E.SPHERE,positionBase:new i(0,50,0),positionRadius:2,velocityStyle:E.CUBE,velocityBase:new i(0,100,0),velocitySpread:new i(20,0,20),particleTexture:j.load("/oss/textures/effect/smokeparticle.png"),sizeTween:new k([0,.3,1.2],[20,150,1]),opacityTween:new k([.9,1.5],[1,0]),colorTween:new k([.5,1],[new i(.02,1,.5),new i(.05,1,0)]),blendStyle:d,particlesPerSecond:60,particleDeathAge:1.5,emitterDeathAge:60}},N=B,X=new h,{createParticleSmoke:F}=M.useSmoke(u),L=N.uniform(.2);class Y extends V{constructor(e){super(e),t(this,"engine"),this.addModel()}render(){this.renderer.renderAsync(this.scene,this.camera)}createRender(){return new y(this.options.render)}addModel(){const e=N.range(.1,1),t=N.range(new i(-4,15,0),new i(4,15,0)),a=N.time.add(5).mul(L),s=a.mul(e).mod(1),o=N.range(.3,2),r=N.range(.1,4),n=s.div(e),c=N.positionLocal.y.oneMinus().max(.9),p=N.texture(X.load("/oss/textures/effect/smokeparticle.png"),N.rotateUV(N.uv(),a.mul(r))).a.mul(n.oneMinus()),h=new w;h.colorNode=N.mix(N.color(16777215),N.color(15732480),n.mul(.5).min(.5)).mul(c),h.opacityNode=p,h.positionNode=t.mul(s),h.scaleNode=o.mul(s.max(.3)),h.depthWrite=!1,h.transparent=!0;const d=new l(new g(1,1),h);d.scale.setScalar(40),d.count=600,d.position.y=10,this.addObject(d);const u=this.createParticleSmoke({size:40,count:1e3,speed:N.uniform(.2),offsetRangeMin:[-5,15,0],offsetRangeMax:[5,15,0],scaleMin:.1,scaleMax:1.5,rotateMax:2*Math.PI,mixColor:[15732480,16777215],mixColorStart:.1,mixColorMinOpacity:.1,textureSrc:"/oss/textures/effect/snowflake.png"});u.position.set(-100,0,100);const y=F({size:50});y.position.set(100,0,100),this.addObject(u,y)}createParticleSmoke(e={}){let{size:t=1,count:a=500,speed:s=.2,lifeRangeMin:o=0,lifeRangeMax:r=1,offsetRangeMin:n=new i(-10,15,-10),offsetRangeMax:c=new i(10,20,10),scaleMin:p=.3,scaleMax:h=2,rotateMin:d=.1,rotateMax:u=4,mixColor:y=[16777215,16777215],mixColorStart:m=.5,mixColorMinOpacity:v=.1,textureSrc:S,startScale:f=.3}=e;if(n instanceof i){const{x:e,y:t,z:i}=n;n=[e,t,i]}if(c instanceof i){const{x:e,y:t,z:i}=c;c=[e,t,i]}Array.isArray(y)||(y=[y]);const B=N.range(o,r),A=N.range(new i(...n),new i(...c)),x=N.time.add(5).mul(s),T=x.mul(B).mod(1),z=N.range(p,h),C=N.range(d,u),b=T.div(B),M=N.positionLocal.y.oneMinus().max(.9),V=X.load(S||"/oss/textures/effect/snowflake.png"),P=N.texture(V,N.rotateUV(N.uv(),x.mul(C))).a.mul(b.oneMinus()),E=new w;E.colorNode=N.mix(N.color(y[0]),N.color(y[1]||y[0]),b.mul(m).min(v)).mul(M),E.opacityNode=P,E.positionNode=A.mul(T),E.scaleNode=z.mul(T.max(f)),E.depthWrite=!1,E.transparent=!0;const D=new l(new g(1,1),E);return D.scale.setScalar(t),D.count=a,D.position.y=t/4,D}addModel_(){const e=new _;e.setValues(H.rain),e.initialize(),this.engine=e,console.log(e),this.addObject(e.particleMesh);const t=new m(10,10,10);let i=new Array(8).fill(0).map((()=>[1,0,0,0,1,0,0,0,1])).flat(),a=new v(new Float32Array(i),3);t.setAttribute("color",a);const s=new l(t,new S({vertexColors:!0,side:f,wireframe:!1}));s.position.x=50,this.addObject(s)}modelAnimate(){var e;const t=null==(e=this.clock)?void 0:e.getDelta();this.engine&&this.engine.update(.5*t)}}const Z={class:"three-page"},q=A({__name:"index",setup(e){const t=x(),i={axes:{visible:!0},grid:{visible:!0},render:{logarithmicDepthBuffer:!1}};let a;return T((()=>{i.container=t.value,a=new Y(i),a.run(),P(a).resize()})),(e,i)=>(z(),C("div",Z,[b("div",{class:"h-100",ref_key:"containerRef",ref:t},null,512)]))}});export{q as default};
