var e=Object.defineProperty,s=(s,t,o)=>(((s,t,o)=>{t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o})(s,"symbol"!=typeof t?t+"":t,o),o);import{t}from"./index-9841f34b.js";import{p as o,D as n,u as a,n as r}from"./scene-resize-83c18528.js";import{bq as i,bc as d,dX as l,eE as c,dW as m,dY as u,dU as p,bn as w,eM as h,bg as g,be as b,eL as f,br as x,eG as S,bk as y,bm as v,d8 as N,eF as k,e as M,Y as j,i as z,l as I,o as L,g as O,h as P,q as _,u as R}from"./vendor-08e99294.js";import"./index-a5d3af4f.js";const{createStripSmoke:A}=o.useSmoke(),D=k,{mix:U,mul:V,oneMinus:W,positionLocal:C,smoothstep:E,texture:G,time:T,rotateUV:Y,Fn:q,uv:F,vec2:B,vec3:X,vec4:H,uniform:J}=D,K=new i,Q=J(.2);class Z extends n{constructor(e){super(e),s(this,"gui"),s(this,"smokeInstancedSprite"),s(this,"fireInstancedSprite"),this.addModel(),this.gui=new d,this.addGui()}render(){this.renderer.renderAsync(this.scene,this.camera)}createScene(){return new l}createRender(){return new c}createDirectionalLight(e,s){return new m(e,s)}createAmbientLight(e,s){return new u(e,s)}createPerspectiveCamera(e,s,t,o){return new p(e,s,t,o)}addModel(){this.addSmoke(),this.addSmallSmoke()}addSmoke(){const e=D.range(.1,1),s=D.range(new w(-2,3,-2),new w(2,5,2)),t=D.time.add(5).mul(Q),o=t.mul(e).mod(1),n=D.range(.3,2),a=D.range(.1,4),r=o.div(e),i=D.positionLocal.y.oneMinus().max(.2),d=D.texture(K.load("/oss/textures/effect/smoke1.png"),D.rotateUV(D.uv(),t.mul(a))).a.mul(r.oneMinus()),l=D.mix(D.color(16777215),D.color(2236962),D.positionLocal.y.mul(.5).clamp()),c=new h;c.colorNode=D.mix(D.color(15891724),l,r.mul(2.5).min(1)).mul(i),c.opacityNode=d,c.positionNode=s.mul(o),c.scaleNode=n.mul(o.max(.3)),c.depthWrite=!1,c.transparent=!0;const m=new g(new b(1,1),c);m.scale.setScalar(40),m.count=2e3,m.position.y=10,m.castShadow=!0,this.smokeInstancedSprite=m,this.addObject(m);const u=new b(1,1),p=new h;p.colorNode=D.mix(D.color(12005143),D.color(12005143),r),p.positionNode=D.range(new w(-1,1,-1),new w(1,2,1)).mul(o),p.scaleNode=c.scaleNode,p.opacityNode=d.mul(.5),p.blending=f,p.transparent=!0,p.depthWrite=!1;const x=new g(u,p);x.scale.setScalar(40),x.count=1e3,x.position.y=10,x.castShadow=!0,this.fireInstancedSprite=x,this.addObject(x)}addSmallSmoke(){const e=new b(1,1,16,64);e.translate(0,.5,0),e.scale(15,60,15);const s=K.load("/oss/textures/gpu/128x128.png");s.wrapS=x,s.wrapT=x;const t=new S({transparent:!0,side:y,depthWrite:!1});t.positionNode=q((()=>{const e=B(.6,F().y.mul(.3).sub(T.mul(Q)).mod(1)),t=G(s,e).r.mul(5);C.xz.assign(Y(C.xz,t,B(1)));const o=B(G(s,B(.25,T.mul(.01)).mod(1)).r.sub(.5),G(s,B(.75,T.mul(.01)).mod(1)).r.sub(0)).mul(F().y.pow(2).mul(80));return C.addAssign(o),C}))(),t.colorNode=q((()=>{const e=F().mul(B(.8,.3)).add(B(0,T.mul(.03).negate())),t=V(G(s,e).r.smoothstep(.4,1),E(0,.1,F().x),E(0,.1,W(F().x)),E(0,.1,F().y),E(0,.1,W(F().y))),o=U(X(.6,.3,.2),X(1,1,1),t.pow(3));return H(o,t)}))();const o=new g(e,t);o.position.x=-80,o.position.y=30,this.addObject(o);const n=A({width:100,height:50,twistNums:1,twistRange:.1,offset:.1,segment:10});n.position.set(-100,0,200),this.addObject(n),console.log(n);const a=new g(new b(100,50),new v({color:15732480,wireframe:!0}));a.position.copy(n.position.clone().add(new w(0,25,0))),this.addObject(a)}createSmoke(e={}){const{width:s=10,height:t=10,speed:o=.2,color:n=16777215,alphaPow:a=3,twistNums:r=5,twistRange:i=0,RLSpeed:d=.1,TDSpeed:l=.1,offset:c=50,segment:m=10,power:u=.03}=e,p=new b(1,1,s*m,t*m);p.scale(s,t,1),p.rotateY(.5*Math.PI/3*r),p.translate(0,t/2,0);const w=new S({transparent:!0,side:y,depthWrite:!1}),h=K.load("/oss/textures/gpu/128x128.png");h.wrapS=x,h.wrapT=x,w.positionNode=q((()=>{const e=B(.8,F().y.mul(.3).sub(T.mul(o))),s=G(h,e).r.mul(r);C.xz.assign(Y(C.xz,s,B(i)));const t=B(G(h,B(.25,T.mul(d)).mod(1)).r.sub(.5),G(h,B(.75,T.mul(l)).mod(1)).r.sub(0)).mul(F().y.pow(1).mul(c));return C.addAssign(t),C}))(),w.colorNode=q((()=>{const e=F().mul(B(.8,.3)).add(B(0,T.mul(u).negate())),s=V(G(h,e).r.smoothstep(.4,1),E(0,.1,F().x),E(0,.1,W(F().x)),E(0,.1,F().y),E(0,.1,W(F().y))),t=new N(n),o=U(X(t.r,t.g,t.b),X(1,1,1),s.pow(a));return H(o,s)}))();return new g(p,w)}addGui(){var e;const s=this.gui;s.add(Q,"value",.01,1,.01).name("烟雾速度"),this.fireInstancedSprite&&s.add(this.fireInstancedSprite,"count",200,2e3).name("烟雾浓度").onChange((e=>{this.smokeInstancedSprite.count=2*e})),s.domElement.className+=" gui-wrap",null==(e=this.container.parentNode)||e.appendChild(s.domElement)}}const $={class:"three-page"},ee=M({__name:"index",setup(e){const s=j({base:"",models:[{key:"coffeeMug",name:"咖啡杯",size:.5,url:"/oss/model/gpu/coffeeMug.glb"}],objects:[{type:"coffeeMug",name:"咖啡杯",position:{x:-80,y:25,z:0},scale:{x:10,y:10,z:10}}]}),{progress:n,loadModels:i,getModel:d,initModels:l}=o.useModelLoader({baseUrl:s.base}),c=z(),m={grid:{visible:!0},axes:{visible:!0},render:{logarithmicDepthBuffer:!1}};let u;return I((()=>{m.container=c.value,u=new Z(m),u.run(),a(u).resize(),i(s.models,(()=>{n.percentage=100,n.show=!1,l(s.objects,(e=>{const{type:s}=e,t=d(s);if(!t)return Promise.resolve();let o=r.modelDeepClone(t);const{position:n,scale:a,rotation:i}=r.get_P_S_R_param(o,e),[l,c,m]=n;return o.scale.set(...a),o.position.set(l,c,m),o.rotation.set(...i),u.addObject(o),Promise.resolve()}))}))})),(e,s)=>(L(),O("div",$,[P("div",{class:"h-100",ref_key:"containerRef",ref:c},null,512),_(t,{modelValue:R(n).show,"onUpdate:modelValue":s[0]||(s[0]=e=>R(n).show=e),progress:R(n).percentage},null,8,["modelValue","progress"])]))}});export{ee as default};
//# sourceMappingURL=index-7e7c8eaf.js.map
