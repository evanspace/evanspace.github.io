var e=Object.defineProperty,t=(t,i,n)=>(((t,i,n)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n})(t,"symbol"!=typeof i?i+"":i,n),n);import{bb as i,bd as n,aW as s,cj as o,bh as r,bf as a,bg as h,b2 as c,aY as l,aZ as d,a_ as p,be as m,bm as b,bn as g,a$ as w,by as f,bc as u,w as v,af as y}from"./vendor-d1722f69.js";import{u as j}from"./common-459c279c.js";const L=e=>((e,t)=>Object.prototype.toString.call(t)===`[object ${e}]`)("Object",e),E=(e,t=new Map)=>{if(null!=e&&L(e)){let i=t.get(e);if(i)return i;const n=Array.isArray(e);let s=n?[]:{};return i=t.set(e,s),n?e.forEach(((e,t)=>{s[t]=E(e,i)})):Object.keys(e).forEach((t=>{L(s[t])?s[t]=E(e[t],i):s[t]=e[t]})),s}return e},x=(e,t)=>{e=E(e);for(let i in t)i in e&&L(t[i])&&L(e[i])?e[i]=x(e[i],t[i]):e[i]=t[i];return e},C=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,O={container:document.body,width:window.innerWidth,height:window.innerHeight,bgColor:null,bgUrl:null,env:null,scale:1,fog:{visible:!1,near:100,far:1e3},render:{antialias:!0,logarithmicDepthBuffer:!0,preserveDrawingBuffer:!1},controls:{visible:!0,enableDamping:!1,dampingFactor:.25,autoRotate:!1,enableZoom:!0,enablePan:!0,screenSpacePanning:!0,minDistance:1,maxDistance:2e3},lightHelperVisible:!1,ambientLight:{visible:!0,color:16777215,intensity:1.5},directionalLight:{visible:!0,light2:!0,color:16777215,intensity:1.5},camera:{near:1,far:1e4,position:[-350,510,700]},grid:{visible:!1,opacity:.3,transparent:!0,width:800,divisions:80,centerLineColor:10592673,gridColor:10592673},axes:{visible:!1,size:50}},k=class e{constructor(n={}){t(this,"options"),t(this,"container"),t(this,"scene"),t(this,"renderer"),t(this,"camera"),t(this,"controls"),t(this,"grid"),t(this,"animationId"),t(this,"pointer"),t(this,"clear",(e=>{e&&e.traverse&&(e.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),null==e||e.clear()})),null==e||e.clear())})),t(this,"disposeObj",(e=>{e&&e.traverse&&(e.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),null==e||e.clear()})),null==e||e.clear(),this.scene.remove(e))}));const s=O;var o;this.options=x(s,n),e.total++,this.pointer={tsp:0,isClick:!1},(o=this.options.container)&&("object"==typeof HTMLElement?o instanceof HTMLElement:o&&"object"==typeof o&&1===o.nodeType&&"string"==typeof o.nodeName)?this.container=this.options.container:this.container=document.querySelector(this.options.container),this.options.width=this.container.offsetWidth,this.options.height=this.container.offsetHeight,this.scene=new i,this.renderer=this.initRenderer(),this.init(),this.camera=this.initCamera(),this.controls=this.initControls()}init(){this.initLight(),this.initGrid(),this.initAxes(),this.initModel()}run(){this.loop()}loop(){this.animationId=window.requestAnimationFrame((()=>{this.loop()})),this.animate(),this.modelAnimate()}animate(){this.renderer&&this.renderer.render(this.scene,this.camera),this.options.controls.visible&&this.controls.update(),n()}initModel(){}modelAnimate(){}initRenderer(){const{width:e,height:t,bgColor:i,bgUrl:n,env:a}=this.options,h=new s(this.options.render);if(a&&this.setEnvironment(a),n?this.setBgTexture(n):this.setBgColor(i),this.options.fog.visible){const{color:e,near:t,far:i}=this.options.fog;this.scene.fog=new o(e??this.scene.background,t,i)}return h.sortObjects=!0,h.shadowMap.enabled=!0,h.shadowMap.type=r,h.setSize(e,t),h.setPixelRatio(window.devicePixelRatio),this.container.appendChild(h.domElement),h}initLight(){const{ambientLight:e,directionalLight:t,lightHelperVisible:i}=this.options;if(e.visible){const t=new a(e.color,e.intensity);this.addObject(t)}if(t.visible){const e=this.createDirectionalLight();if(this.addObject(e),i){const t=new h(e,1);this.addObject(t)}if(t.light2){const e=this.createDirectionalLight(!1);if(e.position.set(-500,800,-800),this.addObject(e),i){const t=new h(e,1);this.addObject(t)}}}}createDirectionalLight(e=!0,t=800,i=4096,n=1,s=2e3){const{color:o,intensity:r}=this.options.directionalLight,a=new c(o,r);if(a.position.set(500,800,800),e){a.shadow.mapSize.setScalar(i),a.shadow.bias=-1e-5,a.shadow.normalBias=.01,a.castShadow=e;const o=a.shadow.camera;o.radius=10,o.near=n,o.far=s,o.top=o.right=t,o.left=o.bottom=-t,o.updateProjectionMatrix()}return a}initCamera(){const{width:e,height:t,camera:i}=this.options,n=new l(36,e/t,i.near,i.far);return n.position.set(...i.position),this.addObject(n),n}initControls(){const e=this.options.controls;if(!e.visible)return;const t=new d(this.camera,this.renderer.domElement);return Object.keys(e).forEach((i=>{t[i]=e[i]})),t.target.set(0,0,0),t}initGrid(){const e=this.options.grid;if(!e.visible)return;const{width:t,divisions:i,centerLineColor:n,gridColor:s,opacity:o,transparent:r}=e,a=new p(t,i,n,s);a.material.opacity=o,a.material.transparent=r,this.grid=a,this.addObject(a)}initAxes(){if(!this.options.axes.visible)return;const e=new m(this.options.axes.size);this.addObject(e)}setEnvironment(e){(new b).load(e,(e=>{e.mapping=g,this.scene.environment=e}))}setBgTexture(e){if(Array.isArray(e)){const t=(new w).load(e);this.scene.background=t}else this.scene.background=(new f).load(e)}setBgColor(e){this.scene.background=e?new u(e):null}bindEvent(){const e=this.renderer.domElement;e.addEventListener("dblclick",this.onDblclick.bind(this)),e.addEventListener("pointerdown",this.onPointerDown.bind(this)),e.addEventListener("pointermove",this.onPointerMove.bind(this)),e.addEventListener("pointerup",this.onPointerUp.bind(this))}onDblclick(e){}onPointerDown(e){this.pointer.isClick=!0,this.pointer.tsp=e.timeStamp}onPointerMove(e){}onPointerUp(e){this.pointer.isClick=!1}exportImage(){const e=document.createElement("a");e.download="render.png",e.href=this.renderer.domElement.toDataURL().replace("image/png","image/octet-stream"),e.click()}addObject(...e){this.scene.add(...e)}resize(){if(!this.camera)return;this.options.width=this.container.offsetWidth||window.innerWidth,this.options.height=this.container.offsetHeight||window.innerHeight;const{width:e,height:t}=this.options,i=e/t;this.camera.aspect=i,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}stopAnimate(){window.cancelAnimationFrame(this.animationId)}dispose(){try{this.scene.clear(),this.renderer.dispose(),this.renderer.forceContextLoss(),this.renderer.content=null;let e=this.renderer.domElement.getContext("webgl");e&&e.getExtension("WEBGL_lose_context").loseContext()}catch(e){}}};t(k,"total",0);let D=k;const M=e=>({resize:()=>{const t=()=>null==e?void 0:e.resize();v((()=>j().sidebar.opened),(()=>{setTimeout(t,300)})),window.addEventListener("resize",t,!1),y((()=>{null==e||e.stopAnimate(),null==e||e.dispose(),window.removeEventListener("resize",t)}))}});export{D as T,x as d,C as r,M as u};
