{"version":3,"file":"index-a7444848.js","sources":["../../../code/src/pages/webgl/effect/cssd2/methods.ts","../../../code/src/pages/webgl/effect/cssd2/index.vue"],"sourcesContent":["import * as THREE from 'three'\nimport * as ThreeScene from 'three-scene'\nimport { GUI } from 'dat.gui'\nimport { CSS2DObject } from 'three/examples/jsm/renderers/CSS2DRenderer.js'\n\nconst base = import.meta.env.VITE_BEFORE_STATIC_PATH\nconst textureLoader = new THREE.TextureLoader()\n\nconst Hooks = ThreeScene.Hooks\nconst { backgroundLoad } = Hooks.useBackground()\nconst { initCSS2DRender, createCSS2DDom } = Hooks.useCSS2D()\n\n// 创建地球\nconst EARTH_RADIUS = 50\nconst createEarth = () => {\n  const earthGeometry = new THREE.SphereGeometry(EARTH_RADIUS, 160, 160)\n  const earthMaterial = new THREE.MeshPhongMaterial({\n    specular: 0x333333,\n    shininess: 5,\n    map: textureLoader.load(`${base}/oss/textures/planets/earth_atmos_2048.jpg`),\n    specularMap: textureLoader.load(`${base}/oss/textures/planets/earth_specular_2048.jpg`),\n    normalMap: textureLoader.load(`${base}/oss/textures/planets/earth_normal_2048.jpg`),\n    normalScale: new THREE.Vector2(0.85, 0.85)\n  })\n  const earth = new THREE.Mesh(earthGeometry, earthMaterial)\n  earth.name = 'earth'\n\n  const label = createCSS2DDom({\n    name: `\n      <div class=\"bg\"></div>\n      <span class=\"inner\">Earth</span>\n    `,\n    className: 'dot-2D-label',\n    position: [0, EARTH_RADIUS, 0],\n    onClick: e => {\n      // 注意event的坐标，因为css2dobject是绝对定位 + transform\n      console.log('click', e)\n      ElMessage.success('click Earth ！')\n    }\n  })\n\n  earth.add(label)\n\n  return earth\n}\n\n// 月球\nconst MOON_RADIUS = 40\nconst createMoon = () => {\n  const moonGeometry = new THREE.SphereGeometry(MOON_RADIUS, 160, 160)\n  const moonMaterial = new THREE.MeshPhongMaterial({\n    shininess: 5,\n    map: textureLoader.load(`${base}/oss/textures/planets/moon_1024.jpg`)\n  })\n  const moon = new THREE.Mesh(moonGeometry, moonMaterial)\n  moon.position.set(0, 100, 0)\n\n  const moonDiv = document.createElement('div')\n  moonDiv.className = 'dot'\n  moonDiv.innerHTML = `\n    <div class=\"bg\"></div>\n    <span class=\"inner\">Moon</span>\n  `\n  // 重点,因为css2d渲染器我们设置了pointerEvents = none\n  moonDiv.style.pointerEvents = 'auto'\n  moonDiv.addEventListener('click', e => {\n    // 注意event的坐标，因为css2dobject是绝对定位 + transform\n    console.log('click', e)\n    ElMessage.success('click Moon ！')\n  })\n\n  const moonLabel = new CSS2DObject(moonDiv)\n  moonLabel.position.set(0, MOON_RADIUS, 0)\n  moon.add(moonLabel)\n\n  return moon\n}\n\nexport class Css2dScene extends ThreeScene.Scene {\n  gui: InstanceType<typeof GUI>\n\n  css2DRender?: InstanceType<typeof Hooks.CSS2DRenderer>\n  moon: InstanceType<typeof THREE.Mesh>\n\n  constructor(options: ConstructorParameters<typeof ThreeScene.Scene>[0]) {\n    super(options)\n\n    this.createClock()\n    backgroundLoad(this.scene, '201')\n\n    this.css2DRender = initCSS2DRender(this.options, this.container)\n    this.css2DRender.domElement.className = 'three-scene__dot-wrap'\n\n    const earth = createEarth()\n    this.addObject(earth)\n\n    const moon = createMoon()\n    this.moon = moon\n    this.addObject(moon)\n\n    this.gui = new GUI()\n    this.addGui()\n  }\n\n  addGui() {\n    const gui = this.gui\n\n    const params = {\n      display: () => {\n        this.scene.children.forEach((obj: any) => {\n          if (obj.isMesh) {\n            const ele = obj.children.find(it => it.isCSS2DObject)\n            ele.visible = !ele.visible\n          }\n        })\n      },\n      earth: () => {\n        const earth = this.scene.children.find(it => it.name == 'earth')\n        if (earth) {\n          earth.clear()\n          this.scene.remove(earth)\n        } else {\n          const earth = createEarth()\n          this.addObject(earth)\n        }\n      }\n    }\n\n    gui.add(params, 'display').name('隐藏/展示')\n    gui.add(params, 'earth').name('删除/添加地球')\n\n    gui.domElement.className += ' gui-wrap'\n    this.container.parentNode?.appendChild(gui.domElement)\n  }\n\n  resize(): void {\n    super.resize()\n    const { height, width } = this.options\n    this.css2DRender?.setSize(height, width)\n  }\n\n  modelAnimate(): void {\n    this.css2DRender?.render(this.scene, this.camera)\n\n    // 流失时间\n    const elapsed = this.clock?.getElapsedTime() || 0\n    this.moon.position.set(Math.sin(elapsed) * 200, 0, Math.cos(elapsed) * 200)\n  }\n\n  dispose(): void {\n    super.dispose()\n\n    this.css2DRender = void 0\n  }\n}\n","<template>\n  <div class=\"three-page\" :class=\"$style.page\">\n    <div class=\"h-100\" ref=\"containerRef\"></div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { Css2dScene } from './methods'\nimport { useResize } from '@/hooks/scene-resize'\n\nconst containerRef = ref()\n\nconst options: ConstructorParameters<typeof Css2dScene>[0] = {\n  grid: {\n    visible: true\n  }\n}\nlet scene: InstanceType<typeof Css2dScene>\n\nonMounted(() => {\n  options.container = containerRef.value\n  scene = new Css2dScene(options)\n  scene.run()\n  useResize(scene).resize()\n})\n</script>\n\n<style lang=\"scss\" module>\n@import './style.scss';\n</style>\n"],"names":["textureLoader","THREE.TextureLoader","Hooks","ThreeScene.Hooks","backgroundLoad","useBackground","initCSS2DRender","createCSS2DDom","useCSS2D","createEarth","earthGeometry","THREE.SphereGeometry","earthMaterial","THREE.MeshPhongMaterial","specular","shininess","map","load","specularMap","normalMap","normalScale","THREE.Vector2","earth","THREE.Mesh","name","label","className","position","onClick","e","console","log","ElMessage","success","add","Css2dScene","ThreeScene.Scene","constructor","options","super","__publicField","this","createClock","scene","css2DRender","container","domElement","addObject","moon","moonGeometry","moonMaterial","set","moonDiv","document","createElement","innerHTML","style","pointerEvents","addEventListener","moonLabel","CSS2DObject","createMoon","gui","GUI","addGui","params","display","children","forEach","obj","isMesh","ele","find","it","isCSS2DObject","visible","clear","remove","_a","parentNode","appendChild","resize","height","width","setSize","modelAnimate","render","camera","elapsed","_b","clock","getElapsedTime","Math","sin","cos","dispose","containerRef","ref","grid","onMounted","value","run","useResize"],"mappings":"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"}