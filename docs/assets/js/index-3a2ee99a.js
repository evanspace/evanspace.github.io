var t=Object.defineProperty,e=(e,o,s)=>(((e,o,s)=>{o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s})(e,"symbol"!=typeof o?o+"":o,s),s);import{u as o,t as s}from"./css2d-eec57338.js";import{e as i,A as n,_ as r}from"./index-b0c68379.js";import{be as a,bv as c,cm as l,cn as h,b7 as u,bs as d,cw as p,c as m,bh as g,e as f,Y as y,i as _,l as v,f as b,aa as k,o as x,g as C,h as G,u as w,n as j,q as A,F as D,r as z,t as P,a9 as O,B as M}from"./vendor-a6dc29a3.js";import{d as S,T,u as F}from"./scene-resize-46f23ed0.js";import{u as R}from"./raycaster-0fb433c0.js";import{u as B,a as $}from"./move-animate-51ecb3d0.js";import{u as E}from"./fence-f4feeecc.js";import{j as N,l as U,k as L,c as I,a as H,d as J,b as V}from"./model-a663f9ee.js";import{u as K}from"./background-c7faf259.js";import{u as W}from"./model-loader-d0c7c921.js";import{u as Q}from"./dialog-85faa7c0.js";import"./config-9a637eb0.js";import"./posZ-54c73ffc.js";const Y="ANCHOR_POS",q="ANCHOR_TARGET",Z="MAIN_SCENE",X="ROBOT",tt="CHARACTER",et="floor_common",ot="OPEN_DOOR",st=27.5,it=100,nt=300,{raycaster:rt,pointer:at,update:ct,style:lt}=R(),{initCSS2DRender:ht,createCSS2DDom:ut}=o(),{createDiffusion:dt,updateDiffusion:pt}=B(),{createMove:mt,moveAnimate:gt}=$(),{createFence:ft,fenceAnimate:yt}=E(),{createRoam:_t,executeRoam:vt,pause:bt,play:kt,getStatus:xt}=(()=>{let t,e={runing:!1,segment:2,close:!0,tension:0,offset:0,points:[],factor:1,speed:1,index:0,animateBack:void 0};const o=(o={})=>{if(t)return;e=S({runing:!1,segment:2,close:!0,tension:0,offset:0,points:[],factor:1,speed:1,index:0,animateBack:void 0},o);const{points:i,tension:n,close:r}=e,l=[];for(let t=0;t<i.length;t++){const e=i[t];l.push(new a(e[0],e[1],e[2]))}t=new c(l,r,"catmullrom",n??0),t=new c(s(),r,"catmullrom",n??0)},s=()=>null==t?void 0:t.getPoints(i()),i=()=>1e3*(e.segment??2),n=(t,e)=>new a(e.x,e.y+t,e.z);return{createRoam:o,updateRoam:(t={})=>{e=S(e,t)},executeRoam:(o,s)=>{if(!o||!s)return;if(!t)return;const{runing:r,offset:a,factor:c,speed:l,animateBack:h}=e;if(!r)return;e.index+=c*l;const u=i(),d=e.index%u/u;let p=d+.01;p>1&&(p-=1);const m=t.getPointAt(p),g=n(a,t.getPointAt(d)),f=n(a,m);s.target=f,o._lookAt_=f,o.lookAt(s.target),"function"==typeof h&&h(g,m,t,d)},pause:()=>{e.runing=!1},play:()=>{e.runing=!0},reset:e=>{t=void 0,o(e)},getStatus:()=>e.runing}})(),{floorAnimate:Ct}=((t={})=>{const e=S({mode:"BA",margin:50},t),o=(t,e,o,s)=>{0!==e.length&&e.forEach((e=>{const i=e._position_,n="UD"==t?(i.y??0)+o:i.y??0,r="BA"==t?(i.z??0)+s:i.z??0;new l(e.position).to({y:n,z:r},500).easing(h.Quadratic.Out).start()}))};return{floorAnimate:(t,s,i)=>{var n;const r=void 0!==s&&s>-1,{margin:a,mode:c}=e;for(let e=0;e<t.length;e++){const u=t[e],d=u._position_;const p=(e-(r?s:e))*a;let m=(d.y??0)+p,g=s==e?(d.z??0)+a:d.z??0;const f=s===e&&("UD"===c&&m===u.position.y||"BA"===c&&g===u.position.z);if(f&&(m=d.y??0,g=d.z??0),"UD"===c){if(u.position.y===m)continue}else if("BA"===c&&u.position.z===g)continue;if(null==(n=u.data)?void 0:n.mark){const t=i(u.data.mark);let n=s==e?a:0;f&&(n=0),o(c,t,p,n)}new l(u.position).to({y:"UD"===c?m:u.position.y,z:"BA"===c?g:u.position.z},500).easing(h.Quadratic.Out).start()}}}})(),Gt="FULL",wt="NPC";class jt extends T{constructor(t,o){super(t),e(this,"buildingGroup"),e(this,"anchorGroup"),e(this,"dotGroup"),e(this,"extend"),e(this,"css2DRender"),e(this,"mouseClickDiffusion"),e(this,"character"),e(this,"floorGroup"),e(this,"clock"),e(this,"currentSight"),e(this,"historyTarget"),e(this,"historyCameraPosition"),e(this,"animateModels"),e(this,"moveFactor",1),e(this,"fence"),this.extend=o,this.css2DRender=ht(this.options,this.container),this.css2DRender.domElement.className="three-scene__dot-wrap",this.mouseClickDiffusion=dt(4,void 0,6),this.mouseClickDiffusion.rotation.x=.5*-Math.PI,this.mouseClickDiffusion.position.y=.5,this.mouseClickDiffusion.visible=!1,this.addObject(this.mouseClickDiffusion),this.clock=new u,this.currentSight=Gt,this.historyTarget=new a,this.historyCameraPosition=new a,this.animateModels=[],this.bindEvent(),this.addBuildingGroup(),this.addFloorGroup(),this.addAnchorGroup(),this.addDotGroup()}addBuildingGroup(){const t=new d;t.name="建筑组",this.buildingGroup=t,this.addObject(t)}clearBuilding(){this.buildingGroup&&this.disposeObj(this.buildingGroup),this.animateModels=[],this.addBuildingGroup(),this.clearAnchor(),this.clearDot(),this.clearFloor()}addBuilding(...t){this.buildingGroup&&this.buildingGroup.add(...t)}addAnchorGroup(){const t=new d;t.name="锚点组",this.anchorGroup=t,this.addObject(t)}clearAnchor(){this.anchorGroup&&this.disposeObj(this.anchorGroup),this.addAnchorGroup()}addAnchor(t){this.anchorGroup&&this.anchorGroup.add(t);const{x:e,y:o,z:s}=t.position;N(t,[e,o,s],1,8)}addDotGroup(){const t=new d;t.name="点位组",this.dotGroup=t,this.addObject(t)}clearDot(){this.dotGroup&&this.disposeObj(this.dotGroup),this.addDotGroup()}addDot(t,e){const o=t.position,{size:s,color:i}=t.font||{},{x:n=0,y:r=0,z:a=0}=o||{},c=ut({name:`\n        <div class="bg"></div>\n        <span class="inner" style="${null!=s?`font-size: ${"string"==typeof s?s:s+"px"};`:""} ${null!=i?`color: ${i}`:""}"></span>\n      `,className:"dot-2D-label",position:[n,r,a],onClick:e});return c.name=t.name,c.data=t,c._position_={x:n,y:r,z:a},this.dotGroup.add(c),c}addFloorGroup(){const t=new d;t.name="楼层组",this.floorGroup=t,this.addObject(t)}clearFloor(){this.floorGroup&&this.disposeObj(this.floorGroup),this.addFloorGroup()}addFloor(...t){this.floorGroup&&this.floorGroup.add(...t)}addCharacter(t,e){const{x:o,y:s,z:i}=e;t.position.set(o,s,i),this.character=t;const n=t.animations,r=new p(t),a={};for(let h=0;h<n.length;h++){const t=n[h],e=r.clipAction(t);a[t.name]=e}const c="Idle";a[c].play();const l=a.Walking;t.extra={key:c,mixer:r,actions:a,runging:l},this.addObject(t)}changeCharacterAction(){let{key:t,actions:e}=this.character.extra;const o=["Idle","Running","Dance","Death","Sitting","Standing","Jump","Punch","ThumbsUp","WalkJump","Yes","No","Wave"];let s=o.findIndex((e=>e===t))||0;e[t].stop(),s++,s>=o.length&&(s=0),t=o[s],e[t].play(),m.success({message:["空闲","跑步","舞蹈","死亡","坐着","站立","弹跳","出拳","点赞","行走跳跃","点头","摇头","打招呼"][s],grouping:!0}),this.character.extra.key=t}toggleSight(){if(this.judgeCruise())return;const t=this.currentSight==Gt?wt:Gt;this.currentSight=t;const e=t===wt;this.controls.maxDistance=e?20:800,this.controls.screenSpacePanning=!e,this.controls.enablePan=!e;const o=this.controls.target,s=this.character.position;if(e)this.historyTarget=(new a).copy(this.controls.target),this.historyCameraPosition=(new a).copy(this.camera.position),this.camera.lookAt((new a).copy(s));else{const{x:t,y:e,z:o}=this.historyCameraPosition;this.camera.position.set(t,e,o),this.camera.lookAt(s)}const{x:i,y:n,z:r}=e?s:this.historyTarget;o.set(i,n,r)}isPerspectives(){return this.currentSight==wt}characterAccelerate(t=1){this.moveFactor+=t,this.moveFactor>=10?this.moveFactor=10:this.moveFactor<=1&&(this.moveFactor=1),m.success({message:"人物速度："+this.moveFactor,grouping:!0})}setControlTarget(t){const{x:e,y:o,z:s}=t;this.controls.target.set(e,o+3,s),this.camera.lookAt(this.controls.target)}mouseClickGround(t){if(this.currentSight!==wt)return Promise.reject();const e=this.character;if(!e)return Promise.reject();const{runing:o}=this.options.cruise;if(o)return Promise.reject();const s=t.point,i=this.mouseClickDiffusion,{runging:n}=e.extra;n.play();const{x:r,y:a,z:c}=s;return i.position.set(r,a,c),i.visible=!0,new Promise((t=>{mt(e,s,(t=>{this.setControlTarget(t)}),(o=>{this.setControlTarget(o),n.stop(),i.visible=!1,t(e)}))}))}getAnimTargetPos(t,e,o){const s=e||t.to||{x:-104,y:7,z:58},i=o||t.target||{x:0,y:0,z:0};return this.controls.target.set(i.x,i.y,i.z),s}addModelAnimate(t,e=[],o=!0,s=1){if(!e.length)return;const i=new p(t),n=e.reduce(((t,e)=>{const n=e.name||"";return t[n]=i.clipAction(e),o&&t[n].play(),t[n].timeScale=s,t}),{});t.__action__=n,t.__mixer__=i,this.animateModels.push(t)}cameraTransition(t){var e;if(this.judgeCruise())return;if(this.mouseClickDiffusion.visible)return void m.warning({message:"人物移动中，不可操作！",grouping:!0});this.isPerspectives()&&this.toggleSight();const{to:o,target:s=t.position}=t.data;if(!o)return;this.isCameraMove(o)||U(this.controls,this.camera,o,s);const{bind:i}=t.data;if(!i)return;const n=null==(e=this.buildingGroup)?void 0:e.getObjectByName(i);this.addFence(n)}addFence(t){if(this.fence&&(this.disposeObj(this.fence),this.fence=void 0),t){const e=ft(t,5439406);this.fence=e,this.addObject(e)}}cameraLookatMoveTo(t){return new Promise(((e,o)=>{if(xt())return m.warning({message:"请退出漫游！",grouping:!0}),void o(!1);this.controls.maxDistance=100,L(this.camera,t,this.controls.target).then((()=>{this.controls.maxDistance=800,e(this.camera)}))}))}toggleCruise(t){xt()?m.warning({message:"请退出漫游！",grouping:!0}):super.toggleCruise(t)}judgeCruise(){return this.options.cruise.runing?(m.warning({message:"请退出巡航！",grouping:!0}),!0):!!xt()&&(m.warning({message:"请退出漫游！",grouping:!0}),!0)}controlReset(){this.judgeCruise()||(this.isPerspectives()&&this.toggleSight(),super.controlReset())}toggleRoam(){if(xt())return bt(),void(this.controls.maxDistance=800);const t=this.extend.roamPoints||[];0!=t.length&&(this.controls.maxDistance=20,_t({points:t,tension:.3}),kt())}floorExpand(t){const e=t.data,o=this.getFloorByGroup(e.group);if(!o.length)return;const s=o.findIndex((e=>t.uuid===e.uuid));Ct(o,s,(t=>this.getFlowMark(t)))}toCoolMachineRoom(t){let e=this.historyTarget,o=this.historyCameraPosition;t&&(this.historyTarget=(new a).copy(this.controls.target),this.historyCameraPosition=(new a).copy(this.camera.position),e={x:-171.5,y:-6.5,z:125.2},o={x:-169.5,y:34.9,z:46.1}),U(this.controls,this.camera,o,e)}openTheDoor(t){const e=this.scene.getObjectByName(t.data.bind);e&&(e.__open__=!e.__open__,new l(e.rotation).to({y:e.__open__?.5*Math.PI:0},1500).delay(0).start())}modelAnimate(){this.css2DRender.render(this.scene,this.camera),"function"==typeof this.extend.animateCall&&this.extend.animateCall(),this.restoreAnchorMaterial();let t=this.clock.getDelta();if(this.animateModels.length&&this.animateModels.forEach((e=>{e.__mixer__&&e.__mixer__.update(t)})),this.anchorGroup.children.forEach((e=>{e.__mixer__&&e.__mixer__.update(t)})),this.character){this.character.extra.mixer.update(t),gt(.5*this.moveFactor)}this.mouseClickDiffusion.visible&&pt(),yt(),vt(this.camera,this.controls)}onDblclick(t){var e;const o=this.container,s=this.options.scale;if(ct(t,o,s),this.floorGroup){rt.setFromCamera(at,this.camera);const t=this.floorGroup.children,o=rt.intersectObjects(t);if(o.length){const t=o[0].object,s=this.findParentGroup(t);if(!s)return;"function"==typeof(null==(e=this.extend)?void 0:e.onDblclick)&&this.extend.onDblclick(s)}}}onPointerMove(t){this.checkIntersectObjects(t)}onPointerUp(t){var e;super.onPointerUp(t);const o=t.timeStamp-this.pointer.tsp<nt;2==t.button?o&&"function"==typeof(null==(e=this.extend)?void 0:e.onClickRight)&&this.extend.onClickRight(t):0==t.button?o&&this.checkIntersectObjects(t):t.button}checkIntersectObjects(t){var e,o,s;const i=this.container,n=this.options.scale;ct(t,i,n);let r="pointerdown"==t.type||"pointerup"==t.type;const a=this.buildingGroup.children.filter((t=>t.visible&&(r||t.__ground__))).concat(this.anchorGroup.children);rt.setFromCamera(at,this.camera);let c=rt.intersectObjects(a,r);if(r)if(i.style.cursor="auto",c.length){const t=c[0],s=t.object,i="string"==typeof s.name&&(this.extend.groundMeshName||[]).some((t=>s.name.indexOf(t)>-1)),n=this.findParentGroup(s);if(i&&"function"==typeof(null==(e=this.extend)?void 0:e.onClickGround)&&this.extend.onClickGround(n,t),!n)return;"function"==typeof(null==(o=this.extend)?void 0:o.onClickLeft)&&this.extend.onClickLeft(n,t)}else"function"==typeof(null==(s=this.extend)?void 0:s.onClickLeft)&&this.extend.onClickLeft();else this.hoverAnchor(c)}hoverAnchor(t){if("function"==typeof this.extend.onHoverAnchor&&this.extend.onHoverAnchor(t[0],lt),t.length){const e=t[0].object;if(this.container.style.cursor=e._isAnchor_?"pointer":"auto",!e._isAnchor_)return;const o=e.material;void 0===e.__mat_color__&&(e.__mat_color__=o.color),o.color=new g(16715760),this.anchorGroup.children.forEach((t=>{t.__change_color__=t.uuid===e.uuid}))}else this.container.style.cursor="auto",this.anchorGroup.children.forEach((t=>{t.__change_color__=!1}))}restoreAnchorMaterial(){this.anchorGroup.traverse((t=>{t.isSprite&&!t.__change_color__&&t.__mat_color__&&(t.material.color=t.__mat_color__)}))}findParentGroup(t){const e=t=>{if(t._isBuilding_)return t;let o=t.parent;return o?o&&o._isBuilding_?o:e(o):void 0};return e(t)}getAll(){return this.buildingGroup.children.concat(this.dotGroup.children).concat(this.floorGroup.children).concat(this.anchorGroup.children)}getFloorByGroup(t){return this.floorGroup.children.filter((e=>e.data.group===t))}getFlowMark(t){return this.getAll().filter((e=>{var o;return(null==(o=e.data)?void 0:o.followMark)===t}))}resize(){super.resize();const{width:t,height:e}=this.options;this.css2DRender.setSize(t,e)}dispose(){this.animateModels=[],this.disposeObj(this.buildingGroup),this.disposeObj(this.character),this.disposeObj(this.dotGroup),this.disposeObj(this.anchorGroup),this.disposeObj(this.fence),this.disposeObj(this.mouseClickDiffusion),this.disposeObj(this.floorGroup),this.clock=null,this.css2DRender=null,this.buildingGroup=null,this.character=null,this.dotGroup=null,this.anchorGroup=null,this.fence=null,this.mouseClickDiffusion=null,this.floorGroup=null,this.extend={},super.dispose()}}const At=(t,e)=>{const o=40*Math.random();return void 0!==o&&(t.value=o),t.show=Math.random()>.5,t.value=Number(Number(t.value||0).toFixed(2)),{value:t.value,show:t.show,font:{...t.font||{},color:"#"+(16777215+1e6*o).toString(16).substring(0,6)}}},Dt={class:"scene-operation"},zt=["onClick"],Pt=["innerHTML"],Ot=r(f({__name:"index",setup(t){const e=y((o=(t,e,o,s)=>{if(ht){(s+=.02)>1&&(s-=1),t=((t,e=0)=>new a(t.x,t.y+e,t.z))(o.getPointAt(s));let i=s+.001;i>1&&(i-=1),e=o.getPointAt(i),ht.position.set(t.x,st,t.z);const n=Math.atan2(-e.z+t.z,e.x-t.x);ht.rotation.z=.5*Math.PI+n}},{devEnv:!1,baseUrl:"",bgColor:"",skyCode:"221",env:"/oss/textures/hdr/6.hdr",dotKey:"DOT",dotShowStrict:!1,config:{},anchorType:[Y,q,ot],animationModelType:[Z],floorModelType:[et],models:[{key:Z,name:"场景",size:49.8,url:"/深圳北站.glb"},{key:"machine_room",name:"机房",size:3.7,url:"/机房.glb"},{key:"building",name:"楼宇",size:.3,url:"/楼宇.glb"},{key:"residential",name:"居民楼",size:.08,url:"/居民楼.glb"},{key:"small_residential",name:"小型居民楼",size:.08,url:"/小型居民楼.glb"},{key:et,name:"楼层",size:6.3,url:"/楼层.glb"},{key:Y,name:"定位",type:"sprite",range:{x:4,y:4},mapUrl:"/pos.png"},{key:q,name:"锚点",type:"sprite",range:{x:4,y:4},mapUrl:"/dw.png"},{key:ot,name:"开门",type:"sprite",range:{x:2,y:2},mapUrl:"/pos.png"},{key:X,name:"机器人",size:.3,url:"/oss/model/park/机器人.glb"},{key:tt,name:"人物",size:2.2,url:"/oss/model/park/RobotExpressive.glb"}].map((t=>(t.url&&t.url.indexOf("oss")<0&&(t.url="/oss/model/station"+t.url),t.mapUrl&&(t.mapUrl="/oss/textures/station"+t.mapUrl),t))),cruise:{visible:!0,auto:!0,mapUrl:"/oss/textures/cruise/line5.png",repeat:[.1,1],width:2,segment:100,tension:0,speed:20,mapSpeed:.01,points:[[102.5,st,9.9],[102.5,st,291.9],[76,st,291.9],[76,st,129],[-76,st,129],[-76,st,291.9],[-107.7,st,291.9],[-107.7,st,9.9]],offset:1.8,animateBack:o},roamPoints:[[-286,it,257],[286,it,257],[286,it,-600],[-286,it,-600]]}));var o;const r=y({show:!1,style:{left:0,top:0},msg:""}),{changeBackground:c,backgroundLoad:l}=K(),{progress:h,loadModels:u,getModel:d,virtualization:p,closeVirtualization:g}=W({baseUrl:e.baseUrl,indexDB:{cache:!0,dbName:"THREE__STATION__DB",tbName:"TB",version:28}}),{options:f}=Q(),S=_(),T={baseUrl:e.baseUrl,env:e.env,cruise:e.cruise,controls:{enableDamping:!0,dampingFactor:.48,maxPolarAngle:.48*Math.PI,maxDistance:800},directionalLight:{intensity:2.2}};let R;v((()=>{T.container=S.value,R=new jt(T,{groundMeshName:["行走地面","平面125","平面126","平面127","平面128","平面129","平面130","楼梯","机房地面","地面002","立方体128","立方体780_1"],roamPoints:e.roamPoints,onDblclick:t=>{R.floorExpand(t)},onClickLeft:(t,e)=>{if(f.select=[],f.show=!1,t&&t.data){const e=t.data;switch(null==e?void 0:e.type){case Y:R.cameraTransition(t);break;case q:f.select=[t],lt();break;case ot:R.openTheDoor(t)}}},onClickGround:(t,e)=>{R.mouseClickGround(e).then((t=>{})).catch((()=>{}))},onHoverAnchor:(t,e)=>{const o=!!t&&t.object._isAnchor_;if(r.show=o,o){r.style.top=e.top,r.style.left=e.left;const o=t.object.data;r.msg=`\n          <p>${o.name}</p>\n          <p>类型：${o.type}</p>\n          <p>绑定：${o.bind||"无"}</p>\n        `}},animateCall:()=>{if(f.show&&f.select.length){const t=f.select[0];ct(t)}}}),R.run(),F(R).resize(),B()}));const B=()=>{N(),l(R,e.skyCode)},$=_([]),E=b((()=>$.value.filter((t=>t.type===Y)))),N=()=>{u(e.models,(()=>{i.get(n.d3.station).then((async t=>{let o={};if(t.ConfigJson instanceof Object)o=t.ConfigJson;else if("string"==typeof t.ConfigJson)try{o=JSON.parse(t.ConfigJson)}catch(s){}$.value=t.JsonList,Object.keys(o).forEach((t=>{e.config&&(e.config[t]=o[t])})),await U(),ut(),dt()}))}))},U=async()=>{h.percentage=100,h.show=!1,R.clearBuilding(),await k(),await L(),R.setCruisePoint(e.cruise.points);const t=R.getAnimTargetPos(e.config||{});I(R.camera,t,R.controls.target).then((()=>{R.controlSave()}))},L=()=>{let t=0,e=$.value.length;return new Promise((o=>{if(0==e)return o(null);const s=async()=>{const i=$.value[t];await nt(i),t++,t<e?s():o(t)};s()}))},nt=async t=>{if(!t)return;const{type:o}=t,s=d(o);if(!s)return void(o===e.dotKey&&at(t));const{anchorType:i=[],animationModelType:n=[],floorModelType:r=[]}=e;let a=J(s);const{position:c,scale:l,rotation:h}=V(a,t),[u,p,m]=c;return a.scale.set(...l),a.position.set(u,p,m),a.rotation.set(...h),a._isBuilding_=!0,a.data=t,n.includes(o)&&R.addModelAnimate(a,s.animations,!0,1),(t.followMark||t.mark)&&(a._position_={x:u,y:p,z:m}),i.includes(o)?(a._isAnchor_=!0,R.addAnchor(a)):r.includes(o)?(a._position_={x:u,y:p,z:m},a._isFloor_=!0,R.addFloor(a)):R.addBuilding(a),Promise.resolve()},rt=t=>{var o;const s=t.data;{const t=At(s,R.buildingGroup);"object"==typeof t&&Object.keys(t).forEach((e=>{s[e]=t[e]}))}t.visible=s.show||!e.dotShowStrict;const i=null==(o=t.element)?void 0:o.getElementsByClassName("inner")[0];if(i){const{size:t,color:e}=s.font||{};null!=t&&(i.style.fontSize="string"==typeof t?t:t+"px"),null!=e&&(i.style.color=e),i.textContent=`${s.value||0}${s.unit}`}},at=t=>{rt(R.addDot(t,((e,o)=>{f.select=[o],lt(),R.cameraLookatMoveTo(t.position).then((()=>{}))})))},ct=t=>{const e=S.value,o=H(e,t,R.camera);return f.position=o,f.style.left=o.left+"px",f.style.top=o.top+"px",o},lt=()=>{const t=f.select[0].data;f.data=t,f.title=(null==t?void 0:t.name)||"",f.list=[{name:"属性 1",value:(100*Math.random()).toFixed(2),unit:"%"},{name:"属性 2",value:(100*Math.random()).toFixed(2),unit:"%"}],f.show=!0};let ht;const ut=()=>{ht=d(X),ht.position.z=st,ht.rotation.z=.5*Math.PI,R.addObject(ht)},dt=()=>{const t=d(tt);t.traverse((t=>{t.isMesh&&(t.castShadow=!0)}));R.addCharacter(t,{x:0,y:27.5,z:122})};return(t,o)=>(x(),C("div",{class:j(t.$style.page)},[G("div",Dt,[G("div",{class:"btn",onClick:o[0]||(o[0]=()=>{R.getAll().forEach(((t,o)=>{t.data&&(t.data.type!==e.dotKey||rt(t))}))})},"随机更新"),G("div",{class:"btn",onClick:o[1]||(o[1]=()=>{var t;return null==(t=w(R))?void 0:t.getPosition()})},"场景坐标")]),G("div",{class:j(t.$style.container),ref_key:"containerRef",ref:S},null,2),A(s,{modelValue:w(h).show,"onUpdate:modelValue":o[2]||(o[2]=t=>w(h).show=t),progress:w(h).percentage},null,8,["modelValue","progress"]),G("div",{class:j(t.$style.camera)},[G("div",{class:j(t.$style.item),onClick:o[3]||(o[3]=()=>{var t;return null==(t=w(R))?void 0:t.toggleRoam()})},"全景漫游",2),G("div",{class:j(t.$style.item),onClick:o[4]||(o[4]=()=>(()=>{var t,e;if(R.judgeCruise())return;R.isPerspectives()&&R.toggleSight();const o=R.scene.getObjectByName("机房");if(!o)return void m.warning({message:"未找到机房模块！",grouping:!0});const s=o.__isFocus__;if(o.__isFocus__=!s,s)return g(null==(t=R.buildingGroup)?void 0:t.children),void R.toCoolMachineRoom(!1);R.toCoolMachineRoom(!0),p(null==(e=R.buildingGroup)?void 0:e.children,o,{wireframe:!0,opacity:.1,filter:["_基础_grp","平面109_1","地面001","地面012","地面002","平面601","平面613","平面642","平面643","平面241","平面243","Landscape001","Landscape002","Landscape003","Landscape008","Landscape009"]})})())},"制冷机房",2),(x(!0),C(D,null,z(w(E),(e=>(x(),C("div",{class:j(t.$style.item),onClick:t=>(t=>{R.cameraTransition({position:t.position,data:t})})(e)},P(e.name),11,zt)))),256))],2),G("div",{class:j([t.$style.camera,t.$style.right])},[G("div",{class:j(t.$style.item),onClick:o[5]||(o[5]=()=>{var t;return null==(t=w(R))?void 0:t.toggleCruise()})},"定点巡航",2),G("div",{class:j(t.$style.item),onClick:o[6]||(o[6]=()=>{var t;return null==(t=w(R))?void 0:t.controlReset()})},"视角重置",2),G("div",{class:j(t.$style.item),onClick:o[7]||(o[7]=()=>w(R).toggleSight())},"人物视角",2),G("div",{class:j(t.$style.item),onClick:o[8]||(o[8]=()=>w(R).changeCharacterAction())},"人物动作",2),G("div",{class:j(t.$style.item),onClick:o[9]||(o[9]=()=>w(R).characterAccelerate())},"人物加速",2),G("div",{class:j(t.$style.item),onClick:o[10]||(o[10]=()=>w(R).characterAccelerate(-1))},"人物减速",2),G("div",{class:j(t.$style.item),onClick:o[11]||(o[11]=()=>w(c)(w(R)))},"切换背景",2)],2),w(r).show?(x(),C("div",{key:0,class:j(t.$style.tip),style:O({left:w(r).style.left+"px",top:w(r).style.top+"px"})},[G("div",{class:j(t.$style.msg),innerHTML:w(r).msg},null,10,Pt)],6)):M("",!0),w(f).show?(x(),C("div",{key:1,class:j(t.$style.dialog),style:O(w(f).style)},[G("div",{class:j(t.$style.wrap)},[G("div",null,P(w(f).title),1),G("div",{class:j(t.$style.content)},[(x(!0),C(D,null,z(w(f).list,(e=>(x(),C("div",{class:j(t.$style.item)},[G("span",null,P(e.name)+"：",1),G("span",null,P(e.value)+P(e.unit||""),1)],2)))),256))],2)],2)],6)):M("",!0)],2))}}),[["__cssModules",{$style:{page:"_page_ogs1y_2",container:"_container_ogs1y_10",tip:"_tip_ogs1y_14",dialog:"_dialog_ogs1y_15",msg:"_msg_ogs1y_24",wrap:"_wrap_ogs1y_38",title:"_title_ogs1y_49",content:"_content_ogs1y_52",item:"_item_ogs1y_55",camera:"_camera_ogs1y_62",right:"_right_ogs1y_69"}}]]);export{Ot as default};
