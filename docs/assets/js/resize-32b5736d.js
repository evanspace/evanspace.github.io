var t=Object.defineProperty,e=(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s);import{ba as i,bc as s,aW as n,cg as o,bj as r,bf as a,bg as h,b1 as c,aX as l,aY as d,aZ as p,be as m,bb as b,w as g,af as f}from"./vendor-1d4f44c1.js";import{u as w}from"./common-d9edda56.js";const u=t=>((t,e)=>Object.prototype.toString.call(e)===`[object ${t}]`)("Object",t),y=(t,e=new Map)=>{if(null!=t&&u(t)){let i=e.get(t);if(i)return i;const s=Array.isArray(t);let n=s?[]:{};return i=e.set(t,n),s?t.forEach(((t,e)=>{n[e]=y(t,i)})):Object.keys(t).forEach((e=>{u(n[e])?n[e]=y(t[e],i):n[e]=t[e]})),n}return t},v=(t,e)=>{t=y(t);for(let i in e)i in t&&u(e[i])&&u(t[i])?t[i]=v(t[i],e[i]):t[i]=e[i];return t},j={container:document.body,width:window.innerWidth,height:window.innerHeight,bgColor:null,scale:1,fog:{visible:!1,near:100,far:1e3},controls:{visible:!0,enableDamping:!1,dampingFactor:.25,autoRotate:!1,enableZoom:!0,enablePan:!0,screenSpacePanning:!0,minDistance:1,maxDistance:2e3},lightHelperVisible:!1,ambientLight:{visible:!0,color:16777215,intensity:1.5},directionalLight:{visible:!0,light2:!0,color:16777215,intensity:1.5},camera:{near:1,far:1e4,position:[-350,510,700]},grid:{visible:!1,opacity:.3,transparent:!0},axes:{visible:!1,size:50}};class x{constructor(t={}){e(this,"options"),e(this,"container"),e(this,"scene"),e(this,"renderer"),e(this,"camera"),e(this,"controls"),e(this,"animationId"),e(this,"clear",(t=>{t&&t.traverse&&(t.traverse((t=>{t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose(),null==t||t.clear()})),null==t||t.clear())})),e(this,"disposeObj",(t=>{t&&t.traverse&&(t.traverse((t=>{t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose(),null==t||t.clear()})),null==t||t.clear(),this.scene.remove(t))}));const s=j;var n;this.options=v(s,t),(n=this.options.container)&&("object"==typeof HTMLElement?n instanceof HTMLElement:n&&"object"==typeof n&&1===n.nodeType&&"string"==typeof n.nodeName)?this.container=this.options.container:this.container=document.querySelector(this.options.container),this.options.width=this.container.offsetWidth,this.options.height=this.container.offsetHeight,this.scene=new i,this.renderer=this.initRenderer(),this.init(),this.camera=this.initCamera(),this.controls=this.initControls()}init(){this.initLight(),this.initGrid(),this.initAxes(),this.initModel()}run(){this.loop()}loop(){this.animationId=window.requestAnimationFrame((()=>{this.loop()})),this.animate(),this.modelAnimate()}animate(){this.renderer&&this.renderer.render(this.scene,this.camera),this.options.controls.visible&&this.controls.update(),s()}initModel(){}modelAnimate(){}initRenderer(){const{width:t,height:e,bgColor:i}=this.options,s=new n({antialias:!0});if(this.setBgColor(i),this.options.fog.visible){const{color:t,near:e,far:i}=this.options.fog;this.scene.fog=new o(t??this.scene.background,e,i)}return s.shadowMap.enabled=!0,s.shadowMap.type=r,s.setSize(t,e),s.setPixelRatio(window.devicePixelRatio),this.container.appendChild(s.domElement),s}initLight(){const{ambientLight:t,directionalLight:e,lightHelperVisible:i}=this.options;if(t.visible){const e=new a(t.color,t.intensity);this.addObject(e)}if(e.visible){const t=this.createDirectionalLight();if(this.addObject(t),i){const e=new h(t,1);this.addObject(e)}if(e.light2){const t=this.createDirectionalLight(!1);if(t.position.set(-500,800,-800),this.addObject(t),i){const e=new h(t,1);this.addObject(e)}}}}createDirectionalLight(t=!0,e=800,i=4096,s=1,n=2e3){const{color:o,intensity:r}=this.options.directionalLight,a=new c(o,r);if(a.position.set(500,800,800),t){a.shadow.mapSize.setScalar(i),a.shadow.bias=-1e-5,a.shadow.normalBias=.01,a.castShadow=t;const o=a.shadow.camera;o.radius=10,o.near=s,o.far=n,o.top=o.right=e,o.left=o.bottom=-e,o.updateProjectionMatrix()}return a}initCamera(){const{width:t,height:e,camera:i}=this.options,s=new l(36,t/e,i.near,i.far);return s.position.set(...i.position),this.addObject(s),s}initControls(){const t=this.options.controls;if(!t.visible)return;const e=new d(this.camera,this.renderer.domElement);return Object.keys(t).forEach((i=>{e[i]=t[i]})),e.target.set(0,0,0),e}initGrid(){const t=this.options.grid;if(!t.visible)return;let e=new p(800,80,10592673,10592673);e.material.opacity=t.opacity,e.material.transparent=t.transparent,this.addObject(e)}initAxes(){if(!this.options.axes.visible)return;let t=new m(this.options.axes.size);this.addObject(t)}setBgColor(t){this.scene.background=t?new b(t):null}addObject(t){Array.isArray(t)?this.scene.add(...t):this.scene.add(t)}resize(){if(!this.camera)return;this.options.width=this.container.offsetWidth||window.innerWidth,this.options.height=this.container.offsetHeight||window.innerHeight;const{width:t,height:e}=this.options,i=t/e;this.camera.aspect=i,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e)}stopAnimate(){window.cancelAnimationFrame(this.animationId)}dispose(){try{this.scene.clear(),this.renderer.dispose(),this.renderer.forceContextLoss(),this.renderer.content=null;let t=this.renderer.domElement.getContext("webgl");t&&t.getExtension("WEBGL_lose_context").loseContext()}catch(t){}}}const L=t=>({resize:()=>{const e=()=>null==t?void 0:t.resize();g((()=>w().sidebar.opened),(()=>{setTimeout(e,300)})),window.addEventListener("resize",e,!1),f((()=>{null==t||t.stopAnimate(),null==t||t.dispose(),window.removeEventListener("resize",e)}))}});export{x as T,v as d,L as u};
