var e=Object.defineProperty,s=(s,t,a)=>(((s,t,a)=>{t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a})(s,"symbol"!=typeof t?t+"":t,a),a);import{di as t,dt as a,dx as r,bA as n,bt as i,dE as o,dF as l,dC as d,bz as u,dG as h,dH as p,dg as c,dI as m,dJ as f,dK as b,dL as y,dB as w,dA as g,dM as O,dN as S,dO as G,bx as v,dP as x,dy as B,by as C,dQ as R,c as E,h as I,k as M,o as _,f as N,g as T,n as A}from"./vendor-d07051c1.js";import{S as W,u as j}from"./scene-resize-03d1dd3d.js";import{_ as z}from"./index-ca31967b.js";const U={glb:"https://ye6.atomgit.net/3d-demo-data/models/csg/bunny.glb",operation:m,wireframe:!1,displayBrushes:!1,shadows:!0,useGroups:!0,consolidateGroups:!0},F=new Map,D=new t({opacity:.15,transparent:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:.1,polygonOffsetUnits:.1,side:a,premultipliedAlpha:!0,roughness:.25,color:5099745}),L=50;let H=new r;H.attributes=["position","normal"],H.useGroups=!1;class P extends W{constructor(e){super(e),s(this,"bunnyBrush"),s(this,"brushResult"),s(this,"wireframeResult"),s(this,"brushes"),s(this,"surfaceSampler"),this.brushes=[],this.addModel()}initModel(){const e=new n(new i(1e3,1e3),new o({color:16442329,transparent:!0,opacity:.35,side:a}));e.rotation.x=-Math.PI/2,e.scale.setScalar(10),e.receiveShadow=!0,this.addObject(e)}async addModel(){const e=await(async()=>{const e=(await(new O).setMeshoptDecoder(S).loadAsync(U.glb)).scene.children[0];e.updateMatrixWorld();const s=e.geometry.clone(),r=new G,n=new v(0,0,0),i=new R,o=new x,l=new v(L,L,L);i.setFromEuler(o),r.compose(n,i,l),s.applyMatrix4(r),s.computeVertexNormals();const d=new B(s,new t);return d.updateMatrixWorld(),d.name="兔子",d.material.opacity=.15,d.material.transparent=!0,d.material.depthWrite=!1,d.material.polygonOffset=!0,d.material.polygonOffsetFactor=.1,d.material.polygonOffsetUnits=.1,d.material.side=a,d.material.premultipliedAlpha=!0,d.material.color.set(14743546),d})();this.bunnyBrush=e,this.addObject(e);const s=new l(e);s.build(),this.surfaceSampler=s;const{brushes:r,material:i}=(e=>{let s=[];for(let t=0;t<50;t++){const t=new B(new C(50,15,15),D);t.receiveShadow=!0,e.add(t),s.push(t)}return{brushes:s,material:D}})(this.scene);let o;this.brushes=r,o=e.material.clone(),o.opacity=1,o.transparent=!1,o.depthWrite=!0,F.set(e.material,o),o=i.clone(),o.opacity=1,o.transparent=!1,o.depthWrite=!0,F.set(i,o);const h=new n(new d,new t({roughness:.1,flatShading:!1,polygonOffset:!0,polygonOffsetUnits:L,polygonOffsetFactor:L}));h.castShadow=!0,h.receiveShadow=!0,this.brushResult=h,this.addObject(h);const p=new n(h.geometry,new u({wireframe:!0,color:0,opacity:.15,transparent:!0}));p.material.color.set(5398),this.wireframeResult=p,this.addObject(p),this.randomizeBrushes(),this.updateCSG(),this.createGUI()}randomizeBrushes(){const e=this.surfaceSampler;if(!e)return;const s=this.brushes,t=this.bunnyBrush;if(t)for(let a=0;a<s.length;a++){const r=s[a];e.sample(r.position),r.position.applyMatrix4(t.matrixWorld),r.scale.setScalar(h.lerp(.05,.15,Math.random())),r.updateMatrixWorld()}}updateCSG(){const{brushes:e,bunnyBrush:s,brushResult:t}=this;if(!s||!t)return;let a=e[0];H.useGroups=U.useGroups,H.consolidateGroups=U.consolidateGroups;for(let r=1,n=e.length;r<n;r++){const s=e[r];a=H.evaluate(a,s,p),a.material=D}H.evaluate(s,a,U.operation,t),t.material=U.useGroups?t.material.map((e=>F.get(e))):F.get(s.material)}createGUI(){var e;const s=new c;s.add(U,"operation",{ADDITION:p,SUBTRACTION:m,REVERSE_SUBTRACTION:f,INTERSECTION:b,DIFFERENCE:y,HOLLOW_SUBTRACTION:w,HOLLOW_INTERSECTION:g}).name("布尔类型").onChange((()=>{this.updateCSG()})),s.add(U,"wireframe").name("线框材质"),s.add(U,"displayBrushes").name("计算元素"),s.add(U,"useGroups").name("使用组合").onChange((()=>{this.updateCSG()})),s.add(U,"consolidateGroups").name("合并组").onChange((()=>{this.updateCSG()})),s.add({randomize:()=>{this.randomizeBrushes(),this.updateCSG()}},"randomize").name("随机更新"),s.domElement.style="position: absolute; top: 10px; right: 10px",null==(e=this.container)||e.appendChild(s.domElement)}modelAnimate(){this.bunnyBrush&&(this.bunnyBrush.visible=U.displayBrushes),this.brushes.length&&this.brushes.forEach((e=>e.visible=U.displayBrushes)),this.wireframeResult&&(this.wireframeResult.visible=U.wireframe)}}const k=z(E({__name:"index",setup(e){const s=I(),t={camera:{position:[0,80,300]},render:{alpha:!0},grid:{visible:!0},axes:{visible:!0}};let a;return M((()=>{t.container=s.value,a=new P(t),a.run(),j(a).resize()})),(e,t)=>(_(),N("div",{class:A([e.$style.page,"h-100 o-h"])},[T("div",{ref_key:"containerRef",ref:s,class:"h-100"},null,512)],2))}}),[["__cssModules",{$style:{page:"_page_12f6y_2"}}]]);export{k as default};
