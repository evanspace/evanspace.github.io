var e=Object.defineProperty,t=(t,s,n)=>(((t,s,n)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n})(t,"symbol"!=typeof s?s+"":s,n),n);import{p as s,E as n,u as o}from"./scene-resize-03d250ff.js";import{bG as a,eY as i,by as r,di as c,eX as u,eU as l,eV as d,eW as p,f2 as m,bu as h,eZ as g,bA as b,bw as f,dU as y,e as w,i as v,l as x,o as j,g as P,h as O}from"./vendor-b9b94b6b.js";import"./index-7b2b7d31.js";const N=new a,{pass:T,mrt:D,output:I,emissive:M,float:B}=i,{createDiffusion:V}=s.useDiffusion2(),E=i.uniform(1);class R extends n{constructor(e){super(e),t(this,"group",new r),t(this,"postProcessing"),t(this,"gui",new c),t(this,"createPostProcessing",((e,t,s,n)=>{const o=T(e,t);n?o.setMRT(D({output:I,emissive:M})):o.setMRT(D({output:I,bloomIntensity:B(.01)}));const a=o.getTextureNode();let i;if(n){const e=o.getTextureNode("emissive");i=l(e,2.5,.5)}else{const e=o.getTextureNode("bloomIntensity");i=l(a.mul(e))}s.toneMapping=d;const r=new p(s);return n?r.outputNode=a.add(i):(r.outputColorTransform=!1,r.outputNode=a.add(i).renderOutput()),r})),this.setDebounceDuration(1e3),this.postProcessing=this.createPostProcessing(this.scene,this.camera,this.renderer),console.log(this),this.addObject(this.group),this.addModel(),this.addGui()}render(){var e;null==(e=this.postProcessing)||e.renderAsync()}createRender(){return new u(this.options.render)}addModel(){const e=this.createDiffusion(1,6404586);e.rotation.x=.5*-Math.PI,this.addObject(e),e.geometry.computeBoundingBox();const t=V({textureSrc:"/oss/textures/diffusion/101.png",bloomIntensity:E},m);t.position.x=3,t.geometry.computeBoundingBox(),this.addObject(t)}createDiffusion(e=1,t){const s=new h(e,e),n=new g({color:t,opacity:.8,map:N.load("/oss/textures/diffusion/101.png"),transparent:!0,depthTest:!0,side:b});n.mrtNode=i.mrt({bloomIntensity:E});const o=new f(s,n),a=.1;return o.scale.setScalar(a),o.tween1=new y({scale:a,opacity:0}).to({scale:1.6,opacity:1},500).delay(0).onUpdate((e=>{let{scale:t,opacity:s}=e;o.scale.setScalar(t),o.material.opacity=s})),o.tween2=new y({scale:1.6,opacity:1}).to({scale:2.1,opacity:0},500).onUpdate((e=>{let{scale:t,opacity:s}=e;o.scale.setScalar(t),o.material.opacity=s})),o.tween1.chain(o.tween2),o.tween2.chain(o.tween1),o.tween1.start(),o}modelAnimate(){this.debounce((()=>{}))}checkObjects(){const e=this.getVisibleObjects();console.log("Visible objects:",e)}getVisibleObjects(){const e=this.getFrustum(),t=[];return this.scene.traverseVisible((s=>{s instanceof f&&this.frustumIntersectsBox(e,s)&&t.push(s)})),t}addGui(){var e;const t=this.gui;t.add(E,"value",0,1,.01).name("发光强度"),t.domElement.className+=" gui-wrap",null==(e=this.container.parentElement)||e.appendChild(t.domElement)}}const S={class:"three-page"},U=w({__name:"index",setup(e){const t=v(),s={container:t.value,render:{antialias:!0},grid:{visible:!0},camera:{near:1e-10,position:[0,5,2]}};let n=null;return x((()=>{s.container=t.value,n=new R(s).run(),o(n).resize()})),(e,s)=>(j(),P("div",S,[O("div",{class:"h-100",ref_key:"containerRef",ref:t},null,512)]))}});export{U as default};
