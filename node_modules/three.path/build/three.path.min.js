// github.com/shawn0326/three.path
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).THREE=t.THREE||{},t.THREE)}(this,(function(t,e){"use strict";function r(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(r){if("default"!==r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}})),e.default=t,Object.freeze(e)}var i=r(e),s=function(){function t(){this.pos=new i.Vector3,this.dir=new i.Vector3,this.right=new i.Vector3,this.up=new i.Vector3,this.dist=0,this.widthScale=1,this.sharp=!1}var e=t.prototype;return e.lerpPathPoints=function(t,e,r){this.pos.lerpVectors(t.pos,e.pos,r),this.dir.lerpVectors(t.dir,e.dir,r),this.up.lerpVectors(t.up,e.up,r),this.right.lerpVectors(t.right,e.right,r),this.dist=(e.dist-t.dist)*r+t.dist,this.widthScale=(e.widthScale-t.widthScale)*r+t.widthScale},e.copy=function(t){this.pos.copy(t.pos),this.dir.copy(t.dir),this.up.copy(t.up),this.right.copy(t.right),this.dist=t.dist,this.widthScale=t.widthScale},t}(),a=new i.Vector3,n=new i.Vector3,o=new i.Vector3,u=new i.Matrix4,h=new i.QuadraticBezierCurve3;var c=function(){function t(){this.array=[],this.count=0}var e=t.prototype;return e.set=function(t,e,r,s,a){if(void 0===e&&(e=.1),void 0===r&&(r=10),void 0===s&&(s=null),void 0===a&&(a=!1),(t=t.slice(0)).length<2)return console.warn("PathPointList: points length less than 2."),void(this.count=0);a&&!t[0].equals(t[t.length-1])&&t.push((new i.Vector3).copy(t[0]));for(var n=0,o=t.length;n<o;n++)if(0===n)this._start(t[n],t[n+1],s);else if(n===o-1)if(a){this._corner(t[n],t[1],e,r,s);var u=this.array[0].dist;this.array[0].copy(this.array[this.count-1]),this.array[0].dist=u}else this._end(t[n]);else this._corner(t[n],t[n+1],e,r,s)},e.distance=function(){return this.count>0?this.array[this.count-1].dist:0},e._getByIndex=function(t){return this.array[t]||(this.array[t]=new s),this.array[t]},e._start=function(t,e,r){this.count=0;var i=this._getByIndex(this.count);if(i.pos.copy(t),i.dir.subVectors(e,t),r)i.up.copy(r);else{var s=Number.MAX_VALUE,a=Math.abs(i.dir.x),n=Math.abs(i.dir.y),o=Math.abs(i.dir.z);a<s&&(s=a,i.up.set(1,0,0)),n<s&&(s=n,i.up.set(0,1,0)),o<s&&i.up.set(0,0,1)}i.right.crossVectors(i.dir,i.up).normalize(),i.up.crossVectors(i.right,i.dir).normalize(),i.dist=0,i.widthScale=1,i.sharp=!1,i.dir.normalize(),this.count++},e._end=function(t){var e=this.array[this.count-1],r=this._getByIndex(this.count);r.pos.copy(t),r.dir.subVectors(t,e.pos);var i=r.dir.length();r.dir.normalize(),r.up.copy(e.up);var s=a.crossVectors(e.dir,r.dir);if(s.length()>Number.EPSILON){s.normalize();var n=Math.acos(Math.min(Math.max(e.dir.dot(r.dir),-1),1));r.up.applyMatrix4(u.makeRotationAxis(s,n))}r.right.crossVectors(r.dir,r.up).normalize(),r.dist=e.dist+i,r.widthScale=1,r.sharp=!1,this.count++},e._corner=function(t,e,r,i,s){if(r>0&&i>0){for(var o=function(t,e,r,i,s,o){var u=a.subVectors(e,t),h=n.subVectors(r,e),c=u.length(),d=h.length();u.normalize(),h.normalize();var p=Math.min(.999999*(s?c/2:c),i);o.v0.copy(e).sub(u.multiplyScalar(p)),o.v1.copy(e);var l=Math.min(d/2*.999999,i);return o.v2.copy(e).add(h.multiplyScalar(l)),o}(this.array[this.count-1].pos,t,e,r,this.count-1==0,h),u=o.getPoints(i),c=0;c<i;c++)this._sharpCorner(u[c],u[c+1],s,0===c?1:0);u[i].equals(e)||this._sharpCorner(u[i],e,s,2)}else this._sharpCorner(t,e,s,0,!0)},e._sharpCorner=function(t,e,r,i,s){void 0===i&&(i=0),void 0===s&&(s=!1);var h=this.array[this.count-1],c=this._getByIndex(this.count),d=a.subVectors(t,h.pos),p=n.subVectors(e,t),l=d.length();if(d.normalize(),p.normalize(),c.pos.copy(t),1===i?c.dir.copy(d):2===i?c.dir.copy(p):(c.dir.addVectors(d,p),c.dir.normalize()),r)1===c.dir.dot(r)?c.right.crossVectors(p,r).normalize():c.right.crossVectors(c.dir,r).normalize(),c.up.crossVectors(c.right,c.dir).normalize();else{c.up.copy(h.up);var y=o.crossVectors(h.dir,c.dir);if(y.length()>Number.EPSILON){y.normalize();var f=Math.acos(Math.min(Math.max(h.dir.dot(c.dir),-1),1));c.up.applyMatrix4(u.makeRotationAxis(y,f))}c.right.crossVectors(c.dir,c.up).normalize()}c.dist=h.dist+l;var g=d.dot(p);c.widthScale=Math.min(1/Math.sqrt((1+g)/2),1.415)||1,c.sharp=Math.abs(g-1)>.05&&s,this.count++},t}();function d(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,p(t,e)}function p(t,e){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},p(t,e)}var l=function(t){function e(e,r){var i;return void 0===e&&(e=3e3),void 0===r&&(r=!1),i=t.call(this)||this,isNaN(e)?i._initByData(e.pathPointList,e.options,e.usage,r):i._initByMaxVertex(e,r),i}d(e,t);var r=e.prototype;return r._initByMaxVertex=function(t,e){this.setAttribute("position",new i.BufferAttribute(new Float32Array(3*t),3).setUsage(i.DynamicDrawUsage)),this.setAttribute("normal",new i.BufferAttribute(new Float32Array(3*t),3).setUsage(i.DynamicDrawUsage)),this.setAttribute("uv",new i.BufferAttribute(new Float32Array(2*t),2).setUsage(i.DynamicDrawUsage)),e&&this.setAttribute("uv2",new i.BufferAttribute(new Float32Array(2*t),2).setUsage(i.DynamicDrawUsage)),this.drawRange.start=0,this.drawRange.count=0,this.setIndex(t>65536?new i.Uint32BufferAttribute(3*t,1):new i.Uint16BufferAttribute(3*t,1))},r._initByData=function(t,e,r,s){void 0===e&&(e={});var a=y(t,e,s);a&&0!==a.count?(this.setAttribute("position",new i.BufferAttribute(new Float32Array(a.position),3).setUsage(r||i.StaticDrawUsage)),this.setAttribute("normal",new i.BufferAttribute(new Float32Array(a.normal),3).setUsage(r||i.StaticDrawUsage)),this.setAttribute("uv",new i.BufferAttribute(new Float32Array(a.uv),2).setUsage(r||i.StaticDrawUsage)),s&&this.setAttribute("uv2",new i.BufferAttribute(new Float32Array(a.uv2),2).setUsage(r||i.StaticDrawUsage)),this.setIndex(a.position.length/3>65536?new i.Uint32BufferAttribute(a.indices,1):new i.Uint16BufferAttribute(a.indices,1))):this._initByMaxVertex(2,s)},r.update=function(t,e){void 0===e&&(e={});var r=!!this.getAttribute("uv2"),i=y(t,e,r);i?(this._updateAttributes(i.position,i.normal,i.uv,r?i.uv2:null,i.indices),this.drawRange.count=i.count):this.drawRange.count=0},r._resizeAttribute=function(t,e){for(var r=this.getAttribute(t);r.array.length<e;){var s=r.array.length,a=new i.BufferAttribute(new Float32Array(2*s),r.itemSize,r.normalized);a.name=r.name,a.usage=r.usage,this.setAttribute(t,a),r=a}},r._resizeIndex=function(t){for(var e=this.getIndex();e.array.length<t;){var r=e.array.length,s=new i.BufferAttribute(2*r>65535?new Uint32Array(2*r):new Uint16Array(2*r),1);s.name=e.name,s.usage=e.usage,this.setIndex(s),e=s}},r._updateAttributes=function(t,e,r,i,s){this._resizeAttribute("position",t.length);var a=this.getAttribute("position");a.array.set(t,0),a.updateRange.count=t.length,a.needsUpdate=!0,this._resizeAttribute("normal",e.length);var n=this.getAttribute("normal");n.array.set(e,0),n.updateRange.count=e.length,n.needsUpdate=!0,this._resizeAttribute("uv",r.length);var o=this.getAttribute("uv");if(o.array.set(r,0),o.updateRange.count=r.length,o.needsUpdate=!0,i){this._resizeAttribute("uv2",i.length);var u=this.getAttribute("uv2");u.array.set(i,0),u.updateRange.count=i.length,u.needsUpdate=!0}this._resizeIndex(s.length);var h=this.getIndex();h.set(s,0),h.updateRange.count=s.length,h.needsUpdate=!0},e}(i.BufferGeometry);function y(t,e,r){void 0===r&&(r=!1);var a=e.width||.1,n=void 0!==e.progress?e.progress:1,o=void 0===e.arrow||e.arrow,u=void 0!==e.side?e.side:"both",h=a/2,c="both"!==u?a/2:a,d=t.distance(),p=n*d;if(0==d)return null;var l=h/c,y=h/d,f=0,g=[],v=[],w=[],b=[],A=[],m=0,x=new i.Vector3,z=new i.Vector3,V=new i.Vector3,_=new i.Vector3,U=new i.Vector3,B=new i.Vector3;function S(t){var e=0===g.length,i=t.sharp&&!e,s=t.dist/c,a=t.dist/d,n=t.dir,o=t.up,p=t.right;if("left"!==u?x.copy(p).multiplyScalar(h*t.widthScale):x.set(0,0,0),"right"!==u?z.copy(p).multiplyScalar(-h*t.widthScale):z.set(0,0,0),x.add(t.pos),z.add(t.pos),i){V.fromArray(g,g.length-6).sub(z),_.fromArray(g,g.length-3).sub(x);var S,M,P=V.length()-_.length();P>0?(S=V,M=z):(S=_,M=x),U.copy(S).setLength(Math.abs(P)).add(M);var D=B.copy(M).sub(U).normalize().dot(n)*B.copy(M).sub(U).length()*2;B.copy(n).setLength(D).add(U),P>0?(g.push(U.x,U.y,U.z,x.x,x.y,x.z,z.x,z.y,z.z,x.x,x.y,x.z,B.x,B.y,B.z,x.x,x.y,x.z),m+=6,A.push(m-6,m-8,m-7,m-6,m-7,m-5,m-4,m-6,m-5,m-2,m-4,m-1),f+=12):(g.push(z.x,z.y,z.z,U.x,U.y,U.z,z.x,z.y,z.z,x.x,x.y,x.z,z.x,z.y,z.z,B.x,B.y,B.z),m+=6,A.push(m-6,m-8,m-7,m-6,m-7,m-5,m-6,m-5,m-3,m-2,m-3,m-1),f+=12),v.push(o.x,o.y,o.z,o.x,o.y,o.z,o.x,o.y,o.z,o.x,o.y,o.z,o.x,o.y,o.z,o.x,o.y,o.z),w.push(s-l,0,s-l,1,s,0,s,1,s+l,0,s+l,1),r&&b.push(a-y,0,a-y,1,a,0,a,1,a+y,0,a+y,1)}else g.push(z.x,z.y,z.z,x.x,x.y,x.z),v.push(o.x,o.y,o.z,o.x,o.y,o.z),w.push(s,0,s,1),r&&b.push(a,0,a,1),m+=2,e||(A.push(m-2,m-4,m-3,m-2,m-3,m-1),f+=6)}var M,P=new i.Vector3;if(p>0)for(var D=0;D<t.count;D++){var R=t.array[D];if(R.dist>p){var I=t.array[D-1];M=new s;var O=(p-I.dist)/(R.dist-I.dist);M.lerpPathPoints(I,R,O),S(M);break}S(R)}else M=t.array[0];return o&&function(t){var e=t.dir,i=t.up,s=t.right,n=t.dist/c,o=t.dist/d;"left"!==u?x.copy(s).multiplyScalar(2*h):x.set(0,0,0),"right"!==u?z.copy(s).multiplyScalar(2*-h):z.set(0,0,0),P.copy(e).setLength(3*h),x.add(t.pos),z.add(t.pos),P.add(t.pos),g.push(z.x,z.y,z.z,x.x,x.y,x.z,P.x,P.y,P.z),v.push(i.x,i.y,i.z,i.x,i.y,i.z,i.x,i.y,i.z),w.push(n,"both"!==u?"right"!==u?-2:0:-.5,n,"both"!==u?"left"!==u?2:0:1.5,n+1.5,"both"!==u?0:.5),r&&b.push(o,"both"!==u?"right"!==u?-2:0:-.5,o,"both"!==u?"left"!==u?2:0:1.5,o+1.5*a/d,"both"!==u?0:.5),m+=3,A.push(m-1,m-3,m-2),f+=3}(M=M||t.array[t.count-1]),{position:g,normal:v,uv:w,uv2:b,indices:A,count:f}}var f=function(t){function e(e,r){return void 0===e&&(e=1e3),void 0===r&&(r=!1),t.call(this,e,r)||this}d(e,t);var r=e.prototype;return r._initByData=function(t,e,r,s){void 0===e&&(e={});var a=g(t,e,s);a&&0!==a.count?(this.setAttribute("position",new i.BufferAttribute(new Float32Array(a.position),3).setUsage(r||i.StaticDrawUsage)),this.setAttribute("normal",new i.BufferAttribute(new Float32Array(a.normal),3).setUsage(r||i.StaticDrawUsage)),this.setAttribute("uv",new i.BufferAttribute(new Float32Array(a.uv),2).setUsage(r||i.StaticDrawUsage)),s&&this.setAttribute("uv2",new i.BufferAttribute(new Float32Array(a.uv2),2).setUsage(r||i.StaticDrawUsage)),this.setIndex(a.position.length/3>65536?new i.Uint32BufferAttribute(a.indices,1):new i.Uint16BufferAttribute(a.indices,1))):this._initByMaxVertex(2,s)},r.update=function(t,e){void 0===e&&(e={});var r=!!this.getAttribute("uv2"),i=g(t,e,r);i?(this._updateAttributes(i.position,i.normal,i.uv,r?i.uv2:null,i.indices),this.drawRange.count=i.count):this.drawRange.count=0},e}(l);function g(t,e,r){void 0===r&&(r=!1);var a=e.radius||.1,n=void 0!==e.progress?e.progress:1,o=Math.max(2,e.radialSegments||8),u=e.startRad||0,h=2*a*Math.PI,c=t.distance(),d=n*c;if(0==d)return null;var p=0,l=[],y=[],f=[],g=[],v=[],w=0,b=new i.Vector3;function A(t,e,i){for(var s=0===l.length,a=t.dist/h,n=t.dist/c,o=0;o<=i;o++){var d=o;d==i&&(d=0),b.copy(t.up).applyAxisAngle(t.dir,u+2*Math.PI*d/i).normalize(),l.push(t.pos.x+b.x*e*t.widthScale,t.pos.y+b.y*e*t.widthScale,t.pos.z+b.z*e*t.widthScale),y.push(b.x,b.y,b.z),f.push(a,o/i),r&&g.push(n,o/i),w++}if(!s)for(var A=w-2*(i+1),m=w-(i+1),x=0;x<i;x++)v.push(m+x,A+x,A+x+1,m+x,A+x+1,m+x+1),p+=6}if(d>0)for(var m=0;m<t.count;m++){var x=t.array[m];if(x.dist>d){var z=t.array[m-1],V=new s,_=(d-z.dist)/(x.dist-z.dist);V.lerpPathPoints(z,x,_),A(V,a,o);break}A(x,a,o)}return{position:l,normal:y,uv:f,uv2:g,indices:v,count:p}}t.PathGeometry=l,t.PathPointList=c,t.PathTubeGeometry=f,Object.defineProperty(t,"__esModule",{value:!0})}));
